"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[3096],{17404:(e,t,i)=>{i.d(t,{z:()=>n});var r=i(95113),s=i(45609);const n=(0,r.Z)(s.Z,{valueKey:"checked",valuePath:"target.checked",shouldInject:!1})},23407:(e,t,i)=>{i.d(t,{H:()=>n});var r=i(95113),s=i(91321);const n=(0,r.Z)(s.Z,{valuePath:"target.value"})},38823:(e,t,i)=>{i.d(t,{i:()=>n});var r=i(95113),s=i(5741);const n=(0,r.Z)(s.Z);n.Option=s.Z.Option,n.OptGroup=s.Z.OptGroup},60838:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(14437),s=i(81135);const n=function(e){return((e,t)=>({value:s.U2(e.values,t),error:s.U2(e.errors,t),touched:s.U2(e.touched,t)}))((0,r.Z)(),e)}},56475:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(18571),s=i(43230);function n(){return(0,r.useContext)(s.mC)}},79337:(e,t,i)=>{i.d(t,{EG:()=>g.Z,Ex:()=>c.Z,FN:()=>f.Z,FX:()=>d.Z,Form:()=>_.Z,HH:()=>w.H,II:()=>a.Z,J2:()=>l.Z,Lt:()=>o.Z,Ph:()=>p.Z,Q2:()=>y.Z,Vp:()=>h.Z,XQ:()=>S.Z,XZ:()=>s.ZP,Y8:()=>u.ZP,ih:()=>b.i,tL:()=>k.Z,u:()=>v.Z,u_:()=>n.Z,yC:()=>m.Z,z8:()=>C.z,zx:()=>r.Z});i(4037);var r=i(46995),s=i(47225),n=i(49576),o=i(34072),a=i(99373),l=i(28246),c=i(50382),u=i(71762),d=i(91321),p=i(5741),m=i(72271),h=i(41986),g=i(81884),f=i(34994),v=i(39362),_=i(42915),S=i(56475),k=i(60838),y=i(95113),b=i(38823),C=i(17404),w=i(23407)},37964:(e,t,i)=>{i.d(t,{S:()=>v,w:()=>f});var r=i(18571),s=i(70126),n=i(54275),o=i(18751),a=i.n(o),l=i(79337),c=i(42716),u=i(51091),d=i(12803),p=i(36958),m=i(93747),h=i(72322);const g=(0,r.forwardRef)(((e,t)=>{const{tooltipProps:i,getPopupContainer:s,onClosePopover:o,position:c,cursor:u="default"}=e,[g,f]=(0,r.useState)(!0),[v,_]=(0,r.useState)(!1),{top:S}=c,k=c.left-10,y=(0,r.useRef)(null),b=(0,r.useRef)(null),C=(0,n.Z)((()=>{var e;null===(e=b.current)||void 0===e||e.destroy(),_(!1),f(!1)})),w=(0,n.Z)((()=>{var e;const t=s().querySelector(`.${m.Z.tooltipWrapper}`);if(!t||(null===(e=b.current)||void 0===e?void 0:e.tooltipWrapper)===t)return;t.addEventListener("animationend",C);const i=new d.B;i.timeout(500).then(C),b.current={tooltipWrapper:t,destroy:()=>{t.removeEventListener("animationend",C),i.cancel(),b.current=null}}}));(0,r.useImperativeHandle)(t,(()=>({hide:()=>{w(),_(!0)}})));const x=(0,r.useMemo)((()=>({default:{height:18,width:12},"not-allowed":{height:(0,p.c)()?30:15,width:15}})),[]),I=x[u]||x.default;return(0,h.jsx)(l.u,{autoAdjustOverflow:!0,position:"bottomLeft",motion:!1,...i,className:a()(i.className,m.Z.tooltipWrapper,v&&m.Z.fadingOut),trigger:"custom",visible:g,showArrow:!1,rePosKey:`${S}-${k}`,getPopupContainer:s,onVisibleChange:e=>{var t;!e&&o(),null===(t=i.onVisibleChange)||void 0===t||t.call(i,e)},children:(0,h.jsx)("div",{className:m.Z.point,tabIndex:-1,ref:y,style:{top:S,left:k,...I}})})}));function f(e){const{zIndex:t=1060,cursor:i="default",checkIsTarget:o,getEllipsisDOM:a,...l}=e,d=(0,r.useRef)(null),p=(0,r.useRef)(null),[f,v]=(0,r.useState)(null),{i18n:_}=(0,c.$)(),S=()=>{const{content:e}=l;if("function"!=typeof e)return e;if(!d.current)return null;const{targetElement:t}=d.current;return i=>e({...i,target:t})},k=(0,n.Z)((()=>{d.current&&(d.current.destroy(),d.current=null,v(null))})),y=(0,n.Z)((()=>{var e;null===(e=d.current)||void 0===e||e.destroy(),d.current=null})),b=(0,n.Z)((()=>{d.current&&(d.current.destroy(),d.current=null,v(null))})),C=(0,n.Z)(((e,i)=>{const r=null==a?void 0:a(i);if(r&&r.offsetWidth>=r.scrollWidth)return;if(d.current){if(!d.current.hasLeaved&&d.current.targetElement===i)return;k()}const n=document.createElement("div");n.className=m.Z.root,n.style.zIndex=`${t}`;const o=e=>{v({left:e.clientX,top:e.clientY})},l=e=>{i===e.target&&(d.current&&(d.current.hasLeaved=!0),p.current?p.current.hide():k())};i.addEventListener("mousemove",o),i.addEventListener("mouseleave",l),document.body.appendChild(n);const c=(0,s.createRoot)(n);d.current={container:n,targetElement:i,hasLeaved:!1,reactRoot:c,destroy:()=>{n.remove(),Promise.resolve().then((()=>c.unmount())),i.removeEventListener("mousemove",o),i.removeEventListener("mouseleave",l)}},v({left:e.clientX,top:e.clientY})})),w=(0,n.Z)((e=>{const t=e.currentTarget;C(e,t)})),x=(0,n.Z)((e=>{var t;const i=e.target;(null!==(t=null==o?void 0:o(i))&&void 0!==t?t:e.currentTarget===i)&&C(e,i)}));return(0,r.useLayoutEffect)((()=>y),[]),(0,r.useLayoutEffect)((()=>{(()=>{if(!d.current||!f)return;const{reactRoot:e,container:r}=d.current;r.style.zIndex=`${t}`,e.render((0,h.jsx)(u.a,{i18n:_,children:(0,h.jsx)(g,{ref:p,tooltipProps:{...l,content:S()},getPopupContainer:()=>r,onClosePopover:k,position:f,cursor:i})}))})()})),{handleMouseEnter:w,handleMouseOver:x,destroyTooltip:b}}function v(e={}){const{getEllipsisDOM:t=e=>e,content:i=({target:e})=>e.textContent,...r}=e;return f({...r,getEllipsisDOM:t,content:i})}},45417:(e,t,i)=>{i.d(t,{y:()=>p});var r=i(18571),s=i(18751),n=i.n(s),o=i(79337),a=i(54275),l=i(13928),c=i(66795),u=i(34889),d=i(72322);const p=(0,o.Q2)((e=>{const{className:t,maxLength:i,onChange:s,onCompositionStart:p,onCompositionEnd:m}=e,[h,g]=(0,r.useState)(""),f=(0,r.useRef)(!1),v=(0,a.Z)((e=>void 0===i?e:(0,l.aF)(e,i))),_=(0,a.Z)((e=>{f.current=!0,g(e.currentTarget.value),null==p||p(e)})),S=(0,r.useRef)(null),{saveSelectionIfNeeded:k}=(0,c.u)({getInputElem:()=>S.current}),y=(0,a.Z)(((e,t)=>{k(e),null==s||s(e,t)})),b=(0,a.Z)((e=>{const t=v(e.currentTarget.value);f.current=!1,g(""),y(t,null),null==m||m(e)})),C=(0,a.Z)(((e,t)=>{if(f.current)return void g(e);if(void 0===i)return void y(e,t);const r=v(e);y(r,t)}));return(0,d.jsx)(o.II,{autoComplete:"off",...e,ref:S,className:n()(t,u.Z.input),value:f.current?h:e.value,maxLength:void 0,onChange:C,onCompositionStart:_,onCompositionEnd:b})}))},33921:(e,t,i)=>{i.d(t,{D:()=>g});var r=i(18571),s=i(70126),n=i(54275),o=i(18751),a=i.n(o),l=i(79337),c=i(42716),u=i(51091),d=i(73994),p=i(92888),m=i(72322);const h=e=>{const{position:t,getPopupContainer:i,onClosePopover:s,popoverProps:o}=e,[c,u]=(0,r.useState)(!0),h=(0,n.Z)((()=>u(!1))),g=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{var e;null===(e=g.current)||void 0===e||e.focus()}),[]),(0,m.jsx)(l.J2,{autoAdjustOverflow:!0,position:"bottomLeft",clickToHide:!0,...o,className:a()(o.className,d.i.heycanPopoverWrapperClearStyle),trigger:"custom",visible:c,onEscKeyDown:h,onClickOutSide:h,getPopupContainer:i,onVisibleChange:e=>{var t;!e&&s(),null===(t=o.onVisibleChange)||void 0===t||t.call(o,e)},children:(0,m.jsx)("div",{className:p.Z.point,tabIndex:-1,ref:g,style:{...t}})})};function g(e){const{zIndex:t=1e3,...i}=e,[o,a]=(0,r.useState)(null),[l,d]=(0,r.useState)(null),{i18n:g}=(0,c.$)(),f=(0,n.Z)((()=>{o&&(o.destroy(),a(null),d(null))})),v=(0,n.Z)((()=>{null==o||o.destroy()})),_=(0,n.Z)((e=>{if(o)return;const i=document.createElement("div");i.className=p.Z.root,i.style.zIndex=`${t}`;i.addEventListener("wheel",(e=>{e.currentTarget===i&&(e.preventDefault(),e.stopPropagation())}),!1),window.addEventListener("resize",f),document.body.appendChild(i);const r=(0,s.createRoot)(i);a({container:i,reactRoot:r,destroy:()=>{i.remove(),Promise.resolve().then((()=>r.unmount())),window.removeEventListener("resize",f)}}),d(e)})),S=(0,n.Z)((e=>{e.preventDefault(),e.stopPropagation(),_({left:e.clientX,top:e.clientY})}));return(0,r.useLayoutEffect)((()=>v),[]),(0,r.useLayoutEffect)((()=>{o&&l&&o.reactRoot.render((0,m.jsx)(u.a,{i18n:g,children:(0,m.jsx)(h,{popoverProps:i,getPopupContainer:()=>o.container,onClosePopover:f,position:l})})),o&&(o.container.style.zIndex=`${t}`)})),{handleContextMenu:S}}},84133:(e,t,i)=>{i.d(t,{m:()=>n});var r=i(43582),s=i(72322);function n(e){const{items:t}=e,i=e=>{e.currentTarget===e.target&&e.stopPropagation()};return(0,s.jsx)("div",{className:r.Z.menu,onClick:i,children:(0,s.jsx)("div",{className:r.Z.menuItemContainer,onClick:i,children:t.map((({key:e,render:t},i)=>t({key:e,index:i,className:r.Z.menuItem})))})})}},18774:(e,t,i)=>{i.d(t,{NZ:()=>a,OD:()=>o,RO:()=>s,ci:()=>c,dr:()=>n,kx:()=>l});const r=e=>`https://sf16-web-tos-buz.capcutstatic.com/obj/capcut-web-buz-sg/artist-op-web${e}`,s=`${r("/LoadingScissorsCapCut.d9f5d23b.gif")}`,n=({lang:e,region:t})=>`https://www.capcut.com/clause/creator-agreement?lang=${e}&store_region=${t}`,o=()=>"https://www.capcut.com/clause/original-work-notice?lang=en",a=()=>"https://www.capcut.com/clause/original-work-notice-commercial-material?lang=en",l=()=>"https://www.capcut.com/clause/paid-materials?lang=en";function c(){return`${r("/sticker_template.psd")}`}},93585:(e,t,i)=>{i.d(t,{Z:()=>l});i(18571);var r=i(18751),s=i.n(r),n=i(42716),o=(i(37964),i(26851),i(46796)),a=i(72322);const l=e=>{const{t}=(0,n.$)(),{className:i,boxClassName:r,title:l,children:c,onClickUseAll:u,hiddenFieldLabel:d=!1,required:p=!1}=e;return(0,a.jsxs)("div",{className:s()(o.Z.root,i),children:[!d&&(0,a.jsxs)("div",{className:o.Z.fieldLabel,children:[(0,a.jsx)("div",{className:s()({[o.Z.showRequired]:p}),children:null!=l?l:t("pc_template_authorize_settings_web")}),u&&(0,a.jsx)("span",{className:o.Z.useAll,onClick:u,children:t("pc_material_release_apply_all")})]}),(0,a.jsx)("div",{className:s()(o.Z.box,r),children:c})]})}},14986:(e,t,i)=>{i.d(t,{P:()=>f});var r=i(18571),s=i(18751),n=i.n(s),o=i(79337),a=i(54275),l=i(42716),c=i(52272),u=i(61843),d=i(5065),p=i(71157),m=i(18774),h=i(4973),g=i(72322);const f=({className:e,leftText:t,isPublishDisabled:i,isPublishing:s,needConfirmModalOnClose:f,onPublish:v,beforeCancel:_,onCancel:S})=>{const{t:k}=(0,l.$)(),y=(0,a.Z)((async()=>{if(_&&_(),f){if(await u.Z.warn({mainText:k("pc_sticker_cancel_web"),subText:k("pc_sticker_click_unrecoverable_web"),confirmBtnText:k("pc_stickers_release_confirm_quit_web"),cancelBtnText:k("pc_stickers_release_cancel_web")})!==u.L.Confirm)return}S?S():(0,c.Nt)()})),b=d.YW.Creator,{language:C,region:w}=p.appModel.appInfo,x=(0,r.useMemo)((()=>(0,m.dr)({lang:C,region:w})),[C,w]);return(0,g.jsxs)("div",{className:n()(e,h.Z.root),children:[(0,g.jsx)("div",{className:h.Z.left,onClick:undefined,children:t}),(0,g.jsxs)("div",{className:h.Z.right,children:[(0,g.jsx)("span",{className:h.Z.remind,onClick:()=>{window.open(x,"_blank")},children:k("pc_sticker_release_agree_{X}_web",{X:(0,g.jsx)("span",{className:h.Z.protocol,children:d.rr[b]},"protocol")})}),(0,g.jsxs)("div",{className:h.Z.buttonContainer,children:[(0,g.jsx)(o.zx,{className:h.Z.button,type:"primary",theme:"solid",disabled:i,loading:s,onClick:v,children:k("pc_stickers_release_web")}),(0,g.jsx)(o.zx,{className:h.Z.button,type:"secondary",theme:"solid",onClick:y,children:k("pc_stickers_release_cancel_web")})]})]})]})}},22531:(e,t,i)=>{i.d(t,{u:()=>a});var r=i(18571),s=i(60963),n=i(52272),o=i(20165);function a(e){const t=(0,o.fv)((()=>({get watchResult(){return e.watch()}})));(0,r.useEffect)((()=>{const e=(0,s.EH)((()=>{const e=t.watchResult;(0,n.c0)({isNeed:e})}));return()=>{e()}}),[])}},7022:(e,t,i)=>{i.d(t,{L:()=>a});var r=i(71412),s=i(18571),n=i(60963);const o=5e3;function a({watch:e,collect:t}){const i=(0,s.useMemo)((()=>(0,r.Z)((async()=>{await Promise.resolve(),t()}),o)),[]);(0,s.useEffect)((()=>{const t=(0,n.EH)((()=>{e(),i()}));return()=>{t(),i.cancel()}}),[])}},69508:(e,t,i)=>{i.d(t,{ZP:()=>j});var r=i(18571),s=i(18751),n=i.n(s),o=i(79337),a=i(93556);const l=(0,a.A)((function(e){return r.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.64 16.44a1.5 1.5 0 0 1-2.12 0l-5.66-5.66-5.66 5.66a1.5 1.5 0 1 1-2.12-2.12L10.8 7.6a1.5 1.5 0 0 1 2.12 0l6.72 6.72a1.5 1.5 0 0 1 0 2.12Z",fill:"currentColor"}))}),"chevron_up");const c=(0,a.A)((function(e){return r.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.08 7.6a1.5 1.5 0 0 1 2.12 0l5.66 5.65 5.66-5.65a1.5 1.5 0 1 1 2.12 2.12l-6.72 6.72a1.5 1.5 0 0 1-2.12 0L4.08 9.72a1.5 1.5 0 0 1 0-2.12Z",fill:"currentColor"}))}),"chevron_down");var u=i(79292),d=i(42716),p=i(37964),m=i(73994);const h="root-ZzVTGw",g="title-JCdnyN",f="titleText-Fuw67p",v="opt-YF2iRW",_="optButton-El1KQ1",S="optPrimaryButton-w8QZPM",k="content-fjkxJu",y="fpsField-n8dui5",b="loopFieldRatioGroup-NJIp0Y",C="edit-w0eg3S",w="globalSettings-fCcYV0";var x=i(72322);const I=[{value:!0,label:u.I18n.t("pc_stickers_release_cycle_start_web")},{value:!1,label:u.I18n.t("pc_stickers_release_one_start_web")}],j=e=>{const{className:t,prefix:i,onStartEdit:s,onSave:a,showGlobalSetting:u}=e,j=(0,o.XQ)(),q=(0,o.tL)(i).value,P=(0,r.useMemo)((()=>{const{fps:e=0,loop:t=!1,sequenceSettingsApplyToAll:i=!1}=q||{};return{fps:e,loop:t,sequenceSettingsApplyToAll:i}}),[null==q?void 0:q.fps,null==q?void 0:q.loop,null==q?void 0:q.sequenceSettingsApplyToAll]),[F,L]=(0,r.useState)(!1),[Z,E]=(0,r.useState)(!1),O=(0,r.useRef)(P),{t:U}=(0,d.$)(),R=(0,r.useMemo)((()=>(()=>{const e=[];for(let t=1;t<=49;t++)e.push({label:`${t} FPS`,value:t});return e})()),[]),T=(0,r.useMemo)((()=>F?U("pc_stickers_release_animation_set_web"):`${U("pc_stickers_release_sfps_web",{X:P.fps,Y:P.loop?U("pc_stickers_release_cycle_start_web"):U("pc_stickers_release_one_start_web")})}`),[P,F]),{handleMouseOver:N}=(0,p.S)({checkIsTarget:e=>null!==e.closest(".semi-form-field-label-text, .semi-radio-addon, .semi-checkbox-addon")});return(0,x.jsxs)("div",{className:n()(t,h,{[C]:F}),children:[(0,x.jsxs)("div",{className:g,children:[(0,x.jsx)("div",{className:f,children:T}),(0,x.jsx)("div",{className:v,children:F?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:_,onClick:()=>{j.setValues({[i]:{...q,...O.current}}),L(!1)},children:U("pc_stickers_release_cancel_web")}),(0,x.jsx)("span",{className:S,onClick:()=>{L(!1),a()},children:U("pc_stickers_release_saved_web")})]}):(0,x.jsx)("span",{className:S,onClick:()=>{O.current=P,L(!0),s()},children:U("pc_sticker_edit_web")})})]}),(0,x.jsxs)("div",{className:k,onMouseOver:N,children:[(0,x.jsx)(o.ih,{labelPosition:"left",field:`${i}.fps`,label:U("pc_stickers_release_fps_web"),size:"small",fieldClassName:y,optionList:R,arrowIcon:Z?(0,x.jsx)(l,{}):(0,x.jsx)(c,{}),onDropdownVisibleChange:E}),(0,x.jsx)(o.HH,{fieldClassName:n()(b,m.i.heycanFormFieldEllipsis),className:m.i.heycanRatioGroupEllipsis,direction:"vertical",labelPosition:"left",field:`${i}.loop`,label:U("pc_stickers_release_cycle_set_web"),options:I}),(0,x.jsx)("div",{className:w,hidden:!u,children:(0,x.jsx)(o.z8,{labelPosition:"left",field:`${i}.sequenceSettingsApplyToAll`,fieldClassName:m.i.heycanFormFieldEllipsis,className:m.i.heycanCheckboxEllipsis,label:U("pc_stickers_release_settings_web_web"),children:U("pc_stickers_release_apply_all_frames_web")})})]})]})}},47938:(e,t,i)=>{i.d(t,{n:()=>u});var r=i(18571),s=i(42716),n=i(65625),o=i(18774),a=i(60930),l=i(43130),c=i(72322);const u=(0,n.Pi)((({className:e,sticker:t})=>{var i,n;const{t:u}=(0,s.$)(),d=e=>Object.entries(a.BI[e]).map((([e,t])=>({key:e,title:t}))),p=(0,r.useMemo)((()=>[{key:a.R8.Static,title:u("pc_stickers_release_png_web"),link:{text:u("pc_stickers_release_template_web"),src:(0,o.ci)()},instructions:d(a.R8.Static)},{key:a.R8.GIF,title:u("pc_stickers_release_gif_details_web"),link:{text:u("pc_stickers_release_template_web"),src:(0,o.ci)()},instructions:d(a.R8.GIF)},{key:a.R8.Sequence,title:u("pc_stickers_release_frame_web_web"),link:{text:u("pc_stickers_release_template_web"),src:(0,o.ci)()},instructions:d(a.R8.Sequence)}]),[]);return(0,c.jsx)(l.v,{className:e,groups:p,initGroup:a.R8.Static,activeGroup:null!==(i=null==t?void 0:t.fileType)&&void 0!==i?i:a.R8.Static,resetExpandedGroupKey:null!==(n=null==t?void 0:t.id)&&void 0!==n?n:null,getStatus:(e,i)=>{var r;return i.key!==(null==t?void 0:t.fileType)?"init":null!=t&&null!==(r=t.unmetRequirements)&&void 0!==r&&r.includes(e.key)?"error":"success"}})}))},10758:(e,t,i)=>{i.d(t,{E:()=>L});var r=i(18571),s=i(65625),n=i(42716),o=i(79337),a=i(54290),l=i(45417),c=i(18329),u=i(45220),d=(i(94443),i(69508)),p=i(93585),m=i(54970),h=i(1234),g=i(34549),f=i(52255),v=i(60930),_=i(56230),S=i(48647),k=i(26851);const y="root-U7gnG8",b="label-ySJjwQ",C="useAll-fBQS09",w="cover-_hZQ9Q",x="input-cVWAZF",I="advancedSettingsTitle-4hrFUR",j="fpsSettingsField-JVMreK",q="publishDirectionUseAll-FwKTNi";var P=i(72322);const{Label:F}=o.Form,L=(0,s.Pi)((e=>{const{t}=(0,n.$)(),i=(0,o.XQ)(),{importStickerFileService:s,sticker:L,initFields:Z,controlField:E,authProps:O,onStartEditSequenceSettings:U,onSaveSequenceSettings:R,showPublishDirection:T,sendLogServ:N}=e,{stickerListStore:A}=s,{authConfig:z}=A.materialPostConfig,{mustPaidAuth:D}=z,{postChannel:B,targetedActivityId:$}=L.formState,[M,G]=(0,r.useState)([]);(0,r.useLayoutEffect)((()=>{Z(L)}),[L]),(0,r.useEffect)((()=>{h.$.isEnableAuthorization&&J(!0)}),[h.$.isEnableAuthorization]),(0,r.useEffect)((()=>{M.length||async function(){return(await(0,S.ip)({effect_type:a.Ab.Sticker})).tasks.map((e=>({label:e.title,value:e.task_id})))}().then((e=>{G(e)}))}),[]);const{getDisplayLength:V}=(0,_._)(),J=e=>{A.updateFormState(L,{isVip:e}),null==i||i.setValue("single",{...i.getValue("single"),isVip:e})};return(0,P.jsxs)("div",{className:y,children:[(0,P.jsx)(c.Y,{className:w,src:(0,f.B3)(L),isSelected:!1,isInvalid:L.unmetRequirements.length>0,isUpdating:(0,f.Nf)(L),size:128}),(0,P.jsx)(l.y,{fieldClassName:x,label:t("pc_stickers_release_set_title_web"),field:"single.title",maxLength:v.S8,placeholder:t("pc_stickers_release_xy_name_web",{X:1,Y:V(v.S8)}),rules:[{required:!0,message:""}],onChange:e=>A.updateFormState(L,{title:e})}),(0,P.jsxs)("div",{className:b,children:[(0,P.jsx)(u.u,{fieldClassName:x,label:t("pc_stickers_release_tag_set_web"),placeholder:t("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"single.tags",itemType:a.Ab.Sticker,recommendConfig:{title:L.title,uri:L.largeImageUri},rules:[{required:!0,message:""}],onChange:e=>A.updateFormState(L,{tags:e})}),(0,P.jsx)("span",{className:C,onClick:()=>{var e;null==A||A.applyForTags((null===(e=i.getValue("single"))||void 0===e?void 0:e.tags)||[])},children:t("pc_stickers_release_apply_all_web")})]}),T&&(0,P.jsxs)("div",{className:b,children:[(0,P.jsx)(F,{required:!0,text:t("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,P.jsx)(g.Z,{value:{postChannel:B,activityId:$},onChange:e=>{const t={postChannel:e.postChannel,targetedActivityId:e.activityId};A.updateFormState(L,t)},taskList:M,loading:!M.length,viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/PDNEdbBZxoXibnxSGn5l7U7Xgre?open_in_browser=true",onOrientationViewMoreClick:()=>{null==N||N.sendPageActionLog({action:"click_more_official_task"})}}),(0,P.jsx)("span",{className:q,onClick:()=>{null==N||N.sendPageActionLog({action:"apply_publish_type_to_all"}),A.applyPublishDirectionToAll({postChannel:L.formState.postChannel,targetedActivityId:L.formState.targetedActivityId})},children:t("pc_material_release_apply_all")})]}),!1,O&&(0,P.jsx)(p.Z,{onClickUseAll:()=>{null==N||N.sendPageActionLog({action:"authorize_apply_to_all"});const e=i.getValue("single");null==A||A.applyAuthSettingsToAll({isOriginal:e.isOriginal,isBusiness:e.isBusiness,isVip:e.isVip})},required:D,children:(0,P.jsx)("div",{className:k.Z.authGroup,children:(0,P.jsx)(m.R,{noLabel:!0,field:"single.isVip",disabled:h.$.isEnableAuthorization,disabledTooltip:t("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:D?t("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:O.sendLogServ,onChange:e=>{e&&(null==N||N.sendPageActionLog({action:"choose_subscription_authorize"})),J(e)}})})}),L.isSequence&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:I,children:t("pc_stickers_release_higher_settings_web")}),(0,P.jsx)(d.ZP,{className:j,prefix:"single",showGlobalSetting:!0,onStartEdit:U,onSave:R})]})]})}))},18775:(e,t,i)=>{i.d(t,{M:()=>E,z:()=>O});var r=i(18571),s=i(65625),n=i(18751),o=i.n(n),a=i(26062),l=i(42398),c=i(42716),u=i(18329),d=i(68288),p=i(84133),m=i(60930),h=i(52255),g=i(33921);const f="root-xS65kc",v="statusBar-_dfb1Q",_="contextMenuItem-gUXpM3";var S=i(72322);const k=(0,s.Pi)((e=>{const{className:t,sticker:i,isSelected:r,onClick:s,onReimport:n,onRemove:a}=e,{t:l}=(0,c.$)(),k=(0,h.B3)(i),y=i.unmetRequirements.length>0,{handleContextMenu:b}=(0,g.D)({content:(0,S.jsx)(p.m,{items:[{key:"reimport",render:({key:e,className:t})=>y&&(0,S.jsx)("div",{className:o()(t,_),onClick:()=>n(i),children:l("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:t})=>(0,S.jsx)("div",{className:o()(t,_),onClick:()=>a(i),children:l("pc_stickers_release_delete_web")},e)}]})});return(0,S.jsxs)("div",{className:o()(t,f),onClick:()=>{s(i)},children:[(0,S.jsx)(u.Y,{src:k,isSelected:r,isInvalid:y,isUpdating:(0,h.Nf)(i),size:80,onContextMenu:e=>{b(e),s(i)}}),(0,S.jsx)(d.ir,{className:v,loading:!k,invalid:y,errorToolip:y&&i.unmetRequirements.map((e=>{const t=m.BI[i.fileType][e];return t?(0,S.jsx)("div",{children:t},e):null})),isInfoComplete:i.isInfoComplete,title:i.title})]})}));var y=i(71412),b=i(9459),C=i(177);const w={cursor:"move"},x=(e,t,i)=>i>e&&i<t,I=({children:e,index:t,id:i,className:s,onMoveCard:n,onHoverCard:o,onCardClick:a,startPoint:l,scrollAreaRef:c,stickerListRect:u,onStickerListRect:d})=>{const p=(0,r.useRef)(null),[{handlerId:m},h]=(0,b.L)({accept:"sticker",collect:e=>({handlerId:e.getHandlerId()})}),g=()=>(new Date).getTime()-l.current.clickTime[0]>E,[{isDragging:f},v]=(0,C.c)({type:"sticker",item:()=>({id:i,index:t}),collect:e=>({isDragging:e.isDragging(),monitor:e}),canDrag:()=>g()});h(v(p));const _=e=>{var i,r;if(!c.current||!p.current)return;if(!g())return;const s=c.current.getBoundingClientRect(),{top:n,bottom:a}=s;if(x(n,n+20,e.clientY)&&c.current.scrollTop>0)return c.current.scrollTop-=2,void o(t,-1);if(x(a-20,a,e.clientY)&&c.current.scrollTop+c.current.clientHeight<c.current.scrollHeight)return c.current.scrollTop+=2,void o(t,-1);const{hoverIndex:d,direction:m}=((e,t)=>{const i=e.findIndex((e=>x(e.left,e.right,t.x)&&x(e.top,e.bottom,t.y)));if(i<0)return{hoverIndex:-1,direction:0};const r=(e[i].right+e[i].left)/2;return{hoverIndex:i,direction:t.x<r?-1:0}})(u,{x:e.clientX+((null===(i=l.current.centerOffset)||void 0===i?void 0:i.x)||0),y:e.clientY+((null===(r=l.current.centerOffset)||void 0===r?void 0:r.y)||0)});o(t,d,m)},k=(0,y.Z)((e=>_(e)),20);return(0,r.useEffect)((()=>{if(p.current){const e=p.current.getBoundingClientRect();null==d||d(t,e)}}),[p.current,d,t]),(0,S.jsx)("div",{draggable:!0,ref:p,className:s,style:{...w,opacity:f?0:1},"data-handler-id":m,onDrag:k,onDragStart:e=>{var i;if(!c.current||!p.current)return;a(t);const r=(null===(i=c.current)||void 0===i?void 0:i.scrollTop)||0,s=p.current.getBoundingClientRect();l.current={x:(null==e?void 0:e.clientX)||-1,y:(null==e?void 0:e.clientY)||-1,start:!0,scrollTop:r,centerOffset:{x:(s.left+s.right)/2-e.clientX,y:(s.top+s.bottom)/2-e.clientY},index:t,clickTime:l.current.clickTime}},onDragEnd:()=>{g()&&n()},children:e})},j="root-bIVz24",q="container-bqVOeD",P="stickerCardDragWrapper-ohlIdQ",F="stickerCard-OqZDu8",L="hover-right-NUTXt8",Z="hover-left-mko1D3",E=1e3,O=(0,s.Pi)((e=>{const[t,i]=(0,r.useState)(-1),[s,n]=(0,r.useState)(-1),c=(0,r.useRef)({x:-1,y:-1,start:!1,scrollTop:0,index:-1,clickTime:[-3e3,0]}),u=(0,r.useRef)([]),{className:d,importStickerFileService:p,onSelect:m,onReimport:h}=e,{stickerListStore:g}=p,f=(0,r.useCallback)((e=>{(()=>{const e=Date.now()-c.current.clickTime[0]>E;c.current.clickTime=e?[c.current.clickTime[1],Date.now()]:[c.current.clickTime[0],Date.now()]})(),g.selectedId!==e.id&&m(e)}),[m,c.current]),v=()=>{-1!==t&&(g.dragInsert(c.current.index,t+s),i(-1),c.current={x:-1,y:-1,start:!1,scrollTop:0,index:-1,clickTime:c.current.clickTime})},_=(e,t,r=0)=>{c.current.start&&(i(t),n(r))},y=(e,t)=>{u.current[e]=t};return(0,S.jsx)("div",{className:o()(d,j),children:(0,S.jsx)("div",{className:q,children:(0,S.jsx)(a.W,{backend:l.PD,children:g.stickers.map(((e,i)=>(0,S.jsx)(I,{id:e.id,className:P,index:i,scrollAreaRef:g.scrollAreaRef,startPoint:c,stickerListRect:u.current,onStickerListRect:y,onMoveCard:v,onHoverCard:_,onCardClick:e=>{f(g.stickers[e])},children:(0,S.jsx)(k,{className:o()(F,{[L]:t===i&&0===s,[Z]:t===i&&-1===s}),sticker:e,isSelected:g.selectedId===e.id,onClick:f,onReimport:h,onRemove:p.removeSticker})},e.id)))})})})}))},67068:(e,t,i)=>{var r=i(18571),s=i(65625),n=i(79337),o=i(72322);(0,s.Pi)((e=>{const[t,i]=(0,r.useState)(!1);(0,r.useEffect)((()=>{window.showStickerDebugWindow=()=>{var e,t;i(!0),null===(e=window.getSelection())||void 0===e||e.removeAllRanges(),null===(t=window.vconsole)||void 0===t||t.showSwitch()}}),[]);const s=(0,r.useRef)(null),a=window.store;return t?(0,o.jsxs)("div",{style:{position:"fixed",top:10,left:0,bottom:10,width:250,zIndex:2,backgroundColor:"white",padding:8,display:"flex",flexDirection:"column",overflow:"auto",color:"black"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,o.jsx)("div",{children:"\u5bfc\u5165\u7684\u8d34\u7eb8\u72b6\u6001"}),(0,o.jsxs)("div",{style:{display:"flex"},children:[(0,o.jsx)("div",{style:{cursor:"pointer",marginInlineEnd:8},onClick:()=>{var e,t;const i=(null===(e=s.current)||void 0===e?void 0:e.innerText)||"",r=document.createElement("textarea");r.value=i,document.body.append(r),r.select(),document.execCommand("copy"),r.blur(),n.FN.info("\u590d\u5236\u6210\u529f"),null===(t=r.parentNode)||void 0===t||t.removeChild(r)},children:"\u590d\u5236"}),(0,o.jsx)("div",{style:{cursor:"pointer"},onClick:()=>i(!1),children:"\u5173\u95ed"})]})]}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"50px 1fr",rowGap:10,columnGap:8,marginTop:10},ref:s,children:[(0,o.jsx)("div",{children:"\u4e0a\u4f20 stats"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{children:["pending:"," ",(a.uploadStats||a.stickerListStore.uploadStats).pending]}),(0,o.jsxs)("div",{children:["succeeded:"," ",(a.uploadStats||a.stickerListStore.uploadStats).succeeded]}),(0,o.jsxs)("div",{children:["failed:"," ",(a.uploadStats||a.stickerListStore.uploadStats).failed]})]}),a.stickersForOnlineImageEditorStats&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:"\u5728\u7ebf\u8bbe\u8ba1 stats"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{children:["pending: ",a.stickersForOnlineImageEditorStats.pending]}),(0,o.jsxs)("div",{children:["ready: ",a.stickersForOnlineImageEditorStats.ready]}),(0,o.jsxs)("div",{children:["failed: ",a.stickersForOnlineImageEditorStats.failed]})]})]}),a.collection&&[a.collection.cover,...a.collection.exampleImages].map(((e,t)=>{const{id:i}=e,r=0===t;return[(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsx)("div",{children:t}),(0,o.jsx)("div",{children:r?"\u5c01\u9762\u56fe":"\u793a\u4f8b\u56fe"})]},`collection-${t}-1`),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["id: ",i]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["uri: ",e.uri||"\u4e0a\u4f20\u4e2d..."]}),(0,o.jsxs)("div",{children:["\u7f29\u7565\u56fe: ",e.url?"OK":"\u2757\ufe0f\u65e0"]}),(0,o.jsxs)("div",{children:["isUploadFailed:"," ",e.isUploadFailed?"\u2757\ufe0ftrue - \u4e0a\u4f20\u5931\u8d25":"false"]}),r&&(0,o.jsxs)("div",{children:["needImport:"," ",e.needImport?"\u2757\ufe0ftrue - \u672a\u751f\u6210":"false"+(e.id?"":" - \u2757\ufe0f\u7b49\u5f85\u751f\u6210\u4e2d")]})]},`collection-${t}-2`)]})),a.stickerListStore.stickers.map(((e,t)=>{const{id:i,isSequence:r}=e;return[(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsx)("div",{children:t}),(0,o.jsx)("div",{children:r?"\u5e8f\u5217\u5e27":"\u666e\u901a\u8d34\u7eb8"})]},`${i}-1`),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["id: ",i]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["uri:"," ",e.uri||(e.isUploadFailed?"":"\u4e0a\u4f20\u4e2d...")]}),(0,o.jsxs)("div",{children:["\u7f29\u7565\u56fe:"," ",e.coverSrc||e.firstFrameCoverSrc?"OK"+(e.coverSrc?"":" - \u7b2c\u4e00\u5e27"):"\u2757\ufe0f\u65e0"]}),(0,o.jsxs)("div",{children:["isUploadFailed:"," ",e.isUploadFailed?"true - "+(e.uri?"\u274c\u5e8f\u5217\u5e27 gif \u56fe\u5408\u6210\u5931\u8d25":"\u274c\u4e0a\u4f20\u5931\u8d25"):"false"]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["unmetRequirements:"," ",e.unmetRequirements.length>0&&"\u274c",e.unmetRequirements.join(", ")||"\u65e0"]}),r&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{children:["largeImgUri:"," ",e.largeImageUri?"OK":"\u2757\ufe0f\u65e0"+(e.isUploadFailed?"":e.uri?" - \u5e8f\u5217\u5e27 gif \u56fe\u5408\u6210\u4e2d...":" - zip \u5305\u4e0a\u4f20\u4e2d...")]}),(0,o.jsxs)("div",{children:["\u5e8f\u5217\u5e27\u91cd\u65b0\u5408\u6210\u4e2d:"," ",e.isSequenceSettingsUpdating?"true":"false"]}),(0,o.jsxs)("div",{children:["\u5e8f\u5217\u5e27\u8bbe\u7f6e: ",e.sequenceSettings.fps,"fps/",e.sequenceSettings.loop?"\u5faa\u73af\u64ad\u653e":"\u5355\u6b21\u64ad\u653e"]})]})]},`${i}-2`)]}))]})]}):null}))},78002:(e,t,i)=>{i.d(t,{WQ:()=>l});var r=i(18571),s=i(60963),n=i(20165),o=i(12803);const a=1e4;function l(e){const{stickerListStore:t}=e,i=(0,n.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new o.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{i.isImportLoading=!0,await Promise.race([new Promise((e=>i.notifyImportLoadingFinish=e)),i.hideImportLoadingTimer.timeout(a)]),(0,s.z)((()=>{i.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{i.isImportLoading&&i.notifyImportLoadingFinish&&(i.notifyImportLoadingFinish(),i.notifyImportLoadingFinish=null)},destroy:()=>{i.hideImportLoadingTimer.cancel()}})));return(0,r.useEffect)((()=>{const e=(0,s.EH)((()=>{t.isAllStickersThumbnailReady&&i.finishImportLoadingFinishIfNeeded()}));return()=>{e()}}),[]),i}},22664:(e,t,i)=>{i.d(t,{T:()=>S});var r=i(88154),s=i(13818),n=i(31062),o=i(48647),a=i(60930),l=i(85918),c=i(34864),u=i(83305),d=i(12803);function p(){let e;return{promise:new Promise((t=>{e=t})),resolve:e}}class m{constructor(){(0,r.Z)(this,"schedulePromiseCtrl",p()),(0,r.Z)(this,"timer",null),(0,r.Z)(this,"finishPromiseCtrl",p())}schedule(e){var t,i;null===(t=(i=this.schedulePromiseCtrl).resolve)||void 0===t||t.call(i),this.schedulePromiseCtrl.resolve=null,e&&!this.timer&&(this.timer=new d.B,this.timer.timeout(e).then((()=>this.finish())))}scheduled(){return this.schedulePromiseCtrl.promise}finish(){var e,t,i;null===(e=(t=this.finishPromiseCtrl).resolve)||void 0===e||e.call(t),this.finishPromiseCtrl.resolve=null,null===(i=this.timer)||void 0===i||i.cancel()}finished(){return this.finishPromiseCtrl.promise}destroy(){var e;this.schedulePromiseCtrl.resolve=null,this.finishPromiseCtrl.resolve=null,null===(e=this.timer)||void 0===e||e.cancel()}}class h{constructor(e){(0,r.Z)(this,"queue",[]),(0,r.Z)(this,"runningSet",new Set),(0,r.Z)(this,"isStopped",!1),(0,r.Z)(this,"config",void 0),this.config={concurrency:1,timeout:0,...e},this.flushRunningSet()}async add(e){const t=this.createTask();await t.scheduled();try{return await e()}finally{t.finish()}}createTask(){const e=new m;return this.queue.push(e),this.flushRunningSet(),e}async flushRunningSet(){if(!this.isStopped)for(;this.runningSet.size<this.config.concurrency&&this.queue.length;){const e=this.queue.shift();this.runningSet.add(e),e.schedule(this.config.timeout),e.finished().then((()=>{this.runningSet.delete(e),this.flushRunningSet()}))}}destroy(){this.isStopped=!0,this.runningSet.forEach((e=>e.destroy())),this.runningSet.clear(),this.queue.splice(0,this.queue.length)}}var g=i(42461);class f{constructor(e){this.props=e,(0,r.Z)(this,"fileMap",new Map)}ensureFile(e){let t=this.fileMap.get(e);return t||(t={data:this.props.initData(),events:{}},this.fileMap.set(e,t)),t}getFile(e){return this.fileMap.get(e)}register(e,t,i){this.ensureFile(t).events[e]=i}dispatch(e){var t,i;const r=this.fileMap.get(e.id);r&&(null===(t=(i=r.events)[e.type])||void 0===t||t.call(i,e,r))}removeFile(e){this.fileMap.delete(e)}}var v=i(18552),_=i(5545);class S{constructor(e){this.props=e,(0,r.Z)(this,"unregisterStickerFileProcessResultEvent",void 0),(0,r.Z)(this,"fileEventDispatcher",new f({initData:()=>({stats:{isCompressed:!1,resolutionBeforeCompress:"",resolutionAfterCompress:"",sizeBeforeCompress:0,sizeAfterCompress:0,uploadStartAt:0,uploadTime:0,uploadError:""}})})),(0,r.Z)(this,"uploadConfigService",new v.w),(0,r.Z)(this,"checkIsSequenceToGifLocallyEnabled",(0,s.Z)((async()=>{const e=await(0,_.G)("sequence_to_gif_locally",["enabled"]);return(0,u.c6)("[ImportStickerFileService] getSettings sequence_to_gif_locally",{result:e}),"true"===e.enabled}))),(0,r.Z)(this,"removeSticker",(e=>{this.cleanupStickerInfo(e),this.stickerListStore.removeSticker(e)})),(0,r.Z)(this,"sequenceInfoMap",new Map),(0,r.Z)(this,"genSequenceStickerQueue",new h({concurrency:1})),(0,r.Z)(this,"genSequenceStickerLocallyQueue",new h({concurrency:4})),this.unregisterStickerFileProcessResultEvent=this.props.api.registerStickerFileProcessResultEvent((e=>this.fileEventDispatcher.dispatch(e))),this.checkIsSequenceToGifLocallyEnabled()}get stickerListStore(){return this.props.stickerListStore}get sendLogServ(){return this.props.sendLogServ}async getUploadConfigs(e){const{imageUploadConfig:t,objectUploadConfig:i}=await this.uploadConfigService.getUploadConfigs(e);return{imageUploadConfig:t,objectUploadConfig:i}}async getOpenStickerFilePickerRequest(e){return{...await this.getUploadConfigs("OpenStickerFilePicker"),...a.DefaultImportStickerFileRequest,sequence:{...a.Q0},needCheckStaticDynamicMix:!1,hasImportedType:"",...e}}async openStickerFilePicker(e){const t=await this.getOpenStickerFilePickerRequest(e),i=await this.props.api.openStickerFilePicker(t),r=this.ensureMaxImageCount(t,i);return this.initStickers(r)}async uploadDroppedStickerFiles(e){const t=await this.getOpenStickerFilePickerRequest(e),i=await this.props.api.uploadDroppedStickerFiles(t),r=this.ensureMaxImageCount(t,i);return this.initStickers(r)}ensureMaxImageCount(e,t){const{maxCount:i}=e,{images:r,...s}=t;return r.length>i&&(0,u.RF)("[ImportStickerFileService] jsb resp images.length > maxCount",null,{imagesCount:r.length,maxCount:i}),{...s,images:r.slice(0,i)}}getFileStats(e){return this.fileEventDispatcher.ensureFile(e).data.stats}registerThumbnailEvent(e,t){this.fileEventDispatcher.register("Thumbnail",e,t)}registerUploadEvent(e,t){this.fileEventDispatcher.register("Upload",e,((e,i)=>{const{uri:r,error:s,isCompressed:n,resolutionBeforeCompress:o,resolutionAfterCompress:a,sizeBeforeCompress:l,sizeAfterCompress:c}=e;i.data.stats={...i.data.stats,isCompressed:n,resolutionBeforeCompress:o,resolutionAfterCompress:a,sizeBeforeCompress:l,sizeAfterCompress:c,uploadError:r?"":s},t(e)}))}initStickers(e){const{isSequenceImport:t,images:i}=e,r=[];for(const s of i){const{id:e,path:i,width:n,height:o}=s;r.push(this.stickerListStore.makeInitSticker({id:e,path:i,width:n,height:o,isSequence:t})),this.recordFileUploadStart(e),this.registerThumbnailEvent(e,(async t=>{const i=this.stickerListStore.getSticker(e);if(!i)return void(0,u.RF)(`[ImportStickerFileService] sticker thumbnail ignored {${e}}`);if(!t.base64)return void(0,u.RF)(`[ImportStickerFileService] sticker thumbnail failed {${e}}`);const r=(0,l.F2)(t.base64),s=await(0,l.J9)(r).catch((()=>r));this.stickerListStore.updateThumbnailSrc(i,s),this.checkRequirements(i)})),this.registerUploadEvent(e,(t=>{const i=this.stickerListStore.getSticker(e);if(!i)return void(0,u.RF)(`[ImportStickerFileService] sticker upload ignored {${e}}`);const{uri:r}=t;if(!r){const r=t.error||"unknown";return this.handleStickerUploadEnd(i,r),void(0,u.RF)(`[ImportStickerFileService] sticker upload failed {${e}}`,null,{error:r,isSequence:i.isSequence})}this.stickerListStore.updateUploadedData(i,r),i.isSequence?this.generateSequenceSticker(i):this.handleStickerUploadEnd(i),(0,u.c6)(`[ImportStickerFileService] sticker upload success {${e}}`,{uri:r,isSequence:i.isSequence})}))}return r}recordFileUploadStart(e){const{stats:t}=this.fileEventDispatcher.ensureFile(e).data;t.uploadStartAt=performance.now(),t.uploadTime=0,t.uploadError=""}recordFileUploadEnd(e,t){var i;const r=null===(i=this.fileEventDispatcher.getFile(e))||void 0===i?void 0:i.data;if(!r||0!==r.stats.uploadTime)return;const{stats:s}=r;s.uploadTime=Math.round(performance.now()-s.uploadStartAt),"string"==typeof t&&(s.uploadError=t)}handleStickerUploadEnd(e,t){"string"==typeof t&&this.stickerListStore.setUploadFailed(e),this.recordFileUploadEnd(e.id,t),this.sendLogServ.sendStickerUploadStatusLog({sticker:e,stats:this.getFileStats(e.id)})}revokeBlobUrlIfNeeded(e){null!=e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}cleanupStickerInfo(e){const{id:t}=e;this.revokeBlobUrlIfNeeded(e.firstFrameCoverSrc),this.revokeBlobUrlIfNeeded(e.coverSrc),this.sequenceInfoMap.forEach(((e,i)=>{if(e.id!==t)return;this.sequenceInfoMap.delete(i);const r=e.cache.getSync();this.revokeBlobUrlIfNeeded(null==r?void 0:r.gifCover.blobUrl)})),this.removeFile(t)}removeFile(e){this.fileEventDispatcher.removeFile(e)}getSequenceInfoKey(e){const{id:t,sequenceSettings:{fps:i,loop:r}}=e;return`${t}-${i}-${r}`}getStickerWithSameSequenceSettings(e,t){const i=this.stickerListStore.getSticker(e),r=null==i?void 0:i.sequenceSettings;return r&&r.fps===t.fps&&r.loop===t.loop?i:null}async generateSequenceSticker(e){const{id:t,sequenceSettings:{fps:i,loop:r}}=e,s=this.getSequenceInfoKey(e),n=this.sequenceInfoMap.get(s);if(n)try{const i=await n.cache.get();return(0,u.c6)(`[ImportStickerFileService] get sequenceInfo cache success {${t}}`,{key:s}),this.updateSequenceStickerInfo(e,i)}catch(p){(0,u.RF)(`[ImportStickerFileService] update sequenceInfo cache failed {${t}}`,p,{key:s});const e=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:r});return void(e&&this.handleStickerUploadEnd(e,"update sequenceInfo cache failed"))}let o=null,a=null;try{const t=await this.generateSequenceStickerImpl(e);t&&({sequenceStickerInfo:o,resp:a}=t)}catch(p){(0,u.RF)(`[ImportStickerFileService] genSequenceSticker failed {${t}}`,p,{key:s,resp:a});const e=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:r});return void(e&&this.handleStickerUploadEnd(e,"genSequenceSticker failed"))}if(!o)return void(0,u.c6)(`[ImportStickerFileService] generateSequenceSticker canceled {${t}}`,{key:s});const l=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:r});if(!l)return;const c=this.initSequenceInfoCache(o);this.sequenceInfoMap.set(s,{id:t,cache:c});const d=!l.isSequenceSettingsUpdating;await this.updateSequenceStickerInfo(l,o),d&&this.handleStickerUploadEnd(l),(0,u.c6)(`[ImportStickerFileService] genSequenceSticker success {${t}}`,{key:s,isFirstTime:d,resp:a})}async generateSequenceStickerImpl(e){const{id:t,uri:i,sequenceSettings:{fps:r,loop:s}}=e;if(await this.checkIsSequenceToGifLocallyEnabled()){const{imageUploadConfig:e}=await this.getUploadConfigs("GenerateSequenceSticker"),{gif_gen_opts:n,...c}=a.mr,[u,d]=await this.genSequenceStickerLocallyQueue.add((()=>Promise.all([(0,o.PU)({...c,file_uri:i,fps:r,loop:s}),this.props.api.sequenceToGif({id:t,...c,fps:r,loop:s,gifs:n.map(((e,t)=>({bgColor:e.bg_color,width:e.width,height:e.height,needBase64:0===t}))),imageUploadConfig:e})])));if(d.isCanceled)return null;if(d.error)throw new g.w(`sequenceToGif error - ${d.error||"unknown"}`,{});const{file_uri:p,file_md5:m,file_size:h}=u,[f,v]=d.gifs,_=(0,l.F2)(f.base64),S=await(0,l.J9)(_);return{sequenceStickerInfo:{gifCover:{uri:f.uri,url:_,blobUrl:S},gifLargeImage:{uri:v.uri,url:"",blobUrl:""},stickerPackage:{uri:p,md5:m,size:h}},resp:u}}const n=await this.genSequenceStickerQueue.add((()=>(0,o.PU)({...a.mr,file_uri:i,fps:r,loop:s}))),c=await(0,l.J9)(n.gif_infos[0].url),{gif_infos:u,file_uri:d,file_md5:p,file_size:m}=n,[h,f]=u;return{sequenceStickerInfo:{gifCover:{...h,blobUrl:c},gifLargeImage:{...f,blobUrl:""},stickerPackage:{uri:d,md5:p,size:m}},resp:n}}async updateSequenceStickerInfo(e,t){const{id:i,uri:r,sequenceSettings:{fps:s,loop:n}}=e,{gifCover:o,gifLargeImage:a}=t;this.props.needSaveSequenceGifUrl&&!await this.checkIsSequenceToGifLocallyEnabled()&&await this.props.api.saveSequenceGifUrl({id:i,url:a.url,coverUrl:o.url,fps:s,loop:n}),this.stickerListStore.updateUploadedData(e,r,t)}initSequenceInfoCache(e){const t=()=>{const e=Date.now();return{expireTime:e+72e5,refreshTime:e,silentRefreshTime:e+6e5}},i=new c.C({initCacheData:{data:e,...t()},refresh:async()=>{var r;if(await this.checkIsSequenceToGifLocallyEnabled())return{data:{...e},...t()};const{gifCoverUrl:s,gifLargeImageUrl:n}=await this.refreshStickerSequenceUrls(e),o=null!==(r=i.getSync())&&void 0!==r?r:e;return{data:{...o,gifCover:{...o.gifCover,url:s},gifLargeImage:{...o.gifLargeImage,url:n}},...t()}}});return i}async refreshStickerSequenceUrls(e){const{gifCover:t,gifLargeImage:i}=e,{uri_to_url:r}=await(0,o.nz)({uri_infos:[{uri:t.uri,width:0,height:0,format:"image"},{uri:i.uri,width:0,height:0,format:"image"}]}),s=[],n=null==r?void 0:r[t.uri];n||s.push(`cover-${t.uri}`);const a=null==r?void 0:r[i.uri];if(a||s.push(`largeImage-${i.uri}`),!n||!a)throw new Error(`Failed to get url for ${s.join(", ")}`);return{gifCoverUrl:n,gifLargeImageUrl:a}}async checkRequirements(e){if(e.isSequence)return void this.stickerListStore.updateUnmetRequirements(e,[]);const t=[],{minImageSize:i}=a.DefaultImportStickerFileRequest;(e.width<i||e.height<i)&&t.push(a.fD.MinImageSize),this.stickerListStore.updateUnmetRequirements(e,t)}async reimportSticker(e,t){const i=await this.getOpenStickerFilePickerRequest({minCount:1,maxCount:1,maxTotalCount:1,...t}),r=await this.props.api.openStickerFilePicker({...i,multiple:!1}),s=this.initStickers(r);if(0===s.length)return null;const[n]=s;return this.cleanupStickerInfo(e),this.stickerListStore.reimportSticker(e.id,n),n.id}async retryUpload(e){return this.retryUploadStickersIfNeeded(this.stickerListStore.stickers,e)}async retryUploadStickersIfNeeded(e,t){const i=[],r=[];return e.forEach((e=>{!e.isUploadFailed||e.unmetRequirements.length>0||(e.isSequence&&e.uri?r.push(e):i.push(e))})),this.retryGenerateSequence(r),this.retryUploadFile(i,t)}async retryUploadFile(e,t){const i=e.map((e=>e.id)),r=[...i,...t];if(!r.length)return;let s;try{s=await this.getOpenStickerFilePickerRequest({minCount:1,maxCount:r.length,maxTotalCount:r.length})}catch(n){throw(0,u.RF)("[ImportStickerFileService] retryUploadFile get request failed",n,{retryUploadIds:r}),n}this.props.stickerListStore.startToRetryUploadStickers(i),r.forEach((e=>this.recordFileUploadStart(e))),this.props.api.openStickerFilePicker({...s,retryUploadIds:r}),(0,u.c6)("[ImportStickerFileService] retryUploadFile start",{retryUploadIds:r})}retryGenerateSequence(e){const t=e.map((e=>e.id));t.length&&(this.stickerListStore.startToRetryUploadStickers(t),t.forEach((e=>this.recordFileUploadStart(e))),this.batchGenerateSequenceSticker(e),(0,u.c6)("[ImportStickerFileService] retryGenerateSequence start",{stickerIds:t}))}updateSequenceSettings(e){const{newSettings:t,isApplyToAll:i}=e;let r=[];if(i)r=this.stickerListStore.stickers.filter((e=>e.isSequence));else{if(!this.stickerListStore.selectedSticker)return;r=[this.stickerListStore.selectedSticker]}const s=r.filter((e=>e.isUploadFailed||e.sequenceSettings.fps!==t.fps||e.sequenceSettings.loop!==t.loop));if(0===s.length)return;this.stickerListStore.startToUpdateSequenceSettings(s,t);const n=s.filter((e=>!e.isUploadFailed&&e.uri)),o=s.filter((e=>e.isUploadFailed));this.batchGenerateSequenceSticker(n),this.retryUploadStickersIfNeeded(o,[])}async batchGenerateSequenceSticker(e){for(const i of(0,n.Z)(e,10))try{await Promise.all(i.map((e=>this.generateSequenceSticker(e))))}catch(t){(0,u.RF)("[ImportStickerFileService] batchGenerateSequenceSticker failed",t,{stickers:i.map((e=>e.id))})}}async generateCollectionCover(e){const{collectionId:t}=e,i=await this.getUploadConfigs("generateCollectionCover"),r=e.stickers.map((e=>({id:e.id,...e.sequenceSettings})));(0,u.c6)("[ImportStickerFileService] generateCollectionCover start",{collectionId:t,stickers:r});const{id:s}=await this.props.api.generateStickerCollectionCoverImage({...i,collectionId:t,stickers:r});return s}async openStickerOnlineImageEditor(e){const{stickers:t,...i}=e,r=await this.getUploadConfigs("openStickerOnlineImageEditor"),{id:s}=await this.props.api.openStickerOnlineImageEditor({...i,...r,stickers:t.map((e=>({id:e.id,...e.sequenceSettings})))});return s}async localUploadImage(e){const t=await this.getOpenStickerFilePickerRequest({...e,minCount:1,maxCount:1,maxTotalCount:1}),{images:i}=await this.props.api.openStickerFilePicker({...t,multiple:!1,enableImportSequence:!1});return 0===i.length?null:i[0]}destroy(){this.unregisterStickerFileProcessResultEvent(),this.genSequenceStickerQueue.destroy(),this.genSequenceStickerLocallyQueue.destroy()}}},84202:(e,t,i)=>{i.d(t,{r:()=>he});var r=i(32547),s=i(73221),n=i(57102),o=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,p=(e,t,i)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,m=(e,t)=>{for(var i in t||(t={}))u.call(t,i)&&p(e,i,t[i]);if(c)for(var i of c(t))d.call(t,i)&&p(e,i,t[i]);return e};const h={version:void 0};var g=(e,t={})=>{return n.Z.call("openStickerFilePicker",e,(i=m({},t),r={customOptions:m({jsb_rules:h},t.customOptions)},a(i,l(r))));var i,r},f=Object.defineProperty,v=Object.defineProperties,_=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,b=(e,t,i)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,C=(e,t)=>{for(var i in t||(t={}))k.call(t,i)&&b(e,i,t[i]);if(S)for(var i of S(t))y.call(t,i)&&b(e,i,t[i]);return e};const w={version:void 0};var x=(e,t={})=>{return n.Z.call("uploadDroppedStickerFiles",e,(i=C({},t),r={customOptions:C({jsb_rules:w},t.customOptions)},v(i,_(r))));var i,r},I=i(11507),j=Object.defineProperty,q=Object.defineProperties,P=Object.getOwnPropertyDescriptors,F=Object.getOwnPropertySymbols,L=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,E=(e,t,i)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,O=(e,t)=>{for(var i in t||(t={}))L.call(t,i)&&E(e,i,t[i]);if(F)for(var i of F(t))Z.call(t,i)&&E(e,i,t[i]);return e};const U={version:void 0};var R=(e,t={})=>{return n.Z.call("sequenceToGif",e,(i=O({},t),r={customOptions:O({jsb_rules:U},t.customOptions)},q(i,P(r))));var i,r};var T=Object.defineProperty,N=Object.defineProperties,A=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,$=(e,t,i)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,M=(e,t)=>{for(var i in t||(t={}))D.call(t,i)&&$(e,i,t[i]);if(z)for(var i of z(t))B.call(t,i)&&$(e,i,t[i]);return e};const G={version:void 0};var V=(e,t={})=>{return n.Z.call("saveSequenceGifUrl",e,(i=M({},t),r={customOptions:M({jsb_rules:G},t.customOptions)},N(i,A(r))));var i,r},J=Object.defineProperty,X=Object.defineProperties,Y=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,K=(e,t,i)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ee=(e,t)=>{for(var i in t||(t={}))W.call(t,i)&&K(e,i,t[i]);if(Q)for(var i of Q(t))H.call(t,i)&&K(e,i,t[i]);return e};const te={version:void 0};var ie=(e,t={})=>{return n.Z.call("generateStickerCollectionCoverImage",e,(i=ee({},t),r={customOptions:ee({jsb_rules:te},t.customOptions)},X(i,Y(r))));var i,r},re=Object.defineProperty,se=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,ae=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,ce=(e,t,i)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ue=(e,t)=>{for(var i in t||(t={}))ae.call(t,i)&&ce(e,i,t[i]);if(oe)for(var i of oe(t))le.call(t,i)&&ce(e,i,t[i]);return e};const de={version:void 0};var pe=(e,t={})=>{return n.Z.call("openStickerOnlineImageEditor",e,(i=ue({},t),r={customOptions:ue({jsb_rules:de},t.customOptions)},se(i,ne(r))));var i,r},me=i(83305);class he{getJSBRequest(e){const t=e.accept.split(",").map((e=>e.trim().replace(/^\./g,""))).join("-");return{...e,accept:t}}async openStickerFilePicker(e){var t;const i=this.getJSBRequest(e);(0,me.c6)("[JSB] openStickerFilePicker req --\x3e",{...(0,s.Z)(i,["objectUploadConfig","imageUploadConfig","sequence"])});const r=await g(i);return(0,me.c6)("[JSB] openStickerFilePicker resp <--",{isSequenceImport:null==r?void 0:r.isSequenceImport,imagesCount:null==r||null===(t=r.images)||void 0===t?void 0:t.length}),r}async uploadDroppedStickerFiles(e){var t;const i=this.getJSBRequest(e);(0,me.c6)("[JSB] uploadDroppedStickerFiles req --\x3e",{...(0,s.Z)(i,["objectUploadConfig","imageUploadConfig","sequence"])});const r=await x(i);return(0,me.c6)("[JSB] uploadDroppedStickerFiles resp <--",{isSequenceImport:null==r?void 0:r.isSequenceImport,imagesCount:null==r||null===(t=r.images)||void 0===t?void 0:t.length}),r}registerStickerFileProcessResultEvent(e){return(e=>{const t=n.Z.on("StickerFileProcessResult",(t=>{t.data&&e(t.data)}));return()=>n.Z.off("StickerFileProcessResult",t)})((t=>{(0,me.c6)(`[JSB] StickerFileProcessResult ${null==t?void 0:t.type} {${null==t?void 0:t.id}}`,{...(0,r.Z)(t,["result","uri","error"])}),e(t)}))}async saveSequenceGifUrl(e){try{return(0,me.c6)(`[JSB] saveSequenceGifUrl {${e.id}}`),await V(e)}catch{return}}async generateStickerCollectionCoverImage(e){(0,me.c6)("[JSB] generateStickerCollectionCoverImage req --\x3e",{...(0,s.Z)(e,["objectUploadConfig","imageUploadConfig"])});const t=await ie(e);return(0,me.c6)("[JSB] generateStickerCollectionCoverImage resp <--",t),t}async openStickerOnlineImageEditor(e){(0,me.c6)("[JSB] openStickerOnlineImageEditor req --\x3e",{...(0,s.Z)(e,["objectUploadConfig","imageUploadConfig"])});const t=await pe(e);return(0,me.c6)("[JSB] openStickerOnlineImageEditor resp <--",t),t}async sequenceToGif(e){var t;(0,me.c6)("[JSB] sequenceToGif req --\x3e",{...(0,s.Z)(e,["imageUploadConfig"])});const i=await(e=>(0,I.oh)(R,"sequenceToGif",{...e,timeout_ms:6e5}))(e);return(0,me.c6)("[JSB] sequenceToGif resp <--",{gifs:null===(t=i.gifs)||void 0===t?void 0:t.map((e=>{var t;return{uri:e.uri,base64Length:null===(t=e.base64)||void 0===t?void 0:t.length}})),isCanceled:i.isCanceled,error:i.error}),i}}},17356:(e,t,i)=>{i.d(t,{YL:()=>f,pg:()=>_,t9:()=>v});var r=i(88154),s=i(18571),n=i(52255),o=i(46026);function a(e){return void 0===e?e:String(Math.round(e/1024))}function l(e){const{material_category:t,material_type:i,collection_detail:r}=e;return{material_category:t,material_type:i,...r&&"collection"===i&&{collection_detail:r}}}function c(e){const{error_report:t,upload_status:i,time:r,isCompressed:s,sizeBeforeCompress:n,sizeAfterCompress:c,resolutionBeforeCompress:u,resolutionAfterCompress:d,extra:p={}}=e;(0,o.g)({eventName:"personal_page_material_upload_status",params:{...l(e),error_report:t,upload_status:i,time:r,is_compressed:s?1:0,...s&&{material_size_before_compress:a(n),material_size_after_compress:a(c),material_resolution_before_compress:u,material_resolution_after_compress:d},...p}})}function u(e){if(0===e.length)return;const t=function(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,i])=>{const r=i||"";t[e]=t[e]?`${t[e]},${r}`:r}))})),t}(e),i=new Set(t.material_type.split(","));1===i.size&&(t.material_type=i.values().next().value),(0,o.g)({eventName:"personal_page_material_publish_error_report",params:t})}function d(e){const{status:t,material_type:i,material_category:r,title:s,description:n,isOriginal:l,tags:c,material_format:u,material_size:d,resolution:p,error_type:m,cover_type:h,time:g,extra:f={},authorize_range:v,isVipAuthorized:_,isBusinessAuthorized:S,is_official_task:k,task_id:y,material_id:b,material_subcategory:C,effect_type_title:w,effect_type_id:x}=e;return(0,o.g)({eventName:"personal_page_material_publish_status",params:{status:t,material_type:i,material_category:r,material_title:s,material_introduction:n,is_original:l?"1":"0",hashtag:c.join(","),material_format:u,material_size:a(d),resolution:p,authorize_range:v,is_official_task:k,task_id:y,material_id:b,material_subcategory:C,effect_type_title:w,effect_type_id:x,..."fail"===t&&{error_type:m},cover_type:h,time:g,is_subscription_authorized:_?1:0,is_commercial_authorized:S?1:0,...f}})}var p=i(54290),m=i(85918),h=i(39110),g=i(48647);class f{constructor(e){(0,r.Z)(this,"materialTypeParams",{material_category:"",material_type:""}),(0,r.Z)(this,"isCollection",!1),this.isCollection=e.itemType===p.Ab.StickerCollection,this.materialTypeParams={material_category:"sticker",material_type:this.isCollection?"collection":"single"}}sendPageActionLog(e){!function(e){const{action:t,extra:i={},material_cnt:r}=e;(0,o.g)({eventName:"personal_page_material_publish_page_action",params:{action:t,material_cnt:r,...l(e),...i}})}({...this.materialTypeParams,...e,...this.isCollection&&{collection_detail:e.collection_detail||"collection_all"}})}sendUploadActionLog(e){const{mainFormLayout:t}=e,i="mainForm"===t?"upload_more":"sticker_upload";this.sendPageActionLog({action:i})}sendStartEditSequenceSettingsLog(e){const{collection_detail:t}=e;this.sendPageActionLog({action:"animation_edit",collection_detail:t})}sendSaveSequenceSettingsLog(e){const{collection_detail:t,sequenceSettings:i}=e;this.sendPageActionLog({action:"animation_edit_save",collection_detail:t,extra:{...i&&{animation_cycle_detail:i.loop?"repeat":"once",animation_fps_detail:String(i.fps),animation_is_applied_to_all:i.sequenceSettingsApplyToAll?"1":"0"}}})}sendStickerUploadStatusLog(e){const{sticker:t,stats:i}=e,{isSequence:r,isUploadFailed:s}=t,n=r&&s&&t.uri&&"sequencial_material_failed",o=!s&&t.largeImageUri&&"success",{isCompressed:a,resolutionBeforeCompress:l,resolutionAfterCompress:u,sizeBeforeCompress:d,sizeAfterCompress:p,uploadTime:m,uploadError:h}=i;c({...this.materialTypeParams,...this.isCollection&&{collection_detail:"collection_material"},error_report:h,upload_status:n||o||"fail",time:m,isCompressed:a,resolutionBeforeCompress:l,resolutionAfterCompress:u,sizeBeforeCompress:d,sizeAfterCompress:p,extra:{...void 0!==r&&{is_sequential:r?1:0}}})}sendCollectionUploadStatusLog(e){const{cover:t,exampleImage:i,stats:r}=e,{isUploadFailed:s}=t||i,{isCompressed:n,resolutionBeforeCompress:o,resolutionAfterCompress:a,sizeBeforeCompress:l,sizeAfterCompress:u,uploadTime:d,uploadError:p}=r;c({...this.materialTypeParams,collection_detail:t?"collection_cover":"collection_sample",error_report:p,upload_status:s?"fail":"success",time:d,isCompressed:n,resolutionBeforeCompress:o,resolutionAfterCompress:a,sizeBeforeCompress:l,sizeAfterCompress:u})}sendStickerImportErrorLog(e){return function(e){const{error_report:t}=e;(0,o.g)({eventName:"personal_page_material_import_error_report",params:{...l(e),error_report:t}})}({...this.materialTypeParams,...e})}sendStickerPublishErrorLog(e){return u(e.map((e=>({...this.materialTypeParams,...e}))))}sendStickerPublishStatusLog(e){const{stickerParams:t,collectionParams:i,error:r,time:s}=e,o=r?"fail":"success",a=[];if((null!=t&&t.stickerReqItem.common_data.is_business||null!=i&&i.collectionReqItem.common_data.is_business)&&a.push("business"),(null!=t&&t.stickerReqItem.is_vip||null!=i&&i.collectionReqItem.is_vip)&&a.push("subscribe"),t){const{sticker:e,stickerReqItem:i,stats:l}=t,{common_data:c,copyright:u}=i,{isSequence:p,sequenceSettings:f,path:v}=e;return d({status:o,material_category:this.materialTypeParams.material_category,material_type:"single",title:c.title,isOriginal:c.is_original||!1,tags:c.tags||[],material_format:p?"zip":(0,m.lm)(v),material_size:l.sizeAfterCompress,resolution:l.resolutionAfterCompress,error_type:r,time:s,authorize_range:a.join(","),isVipAuthorized:(0,h.$X)(i.copyright,g.$x.Vip),isBusinessAuthorized:(0,h.$X)(i.copyright,g.$x.Business),is_official_task:i.common_data.post_channel===g.iu.Open?0:1,task_id:e.formState.targetedActivityId,extra:{sticker_type:(0,n.w3)(e)?"gif":"png",sticker_animation:p?"1":"0",...p&&{animation_cycle_detail:f.loop?"repeat":"once",animation_fps_detail:String(f.fps)}}})}{const{collection:e,collectionReqItem:t}=i,{common_data:n}=t;return d({status:o,...this.materialTypeParams,title:n.title,description:n.description||"",isOriginal:n.is_original||!1,tags:n.tags||[],error_type:r,cover_type:e.cover.generatedFrom,time:s,authorize_range:a.join(","),isVipAuthorized:(0,h.$X)(t.copyright,g.$x.Vip),isBusinessAuthorized:(0,h.$X)(t.copyright,g.$x.Business),is_official_task:t.common_data.post_channel===g.iu.Open?0:1,task_id:e.formState.targetedActivityId,extra:{sticker_animation:"0"}})}}sendClickSubscriptionCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_subscription":"cancel_check_box_subscription"})}sendSubscriptionStatementLog(e){!function(e){const{action:t,material_category:i,material_type:r,entry_from:s}=e;(0,o.g)({eventName:"ugc_material_subscription_original_statment",params:{action:t,material_category:i,material_type:r,entry_from:s}})}({...this.materialTypeParams,...e})}sendClickCommercialCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_commercial":"cancel_check_box_commercial"})}sendCommercialStatementLog(e){!function(e){const{action:t,material_category:i,material_type:r,entry_from:s,hasCopyrightAuthorization:n}=e;(0,o.g)({eventName:"ugc_material_commercial_original_statment",params:{action:t,material_category:i,material_type:r,entry_from:s,..."boolean"==typeof n&&{has_copyright_authorization:n?"1":"0"}}})}({...this.materialTypeParams,...e})}sendAuthorSignLog(e){!function(e){const{action:t,page_type:i,material_category:r,material_type:s,button_name:n}=e;(0,o.g)({eventName:"ugc_material_creator_sign_agreement",params:{action:t,page_type:i,material_category:r,material_type:s,...n&&{button_name:n}}})}({...this.materialTypeParams,...e})}}function v(e){(0,s.useEffect)((()=>{e.sendPageActionLog({action:"upload_page_show"})}),[])}function _(e){const{mainFormLayout:t,sendLogServ:i}=e;(0,s.useEffect)((()=>{"mainForm"===t&&i.sendPageActionLog({action:"detail_page_show"})}),[t])}},55731:(e,t,i)=>{i.d(t,{g:()=>s});var r=i(83305);function s(e){const{logPrefix:t,sticker:i,publishResult:s,sendLogServ:n,importServ:o}=e,{req:a,error:l,errorText:c,time:u,resourceId:d}=s;n.sendStickerPublishStatusLog({error:c,time:u,stickerParams:{sticker:i,stickerReqItem:a,stats:o.getFileStats(i.id)}});const{id:p}=i;l?(0,r.RF)(`${t} sticker publish failed`,l,{id:p}):(0,r.c6)(`${t} sticker publish success`,{id:p,resourceId:d})}},23818:(e,t,i)=>{i.d(t,{xB:()=>r});function r(e){const{len:t,i18n:i}=e,[r]=(i.language||"").split("-");return"zh"===r?Math.floor(t/2):t}},34889:(e,t,i)=>{i.d(t,{Z:()=>r});const r={input:"input-gRb1O6"}},92888:(e,t,i)=>{i.d(t,{Z:()=>r});const r={root:"root-qThJ3Y",point:"point-ytHHVg"}},43582:(e,t,i)=>{i.d(t,{Z:()=>r});const r={menu:"menu-v4m02G",menuItemContainer:"menuItemContainer-K5Eent",menuItem:"menuItem-eU7buP"}},26851:(e,t,i)=>{i.d(t,{Z:()=>r});const r={group:"group-m_Apv3",authGroup:"authGroup-Yuaspf",label:"label-EV9bRs",right:"right-pmBY1Y"}}}]);