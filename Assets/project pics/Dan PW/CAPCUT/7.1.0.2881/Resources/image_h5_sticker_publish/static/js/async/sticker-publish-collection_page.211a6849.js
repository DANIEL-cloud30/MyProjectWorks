"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[6843],{54290:(e,t,i)=>{i.d(t,{Ab:()=>o});let o=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},68288:(e,t,i)=>{i.d(t,{Bo:()=>h,LU:()=>v,ir:()=>f});var o=i(18571),r=i(18751),l=i.n(r),s=i(42716),a=i(12247),n=i(77991),c=i(92644),d=i(17150),p=i(37964),m=i(71410),u=i(7890),g=i(72322);const S=e=>{const{className:t,loadingText:i}=e,{t:o}=(0,s.$)(),{handleMouseEnter:r}=(0,p.S)();return(0,g.jsxs)("div",{className:l()(u.Z.root,t),children:[(0,g.jsx)(d.a,{className:u.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,g.jsx)("div",{className:u.Z.text,onMouseEnter:r,children:i||o("pc_stickers_release_in_web")})]})},_=e=>{const{className:t,tooltip:i}=e,{t:r}=(0,s.$)(),{handleMouseEnter:n}=(0,p.w)({content:i,className:u.Z.tooltip}),c=(0,o.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:S}=(0,m.J)({text:r("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,g.jsxs)("div",{className:l()(u.Z.root,t,u.Z.error),onMouseEnter:e=>{d(!0),n(e)},onMouseLeave:()=>d(!1),children:[(0,g.jsx)(a.r,{className:u.Z.icon}),(0,g.jsx)("div",{ref:c,className:u.Z.text,children:S})]})},h=e=>{const{className:t,text:i}=e,{handleMouseEnter:o}=(0,p.S)();return(0,g.jsxs)("div",{className:l()(u.Z.root,t,u.Z.checked),children:[(0,g.jsx)(c.r,{className:u.Z.icon}),(0,g.jsx)("div",{className:u.Z.text,onMouseEnter:o,children:i})]})},v=e=>{const{className:t}=e,{t:i}=(0,s.$)(),{handleMouseEnter:o}=(0,p.S)();return(0,g.jsxs)("div",{className:l()(u.Z.root,t),children:[(0,g.jsx)("div",{className:l()(u.Z.icon,u.Z.yellowIcon),children:(0,g.jsx)("div",{className:u.Z.yellowPoint})}),(0,g.jsx)("div",{className:u.Z.text,onMouseEnter:o,children:i("pc_stickers_release_editing_web")}),(0,g.jsx)(n.r,{className:u.Z.icon})]})},f=e=>{const{className:t,loading:i,invalid:o,errorToolip:r,isInfoComplete:l,title:s,loadingText:a}=e;return i?(0,g.jsx)(S,{className:t,loadingText:a}):o?(0,g.jsx)(_,{className:t,tooltip:r}):l?(0,g.jsx)(h,{className:t,text:s}):(0,g.jsx)(v,{className:t})}},39110:(e,t,i)=>{i.d(t,{$X:()=>l,pn:()=>r});var o=i(48647);function r({isVip:e,isBusiness:t,authFiles:i}){var r;const l=null!==(r=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==r?r:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:o.$x.Vip,auth_status:e?o.U9.Authorized:o.U9.Unauthorized,third_party_agreements:[]},{scene:o.$x.Business,auth_status:t?o.U9.Authorized:o.U9.Unauthorized,third_party_agreements:t?l:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function l(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===o.U9.Authorized)))}},60930:(e,t,i)=>{i.d(t,{BI:()=>h,DefaultImportStickerFileRequest:()=>n,Em:()=>p,GR:()=>g,J:()=>d,N7:()=>s,Q0:()=>a,R8:()=>r,S8:()=>S,Us:()=>_,fD:()=>l,mr:()=>c,qb:()=>u,r$:()=>m});var o=i(79292);let r=function(e){return e.Static="static",e.GIF="gif",e.Sequence="sequence",e}({}),l=function(e){return e.Format="format",e.MinImageSize="minImageSize",e.RecommendFileSize="RecommendFileSize",e.SequenceNumber="SequenceNumber",e}({});const s={fps:16,loop:!0},a={maxCount:49,minCount:2,minImageSize:360,maxImageSize:1080,maxFileSize:20971520},n={accept:".png,.jpg,.jpeg,.gif",multiple:!0,enableImportSequence:!0,thumbnailSize:200,minImageSize:360,maxImageSize:800,maxFileSize:20971520},c={fps:16,loop:!0,gen_size:0,gif_gen_opts:[{bg_color:"#242424",width:200,height:200,padding:0},{bg_color:"",width:0,height:0,padding:0}]},d={accept:".png,.gif",minImageSize:320,maxImageSize:1e3,maxFileSize:20971520},p={accept:".png,.gif",minImageSize:320,maxImageSize:1250,maxFileSize:5242880},m=20,u=80,g=4,S=40,_=52,h={[r.Static]:{[l.Format]:o.I18n.t("pc_stickers_release_format_web"),[l.MinImageSize]:o.I18n.t("pc_stickers_release_size_min_web"),[l.RecommendFileSize]:o.I18n.t("pc_stickers_release_recommend_web")},[r.GIF]:{[l.Format]:o.I18n.t("pc_stickers_release_format_gif_web"),[l.MinImageSize]:o.I18n.t("pc_stickers_release_size_min_web"),[l.RecommendFileSize]:o.I18n.t("pc_stickers_release_recommend_web")},[r.Sequence]:{[l.Format]:o.I18n.t("pc_stickers_release_png_groups_web_web"),[l.MinImageSize]:o.I18n.t("pc_stickers_release_reccomend_size_web"),[l.SequenceNumber]:o.I18n.t("pc_stickers_release_amount_web"),[l.RecommendFileSize]:o.I18n.t("pc_stickers_release_recommend_web")}}},52255:(e,t,i)=>{i.d(t,{B3:()=>g,Nf:()=>S,WQ:()=>h,w3:()=>_});var o=i(32547),r=i(18571),l=i(20165),s=i(54290),a=i(1234),n=i(60930),c=i(13928),d=i(85918),p=i(39110),m=i(48647),u=i(46350);function g(e){return e.coverSrc||e.firstFrameCoverSrc}function S(e){return e.isSequence&&Boolean(e.isSequenceSettingsUpdating||e.firstFrameCoverSrc&&!e.coverSrc&&!e.isUploadFailed)}function _(e){return e.isSequence||"gif"===(0,d.lm)(e.path)}function h(e){const t=(0,l.fv)((()=>({stickers:[],scrollAreaRef:(0,r.createRef)(),materialPostConfig:new u.E(s.Ab.Sticker),get hasStickers(){return this.stickers.length>0},selectedId:null,get selectedSticker(){return t.selectedId?t.getSticker(t.selectedId):null},setScrollAreaRef(e){t.scrollAreaRef=e},addStickers(e){t.stickers.push(...e)},getSticker:e=>{var i;return null!==(i=t.stickers.find((t=>t.id===e)))&&void 0!==i?i:null},selectSticker(e){t.selectedId=e,t.selectedSticker&&(t.selectedSticker.hasEverSelected=!0)},updateThumbnailSrc(e,t){e.isSequence?e.firstFrameCoverSrc=t:e.coverSrc=t},updateUploadedData(e,t,i){if(e.uri=t,!e.isSequence)return e.coverUri=t,void(e.largeImageUri=t);if(i){const{gifCover:t,gifLargeImage:o,stickerPackage:r}=i;e.coverUri=t.uri,e.coverSrc=t.blobUrl,e.largeImageUri=o.uri,e.stickerPackage=r,e.isSequenceSettingsUpdating=!1}},updateUnmetRequirements(e,t){e.unmetRequirements=t,e.hasCheckedRequirements=!0},setUploadFailed(e){e.isUploadFailed=!0,e.isSequenceSettingsUpdating=!1},get isAllStickersThumbnailReady(){return t.stickers.length>0&&t.stickers.every((e=>g(e)))},applyForTags:e=>{t.stickers.forEach((t=>{t.formState.tags=e}))},applyAuthSettingsToAll:({isOriginal:e,isBusiness:i,isVip:o})=>{t.stickers.forEach((t=>{t.formState.isOriginal=Boolean(e),t.formState.isBusiness=Boolean(i),t.formState.isVip=Boolean(o)}))},applyPublishDirectionToAll:({postChannel:e,targetedActivityId:i})=>{t.stickers.forEach((t=>{t.formState.postChannel=e,t.formState.targetedActivityId=i}))},makeInitFormState:e=>({title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1,...n.N7,sequenceSettingsApplyToAll:!1,...e}),updateFormState(e,t){Object.assign(e.formState,t)},makeInitSticker(i){const{title:o,isInfoComplete:r,formState:l,path:s="",isSequence:p=!1,...u}=i,g=function(e,t){const i=(0,d.lm)(e);if(t)return n.R8.Sequence;if("gif"===i)return n.R8.GIF;if(["png","jpg","jpeg"].includes(i))return n.R8.Static;throw new Error(`Unsupported suffix ${i}`)}(s,p),S=function(e,t){const i=e.split(/[\\/]/g).pop(),o=t?i:i.replace(/\.\w+?$/g,"");return(0,c.aF)(o,n.S8)}(s,p),_=a.$.isEnableAuthorization,{mustPaidAuth:h}=this.materialPostConfig.authConfig;return{id:"",path:s,get title(){return this.formState.title},fileType:g,width:0,height:0,isSequence:p,firstFrameCoverSrc:"",coverSrc:"",uri:"",coverUri:"",largeImageUri:"",stickerPackage:{uri:"",md5:"",size:0},sequenceSettings:{fps:0,loop:!1,...i.isSequence&&n.N7},hasEverSelected:!1,get isInfoComplete(){const{postChannel:t,targetedActivityId:i}=this.formState;{const r="single"===e,l="single"===e,s=t===m.iu.Open||t===m.iu.Targeted&&Boolean(i);return Boolean(this.title&&this.formState.tags.length>0)&&(o=this.formState.isVip,h&&o||!h||!r)&&(s||!l)}var o},unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,isSequenceSettingsUpdating:!1,formState:t.makeInitFormState({title:S,isVip:_}),...u}},reimportSticker(e,i){const o=t.stickers.findIndex((t=>t.id===e));-1!==o&&(t.stickers[o]=i)},startToRetryUploadStickers(e){e.forEach((e=>{const i=t.getSticker(e);i&&(i.isUploadFailed=!1)}))},startToUpdateSequenceSettings(e,t){e.forEach((e=>{e.sequenceSettings=t,e.largeImageUri&&(e.largeImageUri="",e.coverUri="",e.stickerPackage={uri:"",md5:"",size:0},e.isSequenceSettingsUpdating=!0)}))},removeSticker(e){t.stickers=t.stickers.filter((t=>t.id!==e.id))},dragInsert(e,i){const o=t.stickers.splice(e,1),r=e>i?i+1:i;t.stickers.splice(r,0,...o)},get isReadyToPublish(){return t.stickers.every((e=>e.hasCheckedRequirements&&0===e.unmetRequirements.length&&e.isInfoComplete))},get uploadStats(){let e=0,i=0,o=0;return t.stickers.forEach((t=>{if(t.isUploadFailed)return void(i+=1);(t.isSequence?t.largeImageUri:t.uri)?e+=1:o+=1})),{pending:o,succeeded:e,failed:i}},collectLogData:()=>t.stickers.map((e=>({...(0,o.Z)(e,["id","isSequence","isInfoComplete","hasEverSelected","isUploadFailed","uri"]),...e.isSequence&&{isSequenceUpdating:e.isSequenceSettingsUpdating,largeImageUri:e.largeImageUri,...e.sequenceSettings}}))),makePublishItemList:(e={})=>t.stickers.map((t=>{var i;const{id:o,isSequence:r,formState:l,stickerPackage:a}=t,{is_vip:n=Boolean(l.isVip),is_business:c=l.isBusiness,is_original:d=l.isOriginal,postChannel:u=l.postChannel,targetedActivityId:g=l.targetedActivityId,sourceForSimple:S=m.r0.UserPostPc,sourceForSequence:h=m.r0.UserPostPcSequence,authFileUploadServiceManager:v,onResult:f}=e,k=r?h:S,C=(0,p.pn)({isVip:n,isBusiness:c,authFiles:null!==(i=null==v?void 0:v.getUploadedFiles(o))&&void 0!==i?i:[]});return{id:o,req:{effect_type:s.Ab.Sticker,is_vip:n,...C.root,common_data:{title:l.title,description:l.title,icon:{image_uri:t.coverUri},sdk_version:"1.0.0",source:k,tags:[...l.tags],is_original:d,is_business:c,...C.commonData,...r&&{file:{file_uri:a.uri,file_md5:a.md5,size:a.size}},post_channel:u===m.iu.Targeted?`${m.iu.Targeted}_${g}`:u,web_extra:JSON.stringify({targeted_id:g})},sticker:{large_image:{image_uri:t.largeImageUri},sticker_type:_(t)?m.Ic.Dynamic:m.Ic.Static,no_multi_sticker:!1,package_size:0}},onResult:e=>null==f?void 0:f(t,e)}}))})));return t}},23370:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Vt});var o=i(65625),r=i(42716),l=(i(67068),i(47938)),s=i(21418),a=i(18775),n=i(18751),c=i.n(n),d=i(13199),p=i(68288),m=i(37964);const u="root-W9YKLd",g="selected-MfKVC9",S="cover-Sg1bSx",_="icon-NjGS_M",h="textInfo-zYCck9",v="title-PHGLK_",f="description-W4AGHI",k="statusBar-wU3FIA",C="checkedStatusBar-YMzSep";var x=i(72322);const b=({className:e,selected:t,coverSrc:i,title:o,description:l,isInfoComplete:s,onClick:a})=>{const{t:n}=(0,r.$)(),{handleMouseEnter:b}=(0,m.S)();return(0,x.jsxs)("div",{className:c()(e,u,t&&g),onClick:a,children:[(0,x.jsx)("div",{className:S,children:i?(0,x.jsx)("img",{className:_,src:i}):(0,x.jsx)(d.t,{className:_,iconWidth:28})}),(0,x.jsxs)("div",{className:h,children:[(0,x.jsx)("div",{className:v,onMouseEnter:b,children:o||n("pc_stickers_release_group_name_web")}),(0,x.jsx)("div",{className:f,onMouseEnter:b,children:l||n("pc_stickers_release_details_recommend_web")})]}),s?(0,x.jsx)(p.Bo,{className:C,text:n("pc_stickers_release_finish_fill_web")}):(0,x.jsx)(p.LU,{className:k})]})};var I=i(32547),w=i(18571),F=i(79337),y=i(60963),U=i(20165),N=i(79292),j=i(54290),E=i(1234),A=i(22664),q=i(84202),P=i(78002),L=i(52255),T=i(60930),R=i(85918),z=i(39317),M=i(76892),O=i(71157),$=i(15621),B=i(61843),V=i(88154),D=i(31062),Z=i(7561),W=i(83305),X=i(12803),G=i(48647);function J(e){return Boolean(e.id)}class H{constructor(){(0,V.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,D.Z)(e,10)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:o,onUpdateResult:r}=e,l=JSON.parse(JSON.stringify(e.req));let s=this.itemMap.get(i);if(null!==(t=s)&&void 0!==t&&t.promise&&(0,Z.Z)(s.req,l))try{return await s.promise}catch(a){(0,W.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return s={promise:null,id:i,req:l,onResult:o,onUpdateResult:r},this.itemMap.set(i,s),s.promise=this.publishImpl(s),s.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,o)=>{try{const s={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:o};var r,l;if(J(e.req))await(null===(r=e.onUpdateResult)||void 0===r?void 0:r.call(e,{req:e.req,...s}));else await(null===(l=e.onResult)||void 0===l?void 0:l.call(e,{req:e.req,...s}))}catch(s){(0,W.RF)("[MaterialPublishService] callOnResult failed",s)}};let o;try{o=await this.postOrUpdate(e)}catch(r){throw e.promise=null,i(r,""),r}return await i(null,o.resource_id),o}async postOrUpdate(e){return J(e.req)?(await(0,G.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,G.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new X.B).timeout(5e3)])}catch(t){(0,W.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),o=new X.B,r={count:50,effect_types:t,uid:E.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,G.Js)(r).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await o.timeout(500)}}}var Y=i(17356),Q=i(55731),K=i(7022),ee=i(57494),te=i(47791),ie=i(39110),oe=i(47573),re=i(52272),le=i(76664),se=i(22531),ae=i(33452);const ne="ImportSticker";function ce(e){return{title:"",description:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1,...T.N7,sequenceSettingsApplyToAll:!1,...e}}function de(){const e=(0,L.WQ)("collection"),t=(0,P.WQ)({stickerListStore:e}),i=new Y.YL({itemType:j.Ab.StickerCollection}),o=(0,oe.G)({watch:()=>l.isAllUploaded}),r=new $.l,l=(0,U.fv)((()=>({formApi:null,setFormApi:e=>{l.formApi=e},mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===l.mainFormLayoutAfterLoading&&O.appModel.isInitFailed?"error":l.mainFormLayoutAfterLoading},get isImportDisabled(){return e.stickers.length>=T.qb},stickerListStore:e,importLoadingStore:t,importServ:new A.T({api:new q.r,stickerListStore:e,sendLogServ:i,needSaveSequenceGifUrl:!0}),pubServ:new H,sendLogServ:i,authorSignService:new ee.I({signScene:le.d.BusinessArtist}),authFileUploadServiceManager:new te.r({}),performanceTimingCollector:(0,ae.uY)(),getImportMinMaxCount(){const t=e.stickers.length;return{minCount:1,maxCount:Math.max(0,T.qb-t),maxTotalCount:T.qb}},getHasImportedType(){const{stickers:t}=e;return 0===t.length?"":t.every(L.w3)?"dynamic":"static"},getStaticDynamicMixParams:()=>({needCheckStaticDynamicMix:!0,hasImportedType:l.getHasImportedType()}),openStickerFilePicker:()=>r.lock(ne,(async()=>{i.sendUploadActionLog(l),await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openStickerFilePicker"});const e=await l.importServ.openStickerFilePicker({...l.getImportMinMaxCount(),...l.getStaticDynamicMixParams()});l.addNewStickers(e)})),uploadDroppedStickerFiles:()=>r.lock(ne,(async()=>{i.sendUploadActionLog(l),await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"uploadDroppedStickerFiles"});const e=await l.importServ.uploadDroppedStickerFiles({...l.getImportMinMaxCount(),...l.getStaticDynamicMixParams()});l.addNewStickers(e)})),reimportSticker:t=>r.lock(ne,(async()=>{await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"reimportSticker"});const i=await l.importServ.reimportSticker(t,l.getStaticDynamicMixParams());if(i){const t=e.getSticker(i);l.selectSticker(t)}})),addNewStickers(i){if(0!==i.length)if(e.addStickers(i),"uploadArea"===l.mainFormLayoutAfterLoading){l.selectCollectionCoverCard(),t.showImportLoading(),l.mainFormLayoutAfterLoading="mainForm",l.startCheckGenerateCollectionCover();const e=E.$.isEnableAuthorization;l.collection.formState.isVip=e}else{const t=e.getSticker(i[0].id);l.selectSticker(t)}},collection:{id:(0,M.V)("sticker-collection"),cover:{id:"",url:"",uri:"",needImport:!0,isUploadFailed:!1},exampleImages:[],get title(){return this.formState.title},get description(){return this.formState.description},hasEverSelected:!1,get isInfoComplete(){{const{postChannel:t,targetedActivityId:i}=this.formState,o=t===G.iu.Open||t===G.iu.Targeted&&Boolean(i);return Boolean(this.cover.id&&this.title&&this.formState.tags.length>0)&&(t=>{const{mustPaidAuth:i}=e.materialPostConfig.authConfig;return i&&t||!i})(this.formState.isVip)&&o}},formState:ce({})},isCollectionCoverCardSelected:!0,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1,canIconBlank:E.$.permissions.includes(E.v.EffectIconBlank),canHighPro:E.$.permissions.includes(E.v.EffectHighPrio),canPackOne:E.$.permissions.includes(E.v.StickerOnePackage),canFpsSetting:e.stickers.some((e=>e.isSequence))}},get permissions(){return E.$.permissions},selectSticker(t){l.isCollectionCoverCardSelected&&(l.isCollectionCoverCardSelected=!1,l.saveCollectionFormState()),l.saveSingleFormState(),e.selectSticker(t.id)},selectCollectionCoverCard(){l.saveSingleFormState(),e.selectSticker(null),l.isCollectionCoverCardSelected=!0,l.collection.hasEverSelected=!0},initCollectionFields(){var e,t;null===(e=l.formApi)||void 0===e||e.reset(),null===(t=l.formApi)||void 0===t||t.setValues({collection:l.collection.formState})},updateCollectionFormState(e){Object.assign(l.collection.formState,e)},saveCollectionFormState(){var e;l.updateCollectionFormState(ce({...null===(e=l.formApi)||void 0===e?void 0:e.getValue("collection")}))},initSingleFields(e){var t,i;null===(t=l.formApi)||void 0===t||t.reset(),null===(i=l.formApi)||void 0===i||i.setValues({single:{...e.formState,...e.sequenceSettings}})},saveSingleFormState(){var t;const{selectedSticker:i}=e;if(!i)return;const o=e.makeInitFormState({...null===(t=l.formApi)||void 0===t?void 0:t.getValue("single"),...i.sequenceSettings,sequenceSettingsApplyToAll:!1});e.updateFormState(i,o)},saveSequenceSettingsForSingle(){var t;const o=e.makeInitFormState({...null===(t=l.formApi)||void 0===t?void 0:t.getValue("single")}),{fps:r,loop:s,sequenceSettingsApplyToAll:a}=o,n={fps:r,loop:s};l.importServ.updateSequenceSettings({newSettings:n,isApplyToAll:a}),i.sendSaveSequenceSettingsLog({collection_detail:"collection_material",sequenceSettings:{fps:r,loop:s,sequenceSettingsApplyToAll:a}})},saveSequenceSettingsForCollection(){var e;const t=ce({...null===(e=l.formApi)||void 0===e?void 0:e.getValue("collection")}),{fps:o,loop:r}=t,s={fps:o,loop:r};l.importServ.updateSequenceSettings({newSettings:s,isApplyToAll:!0}),i.sendSaveSequenceSettingsLog({collection_detail:"collection_all",sequenceSettings:{...t,sequenceSettingsApplyToAll:!0}})},get needConfirmModalOnClose(){return"mainForm"===l.mainFormLayout||e.stickers.length>0},get isReadyToPublish(){const t=e.stickers.length;return Boolean(t>=T.r$&&t<=T.qb&&l.collection.isInfoComplete&&e.isReadyToPublish&&!l.isPublishSucceeded)},get uploadStats(){const t=e.uploadStats;let i=0,o=0,r=0;const{cover:s,exampleImages:a}=l.collection;return[s,...a].forEach((e=>{e.isUploadFailed?r+=1:e.uri?o+=1:i+=1})),{pending:t.pending+i,succeeded:t.succeeded+o,failed:t.failed+r}},collectLogData(){const t=e.collectLogData(),{collection:i,stickersForOnlineImageEditorStats:o,uploadStats:r}=l,{cover:s,exampleImages:a,isInfoComplete:n}=i,c={isInfoComplete:n,stickersCount:t.length,stickersReadyToPublish:e.isReadyToPublish,stickersForOnlineImageEditorStats:o,uploadStats:r,stickers:t,cover:(0,I.Z)(s,["id","uri","needImport","isUploadFailed"]),exampleImages:a.map((e=>(0,I.Z)(e,["id","uri","isUploadFailed"])))};(0,W.c6)("[CollectionStore] collectLogData",c)},get isAllUploaded(){const{pending:e,failed:t}=l.uploadStats;return!e&&!t},isAllUploadedWatcher:o,async uploadAndPublish(e){i.sendPageActionLog({action:"publish"}),l.isAllUploaded||(await l.retryUpload(),null==e||e.show(),await l.isAllUploadedWatcher.start());try{await l.publish()}finally{null==e||e.hide()}},isPublishing:!1,isPublishSucceeded:!1,async publish(){l.isPublishing=!0;try{await l.publishImpl()}catch(e){return F.FN.error(N.I18n.t("pc_sticker_release_failed_retry_web")),(0,y.z)((()=>{l.isPublishing=!1})),void(0,W.RF)("[CollectionStore] publish failed",e)}(0,y.z)((()=>{l.isPublishing=!1,l.isPublishSucceeded=!0})),F.FN.success(N.I18n.t("pc_sticker_release_successful_web")),(0,re.ZM)({effect_type:j.Ab.StickerCollection}),(0,W.c6)("[CollectionStore] publish success"),setTimeout((()=>(0,re.Nt)({item_type:j.Ab.StickerCollection})),1e3)},async publishImpl(){l.isCollectionCoverCardSelected?l.saveCollectionFormState():l.saveSingleFormState();const{collection:t}=l,{cover:o,exampleImages:r,formState:s}=t,{title:a,description:n,tags:c,isVip:d,isBusiness:p,isOriginal:m,postChannel:u,targetedActivityId:g}=s,S=(0,ie.pn)({isVip:d,isBusiness:p,authFiles:l.authFileUploadServiceManager.getUploadedFiles(l.collection.id)}),_={effect_type:j.Ab.StickerCollection,is_vip:d,...S.root,common_data:{title:a,description:n,icon:{image_uri:o.uri},source:G.r0.UserPostPcCollection,tags:[...c],is_business:p,is_original:m,web_extra:JSON.stringify({tab_detail_images:r.map((e=>e.uri)),targeted_id:g}),post_channel:u===G.iu.Targeted?`${G.iu.Targeted}_${g}`:u,...S.commonData}},h=e.makePublishItemList({is_vip:d,is_business:p,is_original:m,postChannel:u,targetedActivityId:g,sourceForSimple:G.r0.UserPostPcCollection,sourceForSequence:G.r0.UserPostPcSequenceCollection,onResult:(e,t)=>(0,Q.g)({logPrefix:"[CollectionStore] ",sticker:e,publishResult:t,importServ:l.importServ,sendLogServ:l.sendLogServ})});(0,W.c6)("[CollectionStore] stickers publish start",{ids:h.map((e=>e.id))});const v=(await l.pubServ.batchPublish(h)).map((e=>e.resource_id));_.collection_info={resource_id_list:v},(0,W.c6)("[CollectionStore] collection publish start",{resourceIdList:v});const{resource_id:f}=await l.pubServ.publish({id:t.id,req:_,onResult:({req:e,error:o,errorText:r,time:l,resourceId:s})=>{i.sendStickerPublishStatusLog({error:r,time:l,collectionParams:{collection:t,collectionReqItem:e}}),o?(0,W.RF)("[CollectionStore] collection publish failed",o):(0,W.c6)("[CollectionStore] collection publish success",{resourceId:s})}});(0,W.c6)("[CollectionStore] collection publish done",{resourceId:f}),await l.pubServ.pollUntilAllInEffectList({ids:[f],types:[j.Ab.StickerCollection]}),(0,W.c6)("[SingleStore] poll done")},sendUploadProgressModalShowErrorLog(){const{collection:t}=l,o=e.stickers.filter((e=>e.isUploadFailed)).map((e=>({collection_detail:"collection_material",error_report:l.importServ.getFileStats(e.id).uploadError})));t.cover.id&&t.cover.isUploadFailed&&o.push({collection_detail:"collection_cover",error_report:l.importServ.getFileStats(t.cover.id).uploadError}),t.exampleImages.forEach((e=>{e.isUploadFailed&&o.push({collection_detail:"collection_sample",error_report:l.importServ.getFileStats(e.id).uploadError})})),i.sendStickerPublishErrorLog(o)},async retryUpload(){const e=[];[l.collection.cover,...l.collection.exampleImages].forEach((t=>{t.isUploadFailed&&e.push(t.id)})),await this.importServ.retryUpload(e),(0,y.z)((()=>{[l.collection.cover,...l.collection.exampleImages].forEach((t=>{e.includes(t.id)&&(t.isUploadFailed=!1)}))}))},retryTimesForOnlineImageEditor:0,retryUploadForOnlineImageEditor(){const{pending:e,failed:t}=l.getStickersForOnlineImageEditor();0===e.length&&t.length>0&&(l.retryTimesForOnlineImageEditor+=1,l.retryUpload())},getStickersForOnlineImageEditor(){const t=[],i=[],o=[];return e.stickers.forEach((e=>{if(e.unmetRequirements.length>0)return!1;if(e.isSequence){if(e.isUploadFailed)return void o.push(e);if(e.largeImageUri)return void t.push(e)}else if(e.hasCheckedRequirements)return void t.push(e);i.push(e)})),{pending:i,ready:t,failed:o}},get stickersForOnlineImageEditorStats(){const{pending:e,ready:t,failed:i}=l.getStickersForOnlineImageEditor();return{pending:e.length,ready:t.length,failed:i.length}},generateCollectionCoverWatcher:null,startCheckGenerateCollectionCover(){l.collection.cover.needImport=!1,l.generateCollectionCoverWatcher.start()},stopCheckGenerateCollectionCover(){l.generateCollectionCoverWatcher.stop()},generateCollectionCoverIfNeeded(){const{ready:t,failed:i}=l.getStickersForOnlineImageEditor(),o=new Set(i.map((e=>e.id))),r=new Set(t.map((e=>e.id))),s=e.stickers.slice(0,T.GR);if(s.length!==T.GR||s.some((e=>e.unmetRequirements.length>0||o.has(e.id))))return l.collection.cover.needImport=!0,!0;return!!s.every((e=>r.has(e.id)))&&(l.generateCollectionCover(s),!0)},async generateCollectionCover(e){const t=await l.importServ.generateCollectionCover({collectionId:l.collection.id,stickers:e});l.collection.cover.id?(0,W.c6)("[CollectionStore] generateCollectionCover ignored",{coverId:l.collection.cover.id}):t?l.replaceCover(t,"online_generated"):((0,y.z)((()=>{l.collection.cover.needImport=!0})),(0,W.RF)("[CollectionStore] generateCollectionCover failed"))},replaceCover(e,t){l.collection.cover.id&&l.importServ.removeFile(l.collection.cover.id),l.stopCheckGenerateCollectionCover(),l.collection.cover={id:e,uri:"",url:"",needImport:!1,isUploadFailed:!1,generatedFrom:t},l.importServ.recordFileUploadStart(e),l.importServ.registerThumbnailEvent(e,(t=>{l.collection.cover.id===e?t.base64?(0,y.z)((()=>{const{cover:e}=l.collection;e.url=(0,R.F2)(t.base64)})):(0,W.RF)(`[CollectionStore] cover thumbnail failed {${e}}`):(0,W.c6)(`[CollectionStore] cover thumbnail ignored {${e}}`,{coverId:l.collection.cover.id})})),l.importServ.registerUploadEvent(e,(t=>{if(l.collection.cover.id!==e)return void(0,W.c6)(`[CollectionStore] cover upload ignored {${e}}`,{coverId:l.collection.cover.id});const{cover:i}=l.collection,{uri:o}=t;(0,y.z)((()=>{if(o)i.uri=o,l.importServ.recordFileUploadEnd(e),(0,W.c6)(`[CollectionStore] cover upload success {${e}}`,{uri:o});else{i.isUploadFailed=!0;const o=t.error||"unknown";l.importServ.recordFileUploadEnd(e,o),(0,W.RF)(`[CollectionStore] cover upload failed {${e}}`,null,{error:o})}})),this.sendLogServ.sendCollectionUploadStatusLog({cover:i,stats:l.importServ.getFileStats(e)})}))},replaceExample(e,t){const i=l.collection.exampleImages[0];null!=i&&i.id&&l.importServ.removeFile(null==i?void 0:i.id),l.collection.exampleImages=[{id:e,uri:"",url:"",isUploadFailed:!1,generatedFrom:t}],l.importServ.recordFileUploadStart(e),l.importServ.registerThumbnailEvent(e,(t=>{const i=l.collection.exampleImages.find((t=>t.id===e));i?t.base64?(0,y.z)((()=>{i.url=(0,R.F2)(t.base64)})):(0,W.RF)(`[CollectionStore] exampleImage thumbnail failed {${e}}`):(0,W.c6)(`[CollectionStore] exampleImage thumbnail ignored {${e}}`)})),l.importServ.registerUploadEvent(e,(t=>{const i=l.collection.exampleImages.find((t=>t.id===e));i?((0,y.z)((()=>{const{uri:o}=t;if(o)i.uri=o,l.importServ.recordFileUploadEnd(e),(0,W.c6)(`[CollectionStore] exampleImage upload success {${e}}`,{uri:o});else{i.isUploadFailed=!0;const o=t.error||"unknown";l.importServ.recordFileUploadEnd(e,o),(0,W.RF)(`[CollectionStore] exampleImage upload failed {${e}}`,null,{error:o})}})),this.sendLogServ.sendCollectionUploadStatusLog({exampleImage:i,stats:l.importServ.getFileStats(e)})):(0,W.c6)(`[CollectionStore] exampleImage upload ignored {${e}}`)}))},async openCoverImageEditor(){i.sendPageActionLog({action:"cover_generate_from_online"}),await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openCoverImageEditor"});const e=l.getStickersForOnlineImageEditor().ready,t=await l.importServ.openStickerOnlineImageEditor({...T.J,collectionId:l.collection.id,type:"CoverImage",stickers:e});t&&l.replaceCover(t,"online_generated")},async localUploadCover(){i.sendPageActionLog({action:"cover_upload_from_local"}),await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"localUploadCover"});const e=await l.importServ.localUploadImage({...T.J}),t=await this.checkLocalUploadRequirements({image:e,collection_detail:"collection_cover",requirements:T.J,i18nKey:{minImageSize:"pc_collection_cover_size_{X}x{X}px_web"}});t&&l.replaceCover(t.id,"local_uploaded")},async openExampleImageEditor(){await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openExampleImageEditor"});const e=l.getStickersForOnlineImageEditor().ready,t=await l.importServ.openStickerOnlineImageEditor({...T.Em,collectionId:l.collection.id,type:"ExampleImage",stickers:e});t&&l.replaceExample(t,"online_generated")},removeExample(){const e=l.collection.exampleImages[0];null!=e&&e.id&&l.importServ.removeFile(null==e?void 0:e.id),l.collection.exampleImages=[]},async localUploadExample(){await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"localUploadExample"});const e=await l.importServ.localUploadImage({...T.Em}),t=await this.checkLocalUploadRequirements({image:e,collection_detail:"collection_sample",requirements:T.Em,i18nKey:{minImageSize:"pc_sample_smallest_size_{X}x{X}px_web"}});t&&l.replaceExample(t.id,"local_uploaded")},async checkLocalUploadRequirements(e){const{image:t,requirements:o,i18nKey:r,collection_detail:l}=e;if(!t)return null;const{width:s,height:a}=t,{minImageSize:n}=o;return s<n||a<n?(B.Z.warn({mainText:N.I18n.t("pc_stickers_release_failed_web"),subText:N.I18n.t(r.minImageSize,{X:n}),confirmBtnText:N.I18n.t("pc_stickers_release_confirm_web")}),i.sendStickerImportErrorLog({collection_detail:l,error_report:`width or height < ${n}`}),(0,W.c6)(`[CollectionStore] ${l} checkLocalUploadRequirements not passed: minImageSize`,{width:s,height:a,minImageSize:n}),null):t},destroy(){l.stopCheckGenerateCollectionCover()}})),{formApi:!1,generateCollectionCoverWatcher:!1});return l.generateCollectionCoverWatcher=(0,z.e)({watch:()=>l.generateCollectionCoverIfNeeded()}),(0,K.L)({watch:()=>{l.uploadStats,l.isReadyToPublish},collect:l.collectLogData}),(0,se.u)({watch:()=>l.needConfirmModalOnClose}),(0,w.useEffect)((()=>(window.store=l,l.importServ.uploadConfigService.updateCache(),l.authorSignService.init(),l.performanceTimingCollector.addRenderTiming(ae.Pk),()=>{t.destroy(),l.importServ.destroy()})),[]),l}const pe=(0,w.createContext)(null),me=()=>(0,w.useContext)(pe),ue=(0,o.Pi)((e=>{const{className:t}=e,i=me(),{collection:o}=i;return(0,x.jsx)(b,{className:t,selected:i.isCollectionCoverCardSelected,coverSrc:o.cover.url,title:o.title,description:o.description,isInfoComplete:o.isInfoComplete,onClick:i.selectCollectionCoverCard})}));var ge=i(84133);const Se="root-krHCkJ",_e="disabled-n2Aq_E",he="percent-uW3VlL",ve=(0,o.Pi)((e=>{const{className:t,onClick:i}=e,o=me(),{t:l}=(0,r.$)(),s=(()=>{const{ready:e,pending:t,failed:i}=o.stickersForOnlineImageEditorStats;return e<4?{tooltip:l("pc_sticker_import_least_{X}_web",{X:4}),percent:null}:0===t&&0===i?null:{tooltip:o.retryTimesForOnlineImageEditor>1?l("pc_sticker_failed_retrying_web"):l("pc_sticker_loading_web"),percent:Math.floor(e/(e+t+i)*100)}})(),{handleMouseEnter:a}=(0,m.w)({content:null==s?void 0:s.tooltip,cursor:"not-allowed"});return(0,x.jsxs)("div",{className:c()(t,Se,s&&_e),onClick:e=>{s?e.stopPropagation():i(e)},onMouseEnter:s?a:void 0,children:[(0,x.jsx)("span",{children:l("pc_stickers_release_online_puzzle_web")}),s&&null!==s.percent&&(0,x.jsxs)("span",{className:he,children:[s.percent,"%"]})]})}));var fe;function ke(){return ke=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)({}).hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},ke.apply(null,arguments)}const Ce=e=>w.createElement("svg",ke({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),fe||(fe=w.createElement("path",{fill:"#D4A500",d:"M8 14c3.292 0 6-2.71 6-6.003S11.292 2 8 2 2 4.703 2 7.997 4.708 14 8 14m0-5.142c-.391 0-.62-.217-.638-.614l-.09-2.493c-.024-.421.277-.704.722-.704s.752.289.728.71l-.09 2.48c-.018.404-.247.621-.632.621m0 2.047c-.445 0-.794-.283-.794-.71 0-.428.349-.717.794-.717.451 0 .788.29.788.717s-.343.71-.788.71"})));var xe=i(17150);const be="root-OOqubc",Ie="loadingText-blkQ9S",we="errorText-b8vNmn",Fe="retryText-cBAROb",ye="warnText-XizvZZ",Ue=e=>{const{className:t,isUploadFailed:i,onRetry:o,needImport:l,loading:s}=e,a=c()(be,t),{t:n}=(0,r.$)();return i?(0,x.jsx)("div",{className:a,children:(0,x.jsx)("span",{className:we,children:n("pc_stickers_release_error_x_web",{X:(0,x.jsx)("span",{className:Fe,onClick:o,children:n("pc_stickers_release_click_again_web")},"X")})})}):l?(0,x.jsxs)("div",{className:a,children:[(0,x.jsx)(Ce,{height:14,width:14}),(0,x.jsx)("span",{className:ye,children:n("pc_stickers_release_add_cover_web")})]}):s?(0,x.jsxs)("div",{className:a,children:[(0,x.jsx)(xe.a,{size:12,arcColor:"var(--grey-1)"}),(0,x.jsx)("span",{className:Ie,children:n("pc_stickers_release_in_web")})]}):(0,x.jsx)("div",{className:a})},Ne="root-SiuXcn",je="icon-pvz0IF",Ee=e=>{const{className:t,src:i}=e,o=c()(Ne,t);return(0,x.jsx)("div",{className:o,children:i?(0,x.jsx)("img",{className:je,src:i}):(0,x.jsx)(d.t,{className:je,iconWidth:28})})};var Ae=i(73994);const qe="root-RGRrw_",Pe="statusBar-g7EX3X",Le="edit-gNJiPH",Te="editMenuItem-Lwrrxl",Re=(0,o.Pi)((e=>{const t=me(),{t:i}=(0,r.$)(),{cover:o}=t.collection;return(0,x.jsxs)("div",{className:qe,children:[(0,x.jsx)(Ee,{src:o.url}),(0,x.jsx)(F.J2,{position:"bottomRight",trigger:"click",className:Ae.i.heycanPopoverWrapperClearStyle,clickToHide:!0,onVisibleChange:e=>{e&&t.retryUploadForOnlineImageEditor()},content:(0,x.jsx)(ge.m,{items:[{key:"openCoverImageEditor",render:({key:e,className:i})=>(0,x.jsx)(ve,{className:i,onClick:t.openCoverImageEditor},e)},{key:"localUploadCover",render:({key:e,className:o})=>(0,x.jsx)("div",{className:c()(o,Te),onClick:t.localUploadCover,children:i("pc_stickers_release_local_web")},e)}]}),children:(0,x.jsx)("div",{className:Le,children:i("pc_stickers_release_cover_edit_web")})}),(0,x.jsx)(Ue,{className:Pe,isUploadFailed:o.isUploadFailed,onRetry:t.retryUpload,needImport:o.needImport,loading:!o.url&&!o.needImport})]})}));var ze=i(45417),Me=i(45220),Oe=(i(94443),i(67411));const $e=(0,i(93556).A)((function(e){return w.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),w.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.35 4.27c.68.47.86 1.4.38 2.08l-10 14.5a1.5 1.5 0 0 1-2.33.17l-6.5-7a1.5 1.5 0 0 1 2.2-2.04l5.23 5.63 8.94-12.96a1.5 1.5 0 0 1 2.08-.38Z",fill:"currentColor"}))}),"tick"),Be="rules-dY0ScJ",Ve="item-AGHWKH",De="iconDot-j9ob_p",Ze="iconTick-D79ceF",We="content-g4kRtr",Xe=({className:e,rules:t})=>(0,x.jsx)("div",{className:c()([Be,e]),children:t.map(((e,t)=>(0,x.jsxs)("div",{className:Ve,children:[(void 0===e.status||"normal"===e.status)&&(0,x.jsx)("div",{className:De}),"success"===e.status&&(0,x.jsx)($e,{className:Ze}),(0,x.jsx)("p",{className:We,children:e.content})]},t)))});var Ge=i(33921);const Je="root-E0tpJM",He="title-H2crax",Ye="word-BtnjNE",Qe="help-XAH_LZ",Ke="opt-QOw283",et="highLight-PASzWv",tt="content-SmW56E",it="imgBox-q1y7Qu",ot="img-fx46qr",rt="statusBar-QLDUGu",lt="loadingText-uP8NbU",st="retryText-RzWB7U",at="example-p5VW7t",nt="contextMenuItem-tm8D3m",ct="editMenuItem-COaeTW",dt="failedImg-rOcYXw",pt=()=>{const{t:e}=(0,r.$)();return(0,x.jsxs)("div",{className:Ye,children:[e("pc_sticker_sample_web"),(0,x.jsx)(F.J2,{content:(0,x.jsx)("div",{className:at,children:(0,x.jsx)(Xe,{rules:[{content:`${e("file_format_web")}PNG/GIF`},{content:e("pc_stickers_prompt_w_{X}_h_{Y}_web",{X:"1000px",Y:"1250px"})},{content:e("file_size_limit_web",{X:5})}]})}),children:(0,x.jsx)(Oe.Z,{size:"small",className:Qe})})]})},mt=(0,o.Pi)((({className:e})=>{const t=me(),{t:i}=(0,r.$)(),o=t.collection.exampleImages[0],{handleContextMenu:l}=(0,Ge.D)({content:(0,x.jsx)(ge.m,{items:[{key:"remove",render:({key:e,className:o})=>(0,x.jsx)("div",{className:c()(o,nt),onClick:t.removeExample,children:i("pc_stickers_release_delete_web")},e)}]})}),s=(0,w.useMemo)((()=>{const e=o;return e?null!=e&&e.url?(0,x.jsx)("div",{className:it,children:(0,x.jsx)("img",{className:ot,src:null==e?void 0:e.url,alt:""})}):(0,x.jsx)("div",{className:it,children:(0,x.jsx)(d.t,{className:dt,iconWidth:17})}):null}),[null==o?void 0:o.isUploadFailed,null==o?void 0:o.url]);return(0,x.jsx)("div",{className:c()(Je,e),children:(0,x.jsxs)("div",{className:He,children:[(0,x.jsx)(pt,{}),(0,x.jsx)("div",{className:tt,onContextMenu:e=>{l(e)},children:(0,x.jsxs)(x.Fragment,{children:[s,null!=o&&o.isUploadFailed?(0,x.jsx)("div",{className:rt,children:i("pc_stickers_release_error_x_web",{X:(0,x.jsx)("span",{className:st,onClick:t.retryUpload,children:i("pc_stickers_release_click_again_web")},"X")})}):null==o||!o.id||null!=o&&o.url?null:(0,x.jsxs)("div",{className:rt,children:[(0,x.jsx)(xe.a,{size:12,arcColor:"var(--grey-1)"}),(0,x.jsx)("span",{className:lt,children:i("pc_stickers_release_in_web")})]})]})}),(0,x.jsx)("div",{className:Ke,children:(0,x.jsx)(F.J2,{position:"bottomRight",trigger:"click",clickToHide:!0,content:(0,x.jsx)(ge.m,{items:[{key:"openCoverImageEditor",render:({key:e,className:i})=>(0,x.jsx)(ve,{className:i,onClick:t.openExampleImageEditor},e)},{key:"localUploadCover",render:({key:e,className:o})=>(0,x.jsx)("div",{className:c()(o,ct),onClick:t.localUploadExample,children:i("pc_stickers_release_local_web")},e)}]}),children:(0,x.jsx)("span",{className:et,children:i("pc_sticker_edit_web")})})})]})})}));var ut=i(69508),gt=i(93585),St=i(54970),_t=i(34549),ht=i(56230),vt=i(26851);const ft="root-VsnTC4",kt="label-Bpq1iR",Ct="useAll-TIjXSy",xt="advancedSettingsTitle-eGU9np",bt="exampleImageField-Z2iuTF",It="fpsSettingsField-ADkz4K",wt="input-dtQ3J2",{Label:Ft}=F.Form,yt=(0,o.Pi)((()=>{const{t:e}=(0,r.$)(),t=me(),{importServ:i,collection:o}=t,{stickerListStore:l}=i,{authConfig:s}=l.materialPostConfig,{mustPaidAuth:a}=s,{postChannel:n,targetedActivityId:c}=o.formState,[d,p]=(0,w.useState)([]),{getDisplayLength:m}=(0,ht._)();(0,w.useLayoutEffect)((()=>t.initCollectionFields()),[]),(0,w.useEffect)((()=>{d.length||async function(){return(await(0,G.ip)({effect_type:j.Ab.Sticker})).tasks.map((e=>({label:e.title,value:e.task_id})))}().then((e=>{p(e)}))}),[]),(0,w.useEffect)((()=>{E.$.isEnableAuthorization&&u(!0)}),[E.$.isEnableAuthorization]);const u=e=>{var i;t.updateCollectionFormState({isVip:e}),null===(i=t.formApi)||void 0===i||i.setValue("collection",{...t.formApi.getValue("collection"),isVip:e})};return(0,x.jsxs)("div",{className:ft,children:[(0,x.jsx)(Re,{}),(0,x.jsx)(ze.y,{fieldClassName:wt,label:e("pc_stickers_release_group_name_web"),field:"collection.title",maxLength:T.S8,placeholder:e("pc_stickers_release_xy_name_web",{X:1,Y:m(T.S8)}),rules:[{required:!0,message:""}],onChange:e=>t.updateCollectionFormState({title:e})}),(0,x.jsx)(ze.y,{fieldClassName:wt,label:e("pc_stickers_release_details_recommend_web"),field:"collection.description",maxLength:T.Us,placeholder:e("pc_stickers_release_xy_details_web",{X:1,Y:m(T.Us)}),onChange:e=>t.updateCollectionFormState({description:e})}),(0,x.jsxs)("div",{className:kt,children:[(0,x.jsx)(Me.u,{fieldClassName:wt,label:e("pc_stickers_release_tag_set_web"),placeholder:e("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"collection.tags",itemType:j.Ab.Sticker,recommendConfig:{title:o.title,uri:o.cover.uri},rules:[{required:!0,message:""}],onChange:e=>t.updateCollectionFormState({tags:e})}),(0,x.jsx)("span",{className:Ct,onClick:()=>{var e,i;const o=null===(e=t.formApi)||void 0===e?void 0:e.getValues();l.applyForTags((null==o||null===(i=o.collection)||void 0===i?void 0:i.tags)||[])},children:e("pc_stickers_release_apply_all_web")})]}),(0,x.jsxs)("div",{className:kt,children:[(0,x.jsx)(Ft,{required:!0,text:e("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,x.jsx)(_t.Z,{value:{postChannel:n,activityId:c},onChange:e=>{const i={postChannel:e.postChannel,targetedActivityId:e.activityId};t.updateCollectionFormState(i)},taskList:d,loading:!d.length,viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/PDNEdbBZxoXibnxSGn5l7U7Xgre?open_in_browser=true",onOrientationViewMoreClick:()=>{t.sendLogServ.sendPageActionLog({action:"click_more_official_task"})}})]}),!1,(0,x.jsx)(gt.Z,{required:a,children:(0,x.jsx)("div",{className:vt.Z.authGroup,children:(0,x.jsx)(St.R,{noLabel:!0,field:"collection.isVip",disabled:E.$.isEnableAuthorization,disabledTooltip:e("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:a?e("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:t.sendLogServ,onChange:e=>{var i;e&&(null===(i=t.sendLogServ)||void 0===i||i.sendPageActionLog({action:"choose_subscription_authorize"}));u(e)}})})}),(0,x.jsx)("div",{className:xt,children:e("pc_stickers_release_higher_settings_web")}),(0,x.jsx)(mt,{className:bt}),t.field.canFpsSetting&&(0,x.jsx)(ut.ZP,{className:It,prefix:"collection",onStartEdit:()=>t.sendLogServ.sendStartEditSequenceSettingsLog({}),onSave:t.saveSequenceSettingsForCollection})]})}));var Ut=i(10758),Nt=i(40358);const jt="collectionCoverCard-Wqf4av",Et="stickerList-Opl43w",At=(0,o.Pi)((e=>{const{className:t}=e,i=me(),{t:o}=(0,r.$)();return(0,Y.pg)(i),(0,s.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:o("pc_sticker_release_drag_web"),titleForMainForm:o("pc_stickers_release_drag_in_web"),subTitle:o("pc_sticker_release_groups_png_web"),draggingTitle:o("pc_sticker_release_mouse_web"),disabled:i.isImportDisabled,disabledTooltip:o("pc_stickers_release_max_x_web",{X:T.qb}),onClick:i.openStickerFilePicker,onDrop:i.uploadDroppedStickerFiles},importLoadingText:o("pc_sticker_release_loading_web"),setFormApi:i.setFormApi,renderImportArea:e=>(0,x.jsxs)(x.Fragment,{children:[e,(0,x.jsx)(ue,{className:jt}),(0,x.jsx)(a.z,{className:Et,importStickerFileService:i.importServ,onSelect:i.selectSticker,onReimport:i.reimportSticker})]}),renderFormArea:()=>{if(i.isCollectionCoverCardSelected)return(0,x.jsx)(yt,{});const{selectedSticker:e}=i.stickerListStore;return e&&(0,x.jsx)(Ut.E,{importStickerFileService:i.importServ,sticker:e,initFields:i.initSingleFields,onStartEditSequenceSettings:()=>i.sendLogServ.sendStartEditSequenceSettingsLog({collection_detail:"collection_material"}),onSaveSequenceSettings:i.saveSequenceSettingsForSingle})},scrollAreaRef:i.importServ.stickerListStore.scrollAreaRef,onRetry:Nt.cb})}));var qt=i(14986),Pt=i(67509);const Lt=(0,o.Pi)((e=>{const{className:t}=e,i=me(),o=(0,w.useRef)(null),{t:l}=(0,r.$)();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(qt.P,{className:t,leftText:l("pc_sticker_release_X_web",{X:i.importLoadingStore.isImportLoading?0:i.stickerListStore.stickers.length,Y:T.r$,Z:T.qb}),isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>i.uploadAndPublish(o.current)}),(0,x.jsx)(Pt.q,{ref:o,uploadStats:i.uploadStats,onRetryUpload:i.retryUpload,onCancel:i.isAllUploadedWatcher.stop,onShowUploadFail:i.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var Tt=i(62293),Rt=i(90856);const zt="page-bI3zoQ",Mt="content-CkDfjt",Ot="requirement-CWgpLc",$t="mainForm-GIDO1U",Bt="footer-YVeBwr",Vt=(0,o.Pi)((()=>{const e=de(),{t}=(0,r.$)(),{selectedSticker:i}=e.importServ.stickerListStore;return(0,Tt.F)({title:t("pc_stickers_release_ing_web"),pid:"sticker-publish-collection"}),(0,Rt.d)(),(0,Y.t9)(e.sendLogServ),(0,x.jsxs)(pe.Provider,{value:e,children:[(0,x.jsxs)("div",{className:zt,children:[(0,x.jsxs)("div",{className:Mt,children:[(0,x.jsx)(l.n,{className:Ot,sticker:i}),(0,x.jsx)(At,{className:$t})]}),(0,x.jsx)(Lt,{className:Bt})]}),!1]})}))},85918:(e,t,i)=>{i.d(t,{F2:()=>r,J9:()=>o,lm:()=>l});i(57705);const o=async e=>{const t=await fetch(e);return(e=>URL.createObjectURL(e))(await t.blob())},r=(e,t="")=>`data:${t};base64,${e}`;const l=e=>e.toLowerCase().split(".").pop()}}]);