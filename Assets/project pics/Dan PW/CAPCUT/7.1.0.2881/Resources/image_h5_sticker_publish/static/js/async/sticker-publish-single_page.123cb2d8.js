"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[8948],{54290:(e,t,i)=>{i.d(t,{Ab:()=>r});let r=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},68288:(e,t,i)=>{i.d(t,{ir:()=>_});var r=i(18571),s=i(18751),o=i.n(s),a=i(42716),n=i(12247),l=i(77991),c=i(92644),u=i(17150),d=i(37964),p=i(71410),m=i(7890),S=i(72322);const g=e=>{const{className:t,loadingText:i}=e,{t:r}=(0,a.$)(),{handleMouseEnter:s}=(0,d.S)();return(0,S.jsxs)("div",{className:o()(m.Z.root,t),children:[(0,S.jsx)(u.a,{className:m.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,S.jsx)("div",{className:m.Z.text,onMouseEnter:s,children:i||r("pc_stickers_release_in_web")})]})},f=e=>{const{className:t,tooltip:i}=e,{t:s}=(0,a.$)(),{handleMouseEnter:l}=(0,d.w)({content:i,className:m.Z.tooltip}),c=(0,r.useRef)(null),{setIsMarqueeLoopRunning:u,reactNode:g}=(0,p.J)({text:s("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,S.jsxs)("div",{className:o()(m.Z.root,t,m.Z.error),onMouseEnter:e=>{u(!0),l(e)},onMouseLeave:()=>u(!1),children:[(0,S.jsx)(n.r,{className:m.Z.icon}),(0,S.jsx)("div",{ref:c,className:m.Z.text,children:g})]})},h=e=>{const{className:t,text:i}=e,{handleMouseEnter:r}=(0,d.S)();return(0,S.jsxs)("div",{className:o()(m.Z.root,t,m.Z.checked),children:[(0,S.jsx)(c.r,{className:m.Z.icon}),(0,S.jsx)("div",{className:m.Z.text,onMouseEnter:r,children:i})]})},k=e=>{const{className:t}=e,{t:i}=(0,a.$)(),{handleMouseEnter:r}=(0,d.S)();return(0,S.jsxs)("div",{className:o()(m.Z.root,t),children:[(0,S.jsx)("div",{className:o()(m.Z.icon,m.Z.yellowIcon),children:(0,S.jsx)("div",{className:m.Z.yellowPoint})}),(0,S.jsx)("div",{className:m.Z.text,onMouseEnter:r,children:i("pc_stickers_release_editing_web")}),(0,S.jsx)(l.r,{className:m.Z.icon})]})},_=e=>{const{className:t,loading:i,invalid:r,errorToolip:s,isInfoComplete:o,title:a,loadingText:n}=e;return i?(0,S.jsx)(g,{className:t,loadingText:n}):r?(0,S.jsx)(f,{className:t,tooltip:s}):o?(0,S.jsx)(h,{className:t,text:a}):(0,S.jsx)(k,{className:t})}},39110:(e,t,i)=>{i.d(t,{$X:()=>o,pn:()=>s});var r=i(48647);function s({isVip:e,isBusiness:t,authFiles:i}){var s;const o=null!==(s=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==s?s:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:r.$x.Vip,auth_status:e?r.U9.Authorized:r.U9.Unauthorized,third_party_agreements:[]},{scene:r.$x.Business,auth_status:t?r.U9.Authorized:r.U9.Unauthorized,third_party_agreements:t?o:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function o(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===r.U9.Authorized)))}},60930:(e,t,i)=>{i.d(t,{BI:()=>d,DefaultImportStickerFileRequest:()=>l,N7:()=>a,Q0:()=>n,R8:()=>s,S8:()=>u,fD:()=>o,mr:()=>c});var r=i(79292);let s=function(e){return e.Static="static",e.GIF="gif",e.Sequence="sequence",e}({}),o=function(e){return e.Format="format",e.MinImageSize="minImageSize",e.RecommendFileSize="RecommendFileSize",e.SequenceNumber="SequenceNumber",e}({});const a={fps:16,loop:!0},n={maxCount:49,minCount:2,minImageSize:360,maxImageSize:1080,maxFileSize:20971520},l={accept:".png,.jpg,.jpeg,.gif",multiple:!0,enableImportSequence:!0,thumbnailSize:200,minImageSize:360,maxImageSize:800,maxFileSize:20971520},c={fps:16,loop:!0,gen_size:0,gif_gen_opts:[{bg_color:"#242424",width:200,height:200,padding:0},{bg_color:"",width:0,height:0,padding:0}]},u=40,d={[s.Static]:{[o.Format]:r.I18n.t("pc_stickers_release_format_web"),[o.MinImageSize]:r.I18n.t("pc_stickers_release_size_min_web"),[o.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")},[s.GIF]:{[o.Format]:r.I18n.t("pc_stickers_release_format_gif_web"),[o.MinImageSize]:r.I18n.t("pc_stickers_release_size_min_web"),[o.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")},[s.Sequence]:{[o.Format]:r.I18n.t("pc_stickers_release_png_groups_web_web"),[o.MinImageSize]:r.I18n.t("pc_stickers_release_reccomend_size_web"),[o.SequenceNumber]:r.I18n.t("pc_stickers_release_amount_web"),[o.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")}}},52255:(e,t,i)=>{i.d(t,{B3:()=>S,Nf:()=>g,WQ:()=>h,w3:()=>f});var r=i(32547),s=i(18571),o=i(20165),a=i(54290),n=i(1234),l=i(60930),c=i(13928),u=i(85918),d=i(39110),p=i(48647),m=i(46350);function S(e){return e.coverSrc||e.firstFrameCoverSrc}function g(e){return e.isSequence&&Boolean(e.isSequenceSettingsUpdating||e.firstFrameCoverSrc&&!e.coverSrc&&!e.isUploadFailed)}function f(e){return e.isSequence||"gif"===(0,u.lm)(e.path)}function h(e){const t=(0,o.fv)((()=>({stickers:[],scrollAreaRef:(0,s.createRef)(),materialPostConfig:new m.E(a.Ab.Sticker),get hasStickers(){return this.stickers.length>0},selectedId:null,get selectedSticker(){return t.selectedId?t.getSticker(t.selectedId):null},setScrollAreaRef(e){t.scrollAreaRef=e},addStickers(e){t.stickers.push(...e)},getSticker:e=>{var i;return null!==(i=t.stickers.find((t=>t.id===e)))&&void 0!==i?i:null},selectSticker(e){t.selectedId=e,t.selectedSticker&&(t.selectedSticker.hasEverSelected=!0)},updateThumbnailSrc(e,t){e.isSequence?e.firstFrameCoverSrc=t:e.coverSrc=t},updateUploadedData(e,t,i){if(e.uri=t,!e.isSequence)return e.coverUri=t,void(e.largeImageUri=t);if(i){const{gifCover:t,gifLargeImage:r,stickerPackage:s}=i;e.coverUri=t.uri,e.coverSrc=t.blobUrl,e.largeImageUri=r.uri,e.stickerPackage=s,e.isSequenceSettingsUpdating=!1}},updateUnmetRequirements(e,t){e.unmetRequirements=t,e.hasCheckedRequirements=!0},setUploadFailed(e){e.isUploadFailed=!0,e.isSequenceSettingsUpdating=!1},get isAllStickersThumbnailReady(){return t.stickers.length>0&&t.stickers.every((e=>S(e)))},applyForTags:e=>{t.stickers.forEach((t=>{t.formState.tags=e}))},applyAuthSettingsToAll:({isOriginal:e,isBusiness:i,isVip:r})=>{t.stickers.forEach((t=>{t.formState.isOriginal=Boolean(e),t.formState.isBusiness=Boolean(i),t.formState.isVip=Boolean(r)}))},applyPublishDirectionToAll:({postChannel:e,targetedActivityId:i})=>{t.stickers.forEach((t=>{t.formState.postChannel=e,t.formState.targetedActivityId=i}))},makeInitFormState:e=>({title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1,...l.N7,sequenceSettingsApplyToAll:!1,...e}),updateFormState(e,t){Object.assign(e.formState,t)},makeInitSticker(i){const{title:r,isInfoComplete:s,formState:o,path:a="",isSequence:d=!1,...m}=i,S=function(e,t){const i=(0,u.lm)(e);if(t)return l.R8.Sequence;if("gif"===i)return l.R8.GIF;if(["png","jpg","jpeg"].includes(i))return l.R8.Static;throw new Error(`Unsupported suffix ${i}`)}(a,d),g=function(e,t){const i=e.split(/[\\/]/g).pop(),r=t?i:i.replace(/\.\w+?$/g,"");return(0,c.aF)(r,l.S8)}(a,d),f=n.$.isEnableAuthorization,{mustPaidAuth:h}=this.materialPostConfig.authConfig;return{id:"",path:a,get title(){return this.formState.title},fileType:S,width:0,height:0,isSequence:d,firstFrameCoverSrc:"",coverSrc:"",uri:"",coverUri:"",largeImageUri:"",stickerPackage:{uri:"",md5:"",size:0},sequenceSettings:{fps:0,loop:!1,...i.isSequence&&l.N7},hasEverSelected:!1,get isInfoComplete(){const{postChannel:t,targetedActivityId:i}=this.formState;{const s="single"===e,o="single"===e,a=t===p.iu.Open||t===p.iu.Targeted&&Boolean(i);return Boolean(this.title&&this.formState.tags.length>0)&&(r=this.formState.isVip,h&&r||!h||!s)&&(a||!o)}var r},unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,isSequenceSettingsUpdating:!1,formState:t.makeInitFormState({title:g,isVip:f}),...m}},reimportSticker(e,i){const r=t.stickers.findIndex((t=>t.id===e));-1!==r&&(t.stickers[r]=i)},startToRetryUploadStickers(e){e.forEach((e=>{const i=t.getSticker(e);i&&(i.isUploadFailed=!1)}))},startToUpdateSequenceSettings(e,t){e.forEach((e=>{e.sequenceSettings=t,e.largeImageUri&&(e.largeImageUri="",e.coverUri="",e.stickerPackage={uri:"",md5:"",size:0},e.isSequenceSettingsUpdating=!0)}))},removeSticker(e){t.stickers=t.stickers.filter((t=>t.id!==e.id))},dragInsert(e,i){const r=t.stickers.splice(e,1),s=e>i?i+1:i;t.stickers.splice(s,0,...r)},get isReadyToPublish(){return t.stickers.every((e=>e.hasCheckedRequirements&&0===e.unmetRequirements.length&&e.isInfoComplete))},get uploadStats(){let e=0,i=0,r=0;return t.stickers.forEach((t=>{if(t.isUploadFailed)return void(i+=1);(t.isSequence?t.largeImageUri:t.uri)?e+=1:r+=1})),{pending:r,succeeded:e,failed:i}},collectLogData:()=>t.stickers.map((e=>({...(0,r.Z)(e,["id","isSequence","isInfoComplete","hasEverSelected","isUploadFailed","uri"]),...e.isSequence&&{isSequenceUpdating:e.isSequenceSettingsUpdating,largeImageUri:e.largeImageUri,...e.sequenceSettings}}))),makePublishItemList:(e={})=>t.stickers.map((t=>{var i;const{id:r,isSequence:s,formState:o,stickerPackage:n}=t,{is_vip:l=Boolean(o.isVip),is_business:c=o.isBusiness,is_original:u=o.isOriginal,postChannel:m=o.postChannel,targetedActivityId:S=o.targetedActivityId,sourceForSimple:g=p.r0.UserPostPc,sourceForSequence:h=p.r0.UserPostPcSequence,authFileUploadServiceManager:k,onResult:_}=e,v=s?h:g,b=(0,d.pn)({isVip:l,isBusiness:c,authFiles:null!==(i=null==k?void 0:k.getUploadedFiles(r))&&void 0!==i?i:[]});return{id:r,req:{effect_type:a.Ab.Sticker,is_vip:l,...b.root,common_data:{title:o.title,description:o.title,icon:{image_uri:t.coverUri},sdk_version:"1.0.0",source:v,tags:[...o.tags],is_original:u,is_business:c,...b.commonData,...s&&{file:{file_uri:n.uri,file_md5:n.md5,size:n.size}},post_channel:m===p.iu.Targeted?`${p.iu.Targeted}_${S}`:m,web_extra:JSON.stringify({targeted_id:S})},sticker:{large_image:{image_uri:t.largeImageUri},sticker_type:f(t)?p.Ic.Dynamic:p.Ic.Static,no_multi_sticker:!1,package_size:0}},onResult:e=>null==_?void 0:_(t,e)}}))})));return t}},84832:(e,t,i)=>{i.r(t),i.d(t,{default:()=>se});var r=i(65625),s=i(42716),o=(i(67068),i(47938)),a=i(18571),n=i(14986),l=i(67509),c=i(60963),u=i(20165),d=i(79337),p=i(79292),m=i(54290),S=i(1234),g=i(52255),f=i(78002),h=i(84202),k=i(22664),_=i(71157),v=i(15621),b=i(88154),F=i(31062),I=i(7561),w=i(83305),A=i(12803),y=i(48647);function U(e){return Boolean(e.id)}class x{constructor(){(0,b.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,F.Z)(e,10)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:r,onUpdateResult:s}=e,o=JSON.parse(JSON.stringify(e.req));let a=this.itemMap.get(i);if(null!==(t=a)&&void 0!==t&&t.promise&&(0,I.Z)(a.req,o))try{return await a.promise}catch(n){(0,w.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return a={promise:null,id:i,req:o,onResult:r,onUpdateResult:s},this.itemMap.set(i,a),a.promise=this.publishImpl(a),a.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,r)=>{try{const a={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:r};var s,o;if(U(e.req))await(null===(s=e.onUpdateResult)||void 0===s?void 0:s.call(e,{req:e.req,...a}));else await(null===(o=e.onResult)||void 0===o?void 0:o.call(e,{req:e.req,...a}))}catch(a){(0,w.RF)("[MaterialPublishService] callOnResult failed",a)}};let r;try{r=await this.postOrUpdate(e)}catch(s){throw e.promise=null,i(s,""),s}return await i(null,r.resource_id),r}async postOrUpdate(e){return U(e.req)?(await(0,y.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,y.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new A.B).timeout(5e3)])}catch(t){(0,w.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),r=new A.B,s={count:50,effect_types:t,uid:S.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,y.Js)(s).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await r.timeout(500)}}}var C=i(17356),q=i(55731),L=i(7022),P=i(57494),T=i(47791),N=i(47573),R=i(52272),M=i(76664),E=i(22531),z=i(33452);const j="ImportSticker";const B=(0,a.createContext)(null),Z=()=>(0,a.useContext)(B);var O=i(72322);const $=(0,r.Pi)((e=>{const{className:t}=e,i=Z(),{t:r}=(0,s.$)(),o=(0,a.useRef)(null);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(n.P,{className:t,leftText:r("pc_sticker_import_zero_to_hundred_web",{X:i.importLoadingStore.isImportLoading?0:i.stickerListStore.stickers.length,Y:i.maxStickerCount}),isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>i.uploadAndPublish(o.current)}),(0,O.jsx)(l.q,{ref:o,uploadStats:i.stickerListStore.uploadStats,onRetryUpload:i.retryUpload,onCancel:i.isAllUploadedWatcher.stop,onShowUploadFail:i.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var D=i(32547),V=i(21418),W=i(18775),J=i(10758),G=i(40358);const X="stickerList-Tcr1X1",Q=(0,r.Pi)((e=>{const{className:t}=e,i=Z(),{t:r}=(0,s.$)();return(0,C.pg)(i),(0,V.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:r("pc_sticker_release_drag_web"),titleForMainForm:r("pc_stickers_release_drag_in_web"),subTitle:r("pc_sticker_release_groups_png_web"),draggingTitle:r("pc_sticker_release_mouse_web"),disabled:i.isImportDisabled,disabledTooltip:r("pc_stickers_release_max_x_web",{X:i.maxStickerCount}),onClick:i.openStickerFilePicker,onDrop:i.uploadDroppedStickerFiles},setFormApi:i.setFormApi,renderImportArea:e=>(0,O.jsxs)(O.Fragment,{children:[e,(0,O.jsx)(W.z,{className:X,importStickerFileService:i.importServ,onSelect:i.selectSticker,onReimport:i.reimportSticker})]}),renderFormArea:()=>{const{selectedSticker:e}=i.stickerListStore;return e&&(0,O.jsx)(J.E,{importStickerFileService:i.importServ,sticker:e,initFields:i.initFields,controlField:i.field,onStartEditSequenceSettings:()=>i.sendLogServ.sendStartEditSequenceSettingsLog({}),authProps:(0,D.Z)(i,"authorSignService","authFileUploadServiceManager","sendLogServ"),showPublishDirection:!0,onSaveSequenceSettings:i.saveSequenceSettings,sendLogServ:i.sendLogServ})},scrollAreaRef:i.importServ.stickerListStore.scrollAreaRef,onRetry:G.cb})}));var Y=i(62293),H=i(90856);const K="page-BXIsLv",ee="content-z8aW2X",te="requirement-FGjxIs",ie="mainForm-qv90fk",re="footer-JhzMqS",se=(0,r.Pi)((()=>{const e=function(){const e=(0,g.WQ)("single"),t=(0,f.WQ)({stickerListStore:e}),i=new C.YL({itemType:m.Ab.Sticker}),r=(0,N.G)({watch:()=>o.isAllUploaded}),s=(0,a.useMemo)((()=>new v.l),[]),o=(0,u.fv)((()=>({formApi:null,setFormApi:e=>{o.formApi=e},mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===o.mainFormLayoutAfterLoading&&_.appModel.isInitFailed?"error":o.mainFormLayoutAfterLoading},get maxStickerCount(){return S.$.permissions.includes(S.v.EffectBatchMore)?50:20},get isImportDisabled(){return e.stickers.length>=o.maxStickerCount},stickerListStore:e,importLoadingStore:t,importServ:new k.T({api:new h.r,stickerListStore:e,sendLogServ:i,needSaveSequenceGifUrl:!1}),pubServ:new x,sendLogServ:i,authorSignService:new P.I({signScene:M.d.BusinessArtist}),authFileUploadServiceManager:new T.r({}),performanceTimingCollector:(0,z.uY)(),get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1,canIconBlank:S.$.permissions.includes(S.v.EffectIconBlank),canHighPro:S.$.permissions.includes(S.v.EffectHighPrio),canPackOne:S.$.permissions.includes(S.v.StickerOnePackage)}},get permissions(){return S.$.permissions},getImportMinMaxCount(){const t=e.stickers.length;return{minCount:1,maxCount:Math.max(0,o.maxStickerCount-t),maxTotalCount:o.maxStickerCount}},openStickerFilePicker:()=>s.lock(j,(async()=>{i.sendUploadActionLog(o),await o.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"openStickerFilePicker"});const e=await o.importServ.openStickerFilePicker(o.getImportMinMaxCount());o.addNewStickers(e)})),uploadDroppedStickerFiles:()=>s.lock(j,(async()=>{i.sendUploadActionLog(o),await o.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"uploadDroppedStickerFiles"});const e=await o.importServ.uploadDroppedStickerFiles(o.getImportMinMaxCount());o.addNewStickers(e)})),reimportSticker:t=>s.lock(j,(async()=>{await o.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"reimportSticker"});const i=await o.importServ.reimportSticker(t,{});if(i){const t=e.getSticker(i);o.selectSticker(t)}})),addNewStickers(i){0!==i.length&&(e.addStickers(i),e.selectSticker(i[0].id),"uploadArea"===o.mainFormLayoutAfterLoading&&(t.showImportLoading(),o.mainFormLayoutAfterLoading="mainForm"))},selectSticker(t){o.saveFormState(),e.selectSticker(t.id)},initFields(e){var t,i;null===(t=o.formApi)||void 0===t||t.reset(),null===(i=o.formApi)||void 0===i||i.setValues({single:{...e.formState,...e.sequenceSettings}})},saveFormState(){var t;const{selectedSticker:i}=e;if(!i)return;const r=e.makeInitFormState({...null===(t=o.formApi)||void 0===t?void 0:t.getValue("single"),...i.sequenceSettings,sequenceSettingsApplyToAll:!1});e.updateFormState(i,r)},saveSequenceSettings(){var t;const{fps:r,loop:s,sequenceSettingsApplyToAll:a}=e.makeInitFormState({...null===(t=o.formApi)||void 0===t?void 0:t.getValue("single")}),n={fps:r,loop:s};o.importServ.updateSequenceSettings({newSettings:n,isApplyToAll:a}),i.sendSaveSequenceSettingsLog({collection_detail:"collection_material",sequenceSettings:{fps:r,loop:s,sequenceSettingsApplyToAll:a}})},get needConfirmModalOnClose(){return e.stickers.length>0},get isAllUploaded(){const{pending:e,failed:t}=o.stickerListStore.uploadStats;return!e&&!t},isAllUploadedWatcher:r,async uploadAndPublish(e){i.sendPageActionLog({action:"publish"}),o.isAllUploaded||(await o.retryUpload(),null==e||e.show(),await o.isAllUploadedWatcher.start());try{await o.publish()}finally{null==e||e.hide()}},get isReadyToPublish(){return e.stickers.length>0&&e.isReadyToPublish&&!o.isPublishSucceeded},collectLogData(){const t=e.collectLogData(),{isReadyToPublish:i,uploadStats:r}=e,s={stickers:t,stickersCount:t.length,stickersReadyToPublish:i,uploadStats:r};(0,w.c6)("[SingleStore] collectLogData",s)},isPublishing:!1,isPublishSucceeded:!1,async publish(){o.isPublishing=!0;try{await o.publishImpl()}catch(e){return(0,w.RF)("[SingleStore] publish failed",e),d.FN.error(p.I18n.t("pc_sticker_release_failed_retry_web")),void(0,c.z)((()=>{o.isPublishing=!1}))}(0,c.z)((()=>{o.isPublishing=!1,o.isPublishSucceeded=!0})),d.FN.success(p.I18n.t("pc_sticker_release_successful_web")),(0,R.ZM)({effect_type:m.Ab.Sticker}),setTimeout((()=>(0,R.Nt)({item_type:m.Ab.Sticker})),1e3)},async publishImpl(){o.saveFormState();const t=e.makePublishItemList({authFileUploadServiceManager:o.authFileUploadServiceManager,onResult:(e,t)=>(0,q.g)({logPrefix:"[SingleStore] ",sticker:e,publishResult:t,importServ:o.importServ,sendLogServ:o.sendLogServ})});(0,w.c6)("[SingleStore] stickers publish start",{ids:t.map((e=>e.id))});const i=(await o.pubServ.batchPublish(t)).map((e=>e.resource_id));(0,w.c6)("[SingleStore] stickers publish done",{resourceIdList:i}),await o.pubServ.pollUntilAllInEffectList({ids:i.slice(-10),types:[m.Ab.Sticker]}),(0,w.c6)("[SingleStore] poll done")},sendUploadProgressModalShowErrorLog(){const e=o.stickerListStore.stickers.filter((e=>e.isUploadFailed)).map((e=>({error_report:o.importServ.getFileStats(e.id).uploadError})));i.sendStickerPublishErrorLog(e)},retryUpload(){return this.importServ.retryUpload([])}})),{formApi:!1});return(0,L.L)({watch:()=>{o.stickerListStore.uploadStats,o.isReadyToPublish},collect:o.collectLogData}),(0,E.u)({watch:()=>o.needConfirmModalOnClose}),(0,a.useEffect)((()=>(window.store=o,o.importServ.uploadConfigService.updateCache(),o.authorSignService.init(),o.performanceTimingCollector.addRenderTiming(z.Pk),()=>{t.destroy(),o.importServ.destroy()})),[]),o}(),{t}=(0,s.$)(),{selectedSticker:i}=e.importServ.stickerListStore;return(0,Y.F)({title:t("pc_stickers_release_ing_web"),pid:"sticker-publish-single"}),(0,H.d)(),(0,C.t9)(e.sendLogServ),(0,O.jsxs)(B.Provider,{value:e,children:[(0,O.jsxs)("div",{className:K,children:[(0,O.jsxs)("div",{className:ee,children:[(0,O.jsx)(o.n,{className:te,sticker:i}),(0,O.jsx)(Q,{className:ie})]}),(0,O.jsx)($,{className:re})]}),!1]})}))},85918:(e,t,i)=>{i.d(t,{F2:()=>s,J9:()=>r,lm:()=>o});i(57705);const r=async e=>{const t=await fetch(e);return(e=>URL.createObjectURL(e))(await t.blob())},s=(e,t="")=>`data:${t};base64,${e}`;const o=e=>e.toLowerCase().split(".").pop()}}]);