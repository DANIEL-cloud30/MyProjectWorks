"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[377],{52150:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Rr});var s=i(65625),a=i(18571),n=i(42716);let r=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({});const l=r.WordArt;function o(){const{t:e}=(0,n.$)();return(0,a.useMemo)((()=>({effect_type:l,pid:"publish-text-effect-single",pageTitle:e("pc_cc_text_effect_post_page_title_web"),instructions:[{key:"textEffect",title:e("pc_cc_text_effect_post_page_title_left_web"),instructions:[{key:"",title:e("pc_cc_text_effect_post_page_title_left_sub_web")}]}]})),[])}var c=i(18751),d=i.n(c),u=i(91720);const p="root-uLKAXM",m="title-zTU1ta",h="titleText-IBFt9m",f="icon-_YRcF7",g="rotate-biqGJK",v="bottom-line-nHX1wW",_="contentWrapper-Nsy6v8",x="content-nUJ6jp";var w=i(72322);const y=({visible:e,className:t,contentClassName:i,onChange:s,title:n,children:r})=>{const[l,o]=(0,a.useState)(e),[c,y]=(0,a.useState)(e?null:0),T=(0,a.useRef)(null),b=e=>{if(e!==l){var t,i;const e=null!==(t=null===(i=T.current)||void 0===i?void 0:i.getBoundingClientRect().height)&&void 0!==t?t:null;y(e)}o(e)};(0,a.useLayoutEffect)((()=>{l||requestAnimationFrame((()=>y(0)))}),[l]);return(0,a.useLayoutEffect)((()=>{b(e)}),[e]),(0,w.jsxs)("div",{className:d()(t,p),children:[(0,w.jsxs)("div",{className:m,onClick:()=>{b(!l),null==s||s(!e)},children:[(0,w.jsx)(u.Z,{className:d()(f,{[g]:l})}),(0,w.jsx)("div",{className:h,children:n})]}),(0,w.jsxs)("div",{className:_,style:{height:null!=c?c:"auto"},onTransitionEnd:()=>l&&y(null),children:[(0,w.jsx)("div",{className:v}),(0,w.jsx)("div",{ref:T,className:d()(i,x),children:r})]})]})};var T;function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},b.apply(null,arguments)}const C=e=>a.createElement("svg",b({xmlns:"http://www.w3.org/2000/svg",width:8,height:6,fill:"none",viewBox:"0 0 8 6"},e),T||(T=a.createElement("path",{stroke:"#00C1CD",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m1 3 2.143 2L7 1"})));var S;function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},F.apply(null,arguments)}const k=e=>a.createElement("svg",F({xmlns:"http://www.w3.org/2000/svg",width:6,height:6,fill:"none",viewBox:"0 0 6 6"},e),S||(S=a.createElement("path",{stroke:"#AE1C1C",strokeLinecap:"round",strokeWidth:1.5,d:"m1 1 4 4M5 1 1 5"}))),I="root-ZH_C8Z",j="icon-box-FdFonZ",L="dot-VyF22G",N="word-oYDchC",E="error-NPw70q",P=({className:e,status:t,text:i})=>{const s=d()(I,e);return"init"===t?(0,w.jsxs)("div",{className:s,children:[(0,w.jsx)("div",{className:j,children:(0,w.jsx)("span",{className:L})}),(0,w.jsx)("div",{className:N,children:i})]}):"error"===t?(0,w.jsxs)("div",{className:s,children:[(0,w.jsx)("div",{className:j,children:(0,w.jsx)(k,{className:E})}),(0,w.jsx)("div",{className:d()([N,E]),children:i})]}):(0,w.jsxs)("div",{className:s,children:[(0,w.jsx)("div",{className:j,children:(0,w.jsx)(C,{})}),(0,w.jsx)("div",{className:N,children:i})]})};var R=i(67856);const M="root-peWMdc",O="wrapper-W8rapW",D="download-MCE7pb",A="instruction-SvWEjU",U=(0,s.Pi)((e=>{const{className:t,groups:i,initGroup:s,activeGroup:n,resetExpandedGroupKey:r,getStatus:l,onClickGroupLink:o}=e,[c,u]=(0,a.useState)([s]),p=(0,a.useRef)(!1);(0,a.useLayoutEffect)((()=>{r&&p.current&&u([n])}),[r]),(0,a.useEffect)((()=>{p.current=!0}),[]);return(0,w.jsx)("div",{className:d()(t,M),children:(0,w.jsx)("div",{className:O,children:i.map((e=>(0,w.jsxs)(y,{title:e.title,visible:c.includes(e.key),onChange:()=>{return t=e.key,void(c.includes(t)?u(c.filter((e=>e!==t))):u([...c,t]));var t},children:[e.link&&(0,w.jsx)("div",{className:D,onClick:()=>{var t,i;return i=null===(t=e.link)||void 0===t?void 0:t.src,null==o||o(),void(i&&(0,R.Z)({url:i}))},children:e.link.text}),e.instructions.map((t=>{var i;return(0,w.jsx)(P,{className:A,status:null!==(i=t.status)&&void 0!==i?i:l(t,e),text:t.title},t.key)}))]},e.key)))})})})),Z=(0,s.Pi)((e=>{const{className:t}=e,{instructions:i}=o(),s=(0,a.useMemo)((()=>()=>"init"),[]);return(0,w.jsx)(U,{className:t,groups:i,initGroup:i[0].key,activeGroup:i[0].key,resetExpandedGroupKey:i[0].key,getStatus:s})}));var z,$,V=i(54275),B=i(69617);function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},W.apply(null,arguments)}const H=e=>a.createElement("svg",W({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},e),z||(z=a.createElement("rect",{width:18,height:18,fill:"#29292D",opacity:.5,rx:9})),$||($=a.createElement("path",{stroke:"#FAFAFA",strokeWidth:1.35,d:"M13.925 9a4.924 4.924 0 1 0-1.443 3.482"}))),q="root-yumxDJ",J="animated-IHczOy",K=(0,a.memo)((e=>{const{className:t,size:i,circleColor:s="var(--black-4)",arcColor:a="var(--white-0)",animated:n=!0}=e;return(0,w.jsx)(H,{className:d()(t,q,n&&J),width:i,height:i,style:{"--heycan-loading-circle-color":s,"--heycan-loading-arc-color":a}})})),G="card-f4fcSb",X="text-RGDuHx",Q=e=>{const{className:t,status:i,children:s}=e;return(0,w.jsxs)("div",{className:d()(t,G),children:["loading"===i?(0,w.jsx)(K,{size:18},i):(0,w.jsx)(K,{size:18,circleColor:"#c30000",animated:!1},i),s&&(0,w.jsx)("div",{className:X,children:s})]})};var Y,ee;function te(){return te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},te.apply(null,arguments)}const ie=e=>a.createElement("svg",te({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),Y||(Y=a.createElement("rect",{width:30,height:30,fill:"#00C1CD",rx:15})),ee||(ee=a.createElement("path",{stroke:"#FAFAFA",strokeLinecap:"square",strokeWidth:1.875,d:"M9.001 15h12M15.001 21.001v-12"})));var se=i(70126),ae=i(51091),ne=i(12803),re=i(36958);const le="root-wurvCd",oe="point-E_OjHv",ce="tooltipWrapper-f4Ku2I",de="fadingOut-WkHWF7",ue=(0,a.forwardRef)(((e,t)=>{const{tooltipProps:i,getPopupContainer:s,onClosePopover:n,position:r,cursor:l="default"}=e,[o,c]=(0,a.useState)(!0),[u,p]=(0,a.useState)(!1),{top:m}=r,h=r.left-10,f=(0,a.useRef)(null),g=(0,a.useRef)(null),v=(0,V.Z)((()=>{var e;null===(e=g.current)||void 0===e||e.destroy(),p(!1),c(!1)})),_=(0,V.Z)((()=>{var e;const t=s().querySelector(`.${ce}`);if(!t||(null===(e=g.current)||void 0===e?void 0:e.tooltipWrapper)===t)return;t.addEventListener("animationend",v);const i=new ne.B;i.timeout(500).then(v),g.current={tooltipWrapper:t,destroy:()=>{t.removeEventListener("animationend",v),i.cancel(),g.current=null}}}));(0,a.useImperativeHandle)(t,(()=>({hide:()=>{_(),p(!0)}})));const x=(0,a.useMemo)((()=>({default:{height:18,width:12},"not-allowed":{height:(0,re.c)()?30:15,width:15}})),[]),y=x[l]||x.default;return(0,w.jsx)(B.u,{autoAdjustOverflow:!0,position:"bottomLeft",motion:!1,...i,className:d()(i.className,ce,u&&de),trigger:"custom",visible:o,showArrow:!1,rePosKey:`${m}-${h}`,getPopupContainer:s,onVisibleChange:e=>{var t;!e&&n(),null===(t=i.onVisibleChange)||void 0===t||t.call(i,e)},children:(0,w.jsx)("div",{className:oe,tabIndex:-1,ref:f,style:{top:m,left:h,...y}})})}));function pe(e){const{zIndex:t=1060,cursor:i="default",checkIsTarget:s,getEllipsisDOM:r,...l}=e,o=(0,a.useRef)(null),c=(0,a.useRef)(null),[d,u]=(0,a.useState)(null),{i18n:p}=(0,n.$)(),m=()=>{const{content:e}=l;if("function"!=typeof e)return e;if(!o.current)return null;const{targetElement:t}=o.current;return i=>e({...i,target:t})},h=(0,V.Z)((()=>{o.current&&(o.current.destroy(),o.current=null,u(null))})),f=(0,V.Z)((()=>{var e;null===(e=o.current)||void 0===e||e.destroy(),o.current=null})),g=(0,V.Z)((()=>{o.current&&(o.current.destroy(),o.current=null,u(null))})),v=(0,V.Z)(((e,i)=>{const s=null==r?void 0:r(i);if(s&&s.offsetWidth>=s.scrollWidth)return;if(o.current){if(!o.current.hasLeaved&&o.current.targetElement===i)return;h()}const a=document.createElement("div");a.className=le,a.style.zIndex=`${t}`;const n=e=>{u({left:e.clientX,top:e.clientY})},l=e=>{i===e.target&&(o.current&&(o.current.hasLeaved=!0),c.current?c.current.hide():h())};i.addEventListener("mousemove",n),i.addEventListener("mouseleave",l),document.body.appendChild(a);const d=(0,se.createRoot)(a);o.current={container:a,targetElement:i,hasLeaved:!1,reactRoot:d,destroy:()=>{a.remove(),Promise.resolve().then((()=>d.unmount())),i.removeEventListener("mousemove",n),i.removeEventListener("mouseleave",l)}},u({left:e.clientX,top:e.clientY})})),_=(0,V.Z)((e=>{const t=e.currentTarget;v(e,t)})),x=(0,V.Z)((e=>{var t;const i=e.target;(null!==(t=null==s?void 0:s(i))&&void 0!==t?t:e.currentTarget===i)&&v(e,i)}));return(0,a.useLayoutEffect)((()=>f),[]),(0,a.useLayoutEffect)((()=>{(()=>{if(!o.current||!d)return;const{reactRoot:e,container:s}=o.current;s.style.zIndex=`${t}`,e.render((0,w.jsx)(ae.a,{i18n:p,children:(0,w.jsx)(ue,{ref:c,tooltipProps:{...l,content:m()},getPopupContainer:()=>s,onClosePopover:h,position:d,cursor:i})}))})()})),{handleMouseEnter:_,handleMouseOver:x,destroyTooltip:g}}function me(e={}){const{getEllipsisDOM:t=e=>e,content:i=({target:e})=>e.textContent,...s}=e;return pe({...s,getEllipsisDOM:t,content:i})}const he={root:"root-rylHEj","root--small":"root--small-aQdS7l",rootSmall:"root--small-aQdS7l",disabled:"disabled-UDlazI",box:"box-ZWa78Y",dragging:"dragging-vqbsIa",largeBox:"largeBox-WcUW_R",addIcon:"addIcon-qWe0Z9",titleContainer:"titleContainer-h3CoYT",title:"title-vs2_SI",subTitle:"subTitle-cCG07G",smallBox:"smallBox-gFzkvY"},fe=(0,a.memo)((({className:e,size:t,title:i,draggingTitle:s="",draggingDisabled:n,subTitle:r="",disabled:l,disabledTooltip:o="",onDrop:c,onClick:u})=>{const[p,m]=(0,a.useState)(!1),h=p?s:i,f=e=>{n||m(e)},{handleMouseEnter:g}=pe({content:o,cursor:"not-allowed"}),v=e=>t=>{l||(t.preventDefault(),t.stopPropagation(),null==e||e(t))};return(0,w.jsx)("div",{className:d()(e,he.root,he[`root--${t}`],l&&he.disabled,p&&he.dragging),onDragEnter:v((()=>!p&&f(!0))),onDragOver:v(),onDragLeave:v((e=>{e.currentTarget===e.target&&p&&f(!1)})),onDrop:v((e=>{f(!1),c(e)})),onMouseEnter:l&&null!=o&&o.length?g:void 0,children:"large"===t?(0,w.jsxs)("div",{className:d()(he.box,he.largeBox),onClick:l?void 0:u,children:[(0,w.jsx)(ie,{className:he.addIcon}),(0,w.jsxs)("div",{className:he.titleContainer,children:[(0,w.jsx)("div",{className:he.title,children:h}),(0,w.jsx)("div",{className:he.subTitle,children:r})]})]}):(0,w.jsxs)("div",{className:d()(he.box,he.smallBox),onClick:l?void 0:u,children:[(0,w.jsx)(ie,{className:he.addIcon}),(0,w.jsx)("span",{className:he.title,children:h})]})})})),ge="root-qiLomF",ve="uploadArea-CUnzAK",_e="uploadAreaWithoutStickers-lupETK",xe="retryText-CmFKf2",we="mainForm-QtsMBI",ye="importArea-t3T7nf",Te="formArea-cY23J0";function be(e){const{className:t,layout:i,setFormApi:s,renderImportArea:a,renderFormArea:r,onRetry:l,importLoadingText:o,scrollAreaRef:c,uploadAreaProps:u}=e,{titleForUploadArea:p,titleForMainForm:m,...h}=u,{t:f}=(0,n.$)();return(0,w.jsx)(B.Form,{className:d()(t,ge),getFormApi:s,children:"loading"===i?(0,w.jsx)(Q,{status:"loading",children:o||f("pc_filter_material_loading")}):"error"===i?(0,w.jsx)(Q,{status:"error",children:f("pc_sticker_abnormal_{X}_web",{X:(0,w.jsx)("span",{className:xe,onClick:l,children:f("pc_sticker_retry_web")},"X")})}):"mainForm"===i?(0,w.jsxs)("div",{className:we,children:[(0,w.jsx)("div",{className:ye,ref:c,children:a((0,w.jsx)(fe,{className:ve,size:"small",title:m,...h}))}),(0,w.jsx)("div",{className:Te,id:"formAreaWrapper",children:r()})]}):(0,w.jsx)(fe,{className:_e,size:"large",title:p,...h})})}(0,s.Pi)((e=>be(e)));const Ce="root-Jdq72k",Se="title-x8UGgH",Fe="line-HKnXMT";function ke(e){const{className:t,title:i}=e;return(0,w.jsxs)("div",{className:d()(Ce,t),children:[(0,w.jsx)("div",{className:Se,children:i}),(0,w.jsx)("div",{className:Fe})]})}var Ie;function je(){return je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},je.apply(null,arguments)}const Le=e=>a.createElement("svg",je({xmlns:"http://www.w3.org/2000/svg",width:34,height:28,fill:"none",viewBox:"0 0 34 28"},e),Ie||(Ie=a.createElement("path",{fill:"#fff",fillOpacity:.09,d:"M33.71 6.32V1.11l-6.268 3.291v-.196c0-2.076-1.489-3.33-3.643-3.33H3.935C1.662.875.292 2.129.292 4.205v5.25L9.067 14 .291 18.584v5.25c0 2.037 1.371 3.291 3.643 3.291H23.8c2.154 0 3.643-1.254 3.643-3.291v-.274l6.269 3.33V21.6L19.136 14zM14.083 16.587l10.774 5.642H3.27zM24.778 5.773l-10.695 5.602L3.268 5.773z"}))),Ne="root-I5KeTG",Ee=e=>{const{className:t,iconWidth:i}=e,s=Math.round(.785*i);return(0,w.jsx)("div",{className:d()(t,Ne),children:(0,w.jsx)(Le,{height:s,width:i})})},Pe="root-QyKpzG",Re="border-igpdqP",Me="content-i0g8M8",Oe="invalid-E06Qru",De="selected-vCvIxt",Ae="icon-uXwoK2",Ue="customIcon-BcMgG4",Ze="isUpdatingHint-TmA7x3",ze=({src:e,className:t,onClick:i,onContextMenu:s,isSelected:a,isInvalid:r,isUpdating:l=!1,size:o,customRenderIcon:c})=>{const{t:u}=(0,n.$)();return(0,w.jsxs)("div",{className:d()(t,Pe,r&&Oe,a&&De),style:{width:o,height:o},onClick:i,onContextMenu:s,children:[(0,w.jsxs)("div",{className:Me,children:[c?(0,w.jsx)("div",{className:Ue,children:c()}):e?(0,w.jsx)("img",{className:Ae,src:e}):(0,w.jsx)(Ee,{className:Ae,iconWidth:Math.round(.41*o)}),l&&(0,w.jsx)("div",{className:Ze,children:u("pc_sticker_upgrading_web")})]}),(0,w.jsx)("div",{className:Re})]})};var $e;function Ve(){return Ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},Ve.apply(null,arguments)}const Be=e=>a.createElement("svg",Ve({xmlns:"http://www.w3.org/2000/svg",width:12,height:12,fill:"none",viewBox:"0 0 12 12"},e),$e||($e=a.createElement("path",{stroke:"#AE1C1C",strokeLinecap:"round",strokeWidth:1.5,d:"m4 4 4 4M8 4 4 8"})));var We;function He(){return He=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},He.apply(null,arguments)}const qe=e=>a.createElement("svg",He({xmlns:"http://www.w3.org/2000/svg",width:12,height:12,fill:"none",viewBox:"0 0 12 12"},e),We||(We=a.createElement("path",{fill:"#6C6C6C",fillRule:"evenodd",d:"M6.875 6.154a.22.22 0 0 0 0-.308L4.447 3.418A.783.783 0 1 1 5.554 2.31l3.415 3.415a.387.387 0 0 1 0 .548L5.554 9.689a.783.783 0 1 1-1.107-1.107z",clipRule:"evenodd"})));var Je;function Ke(){return Ke=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},Ke.apply(null,arguments)}const Ge=e=>a.createElement("svg",Ke({xmlns:"http://www.w3.org/2000/svg",width:12,height:12,fill:"none",viewBox:"0 0 12 12"},e),Je||(Je=a.createElement("path",{stroke:"#00C1CD",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m3 6 2.143 2L9 4"}))),Xe="running-h0Lfzw",Qe=26,Ye=e=>{const{text:t,gap:i,speed:s=Qe}=e,n=(0,a.useRef)(null),r=(0,a.useRef)(null),[l,o]=(0,a.useState)(0);(0,a.useEffect)((()=>{const e=n.current,t=r.current;if(!e||!t)return;const i=e.getBoundingClientRect().left,s=t.getBoundingClientRect().left;o(s-i)}),[]);const c={"--heycan-marquee-loop-text-animation-transform-to":`translateX(${-l}px)`,"--heycan-marquee-loop-text-animation-duration":`${(l/s).toFixed(2)}s`};return(0,w.jsxs)("span",{ref:n,className:l?Xe:"",style:c,children:[(0,w.jsx)("span",{children:t}),(0,w.jsx)("span",{ref:r,style:{marginInlineStart:i},children:t})]})},et="root-vUjaY_",tt="icon-Rvn8cb",it="yellowIcon-ZUE7YW",st="yellowPoint-D92cGf",at="text-FIGDkp",nt="error-CX16ns",rt="checked-ot4aGx",lt="tooltip-CeFJfC",ot=e=>{const{className:t,loadingText:i}=e,{t:s}=(0,n.$)(),{handleMouseEnter:a}=me();return(0,w.jsxs)("div",{className:d()(et,t),children:[(0,w.jsx)(K,{className:tt,size:12,arcColor:"var(--grey-1)"}),(0,w.jsx)("div",{className:at,onMouseEnter:a,children:i||s("pc_stickers_release_in_web")})]})},ct=e=>{const{className:t,tooltip:i}=e,{t:s}=(0,n.$)(),{handleMouseEnter:r}=pe({content:i,className:lt}),l=(0,a.useRef)(null),{setIsMarqueeLoopRunning:o,reactNode:c}=(e=>{const{text:t,getEllipsisDOM:i}=e,[s,n]=(0,a.useState)(!1);return{isMarqueeLoopRunning:s,setIsMarqueeLoopRunning:e=>{const t=null==i?void 0:i();t&&t.offsetWidth>=t.scrollWidth||n(e)},reactNode:s?(0,w.jsx)(Ye,{...e}):(0,w.jsx)("span",{children:t})}})({text:s("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>l.current});return(0,w.jsxs)("div",{className:d()(et,t,nt),onMouseEnter:e=>{o(!0),r(e)},onMouseLeave:()=>o(!1),children:[(0,w.jsx)(Be,{className:tt}),(0,w.jsx)("div",{ref:l,className:at,children:c})]})},dt=e=>{const{className:t,text:i}=e,{handleMouseEnter:s}=me();return(0,w.jsxs)("div",{className:d()(et,t,rt),children:[(0,w.jsx)(Ge,{className:tt}),(0,w.jsx)("div",{className:at,onMouseEnter:s,children:i})]})},ut=e=>{const{className:t}=e,{t:i}=(0,n.$)(),{handleMouseEnter:s}=me();return(0,w.jsxs)("div",{className:d()(et,t),children:[(0,w.jsx)("div",{className:d()(tt,it),children:(0,w.jsx)("div",{className:st})}),(0,w.jsx)("div",{className:at,onMouseEnter:s,children:i("pc_stickers_release_editing_web")}),(0,w.jsx)(qe,{className:tt})]})},pt=e=>{const{className:t,loading:i,invalid:s,errorToolip:a,isInfoComplete:n,title:r,loadingText:l}=e;return i?(0,w.jsx)(ot,{className:t,loadingText:l}):s?(0,w.jsx)(ct,{className:t,tooltip:a}):n?(0,w.jsx)(dt,{className:t,text:r}):(0,w.jsx)(ut,{className:t})};var mt=i(74572),ht=i(65656),ft=i(60963),gt=i(83305);class vt{constructor(e){this.props=e,(0,mt.Z)(this,"fileMap",new Map)}ensureFile(e){let t=this.fileMap.get(e);return t||(t={data:this.props.initData(),events:{}},this.fileMap.set(e,t)),t}getFile(e){return this.fileMap.get(e)}register(e,t,i){this.ensureFile(t).events[e]=i}dispatch(e){var t,i;const s=this.fileMap.get(e.id);s&&(null===(t=(i=s.events)[e.type])||void 0===t||t.call(i,e,s))}removeFile(e){this.fileMap.delete(e)}}var _t=i(42461),xt=i(50140),wt=i.n(xt),yt=i(79292),Tt=i(71157),bt=i(1234),Ct=i(48647);let St=function(e){return e[e.Video=1]="Video",e[e.Image=2]="Image",e[e.Object=9]="Object",e}({});const Ft={[St.Video]:"video",[St.Image]:"image",[St.Object]:"object"};const kt=e=>new Promise((async(t,i)=>{const{file:s,onProgress:a,onSuccess:n,onError:r,getUploadToken:l}=e,o=(c=s.type).includes("image")?St.Image:c.includes("video")?St.Video:St.Object;var c;const d=new Error("").stack,u=yt.I18n.t("pc_upload_fail_web");let p=new _t.w("upload failed: getUploadConfig error",{displayMessage:u,uploadType:o,uploadStack:d});const m=await async function(e){var t;const{uploadType:i,getUploadToken:s}=e,a=await(null!==(t=null==s?void 0:s())&&void 0!==t?t:(0,Ct._M)({scene:i})),n={CurrentTime:a.current_time,ExpiredTime:a.expired_time,SessionToken:a.session_token,AccessKeyId:a.access_key_id,SecretAccessKey:a.secret_access_key};return{config:{userId:bt.$.userInfo.uid,appId:Number(Tt.appModel.appInfo.appID),region:a.region,videoHost:`https://${a.upload_domain}`,imageHost:`https://${a.upload_domain}`,useServerCurrentTime:!0,imageConfig:{serviceId:a.space_name},videoConfig:{spaceName:a.space_name,processAction:[{name:"GetMeta"},{name:"Snapshot",input:{SkipBlackDetect:!1,SnapshotTime:0}}]},objectConfig:{spaceName:1===a.space_type?a.space_name:void 0,serviceId:2===a.space_type?a.space_name:void 0}},stsToken:n}}({uploadType:o,getUploadToken:l}).catch((e=>{p=e||p}));if(!m)return null==r||r({status:-1,statusText:u}),void i(p);null==a||a({total:100,loaded:20});const{config:h,stsToken:f}=m,g=new(wt())(h);g.on("complete",(e=>{null==a||a({total:100,loaded:100}),null==n||n(e),t(e)})),g.on("progress",(e=>{null==a||a({total:100,loaded:20+e.percent/100*80})})),g.on("error",(e=>{var t,s;null==r||r({status:(null===(t=e.extra)||void 0===t?void 0:t.errorCode)||-1,statusText:u});const a=new _t.w("upload failed",{code:String((null===(s=e.extra)||void 0===s?void 0:s.errorCode)||-1),displayMessage:u,uploadStack:d});i(a)}));const v=g.addFile({file:s,stsToken:f,type:Ft[o]});g.start(v),null==a||a({total:100,loaded:20})}));var It=i(57705),jt=i.n(It);const Lt=(e,t="image/png")=>{let i=e;e.startsWith("data:")&&(i=e.split(",")[1]);const s=atob(i),a=new Array(s.length);for(let r=0;r<s.length;r++)a[r]=s.charCodeAt(r);const n=new Uint8Array(a);return new Blob([n],{type:t})},Nt=e=>URL.createObjectURL(e);const Et=e=>e.toLowerCase().split(".").pop();class Pt{constructor(){(0,mt.Z)(this,"uploadConfigService",null),(0,mt.Z)(this,"fileEventDispatcher",null),(0,mt.Z)(this,"map",new Map)}init(e){const{uploadConfigService:t,fileEventDispatcher:i}=e;this.uploadConfigService=t,this.fileEventDispatcher=i}async initUpload(e){return this.map.set(e.id,e),this.upload(e.id)}async retryUpload(e){return this.upload(e)}async upload(e){const t={type:"Upload",result:"Error",id:e,uri:"",size:0,md5:"",error:""},{uploadConfigService:i,fileEventDispatcher:s}=this;if(!i||!s){const t=new _t.w("not inited",{id:e});throw(0,gt.RF)("[SimpleFileUploader] init upload failed",t),t}const a=this.map.get(e);if(!a){const i=new _t.w("data not set",{id:e});throw(0,gt.RF)("[SimpleFileUploader] init upload failed",i),t.error=i.message,s.dispatch(t),i}const{type:n,file:r}=a,l=async()=>{const{imageUploadConfig:e,videoUploadConfig:t,objectUploadConfig:s}=await i.getUploadConfigs("SimpleFileUploader");let a;return a=n===Ct.AJ.Image?e:n===Ct.AJ.Video?t:s,{current_time:a.currentTime,expired_time:a.expiredTime,access_key_id:a.accessKey,secret_access_key:a.secretKey,session_token:a.sessionToken,upload_domain:a.hostDomain,space_name:a.serviceId||a.nameSpace,space_type:a.serviceId?2:1,region:a.region||""}};try{const i=await kt({file:r,getUploadToken:l});t.result="Success",t.uri=i.uploadResult.Uri,t.size=i.fileSize,t.md5=a.withMD5?await(async e=>{const t=await e.arrayBuffer(),i=new Uint8Array(t);return jt()(i)})(r):"",s.dispatch(t),this.map.delete(e)}catch(c){var o;throw(0,gt.RF)("[SimpleFileUploader] upload failed",c),t.result="Error",t.uri="",t.size=0,t.error=null!=c&&c.message?`${c.message}, code=${null===(o=c.context)||void 0===o?void 0:o.code}`:JSON.stringify(c||{}),s.dispatch(t),c}}}function Rt(e,...t){return(0,ft.z)((()=>Object.assign(e,...t)))}var Mt=i(91449);const Ot=({frame:e,tempCanvas:t,tempCtx:i,gifCanvas:s,gifCtx:a})=>{const{disposalType:n}=e,{dims:r}=e;t.width=r.width,t.height=r.height;const l=i.createImageData(r.width,r.height);l.data.set(e.patch),1!==n&&a.clearRect(0,0,s.width,s.height),i.putImageData(l,0,0),a.drawImage(t,r.left,r.top);return s.toDataURL("image/png")},Dt=e=>{const t=[],i=(0,Mt.vq)(e),s=(0,Mt.zw)(i,!0),a=document.createElement("canvas"),n=a.getContext("2d"),r=document.createElement("canvas"),l=r.getContext("2d");r.width=s[0].dims.width,r.height=s[0].dims.height;for(let o=0;o<=s.length-1;o++){const e=Ot({frame:s[o],tempCanvas:a,tempCtx:n,gifCanvas:r,gifCtx:l});t.push(e)}return{base64List:t,gifWidth:r.width,gifHeight:r.height,delay:s[0].delay}};async function At(e){const{base64List:t}=await(e=>new Promise((t=>{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{const e=i.response,s=[];if(e){const i=(0,Mt.vq)(e),a=(0,Mt.zw)(i,!0),n=document.createElement("canvas"),r=n.getContext("2d"),l=document.createElement("canvas"),o=l.getContext("2d");l.width=a[0].dims.width,l.height=a[0].dims.height;for(let e=0;e<=a.length-1;e++){const t=Ot({frame:a[e],tempCanvas:n,tempCtx:r,gifCanvas:l,gifCtx:o});s.push(t)}t({base64List:s,gifWidth:l.width,gifHeight:l.height,delay:a[0].delay})}},i.send(null)})))(e);return t}function Ut(e){const{base64List:t}=Dt(e);return t}function Zt(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}function zt(e){const t=Zt(e);let i=0;for(let s=0;s<e.length;s++){const a=e[s];i+=(a-t)*(a-t)}return Math.sqrt(i/e.length)}const $t=async e=>{const t=await e.arrayBuffer();return Dt(t).base64List},Vt=e=>new Promise(((t,i)=>{const s=new Image;s.src=e,s.setAttribute("crossOrigin","Anonymous"),s.onload=()=>{const e=document.createElement("canvas"),i=e.getContext("2d");e.width=s.width,e.height=s.height,null==i||i.drawImage(s,0,0,e.width,e.height);const a=async function(e){const t=e.width,i=e.height,s=Array(i*t).fill(0),a=Array(i*t).fill(0);let n=0,r=performance.now();for(let u=0;u<i;u++){for(let i=0;i<t;i++){const t=4*(i+u*i),r=e.data[t],l=e.data[t+1],o=e.data[t+2];s[n]=Math.abs(r-l),a[n]=Math.abs((r+l)/2-o),n+=1}performance.now()-r>16&&(await(0,ne.N)(),r=performance.now())}await(0,ne.N)();const l=Zt(s),o=zt(s),c=Zt(a),d=zt(a);return Math.sqrt(o*o+d*d)+.3*Math.sqrt(l*l+c*c)}(null==i?void 0:i.getImageData(0,0,e.width,e.height));t(a)}}));function Bt(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return e?`${e}-${t}`:t}function Wt(e){return{id:"",src:"",uri:"",isUploadFailed:!1,file:new File([],""),...e}}function Ht(e){return{id:"",uri:"",isUploadFailed:!1,file:new File([],""),md5:"",size:0,...e}}function qt(e,...t){for(const i of t)i.id||null==e.uninited||(e.uninited+=1),i.isUploadFailed?e.failed+=1:i.uri?e.succeeded+=1:e.pending+=1}class Jt{constructor(e){this.props=e,(0,mt.Z)(this,"fileEventDispatcher",new vt({initData:()=>null})),(0,mt.Z)(this,"fileUploader",new Pt),(0,mt.Z)(this,"prevDepResourceIdMap",{}),(0,mt.Z)(this,"templateZipCacheMap",new Map),(0,ft.ky)(this),this.fileUploader.init({fileEventDispatcher:this.fileEventDispatcher,uploadConfigService:this.props.uploadConfigService})}async initUploadCover(e){const t=e.getCover();if(!t||t.id)return;if(Rt(t,{...e.getInitValues(),uri:"",isUploadFailed:!1}),!t.file.size&&!t.file.name){const e=new _t.w("file is empty",{id:t.id});throw(0,gt.RF)("[TemplateFileOperator] initUploadCover failed",e),e}const{id:i}=t;this.fileUploader.initUpload({id:i,type:Ct.AJ.Image,file:t.file}),this.fileEventDispatcher.register("Upload",t.id,(0,ft.aD)((t=>{const s=e.getCover();var a;if(!s||s.id!==i)return void(0,gt.c6)(`[TemplateFileOperator] cover upload ignored {${i}}`,{coverId:null!==(a=null==s?void 0:s.id)&&void 0!==a?a:"null"});const{uri:n}=t;if(n)s.uri=n,(0,gt.c6)(`[TemplateFileOperator] cover upload success {${i}}`,{uri:n});else{s.isUploadFailed=!0;const e=t.error||"unknown";(0,gt.RF)(`[TemplateFileOperator] cover upload failed {${i}}`,null,{error:e})}})))}async initUploadFile(e){const{typeName:t}=e,i=e.getFile();if(!i||i.id)return;if(Rt(i,{...e.getInitValues(),uri:"",isUploadFailed:!1,md5:"",size:0}),!i.file.size&&!i.file.name){const e=new _t.w("file is empty",{id:i.id,type:t});throw(0,gt.RF)("[TemplateFileOperator] initUploadFile failed",e),e}const{id:s}=i;this.fileUploader.initUpload({id:s,type:Ct.AJ.Object,file:i.file,withMD5:!0}),this.fileEventDispatcher.register("Upload",s,(0,ft.aD)((i=>{const a=e.getFile();var n;if(!a||a.id!==s)return void(0,gt.c6)(`[TemplateFileOperator] ${t} upload ignored {${s}}`,{fileId:null!==(n=null==a?void 0:a.id)&&void 0!==n?n:"null"});const{uri:r,size:l,md5:o}=i;if(r)a.uri=r,a.size=l,a.md5=o,(0,gt.c6)(`[TemplateFileOperator] ${t} upload success {${s}}`,{uri:r});else{a.isUploadFailed=!0;const e=i.error||"unknown";(0,gt.RF)(`[TemplateFileOperator] ${t} upload failed {${s}}`,null,{error:e})}})))}retryUpload(...e){for(const t of e)t.id&&t.isUploadFailed&&(t.isUploadFailed=!1,this.fileUploader.retryUpload(t.id))}async getStaticFrame(e,t){if(null==t){const{maxIndex:t,frameList:i}=await(async e=>{var t;let i=[];if("string"==typeof e&&(i=await At(e)),e instanceof ArrayBuffer&&(i=await Ut(e)),e instanceof File&&(i=await $t(e)),null===(t=i)||void 0===t||!t.length)throw new Error("Invalid GIF file");const s=[];let a=0,n=0;for(let r=0;r<i.length;r++){const e=i[r],t=await Vt(e);s.push(t),t>a&&(a=t,n=r)}return{max:a,maxIndex:n,frameList:i,frame:i[n]}})(e);return{index:t,frameList:i}}return{index:t,frameList:await $t(e)}}async initStaticFrame(e){var t;const{id:i,templateZipData:s,staticFrame:a}=e,{coverFile:n}=s.template;(0,gt.c6)(`[TemplateFileOperator] getGifColorFrame start {${i}}`);const{index:r,frameList:l}=await this.getStaticFrame(n,null===(t=e.getInitIndex)||void 0===t?void 0:t.call(e));(0,gt.c6)(`[TemplateFileOperator] getGifColorFrame done {${i}}`),Rt(a,{id:"",uri:"",isUploadFailed:!1,src:l[r],index:r,list:l})}updateStaticFrame(e,t){const{list:i}=e;0!==i.length&&Rt(e,{id:"",uri:"",isUploadFailed:!1,src:i[t],index:t})}saveTemplateZipCache(e,t,i){i.id&&!i.isUploadFailed&&i.uri&&this.templateZipCacheMap.set(`${t}-${e}`,{...i}),Rt(i,{...Ht({}),extraJson:{}})}async initUploadTemplateZip(e){const{zipFile:t,templateZipData:i,staticFrame:s,depResourceIdMap:a,checkIsCanceled:n}=e,r=`${e.lang}-${e.id}`,l=this.templateZipCacheMap.get(r),o=(0,ht.Z)(a,this.prevDepResourceIdMap);o&&(this.prevDepResourceIdMap=a);const c=s.index/s.list.length*s.duration;if(l&&c===l.previewTime&&o)return Rt(t,l),void(0,gt.c6)(`[TemplateFileOperator] zip reuse cache success {${r}}`,{uri:l.uri});const d=function(e,t,i){const s={};for(const a of t.flowerTexts){const t=`${e}-${a.id}`;a.isDepMaterial&&i[t]&&(s[a.id]=i[t])}for(const a of t.stickers)a.isDepMaterial&&i[a.id]&&(s[a.id]=i[a.id]);return s}(e.lang,i,a),{file:u,extraJson:p}=await i.createNewZipFile({previewTime:c,depResourceIdMap:d});(0,gt.c6)(`[SingleStore] createNewZipFile success {${r}}`,{depResourceIdMap:d}),n()||this.initUploadFile({getFile:()=>t,typeName:"zip",getInitValues:()=>({id:Bt("template-zip"),file:u,previewTime:c,extraJson:p})})}}function Kt({isVip:e,isBusiness:t,authFiles:i}){var s;const a=null!==(s=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==s?s:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:Ct.$x.Vip,auth_status:e?Ct.U9.Authorized:Ct.U9.Unauthorized,third_party_agreements:[]},{scene:Ct.$x.Business,auth_status:t?Ct.U9.Authorized:Ct.U9.Unauthorized,third_party_agreements:t?a:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function Gt(e){const{isOriginal:t=!1,isVip:i=!1,isBusiness:s=!1,authFiles:a}=e;const{root:n}=Kt({isVip:i,isBusiness:s,authFiles:a});return{copyright:n.copyright}}function Xt(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===Ct.U9.Authorized)))}function Qt(e){const t=function(e){const t={isBusiness:!1,isVip:!1,uris:[]};return null==e||e.copyright_info.forEach((e=>{switch(e.scene){case Ct.$x.Vip:return void(t.isVip=e.auth_status===Ct.U9.Authorized);case Ct.$x.Business:return t.isBusiness=e.auth_status===Ct.U9.Authorized,void(e.thrid_party_agreements&&(t.uris=e.thrid_party_agreements.filter((({uri:e})=>e)).map((({uri:e})=>e))));default:return}})),t}(e.copyright);return{isBusiness:t.isBusiness,isVip:t.isVip,authFiles:t.uris.map(((e,t)=>({uri:e,file:new File([],String(t+1).padStart(2,"0"))})))}}function Yt(e){return Boolean(e.title&&e.tags.length)}function ei(e){return e.subFlowerTexts[0]}const ti="root-ITIgwH",ii="statusBar-PBKTou",si=(0,s.Pi)((e=>{const{className:t,flowerText:i,isSelected:s,onClick:a}=e;return(0,w.jsxs)("div",{className:d()(ti,t),onClick:()=>{a(i)},children:[(0,w.jsx)(ze,{src:ei(i).cover.src,isInvalid:!1,isSelected:s,size:80,onContextMenu:e=>{e.preventDefault(),a(i)}}),(0,w.jsx)(pt,{className:ii,loading:!1,invalid:!1,errorToolip:"",isInfoComplete:Yt(i),title:i.title})]})}));var ai=i(56366),ni=i(75255),ri=i(31062);function li(e){return Boolean(e.id)}class oi{constructor(){(0,mt.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,ri.Z)(e,10)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:s,onUpdateResult:a}=e,n=JSON.parse(JSON.stringify(e.req));let r=this.itemMap.get(i);if(null!==(t=r)&&void 0!==t&&t.promise&&(0,ht.Z)(r.req,n))try{return await r.promise}catch(l){(0,gt.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return r={promise:null,id:i,req:n,onResult:s,onUpdateResult:a},this.itemMap.set(i,r),r.promise=this.publishImpl(r),r.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,s)=>{try{const r={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:s};var a,n;if(li(e.req))await(null===(a=e.onUpdateResult)||void 0===a?void 0:a.call(e,{req:e.req,...r}));else await(null===(n=e.onResult)||void 0===n?void 0:n.call(e,{req:e.req,...r}))}catch(r){(0,gt.RF)("[MaterialPublishService] callOnResult failed",r)}};let s;try{s=await this.postOrUpdate(e)}catch(a){throw e.promise=null,i(a,""),a}return await i(null,s.resource_id),s}async postOrUpdate(e){return li(e.req)?(await(0,Ct.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,Ct.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new ne.B).timeout(5e3)])}catch(t){(0,gt.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),s=new ne.B,a={count:50,effect_types:t,uid:bt.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,Ct.Js)(a).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await s.timeout(500)}}}var ci=i(42245);let di=function(e){return e[e.Unsigned=0]="Unsigned",e[e.Signing=1]="Signing",e[e.Signed=2]="Signed",e}({}),ui=function(e){return e.BusinessArtist="business_artist",e}({});class pi{constructor(e){this.props=e,(0,mt.Z)(this,"signCode",null),(0,mt.Z)(this,"isRefreshing",!1),(0,mt.Z)(this,"fetchRegionDataPromise",null),(0,mt.Z)(this,"fetchRegionDataImpl",(async()=>{const[{country_code_list:e},{doc_type_info:t},i]=await Promise.all([(0,ci.Jr)({sign_scene:this.props.signScene}),(0,ci.Yg)(),(0,Ct.vW)()]);return{country_code_list:e,doc_type_info:t,region:i}}))}async init(){this.refreshSignInfo().catch((()=>{})),this.fetchRegionData().catch((()=>{}))}async refreshSignInfo(){const{signScene:e}=this.props;try{this.isRefreshing=!0;const{sign_status_infos:t=[]}=await(0,ci.x3)(),i=t.find((t=>t.sign_scene===e)),s=(null==i?void 0:i.sign_code)||di.Unsigned;return this.signCode=s,s}catch(t){throw(0,gt.RF)("[AuthorSignService] refreshSignInfo failed",t,{signScene:e}),t}finally{this.isRefreshing=!1}}async checkAuthorHasSigned(){if(this.signCode===di.Signed)return!0;return await this.refreshSignInfo()===di.Signed}fetchRegionData(){return this.fetchRegionDataPromise||(this.fetchRegionDataPromise=this.fetchRegionDataImpl().catch((e=>{throw this.fetchRegionDataPromise=null,e}))),this.fetchRegionDataPromise}async createContract(e){const t=await(0,ci.OP)({...e,sign_scene:this.props.signScene});return this.signCode=di.Signing,this.refreshSignInfo(),t}}class mi{constructor(){(0,mt.Z)(this,"fileList",[]),(0,ft.ky)(this)}addFiles(e){e.some((e=>e.size>10485760))?B.FN.error(yt.I18n.t("pc_template_authorize_exceed_size_web")):(e.forEach((e=>{this.fileList.push({id:Bt(),file:e,uri:"",progress:0})})),this.fileList.slice(-e.length).forEach((e=>this.uploadOneFile(e))))}async uploadOneFile(e){try{const{uploadResult:t}=await kt({file:e.file,onProgress:(0,ft.aD)((({total:t,loaded:i})=>{e.progress=i/t||0}))});await(new ne.B).timeout(500),(0,ft.z)((()=>{e.uri=t.Uri}))}catch(t){B.FN.error(yt.I18n.t("pc_template_authorize_upload_failed_web")),this.deleteFile(e.id),(0,gt.RF)("[ThirdPartyAuthFileUploadService] file upload failed",t,{id:e.id,fileName:e.file.name})}}deleteFile(e){this.fileList=this.fileList.filter((t=>t.id!==e))}get isAllUploaded(){return this.fileList.every((e=>e.uri))}addOnlineFiles(e){e.forEach((e=>this.fileList.push({id:Bt(),file:e.file,uri:e.uri,progress:100})))}}class hi{constructor(e){this.props=e,(0,mt.Z)(this,"map",new Map)}getKey(e){var t,i,s;return null!==(t=null===(i=(s=this.props).getKey)||void 0===i?void 0:i.call(s,e))&&void 0!==t?t:String(e)}get(e){const t=this.getKey(e);return this.map.get(t)}ensure(e){const t=this.getKey(e);let i=this.map.get(t);return i||(i=new mi,this.map.set(t,i)),i}getUploadedFiles(e){const t=this.getKey(e),i=this.map.get(t);return(null==i?void 0:i.fileList.filter((e=>e.uri)))||[]}}const fi=e=>{const t=(0,ni.fv)((()=>({disposer:null,resolve:null,get watchResult(){return e.watch()},start:()=>(t.stop(),new Promise((e=>{t.resolve=e,t.disposer=(0,ft.EH)((()=>{t.watchResult&&(e(),t.stop())}))}))),stop(){var e;null===(e=t.disposer)||void 0===e||e.call(t),t.disposer=null,t.resolve=null}})));return(0,a.useEffect)((()=>()=>t.stop()),[]),t};function gi(e){const t=fi({watch:()=>e.watch()&&!i.isPromptingConfirmToCancel}),i=(0,ni.fv)((()=>({start:()=>t.start(),stop:()=>t.stop(),isPromptingConfirmToCancel:!1,handlePromptConfirmToCancel:async e=>{i.isPromptingConfirmToCancel=!0;const s=await e;(0,ft.z)((()=>{s&&t.stop(),i.isPromptingConfirmToCancel=!1}))}})));return i}var vi=i(52272);const _i=e=>`https://sf16-web-tos-buz.capcutstatic.com/obj/capcut-web-buz-sg/artist-op-web${e}`,xi=`${_i("/LoadingScissorsCapCut.d9f5d23b.gif")}`,wi=({lang:e,region:t})=>`https://www.capcut.com/clause/creator-agreement?lang=${e}&store_region=${t}`;const yi=new class{constructor(){(0,mt.Z)(this,"documentLoadPromise",this.initDocumentLoadPromise())}initDocumentLoadPromise(){return new Promise((e=>{if("complete"===document.readyState)return void e();const t=()=>{e(),document.removeEventListener("load",t)};document.addEventListener("load",t)}))}async preloadImagesOnIdle(e){await this.documentLoadPromise;const t=window.requestIdleCallback||window.setTimeout;for(const i of e)await new Promise((e=>{t((()=>{const t=new Image;t.src=i.src,t.onload=()=>e(),t.onerror=()=>e(),window.setTimeout(e,3e3)}))}))}},Ti="root-VcsGtp",bi=e=>{const{className:t,size:i=64}=e;return(0,w.jsx)("img",{src:xi,className:d()(t,Ti),style:{height:i,width:i}})};yi.preloadImagesOnIdle([{src:xi}]);const Ci="root-LGkvBj",Si="panel-fE_gjU",Fi="icon-jLOlfC",ki="text-qnYZsw",Ii=()=>{const{t:e}=(0,n.$)();return(0,w.jsxs)("div",{className:Si,children:[(0,w.jsx)(bi,{className:Fi}),(0,w.jsx)("div",{className:ki,children:e("pc_sticker_load_web")})]})};const ji=new class{constructor(){(0,mt.Z)(this,"destroyLoading",null)}async show(e){try{const t=e();this.showImpl(),await t}finally{this.hide()}}hide(){var e;null===(e=this.destroyLoading)||void 0===e||e.call(this),this.destroyLoading=null}showImpl(){if(this.destroyLoading)return;const e=document.createElement("div");e.className=Ci,document.body.appendChild(e);const t=(0,se.createRoot)(e);this.destroyLoading=()=>{e.remove(),Promise.resolve().then((()=>t.unmount()))},t.render((0,w.jsx)(ae.a,{i18n:yt.I18n.i18nInstance.instance,children:(0,w.jsx)(Ii,{})}))}};class Li{constructor(e){var t;this.options=e,(0,mt.Z)(this,"cacheData",null),this.cacheData=null!==(t=this.options.initCacheData)&&void 0!==t?t:null}async get(){if(this.cacheData&&!this.isExpired()){const{data:e}=this.cacheData;return this.silentRefreshIfNeeded(),e}return this.update()}getSync(){var e,t;return null!==(e=null===(t=this.cacheData)||void 0===t?void 0:t.data)&&void 0!==e?e:null}isExpired(){if(!this.cacheData)return!0;const{expireTime:e,refreshTime:t}=this.cacheData,i=Date.now();return i<t||e<=i}needSilentRefresh(){if(!this.cacheData)return!0;const{silentRefreshTime:e}=this.cacheData;return e<=Date.now()}async silentRefreshIfNeeded(){this.needSilentRefresh()&&await this.update()}async update(){var e,t;const{data:i,expireTime:s,silentRefreshTime:a}=await this.options.refresh(null!==(e=null===(t=this.cacheData)||void 0===t?void 0:t.data)&&void 0!==e?e:null);return this.cacheData={data:i,expireTime:s,silentRefreshTime:a,refreshTime:Date.now()},i}}class Ni{constructor(){(0,mt.Z)(this,"objectUploadType",Ct.AJ.Object),(0,mt.Z)(this,"uploadConfigsCache",new Li({refresh:async()=>{const[e,t,i]=await Promise.all([this.getUploadConfigByScene(Ct.AJ.Video),this.getUploadConfigByScene(Ct.AJ.Image),this.getUploadConfigByScene(this.objectUploadType)]),s={videoUploadConfig:e,imageUploadConfig:t,objectUploadConfig:i},a=new Date(t.currentTime).getTime();return{data:s,refreshTime:a,expireTime:Math.min(new Date(t.expiredTime).getTime(),a+18e5),silentRefreshTime:a+6e5}}}))}useVodObject(){this.objectUploadType=Ct.AJ.VodObject}async getUploadConfigs(e){try{return await this.uploadConfigsCache.get()}catch(t){throw(0,gt.RF)(`[UploadConfigService] getUploadConfigs failed for ${e}`,t,{action:e}),t}}updateCache(){return this.uploadConfigsCache.update()}async refreshUploadConfigsIfNeeded({when:e,logPrefix:t,errorMsg:i=yt.I18n.t("pc_sticker_failed_retry_web")}){if(this.uploadConfigsCache.isExpired())return ji.show((async()=>{try{await this.uploadConfigsCache.update()}catch(s){throw B.FN.error(i),(0,gt.RF)(`${t} refreshUploadConfigs failed when ${e}`,s,{action:e}),s}}))}async getUploadConfigByScene(e){const t=await(0,Ct._M)({scene:e});if(!t.upload_domain)throw new _t.w("upload_domain is empty",{scene:e});return{currentTime:t.current_time,expiredTime:t.expired_time,accessKey:t.access_key_id,secretKey:t.secret_access_key,sessionToken:t.session_token,hostDomain:t.upload_domain,nameSpace:2===t.space_type?"":t.space_name,serviceId:2===t.space_type?t.space_name:"",region:t.region}}}class Ei{constructor(e){this.props=e,(0,mt.Z)(this,"fetchStatus",{isPending:!1,isFailed:!1,hasFetched:!1,fetchVersion:0,hasMore:!1}),(0,mt.Z)(this,"nextCursor",null),(0,mt.Z)(this,"fetchContext",null),(0,ft.ky)(this,{fetchContext:!1})}async fetchFirstPage(e){const t=this.fetchStatus.isFailed;try{e.isRefresh||this.runStartAction();const t=await this.props.fetchFirstPage(this.fetchContext),{action:i,hasMore:s,nextCursor:a}=this.normalizeFetchResult(t);this.runSuccessAction((()=>{this.fetchStatus.fetchVersion+=1,this.fetchStatus.hasMore=null!=s&&s,this.nextCursor=null!=a?a:null,i()}))}catch(i){this.runFailureAction({isFirstPage:!0,isRefresh:e.isRefresh});const s=e.isRefresh&&"refresh_first_page"||t&&"retry_fetch_first_page"||"init_fetch_first_page";throw this.props.slardarErrorLog(s,i,{}),i}}async fetchMorePage(){if(!this.props.fetchMorePage)throw new Error("props.fetchMorePage not implemented");const e=this.fetchStatus.isFailed,t=this.nextCursor;try{this.runStartAction();const e=await this.props.fetchMorePage(t,this.fetchContext),{action:i,hasMore:s,nextCursor:a}=this.normalizeFetchResult(e);this.runSuccessAction((()=>{this.fetchStatus.hasMore=null!=s&&s,this.nextCursor=null!=a?a:null,i()}))}catch(i){this.runFailureAction({isFirstPage:!1,isRefresh:!1});const s=e?"retry_fetch_more_page":"fetch_more_page";throw this.props.slardarErrorLog(s,i,{cursor:t}),i}}normalizeFetchResult(e){return"function"==typeof e?{action:e,hasMore:!1,nextCursor:null}:e}runStartAction(){this.fetchStatus.isPending=!0,this.fetchStatus.isFailed=!1}runSuccessAction(e){this.fetchStatus.isPending=!1,this.fetchStatus.isFailed=!1,this.fetchStatus.hasFetched=!0,e()}runFailureAction(e){var t,i;this.fetchStatus.isPending=!1,this.fetchStatus.isFailed=!0,null===(t=(i=this.props).actionOnFailure)||void 0===t||t.call(i,e,this.fetchContext)}async initFetchFirstPage(e){this.fetchContext=e;const{isPending:t,hasFetched:i}=this.fetchStatus;if(!t&&!i)return this.fetchFirstPage({isRefresh:!1})}async retryFetchFirstPage(){const{isPending:e}=this.fetchStatus;if(!e)return this.fetchFirstPage({isRefresh:!1})}async refreshFirstPage(){const{isPending:e}=this.fetchStatus;if(!e)return this.fetchFirstPage({isRefresh:!0})}async retryFetchMorePage(){const{isPending:e,hasMore:t}=this.fetchStatus;if(!e&&t)return this.fetchMorePage()}async fetchMorePageOnScrollToEnd(){const{isPending:e,hasMore:t,isFailed:i}=this.fetchStatus;if(!e&&t&&!i)return this.fetchMorePage()}reduceToFirstPageStatus(e){this.nextCursor=e,this.fetchStatus.hasMore=!0}}var Pi=i(38765),Ri=i(17773),Mi=i.n(Ri);async function Oi(e,t={}){const i=new(Mi());return(await i.loadAsync(e,t)).files}var Di=i(23818);async function Ai(e,t){try{const i=await e.async("blob"),s=await i.text();return(0,Di.ZP)(s,t)}catch(i){throw(0,gt.RF)("[TextTmp] file error",i,e),i}}const Ui="content.json",Zi="extra.json";r.Font,r.Font,r.WordArt,r.Sticker;class zi{constructor(e){this.options=e,(0,mt.Z)(this,"_effectType",void 0),(0,mt.Z)(this,"timing",{}),(0,mt.Z)(this,"sdkVersion",""),(0,mt.Z)(this,"rootFiles",{}),(0,mt.Z)(this,"_template",null),(0,mt.Z)(this,"flowerTexts",[]),(0,mt.Z)(this,"stickers",[]),this._effectType=e.effectType}get effectType(){return this._effectType}get template(){if(!this._template)throw new _t.w("template not inited",{id:this.options.id});return this._template}async init(){this.timing.startTime=performance.now();const{id:e,fetchZipBase64:t}=this.options;(0,gt.c6)(`[TemplateZipData] init start {${e}}`);let i="";try{[i,this.sdkVersion]=await Promise.all([t(e),(0,vi.mI)().then((e=>e.sdk))])}catch(n){throw(0,gt.RF)(`[TemplateZipData] fetch from native failed {${e}}`,n),n}this.timing.fetchZipBase64EndTime=performance.now(),(0,gt.c6)("[TemplateZipData] fetchZipBase64 done"),this.rootFiles=await Oi(i,{base64:!0}),this.timing.decompressRootEndTime=performance.now(),(0,gt.c6)("[TemplateZipData] decompress root done",{files:Object.keys(this.rootFiles)});const s=[this.initFlowerTexts()],a=this.rootFiles["template_sticker.zip"];if(a){const e=await a.async("blob"),t=await Oi(e);(0,gt.c6)("[TemplateZipData] decompress template_sticker.zip done",{files:Object.keys(t)});const i=t["caption_animation.json"],[n,r,l]=await Promise.all([Ai(t[Zi],{}),Ai(t[Ui],{root:{duration:3,preview_time:0},children:[]}),i&&Ai(i,{caption_animation:[]})]);n.depend_resource_list&&(n.depend_resource_list=n.depend_resource_list.filter((e=>e.resource_id))),this._template={files:t,extraJson:n,contentJson:r,captionAnimationJson:l,coverFile:new File([],""),notBusinessEffectTypes:[]},this.timing.decompressTemplateZipEndTime=performance.now(),(0,gt.c6)("[TemplateZipData] decompress template.zip done",{files:Object.keys(t),extraJson:n,contentJson:r}),s.push(this.initTemplateFiles(this.template),this.initNonBusinessInfo(this.template),this.initStickers(this.template))}await Promise.all(s),this.timing.endTime=performance.now(),(0,gt.c6)(`[TemplateZipData] all done {${e}}`)}async initTemplateFiles(e){const t=await this.rootFiles["preview_gif.gif"].async("blob");e.coverFile=new File([t],"text.gif",{type:"image/gif"}),this.timing.initTemplateFilesEndTime=performance.now(),(0,gt.c6)("[TemplateZipData] initTemplateFiles done")}async initNonBusinessInfo(e){}async initFlowerTexts(){const e=this.rootFiles["flower_text.json"];if(!e)return;const{text_template:t=[],local:i=[]}=await Ai(e,{});if((0,gt.c6)("[TemplateZipData] flower_text.json",{text_template:t,local:i}),!t.length&&!i.length)return;const s=await Promise.all(t.map((async e=>{const t=e.local_id,i=this.rootFiles[`${t}.zip`];if(!i)return null;const s=await i.async("blob"),a=new File([s],"flower.zip",{type:"application/zip"}),n=await Oi(s);(0,gt.c6)(`[TemplateZipData] decompress flower.zip done {${t}}`,{id:t,files:Object.keys(n)});const r=await n["cover_icon.png"].async("blob"),l=new File([r],"flower.png",{type:"image/png"}),{version:o="1.0.0"}=await Ai(n["config.json"],{});return{id:t,isDepMaterial:!0,file:a,coverFile:l,sdkVersion:o,groupId:e.group_id||""}})));this.flowerTexts=s.filter((e=>null!==e)),this.timing.initFlowerTextsEndTime=performance.now(),(0,gt.c6)("[TemplateZipData] initFlowerTexts done",{flowers:this.flowerTexts.map((e=>e.id))})}async initStickers(e){const t=this.rootFiles["local_sticker.json"];if(!t)return;const{text_template:i=[],local:s=[]}=await Ai(t,{});(0,gt.c6)("[TemplateZipData] local_sticker.json",{text_template:i,local:s});const a=await Promise.all(i.map((async t=>{var i;const s=t.local_id,a="true"===t.is_sequence,n=t.type,r=null===(i=e.contentJson.children)||void 0===i?void 0:i.find((e=>e.name===t.local_id)),l="sticker"===(null==r?void 0:r.type)&&r.sticker_path||"",o=e.files[l];if(!o)return null;const c=await o.async("blob");return{id:s,isDepMaterial:!0,file:new File([c],o.name,{type:`image/${n}`}),isSequence:a}})));this.stickers=a.filter((e=>null!==e)),this.timing.initStickersEndTime=performance.now(),(0,gt.c6)("[TemplateZipData] initStickers done",{stickers:this.stickers.map((e=>e.id))})}generateNewTemplateContentJsonChild(e,t){var i;if("text"===e.type&&null!==(i=e.text_params)&&void 0!==i&&i.richText){let i=e.text_params.richText;return Object.entries(t).forEach((([e,t])=>{const s=new RegExp(e,"g");i=i.replace(s,t)})),{...e,text_params:{...e.text_params,richText:i}}}return"sticker"===e.type&&!e.sticker_resource_id&&t[e.name]&&e.sticker_path?{...e,sticker_path:"",sticker_design_type:0,sticker_resource_id:t[e.name]}:e}async createNewZipFile(e){return this._effectType===r.TextTemplate?this.createNewTextTemplateZipFile(e):this._effectType===r.SubtitleTemplate?this.createNewSubtitleTemplateZipFile(e):this.createDefaultZipFile()}async createNewTextTemplateZipFile(e){var t;const{previewTime:i,depResourceIdMap:s}=e,{files:a,contentJson:n,extraJson:r}=this.template,l={...n,root:{...n.root,preview_time:i},children:n.children.map((e=>this.generateNewTemplateContentJsonChild(e,s)))},o={...r,depend_resource_list:null===(t=r.depend_resource_list)||void 0===t?void 0:t.map((e=>{const t=s[e.resource_id];return t?{...e,resource_id:t,source:1}:e}))},c=new(Mi());c.file(Ui,JSON.stringify(l)),c.file(Zi,JSON.stringify(o)),c.files={...a,...c.files};const d=await c.generateAsync({type:"blob"});return{file:new File([d],"text_template.zip",{type:"application/zip"}),contentJson:l,extraJson:o}}async createNewSubtitleTemplateZipFile(e){var t;const{previewTime:i,depResourceIdMap:s}=e,{files:a,contentJson:n,extraJson:r}=this.template,l={...n,root:{...n.root,preview_time:i},children:n.children.map((e=>this.generateNewTemplateContentJsonChild(e,s)))};if(n.sub_template_info){const e={...n.sub_template_info,elements:n.sub_template_info.elements.map((e=>({...e,root:{...e.root,preview_time:i},children:e.children.map((e=>this.generateNewTemplateContentJsonChild(e,s)))})))};l.sub_template_info=e}const o={...r,depend_resource_list:null===(t=r.depend_resource_list)||void 0===t?void 0:t.map((e=>{const t=s[e.resource_id];return t?{...e,resource_id:t,source:1}:e}))},c=new(Mi());c.file(Ui,JSON.stringify(l)),c.file(Zi,JSON.stringify(o)),c.files={...a,...c.files};const d=await c.generateAsync({type:"blob"});return{file:new File([d],"text_template.zip",{type:"application/zip"}),contentJson:l,extraJson:o}}async createDefaultZipFile(){const{files:e,contentJson:t,extraJson:i}=this.template,s=new(Mi());s.file(Ui,JSON.stringify(t)),s.file(Zi,JSON.stringify(i)),s.files={...e,...s.files};const a=await s.generateAsync({type:"blob"});return{file:new File([a],"text_template.zip",{type:"application/zip"}),contentJson:t,extraJson:i}}}function $i(e){const{title:t,isHighPriority:i,isVip:s,isBusiness:a,isOriginal:n,tags:l,sdkVersion:o,baseSource:c,cover:d,file:u,postChannel:p,targetedActivityId:m,lang:h}=e,f=i?`${c}_without_review`:c,g=Kt({isVip:s,isBusiness:a});return{effect_type:r.WordArt,is_vip:s,...g.root,common_data:{title:t,description:t,icon:{image_uri:d.uri},file:{file_md5:u.md5,file_uri:u.uri,size:u.size},sdk_version:o,source:f,tags:l,is_original:n,is_business:a,post_channel:p===Ct.iu.Targeted?`${Ct.iu.Targeted}_${m}`:p,web_extra:JSON.stringify({targeted_id:m}),...g.commonData,...h&&{item_language:h}}}}function Vi(e){var t,i;const{effectType:s,title:a,tags:n,isHighPriority:l,isVip:o,postChannel:c,targetedActivityId:d,isBusiness:u,isOriginal:p,templateZipData:m,cover:h,staticFrame:f,file:g,lang:v,extraJson:_,authFiles:x,baseSource:w}=e,{sdkVersion:y}=m,T=Kt({isVip:o,isBusiness:u,authFiles:x}),b=l?`${w}_without_review`:w,C=s===r.SubtitleTemplate?"subtitle_template":"text_template";return{effect_type:s,is_vip:o,...T.root,common_data:{title:a,description:a,icon:{image_uri:h.uri,static_uri:f.uri},file:{file_md5:g.md5,file_uri:g.uri,size:g.size},sdk_version:y,source:b,tags:n,is_original:p,is_business:u,post_channel:c===Ct.iu.Targeted?`${Ct.iu.Targeted}_${d}`:c,web_extra:JSON.stringify({targeted_id:d}),...T.commonData,...v&&{item_language:v}},[C]:{depend_resource_list:null!==(t=_.depend_resource_list)&&void 0!==t?t:[],script_template_version:null!==(i=_.script_template_version)&&void 0!==i?i:"",..._.texts&&{texts:_.texts}}}}function Bi(e){const{id:t,title:i,tags:s,isVip:a,isBusiness:n,isOriginal:r,cover:l,staticFrame:o,file:c,authFiles:d,onlineData:u}=e,p=Gt({isOriginal:r,isVip:a,isBusiness:n,authFiles:d,onlineData:u});return{id:t,title:i,description:i,icon:{image_uri:l.uri,static_uri:o.uri},file:{file_md5:c.md5,file_uri:c.uri,size:c.size},tags:s,...p}}class Wi{constructor(e){(0,mt.Z)(this,"_effectType",void 0),(0,mt.Z)(this,"_isInitialized",!1),(0,mt.Z)(this,"authConfig",{mustPaidAuth:!1,mustCommerceAuth:!1}),(0,mt.Z)(this,"resourceCommonConfig",{maxTitleLen:0}),this._effectType=e,this.init()}async init(){{const e=await(0,Ct.A1)({effect_type:this._effectType});this.authConfig={mustPaidAuth:e.auth_config.must_paid_auth,mustCommerceAuth:e.auth_config.must_commerce_auth}}this._isInitialized=!0}}function Hi(e){const{id:t,resourceId:i,isMultiLang:s}=e,a=e.languages.map(((e,t)=>function(e,t){const{lang:i,resourceId:s,templateZipData:a}=e,{coverFile:n,extraJson:r}=a.template;return{lang:i,resourceId:s,templateZipData:a,cover:Wt({src:t.needSrc?Nt(n):"",file:n}),staticFrame:(l={},{id:"",src:"",uri:"",isUploadFailed:!1,file:new File([],""),index:0,duration:3,list:[],...l}),file:(0,ft.LO)({...Ht({}),previewTime:0,extraJson:r},{extraJson:ft.LO.ref}),publishType:s?"update":"create"};var l}(e,{needSrc:!0}))),n=bt.$.isEnableAuthorization;return(0,ft.LO)({id:t,resourceId:s?i:a[0].resourceId,title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:n,isHighPriority:!1,isMultiLang:s,languages:a,onlineData:{isOriginal:!1,isVip:!1,isBusiness:!1,resourceId:i,langResourceIds:[],langResourceIdMap:{}}},{onlineData:ft.LO.ref})}const qi=new Wi(r.TextTemplate);function Ji(e){return e.languages[0]}function Ki(e,t){const i=e.languages[0],{resourceId:s,title:a,tags:n,isVip:l,isBusiness:o,isOriginal:c,isHighPriority:d,languages:u,onlineData:p,postChannel:m,targetedActivityId:h}=e,{sdkVersion:f}=i.templateZipData,g=t.authFileUploadServiceManager.getUploadedFiles(e.id),v=Ct.r0.UserPostPcMultiLangTextTemplate,_=d?`${v}_without_review`:v;if(p.resourceId){const t=Gt({isOriginal:c,isVip:l,isBusiness:o,authFiles:g,onlineData:p}),{newResourceIdList:r}=function(e){const{onlineData:t,languages:i}=e;let s=!1;const a=[...t.langResourceIds];for(const n of i){const e=t.langResourceIdMap[n.lang];if(e&&e===n.resourceId)continue;const i=a.findIndex((t=>t===(null!=e?e:n.resourceId)));-1===i?a.push(n.resourceId):a[i]=n.resourceId,(0,gt.c6)("[TextTemplateService] makeMultiLangTextTemplateReq update resourceIdList",{existingId:e,updatedId:n.resourceId,isAdd:-1===i,languageResourceIds:t.langResourceIds,langResourceIdMap:t.langResourceIdMap}),s=!0}return{newResourceIdList:a,isResourceIdListUpdated:s}}(e);return{id:s,..."en"===i.lang&&{title:a,description:a,icon:{image_uri:i.cover.uri,static_uri:i.staticFrame.uri},tags:n,...t},collection_info:{resource_id_list:r}}}const x=Kt({isVip:l,isBusiness:o,authFiles:g}),w=u.map((e=>e.resourceId));return{effect_type:r.MultiLanguageTextTemplate,is_vip:l,...x.root,common_data:{title:a,description:a,icon:{image_uri:i.cover.uri,static_uri:i.staticFrame.uri},sdk_version:f,source:_,tags:n,is_original:c,is_business:o,post_channel:m===Ct.iu.Targeted?`${Ct.iu.Targeted}_${h}`:m,web_extra:JSON.stringify({targeted_id:h}),...x.commonData},collection_info:{resource_id_list:w}}}class Gi{get materials(){return this.ids.map((e=>this.data.get(e)))}get selected(){var e;return this.ids.includes(this.selectedId)&&null!==(e=this.data.get(this.selectedId))&&void 0!==e?e:null}get length(){return this.ids.length}select(e){this.selectedId=e&&this.ids.includes(e.id)?e.id:""}constructor(e){this.options=e,(0,mt.Z)(this,"ids",[]),(0,mt.Z)(this,"data",new Map),(0,mt.Z)(this,"selectedId",""),(0,mt.Z)(this,"op",null),(0,ft.ky)(this),this.options.createOp&&(this.op=this.options.createOp(this))}get(e){return this.ids.includes(e)&&this.data.get(e)||null}add(...e){for(const t of e)this.ids.includes(t.id)||(this.ids.push(t.id),this.data.set(t.id,t))}replaceByMap(e,t){const i=this.ids;if(e.forEach((e=>{var i;const s=null!==(i=this.data.get(e.id))&&void 0!==i?i:null;this.data.set(e.id,t(e,s))})),this.ids=e.map((e=>e.id)),this.ids.includes(this.selectedId)||(this.selectedId=""),!this.options.keepDataOnDelete){const e=new Set(this.ids);i.filter((t=>!e.has(t))).forEach((e=>this.deleteData(e)))}}delete(e){const t=this.ids.findIndex((t=>t===e.id));-1!==t&&(this.ids.splice(t,1),e.id===this.selectedId&&(this.selectedId=""),this.options.keepDataOnDelete||this.deleteData(e.id))}deleteData(e){var t,i;const s=this.data.get(e);this.data.delete(e),s&&(null===(t=(i=this.options).onDeleteData)||void 0===t||t.call(i,s))}updateAll(e){this.materials.forEach((t=>e(t)))}}var Xi=i(17473);function Qi(e){console.log("[sendLog]",e.eventName,e.params),(0,Xi.Z)(e)}function Yi(e){return void 0===e?e:String(Math.round(e/1024))}function es(e){const{material_category:t,material_type:i,collection_detail:s}=e;return{material_category:t,material_type:i,...s&&"collection"===i&&{collection_detail:s}}}function ts(e){if(0===e.length)return;const t=function(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,i])=>{const s=i||"";t[e]=t[e]?`${t[e]},${s}`:s}))})),t}(e),i=new Set(t.material_type.split(","));1===i.size&&(t.material_type=i.values().next().value),Qi({eventName:"personal_page_material_publish_error_report",params:t})}function is(e){const{status:t,material_type:i,material_category:s,title:a,description:n,isOriginal:r,tags:l,material_format:o,material_size:c,resolution:d,error_type:u,cover_type:p,time:m,extra:h={},authorize_range:f,isVipAuthorized:g,isBusinessAuthorized:v,is_official_task:_,task_id:x,material_id:w,material_subcategory:y,effect_type_title:T,effect_type_id:b}=e;return Qi({eventName:"personal_page_material_publish_status",params:{status:t,material_type:i,material_category:s,material_title:a,material_introduction:n,is_original:r?"1":"0",hashtag:l.join(","),material_format:o,material_size:Yi(c),resolution:d,authorize_range:f,is_official_task:_,task_id:x,material_id:w,material_subcategory:y,effect_type_title:T,effect_type_id:b,..."fail"===t&&{error_type:u},cover_type:p,time:m,is_subscription_authorized:g?1:0,is_commercial_authorized:v?1:0,...h}})}const ss={[r.Sticker]:"sticker",[r.Filter]:"filter",[r.FilterCollection]:"filter",[r.AudioEffect]:"audio",[r.Video]:"video",[r.TextTemplate]:"text_template",[r.SubtitleTemplate]:"caption_template",[r.WordArt]:"flower",[r.LocalEffects]:"effect"};class as{constructor({itemType:e,materialCategory:t}){(0,mt.Z)(this,"materialTypeParams",{material_category:"",material_type:""}),(0,mt.Z)(this,"isCollection",!1),this.isCollection=e>100,this.materialTypeParams={material_category:t||ss[e]||"",material_type:e>100?"collection":"single"}}sendPageActionLog(e){!function(e){const{action:t,extra:i={},material_cnt:s}=e;Qi({eventName:"personal_page_material_publish_page_action",params:{action:t,material_cnt:s,...es(e),...i}})}({...this.materialTypeParams,...e,...this.isCollection&&{collection_detail:e.collection_detail||"collection_all"}})}sendMaterialUploadStatusLog(e){!function(e){const{error_report:t,upload_status:i,time:s,isCompressed:a,sizeBeforeCompress:n,sizeAfterCompress:r,resolutionBeforeCompress:l,resolutionAfterCompress:o,extra:c={}}=e;Qi({eventName:"personal_page_material_upload_status",params:{...es(e),error_report:t,upload_status:i,time:s,is_compressed:a?1:0,...a&&{material_size_before_compress:Yi(n),material_size_after_compress:Yi(r),material_resolution_before_compress:l,material_resolution_after_compress:o},...c}})}({...this.materialTypeParams,...e})}sendMaterialImportErrorLog(e){return function(e){const{error_report:t}=e;Qi({eventName:"personal_page_material_import_error_report",params:{...es(e),error_report:t}})}({...this.materialTypeParams,...e})}sendMaterialPublishErrorLog(e){return ts(e.map((e=>({...this.materialTypeParams,...e}))))}sendMaterialPublishStatusLog(e,t){var i;const{status:s,error_type:a,cover_type:n,resolution:r,time:l,path:o,targetedActivityId:c}=e,{common_data:d,is_vip:u}=e.publishParams,p=[];return d.is_business&&p.push("business"),u&&p.push("subscribe"),is({...this.materialTypeParams,status:s,title:d.title,isOriginal:Boolean(d.is_original),tags:d.tags||[],material_format:Et(o),material_size:null===(i=d.file)||void 0===i?void 0:i.size,description:d.description,resolution:r,error_type:a,time:l,cover_type:n,authorize_range:p.join(","),isVipAuthorized:Xt(e.publishParams.copyright,Ct.$x.Vip),isBusinessAuthorized:Xt(e.publishParams.copyright,Ct.$x.Business),is_official_task:d.post_channel===Ct.iu.Open?0:1,task_id:c,...t})}sendMaterialPublishPageResultLog(e){!function(e){Qi({eventName:"personal_page_material_publish_page_result",params:e})}({...this.materialTypeParams,...e})}sendClickSubscriptionCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_subscription":"cancel_check_box_subscription"})}sendSubscriptionStatementLog(e){!function(e){const{action:t,material_category:i,material_type:s,entry_from:a}=e;Qi({eventName:"ugc_material_subscription_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:a}})}({...this.materialTypeParams,...e})}sendClickCommercialCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_commercial":"cancel_check_box_commercial"})}sendCommercialStatementLog(e){!function(e){const{action:t,material_category:i,material_type:s,entry_from:a,hasCopyrightAuthorization:n}=e;Qi({eventName:"ugc_material_commercial_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:a,..."boolean"==typeof n&&{has_copyright_authorization:n?"1":"0"}}})}({...this.materialTypeParams,...e})}sendAuthorSignLog(e){!function(e){const{action:t,page_type:i,material_category:s,material_type:a,button_name:n}=e;Qi({eventName:"ugc_material_creator_sign_agreement",params:{action:t,page_type:i,material_category:s,material_type:a,...n&&{button_name:n}}})}({...this.materialTypeParams,...e})}}const ns={[r.TextTemplate]:r.MultiLanguageTextTemplate};var rs=i(71412);var ls=i(11507),os=i(53697),cs=i(23875);var ds=i(7142),us=i(77517);const ps="fmp";class ms extends((()=>us.EventEmitter)()){constructor(){super(),(0,mt.Z)(this,"category",{}),(0,mt.Z)(this,"customTiming",{}),(0,mt.Z)(this,"hasReportedFmp",!1),(0,mt.Z)(this,"messageChannel",new MessageChannel),(0,mt.Z)(this,"afterFramePromise",null),this.messageChannel.port2.onmessage=()=>this.emit("_messagechannel")}updateCategory(e){this.category={...e,...this.category}}getCategoryToReport(){return{scene:"success",...this.category}}addTiming(e,t=performance.now()){this.customTiming[e]||(this.customTiming[e]=t)}addSetStateTiming(e,t){this.customTiming[e]||(this.addTiming(`${e}-setState`),this.addRenderTiming(e),t&&this.updateCategory(t))}afterFrame(){return this.afterFramePromise||(this.afterFramePromise=new Promise((e=>{window.requestAnimationFrame((()=>{this.once("_messagechannel",(()=>{this.afterFramePromise=null,e()})),this.messageChannel.port1.postMessage(null)}))}))),this.afterFramePromise}async addRenderTiming(e,t){this.customTiming[e]||("visible"===document.visibilityState&&await this.afterFrame(),this.addTiming(e),t&&this.updateCategory(t),e!==ps||this.hasReportedFmp||this.report())}report(){var e;const t=(0,ai.Z)(performance.timing,["connectEnd","connectStart","domComplete","domContentLoadedEventEnd","domContentLoadedEventStart","domInteractive","domLoading","domainLookupEnd","domainLookupStart","fetchStart","loadEventEnd","loadEventStart","navigationStart","redirectEnd","redirectStart","requestStart","responseEnd","responseStart","secureConnectionStart","unloadEventEnd","unloadEventStart"]),i=t.navigationStart,s=this.getMetrics(i,t);Object.assign(s,this.customTiming);const a=this.getCategoryToReport();(0,gt.hC)({module:"fmp",scene:a.scene,categories:a,metrics:s}),Qi({eventName:"heycan_performance_timing",params:{pid:null===(e=ds.Z.config)||void 0===e||null===(e=e.call(ds.Z))||void 0===e?void 0:e.pid,...a,...s}}),this.hasReportedFmp=!0,this.emit("fmp",{startTime:i,category:a})}getMetrics(e,t){const i={};return Object.keys(t).forEach((s=>{t[s]&&(i[s]=t[s]-e)})),i}}let hs=null;function fs(e){const t=e.subFlowerTexts.map(((e,t)=>function(e,t){const{lang:i,data:s}=e,{id:a,coverFile:n,file:r}=s;return{id:a,lang:i,resourceId:"",cover:Wt({src:t.needSrc?Nt(n):"",file:n}),file:Ht({file:r})}}(e,{needSrc:0===t}))),i=bt.$.isEnableAuthorization,{isDepMaterial:s,sdkVersion:a}=e.subFlowerTexts[0].data;return(0,ft.LO)({id:t[0].id,groupId:e.groupId,isDepMaterial:s,sdkVersion:a,title:"",tags:[],subFlowerTexts:t,isVip:i})}const gs=new Wi(r.WordArt);function vs(){const e=gi({watch:()=>o.isAllUploaded}),t=gi({watch:()=>o.isDepUploaded&&!o.isAllUploadedWatcher.isPromptingConfirmToCancel}),i=fi({watch:()=>o.textTemplateList.materials.every((e=>e.languages.every((e=>e.staticFrame.src))))}),s=(0,a.useMemo)((()=>new Ni),[]),{t:l}=(0,n.$)(),o=(0,ni.fv)((()=>({formApi:null,setFormApi:e=>{o.formApi=e},startPublishTime:0,performanceTimingCollector:(hs||(hs=new ms),hs),initOp:new Ei({fetchFirstPage:async()=>{Tt.appModel.isInited||await(0,Pi.cb)({throwOnError:!0}),o.performanceTimingCollector.addTiming("initFullAppInfoDone"),(0,gt.c6)("[SingleStore] getTextTemplateSingleInitialData req --\x3e");const e=await(0,ls.oh)(os.Z,"getTextTemplateSingleInitialData",{});(0,gt.c6)("[SingleStore] getTextTemplateSingleInitialData resp <--",(0,ai.Z)(e,"type","singles")),o.performanceTimingCollector.addTiming("getInitialDataDone");const t=o.fetchOnlineTextTemplates(e),i=[],s=[],a=[];for(const c of e.singles){const e=await o.makeInitTextTemplate(c,s,a);i.push(e)}o.performanceTimingCollector.addTiming("initTextTemplateDone"),(0,gt.c6)("[SingleStore] await fetchOnlineTextTemplates start");const n=await t;o.performanceTimingCollector.addTiming("fetchOnlineDataDone"),(0,gt.c6)("[SingleStore] mergeOnlineTextTemplate start");for(const c of i)o.mergeOnlineTextTemplate(c,n);(0,gt.c6)("[SingleStore] make init flowerText sticker start");const r=s.map((e=>fs(e))),l=a.map((e=>function(e){const{id:t,isDepMaterial:i,isSequence:s,file:a}=e;return{id:t,resourceId:"",isDepMaterial:i,title:"",tags:[],isSequence:s,cover:Wt({file:a})}}(e)));return()=>{o.textTemplateList.replaceByMap(i,(e=>e)),o.flowerTextList.replaceByMap(r,(e=>e)),o.stickers=l;const e=o.flowerTextList.materials[0];o.flowerTextList.select(e),o.initStaticFrame(o.textTemplateList.materials),o.initUploadFiles(),o.performanceTimingCollector.addSetStateTiming(ps)}},slardarErrorLog:(e,t)=>{(0,gt.RF)(`[SingleStore] ${e} failed`,t),o.performanceTimingCollector.addSetStateTiming(ps,{scene:"initFailed"})}}),async makeInitTextTemplate(e,t,i){const{id:s,isMultiLang:a}=e,n=[];(0,gt.c6)("[SingleStore] makeInitTextTemplate start",{id:s});const l=a?e.languages:e.languages.slice(0,1);for(const o of l){const{lang:a}=o;(0,gt.c6)("[SingleStore] makeInitTextTemplate one language start",{id:s,lang:a});const l=new zi({id:`${a}-${e.id}`,effectType:r.TextTemplate,fetchZipBase64:async()=>{const{zipData:t}=await(0,vi.FI)({id:e.id,lang:a});return t}});await l.init(),n.push({lang:a,resourceId:o.resourceId,templateZipData:l});for(const e of l.flowerTexts){const i=e.id;let s=t.find((e=>e.groupId&&e.groupId===i));s||(s={groupId:i,subFlowerTexts:[]},t.push(s)),s.subFlowerTexts.push({lang:a,data:e})}for(const e of l.stickers)i.some((t=>t.id===e.id))||i.push(e)}return(0,gt.c6)("[SingleStore] makeInitTextTemplate done",{id:s}),Hi({id:s,isMultiLang:a,resourceId:e.resourceId,languages:n})},fetchOnlineTextTemplates:async({type:e,singles:t})=>"update"!==e?{}:async function({effectType:e,singles:t}){const i=ns[e],s={},a=[];for(const c of t){var n;const t=c.isMultiLang?c.resourceId:null===(n=c.languages[0])||void 0===n?void 0:n.resourceId;if(!t)continue;const s=c.isMultiLang?i:e;if(void 0===s)throw new _t.w(`effectType=${e} doesn't support multi lang`,{effectType:e});a.push({id:t,effect_type:s,source:1})}if(0===a.length)return(0,gt.c6)("[OnlineData] fetchOnlineTemplates no reqItems"),s;(0,gt.c6)("[OnlineData] fetchOnlineTemplates mgetItem start",{ids:a.map((e=>e.id))});const r=await(0,Ct.yF)({items:a,pack_optional:{need_tag:!0,need_parent_tag:!1,need_copyright:!0},controller_policy_optional:{from_cache:!1}});(0,gt.c6)("[OnlineData] fetchOnlineTemplates mgetItem success",{ids:r.effect_item_list.map((e=>e.common_attr.id))});const l=[];if(r.effect_item_list.forEach((t=>{var a;s[t.common_attr.id]=t,t.common_attr.effect_type===i&&(null===(a=t.collection)||void 0===a||a.resource_id_list.forEach((t=>l.push({id:t,effect_type:e,source:1}))))})),0===l.length)return(0,gt.c6)("[OnlineData] fetchOnlineTemplates no subLangReqItems"),s;(0,gt.c6)("[OnlineData] fetchOnlineTemplates subLanguage mgetItem start",{ids:l.map((e=>e.id))});const o=await(0,Ct.yF)({items:l,pack_optional:{need_tag:!0,need_parent_tag:!1,need_copyright:!0},filter_optional:{no_filter_by_rule:!0},controller_policy_optional:{from_cache:!1}});return(0,gt.c6)("[OnlineData] fetchOnlineTemplates subLanguage mgetItem success",{ids:o.effect_item_list.map((e=>e.common_attr.id))}),o.effect_item_list.forEach((e=>{s[e.common_attr.id]=e})),s}({effectType:r.TextTemplate,singles:t}),mergeOnlineTextTemplate(e,t){const i=function({effectType:e,resourceId:t,mainLang:i,firstLanguage:s,onlineTemplates:a}){var n,r;if(!t)return null;const l=a[s.lang===i?t:s.resourceId||t];if(!l)return(0,gt.RF)("[OnlineData] extractOnlineTemplate item not found",null,{id:t,firstLanguage:s,mainLang:i}),null;const{title:o,tag_list:c=[],is_original:d}=l.common_attr,{isBusiness:u,isVip:p,authFiles:m}=Qt(l),h={form:{title:o,tags:Array.from(new Set(c.map((e=>e.name)))),isOriginal:d,isBusiness:u,isVip:p,isHighPriority:String(l.common_attr.publish_source).endsWith("_without_review")},authFiles:m,onlineData:{isOriginal:d,isBusiness:u,isVip:p,copyright:l.copyright,langResourceIds:[],langResourceIdMap:{}}},f=a[t],g=ns[e];if(!g||(null==f?void 0:f.common_attr.effect_type)!==g)return h;h.onlineData.langResourceIds=null!==(n=null===(r=f.collection)||void 0===r?void 0:r.resource_id_list)&&void 0!==n?n:[],h.onlineData.langResourceIdMap={};for(const _ of h.onlineData.langResourceIds){var v;const e=null===(v=a[_])||void 0===v?void 0:v.common_attr.item_language;e?h.onlineData.langResourceIdMap[e]=_:(0,gt.RF)("[OnlineData] extractOnlineTemplate lang is empty",null,{id:_,hasItem:Boolean(a[_])})}return h}({effectType:r.TextTemplate,resourceId:e.resourceId,mainLang:"en",firstLanguage:e.languages[0],onlineTemplates:t});i&&(Rt(e,i.form),Rt(e.onlineData,i.onlineData),i.authFiles.length&&o.authFileUploadServiceManager.ensure(e.id).addOnlineFiles(i.authFiles))},get mainFormLayout(){const{fetchStatus:e}=o.initOp;return e.isFailed?"error":e.hasFetched?"mainForm":"loading"},get needConfirmModalOnClose(){return!0},get field(){return{canBusiness:bt.$.permissions.includes(bt.v.EffectSetBusiness),canVip:bt.$.permissions.includes(bt.v.EffectSetVip),canHighPrio:bt.$.permissions.includes(bt.v.EffectHighPrio)}},pubService:new oi,sendLogService:new as({itemType:r.WordArt,materialCategory:"text_effect"}),authorSignService:new pi({signScene:ui.BusinessArtist}),authFileUploadServiceManager:new hi({}),isAllUploadedWatcher:e,fileOp:new Jt({uploadConfigService:s}),textTemplateList:new Gi({}),flowerTextList:new Gi({}),stickers:[],init(){o.initOp.initFetchFirstPage(null)},retryInit(){o.initOp.retryFetchFirstPage()},selectTextTemplateCard(e){o.saveCurrentForm(),o.textTemplateList.select(e),o.flowerTextList.select(null)},selectFlowerTextCard(e){o.saveCurrentForm(),o.flowerTextList.select(e),o.textTemplateList.select(null)},initTextTemplateForm(e){var t;null===(t=o.formApi)||void 0===t||t.setValues({textTemplate:{title:e.title,tags:[...e.tags],isOriginal:e.isOriginal,isVip:e.isVip,isBusiness:e.isBusiness,isHighPriority:e.isHighPriority}})},saveTextTemplateForm(e){var t;const i=null===(t=o.formApi)||void 0===t?void 0:t.getValues().textTemplate;i&&Rt(e,{title:i.title||"",tags:i.tags,isOriginal:i.isOriginal||!1,isVip:i.isVip||!1,isBusiness:i.isBusiness||!1,isHighPriority:i.isHighPriority||!1})},initFlowerTextForm(e){var t;null===(t=o.formApi)||void 0===t||t.setValues({flowerText:{...o.formApi.getValue("flowerText"),title:e.title,tags:[...e.tags],isVip:e.isVip}})},applyTagsToAll(e){o.flowerTextList.updateAll((t=>{t.tags=[...e]}))},saveFlowerTextForm(e){var t;const i=null===(t=o.formApi)||void 0===t?void 0:t.getValues().flowerText;i&&Rt(e,{title:i.title||"",tags:i.tags})},saveCurrentForm(){o.textTemplateList.selected?o.saveTextTemplateForm(o.textTemplateList.selected):o.flowerTextList.selected&&o.saveFlowerTextForm(o.flowerTextList.selected)},initStaticFrameTimer:new ne.B,async initStaticFrame(e){for(const t of e){const{id:e,languages:i}=t;for(let s=0;s<i.length;s+=1){const a=i[s];await o.fileOp.initStaticFrame({id:`${a.lang}-${e}`,getInitIndex:()=>0===s?null:t.languages[0].staticFrame.index,staticFrame:a.staticFrame,templateZipData:a.templateZipData}),await o.initStaticFrameTimer.timeout(100)}}},async initUploadFiles(){try{await s.getUploadConfigs("initUploadFiles")}catch{}for(const e of o.textTemplateList.materials)o.initUploadTextTemplateFiles(e);!function(e,t){for(const i of t.flowerTexts)for(const t of i.subFlowerTexts)e.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:Bt("flower-text-cover")})}),e.initUploadFile({getFile:()=>t.file,typeName:"zip",getInitValues:()=>({id:Bt("flower-text-zip")})});for(const i of t.stickers)e.initUploadCover({getCover:()=>i.cover,getInitValues:()=>({id:Bt("sticker-cover")})})}(o.fileOp,{flowerTexts:o.flowerTextList.materials,stickers:o.stickers})},initUploadTextTemplateFiles(e){for(const t of e.languages)o.fileOp.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:Bt("text-template-cover")})})},async retryUpload(){o.depPublishStatus.isCanceled=!1;try{await s.getUploadConfigs("retryUploadFiles")}catch{o.depPublishStatus.isFailed=!0}for(const e of o.textTemplateList.materials)for(const t of e.languages)o.fileOp.retryUpload(t.cover,t.staticFrame,t.file);!function(e,t){for(const i of t.flowerTexts)for(const t of i.subFlowerTexts)e.retryUpload(t.cover,t.file);for(const i of t.stickers)e.retryUpload(i.cover)}(o.fileOp,{flowerTexts:o.flowerTextList.materials,stickers:o.stickers})},handleUploadCancel(){(0,gt.c6)("[SingleStore] publish cancel"),o.sendLogService.sendMaterialPublishPageResultLog({status:"cancel",time:Date.now()-o.startPublishTime,material_cnt:o.flowerTextList.length,material_id:""}),o.sendLogService.sendPageActionLog({action:"cancel"}),t.stop(),i.stop(),o.isAllUploadedWatcher.stop(),o.depPublishStatus.isCanceled=!0},async initUploadStaticFrame(e){await i.start();for(const t of e.languages)o.fileOp.initUploadCover({getCover:()=>t.staticFrame,getInitValues:()=>({id:Bt("text-template-static-frame"),file:new File([Lt(t.staticFrame.src)],"icon.png",{type:"image/png"})})})},handleStaticFrameChange(e,t){for(const i of e.languages)o.fileOp.updateStaticFrame(i.staticFrame,t)},async publishDeps(){const{textTemplateList:e,flowerTextList:t,stickers:i}=o,s=e.materials[0],a=(0,ai.Z)(s,"isBusiness","isOriginal","isHighPriority"),n=(r=t.materials,l=a,r.map((e=>e.subFlowerTexts.map((t=>{const{lang:i}=t,s=t.id;return{id:s,req:$i({...(0,ai.Z)(e,["tags","sdkVersion","postChannel","targetedActivityId","isVip"]),...(0,ai.Z)(t,["cover","file"]),...l,title:e.title,baseSource:Ct.r0.UserPostPc,lang:i}),onResult:(0,ft.aD)((({resourceId:a,error:n,req:r,time:l,errorText:o})=>{var c;is({status:n?"fail":"success",material_category:"text_effect",material_type:"single",material_id:a,task_id:e.targetedActivityId,title:r.common_data.title,isOriginal:Boolean(r.common_data.is_original),tags:null!==(c=r.common_data.tags)&&void 0!==c?c:[],time:l,isVipAuthorized:Xt(r.copyright,Ct.$x.Vip),isBusinessAuthorized:Xt(r.copyright,Ct.$x.Business),error_type:o}),n?(0,gt.RF)(`[DepMaterial] dep publish failed {${s}}`,n,{lang:i}):(t.resourceId=a,(0,gt.c6)(`[DepMaterial] dep publish success {${s}}`,{resourceId:a,lang:i}))}))}})))).flat());var r,l;const c=await o.pubService.batchPublish([...n]).catch((e=>{o.sendLogService.sendMaterialPublishPageResultLog({status:"fail",time:Date.now()-o.startPublishTime,material_cnt:o.flowerTextList.length,material_id:"",error_type:JSON.stringify(e||"").slice(1,50)})})),d=function(e){const t={};for(const i of e.flowerTexts)for(const e of i.subFlowerTexts)t[`${e.lang}-${e.id}`]=e.resourceId;for(const i of e.stickers)t[i.id]=i.resourceId;return t}({flowerTexts:o.flowerTextList.materials,stickers:o.stickers}),u=c.map((e=>e.resource_id));return(0,gt.c6)("[SingleStore] deps publish success",{resourceIdList:u,depResourceIdMap:d}),o.sendLogService.sendMaterialPublishPageResultLog({status:"success",time:Date.now()-o.startPublishTime,material_cnt:o.flowerTextList.length,material_id:u.join(",")}),{depResourceIdMap:d}},clearTextTemplateZip(){o.fileOp.templateZipCacheMap.clear();for(const e of o.textTemplateList.materials)for(const t of e.languages)o.fileOp.saveTemplateZipCache(e.id,t.lang,t.file)},async initUploadTextTemplateZip(e,t){const{textTemplateList:i}=o;for(const s of i.materials)for(const i of s.languages){const{lang:a,staticFrame:n,templateZipData:r}=i;if(await o.fileOp.initUploadTemplateZip({id:s.id,lang:a,zipFile:i.file,staticFrame:n,templateZipData:r,depResourceIdMap:e,checkIsCanceled:()=>t.isCanceled}),t.isCanceled)return}},depPublishStatus:{isFailed:!1,isCanceled:!1,isDone:!1},async startUploadAndPublishDeps(e){try{for(const e of o.textTemplateList.materials)o.initUploadStaticFrame(e);await t.start();const{depResourceIdMap:i}=await o.publishDeps();if(e.isCanceled)return;await o.initUploadTextTemplateZip(i,e),(0,ft.z)((()=>{e.isDone=!0}))}catch(i){(0,ft.z)((()=>{e.isFailed=!0})),(0,gt.RF)("[SingleStore] startUploadAndPublishDeps failed",i)}},get depUploadStats(){const e={pending:0,succeeded:0,failed:0};for(const t of o.flowerTextList.materials)for(const i of t.subFlowerTexts)qt(e,i.cover,i.file);for(const t of o.stickers)qt(e,t.cover);return e},get isDepUploaded(){const{pending:e,failed:t}=o.depUploadStats;return!e&&!t},get uploadStats(){const e={uninited:0,...o.depUploadStats};for(const s of o.textTemplateList.materials)for(const t of s.languages)qt(e,t.cover,t.staticFrame,t.file);const{isFailed:t,isDone:i}=o.depPublishStatus;return t?e.failed+=1:i?e.succeeded+=1:e.pending+=1,e},get isAllUploaded(){const{pending:e,failed:t}=o.uploadStats;return!e&&!t},get isReadyToPublish(){const{flowerTextList:e}=o;return e.length>0&&e.materials.every((e=>function(e){const{mustPaidAuth:t}=gs.authConfig,{postChannel:i,targetedActivityId:s,isVip:a}=e,n=i===Ct.iu.Open||i===Ct.iu.Targeted&&Boolean(s);return Boolean(e.title&&e.tags.length&&(t&&a||!t)&&n)}(e)))&&!o.isPublishSucceeded},async uploadAndPublish(e){(0,gt.c6)("[SingleStore] publish start"),this.startPublishTime=Date.now(),o.saveCurrentForm(),o.sendMaterialToolClickPublishLog(),o.sendLogService.sendPageActionLog({action:"publish",material_cnt:o.flowerTextList.length}),o.retryUploadAndPublishDeps(),null==e||e.show(),await o.isAllUploadedWatcher.start();try{await o.publish()}finally{null==e||e.hide()}},async retryUploadAndPublishDeps(){o.clearTextTemplateZip(),o.depPublishStatus={isFailed:!1,isCanceled:!1,isDone:!1};const{depPublishStatus:e}=o;await o.retryUpload(),o.startUploadAndPublishDeps(e)},isPublishing:!1,isPublishSucceeded:!1,async publish(){o.isPublishing=!0,(0,ft.z)((()=>{o.isPublishing=!1,o.isPublishSucceeded=!0})),B.FN.info({content:l("published_released_pc"),textMaxWidth:"80vw"}),o.sendMaterialToolPublishLog("success"),(0,gt.c6)("[SingleStore] publish success",{time:Date.now()-o.startPublishTime}),setTimeout((()=>(0,vi.gk)({showHomePage:!0})),3e3)},async publishImpl(){const e=o.textTemplateList.materials.map((e=>{const{isMultiLang:t}=e,{authFileUploadServiceManager:i}=o;return e.languages.map((s=>{const a=`${s.lang}-${e.id}`,n=t?function(e,t){const i={...(0,ai.Z)(e,["title","tags","isHighPriority","isVip","isBusiness","isOriginal","postChannel","targetedActivityId"]),...(0,ai.Z)(t,"lang","cover","staticFrame","file"),authFiles:[],baseSource:Ct.r0.UserPostPcInMultiLangTextTemplate};return"update"===t.publishType?Bi({id:t.resourceId,onlineData:e.onlineData,...i}):Vi({effectType:r.TextTemplate,templateZipData:t.templateZipData,extraJson:t.file.extraJson,...i})}(e,s):function(e,t){const i=Ji(e),s={...(0,ai.Z)(e,["title","tags","isHighPriority","isVip","isBusiness","isOriginal","postChannel","targetedActivityId"]),...(0,ai.Z)(i,"cover","staticFrame","file"),authFiles:t.authFileUploadServiceManager.getUploadedFiles(e.id),baseSource:Ct.r0.UserPostPc};return"update"===i.publishType?Bi({id:i.resourceId,onlineData:e.onlineData,...s}):Vi({effectType:r.TextTemplate,templateZipData:i.templateZipData,extraJson:i.file.extraJson,...s})}(e,{authFileUploadServiceManager:i});return{id:a,req:n,onResult:(0,ft.aD)((({req:i,resourceId:n,error:r,errorText:l,time:c})=>{o.sendLogService.sendMaterialPublishStatusLog({time:c,status:r?"fail":"success",error_type:l,publishParams:i,path:"",targetedActivityId:e.targetedActivityId}),r?(0,gt.RF)(`[SingleStore] single publish failed {${a}}`,r):(s.resourceId=n,t||(e.resourceId=n),(0,gt.c6)(`[SingleStore] single publish success {${a}}`,{resourceId:n}))})),onUpdateResult:(0,ft.aD)((({req:e,resourceId:t,error:i,errorText:s,time:n})=>{i?(0,gt.RF)(`[SingleStore] single update failed {${a}}`,i):(0,gt.c6)(`[SingleStore] single update success {${a}}`,{resourceId:t})}))}}))})).flat();(0,gt.c6)("[SingleStore] single publish start",{resourceIdList:e.map((e=>e.id))});const t=await o.pubService.batchPublish(e);(0,gt.c6)("[SingleStore] single publish done",{resourceIdList:t.map((e=>e.resource_id))});const i=o.textTemplateList.materials.filter((e=>e.isMultiLang)).map((e=>{const{authFileUploadServiceManager:t}=o,{id:i}=e;return{id:i,req:Ki(e,{authFileUploadServiceManager:t}),onResult:(0,ft.aD)((({req:t,resourceId:s,error:a,errorText:n,time:r})=>{a?(0,gt.RF)(`[SingleStore] multi lang publish failed {${i}}`,a):(e.resourceId=s,(0,gt.c6)(`[SingleStore] multi lang publish success {${i}}`,{resourceId:s}))})),onUpdateResult:(0,ft.aD)((({req:e,resourceId:t,error:s,errorText:a,time:n})=>{s?(0,gt.RF)(`[SingleStore] multi lang update failed {${i}}`,s):(0,gt.c6)(`[SingleStore] multi lang update success {${i}}`,{resourceId:t})}))}}));(0,gt.c6)("[SingleStore] multi lang publish start",{resourceIdList:i.map((e=>e.id))}),await o.pubService.batchPublish(i);const s=o.textTemplateList.materials.map((e=>e.resourceId));(0,gt.c6)("[SingleStore] multi lang publish done",{resourceIdList:s});const a=o.textTemplateList.materials.filter((e=>e.isMultiLang&&!e.onlineData.resourceId)).map((e=>({id:e.id,resourceId:e.resourceId})));var n;a.length&&((0,gt.c6)("[SingleStore] syncTemplateResourceId req --\x3e",{templates:a}),await(n={templates:a},(0,ls.oh)(cs.Z,"syncTemplateResourceId",n)),(0,gt.c6)("[SingleStore] syncTemplateResourceId resp <--"));o.textTemplateList.materials.some((e=>!e.onlineData.resourceId))?(await o.pubService.pollUntilAllInEffectList({ids:s.slice(-10),types:[r.TextTemplate,r.MultiLanguageTextTemplate]}),(0,gt.c6)("[SingleStore] poll done")):(0,gt.c6)("[SingleStore] no need to poll")},sendMaterialToolClickPublishLog(){const{textTemplateList:e,flowerTextList:t}=o;!function(e){const{caption_template_cnt:t,captionAnimationIds:i=[],text_template_cnt:s,material_type:a,text_special_effect_cnt:n}=e;Qi({eventName:"material_tool_click_publish_confirm",params:{caption_template_cnt:t,caption_animation_id:i.join(","),text_template_cnt:s,material_type:a,text_special_effect_cnt:n}})}({text_template_cnt:e.length,material_type:"single",text_special_effect_cnt:t.length})},sendMaterialToolPublishLog(e){const{textTemplateList:t,flowerTextList:i}=o;!function(e){const{multiLang:t,...i}=e,s=e=>({zh:"cn",en:"en",ja:"jp",ko:"kr"}[e]||""),a=e=>{var i;return null!==(i=null==t?void 0:t.map(e).join(","))&&void 0!==i?i:""};Qi({eventName:"material_tool_publish_status",params:{...i,...t&&{language_setting:a((({isMultiLang:e})=>e?"multi":"single")),language_type:a((({langs:e})=>s(e[0]))),language_total_type:a((({langs:e})=>e.map(s).join(";")))}}})}({text_template_cnt:t.length,text_special_effect_cnt:i.length,material_type:"single",status:e,success_cnt:t.materials.filter((e=>e.resourceId)).length,multiLang:t.materials.map((e=>({isMultiLang:e.isMultiLang,langs:e.languages.map((e=>e.lang))})))})},collectLogData(){const e=["id","uri","isUploadFailed"],t=o.textTemplateList.materials.map((t=>({...(0,ai.Z)(t,"id","resourceId","isMultiLang"),languages:t.languages.map((t=>({...(0,ai.Z)(t,"lang","resourceId"),cover:(0,ai.Z)(t.cover,e),staticFrame:(0,ai.Z)(t.staticFrame,[...e,"index"]),file:(0,ai.Z)(t.file,e),extraJson:t.file.extraJson})))}))),i=o.flowerTextList.materials.map((t=>({...(0,ai.Z)(t,"id","isDepMaterial","sdkVersion"),subFlowerTexts:t.subFlowerTexts.map((t=>({...(0,ai.Z)(t,"id","lang","resourceId"),cover:(0,ai.Z)(t.cover,e),file:(0,ai.Z)(t.file,e)})))}))),s=o.stickers.map((t=>({...(0,ai.Z)(t,"id","resourceId","isDepMaterial","isSequence"),cover:(0,ai.Z)(t.cover,e)}))),a={textTemplates:t,textTemplateCount:t.length,flowerTexts:i,stickers:s,isReadyToPublish:o.isReadyToPublish,depPublishStatus:{...o.depPublishStatus},uploadStats:{...o.uploadStats}};(0,gt.c6)("[SingleStore] collectLogData",a)}})));return function({watch:e,collect:t}){const i=(0,a.useMemo)((()=>(0,rs.Z)((async()=>{await Promise.resolve(),t()}),5e3)),[]);(0,a.useEffect)((()=>{const t=(0,ft.EH)((()=>{e(),i()}));return()=>{t(),i.cancel()}}),[])}({watch:()=>{o.uploadStats,o.isReadyToPublish},collect:o.collectLogData}),(0,a.useEffect)((()=>(window.store=o,o.init(),o.authorSignService.init(),()=>{o.initStaticFrameTimer.cancel()})),[]),o}const _s=(0,a.createContext)(null),xs=()=>(0,a.useContext)(_s),ws="root-LbkeWz",ys="container-jnsvSx",Ts="card-yURKE_",bs=(0,s.Pi)((e=>{const{className:t}=e,i=xs();return(0,w.jsx)("div",{className:d()(ws,t),children:(0,w.jsx)("div",{className:ys,children:i.flowerTextList.materials.map(((e,t)=>(0,w.jsx)(si,{className:Ts,flowerText:e,isSelected:i.flowerTextList.selectedId===e.id,onClick:i.selectFlowerTextCard},e.id)))})})}));function Cs(e,t){return t[0]<=e&&e<=t[1]}const Ss=[[8960,9215],[9728,55215],[65280,65519]];function Fs(e){const t=e.charCodeAt(0);return e.length>1||Ss.some((e=>Cs(t,e)))}const ks=[127462,127487],Is=[[8419,8419],[65024,65039],[127995,127999],[917536,917631],[768,879],[3633,3633],[3636,3642],[3655,3662]];function js(e,t){const i=e.normalize(),s=[];let a=0,n=0,r="";for(;a<i.length;){const e=i.codePointAt(a),l=e>65535?2:1,o=i.slice(a,a+l),c=s.length-1,d=c>=0?s[c]:null;if(c>=0&&(8205===e||8205===n||Cs(e,ks)&&Cs(n,ks)&&d===r||Is.some((t=>Cs(e,t))))&&(s[c]+=o),(c<0||d===s[c])&&o){if(null!=t&&t.maxLength&&s.length>=t.maxLength)return s;s.push(o)}n=e,r=o,a+=l}return s}function Ls(e,t,i){let s=0,a=0;for(;a<e.length;){const n=e[a],r=Fs(n)?2:1;if(s+=r,s>t&&a>0){a-=1,s-=r;break}if(i(n),s>=t)break;a+=1}return{segIndex:a,count:s}}function Ns(e,t){if(2*e.length<=t)return e;const i=js(e,{maxLength:t});let s="";return Ls(i,t,(e=>s=`${s}${e}`)),s}function Es(e){const t=(0,V.Z)((()=>e.getInputElem())),i=(0,a.useRef)(null);return(0,a.useLayoutEffect)((()=>{const e=t();i.current&&e&&([e.selectionStart,e.selectionEnd]=i.current,i.current=null)})),{saveSelectionIfNeeded:e=>{const s=t();null!=(null==s?void 0:s.selectionStart)&&null!=s.selectionEnd&&e!==s.value&&(i.current=[Math.min(e.length,s.selectionStart),Math.min(e.length,s.selectionEnd)])}}}const Ps="textarea-LCPYTj",Rs=e=>{var t;const i=(0,a.useRef)(!1),[s,n]=(0,a.useState)(""),{allowEnter:r=!0,value:l,...o}=e,{className:c,maxLength:u,onChange:p,onCompositionEnd:m,onCompositionStart:h}=o,f=i.current?s:l,g=(0,V.Z)((e=>{const t=e||"";return r?t:t.replace(/\n/g,"")})),v=(0,V.Z)((e=>{const t=g(e);return void 0!==u?Ns(t,u):t})),_=(0,V.Z)((e=>{i.current=!0,n(e.currentTarget.value),null==h||h(e)})),x=(0,a.useRef)(null),{saveSelectionIfNeeded:y}=Es({getInputElem:()=>x.current}),T=(0,V.Z)(((e,t)=>{y(e),null==p||p(e,t)})),b=(0,V.Z)((e=>{const t=v(e.currentTarget.value);i.current=!1,n(t),T(t,e),null==m||m(e)})),C=(0,V.Z)(((e,t)=>{const s=g(e);if(i.current)return void n(s);if(void 0===u)return void T(s,t);const a=v(s);T(a,t)})),S=(0,a.useMemo)((()=>({maxRows:3})),[]);return(0,w.jsx)(B.Kx,{autoComplete:"off",...o,ref:x,value:f,className:d()(c,Ps),maxLength:void 0,autosize:null!==(t=o.autosize)&&void 0!==t?t:S,rows:1,onChange:C,onCompositionStart:_,onCompositionEnd:b})},Ms=(0,B.Q2)(Rs);var Os=i(95291),Ds=i(61458);let As=function(e){return e.TagEachUser="TagEachUser",e.UseHasAgree="useHasAgree",e}({});const Us={TagEachUser:20};function Zs(e,t,i=Us[e]){return{get:()=>JSON.parse(localStorage.getItem(e)||"{}")[t]||[],set:(s,a)=>{const n=JSON.parse(localStorage.getItem(e)||"{}"),r=n[t]||[];let l=[];"add"===s?(Array.isArray(a)?r.unshift(...a):r.unshift(a),l=Array.isArray(a)?Array.from(new Set(r.slice(0,i))):a):"remove"===s?l=r.filter((e=>Array.isArray(a)?a.includes(e):e!==a)):"change"===s&&(l=a),n[t]=l;const o=JSON.stringify(n);localStorage.setItem(e,o)}}}const zs=(e,t,i)=>(0,a.useMemo)((()=>Zs(e,t,i)),[e,t,i]);class $s{constructor(){(0,mt.Z)(this,"lockedKey",new Set)}async lock(e,t){if(this.lockedKey.has(e))return null;this.lockedKey.add(e);try{return await t()}finally{this.lockedKey.delete(e)}}}const Vs="tag-ZaY7YS",Bs="selected-umR1Vs",Ws="disabled-A37DzB",Hs=({className:e,value:t,selected:i,disabled:s,onClick:a})=>(0,w.jsx)(B.Vp,{className:d()(e,Vs,i&&Bs,s&&Ws),color:i?"cyan":void 0,onClick:()=>null==a?void 0:a(t),children:t},t),qs="block-smxiey",Js="title-aqS4Cg",Ks="content-IyBLdN",Gs="loading-QuFv_G",Xs="text-ukrQOj",Qs=({className:e,title:t,loading:i,loadingText:s,value:n,options:r,onSelect:l})=>{const o=(0,a.useCallback)((e=>n.includes(e)),[n]),c=(0,a.useMemo)((()=>r.filter((e=>!n.includes(e)))),[n,r]);return 0===c.length?null:(0,w.jsxs)("div",{className:d()([qs,e]),children:[(0,w.jsx)("p",{className:Js,children:t}),(0,w.jsx)("div",{className:Ks,children:i?(0,w.jsxs)("div",{className:Gs,children:[(0,w.jsx)("span",{className:Xs,children:s}),(0,w.jsx)(B.yC,{size:"small"})]}):c.map((e=>(0,w.jsx)(Hs,{selected:o(e),value:e,onClick:()=>l(e)},e)))})]})},Ys=(0,s.Pi)((({value:e,onSelect:t})=>{const[i,s]=(0,a.useState)([]),{t:r}=(0,n.$)();return(0,a.useEffect)((()=>{const e=Zs(As.TagEachUser,bt.$.userInfo.uid).get();s(e)}),[bt.$.userInfo.uid,e]),(0,w.jsx)(Qs,{title:r("pc_recently_used_web"),value:e,options:i,onSelect:t})})),ea=((0,s.Pi)((({title:e,uri:t,value:i,itemType:s,onSelect:r})=>{const[l,o]=(0,a.useState)([]),[c,d]=(0,a.useState)([]),[u,p]=(0,a.useState)(!1),m=(0,a.useRef)({selfConfigTagsReady:{}}),{t:h}=(0,n.$)(),f=(0,a.useMemo)((()=>[...c,...l]),[l,c]),g=(0,V.Z)((e=>{const{title:t,uri:i}=e;return t?m.current.cvid&&m.current.uri===i?{cvid:m.current.cvid,title:t}:i?{image_uri:i,title:t}:null:null})),v=(0,a.useCallback)((async()=>{try{p(!0);const i=g({title:e,uri:t});await Promise.all([i&&(0,Ct.Uz)(i).then((e=>{d(e.cv_tags),m.current.cvid=e.cvid,i.image_uri&&(m.current.uri=i.image_uri)})),!m.current.selfConfigTagsReady[s]&&(0,Ct.On)({effect_type:s}).then((e=>{o(e.rec_tags),m.current.selfConfigTagsReady[s]=!0}))])}finally{p(!1)}}),[e,t,s]);return(0,Ds.Z)(v,500,[v]),(0,a.useEffect)((()=>{v()}),[s]),(0,w.jsx)(Qs,{title:h("recommend_signature_web"),loading:u,loadingText:h("loading_web"),value:i,options:f,onSelect:r})})),"tagSelect-KEPqcU"),ta="dropItem-bpnHuZ",ia="suggestListDropdown-fV0lMc",sa=(0,s.Pi)((({recommendConfig:e,value:t=[],itemType:i,disabled:s,disableRecommend:r,disableLatest:l,onChange:o,placeholder:c,max:d=15,temporaryId:u,ignoreAddTagOnBlurSelector:p,onRecentTagSelect:m})=>{const h=(0,a.useRef)(!1),[f,g]=(0,a.useState)(""),[v,_]=(0,a.useState)(""),x=(0,a.useRef)(!1),y=x.current?v:f,[T,b]=(0,a.useState)([]),[C,S]=(0,a.useState)([]),{t:F}=(0,n.$)(),k=e=>Zs(As.TagEachUser,bt.$.userInfo.uid).set("add",[e]),I=(0,V.Z)((e=>{S(f?e:[])}));(0,Ds.Z)((async()=>{if(!i||!f)return;const e=await(0,Ct.EO)({query:f,count:10}),t=(null==e?void 0:e.sug_tags)||[];I(t)}),500,[f,i]),(0,a.useEffect)((()=>{f||S([])}),[f]);const j=(0,a.useCallback)((e=>{if(d&&e.length>d)return B.FN.error(F("pc_stickers_release_max_tag_web",{X:d})),void(null==o||o(e.slice(0,d)));null==o||o(e)}),[o]),L=(0,V.Z)((e=>{t.includes(e)||j([...t,e])})),N=(0,a.useMemo)((()=>new $s),[]),E=(0,V.Z)((async e=>{const i=await N.lock("",(async()=>{if(t.includes(e))return!0;let i=!1;try{const t=await(0,Ct._K)({words:e,scene:Ct.Xb.Tag});i=!1===(null==t?void 0:t.is_hit)}catch(s){return(0,gt.RF)("[TagSelect] call checkAntiDirt failed",s,{tag:e}),B.FN.error(F("pc_tag_retry_web")),!1}return i?(L(e),!0):((0,gt.c6)("[TagSelect] checkAntiDirt not passed",{tag:e}),B.FN.error(F("pc_tag_illegal_fail_web")),!1)}));return null!=i&&i})),P=(0,V.Z)((e=>{if(0===e.length)return;const i=t.filter((t=>!e.includes(t)));j(i)})),R=(0,a.useRef)(null),{saveSelectionIfNeeded:M}=Es({getInputElem:()=>{var e;return null===(e=R.current)||void 0===e?void 0:e.inputRef.current}}),O=e=>{const t=Ns(e,30);M(t),g(t)},D=(0,V.Z)((e=>{O(""),t.includes(e)?P([e]):(L(e),k(e))})),A=e=>{const t=T.includes(e);b(t?T.filter((t=>t!==e)):[...T,e])},U=(0,V.Z)((()=>{P(T),b([])})),Z=(0,V.Z)((()=>R.current&&R.current.inputRef.current&&R.current.tagInputRef.current?{tagInput:R.current,tagInputElem:R.current.tagInputRef.current,inputElem:R.current.inputRef.current}:null)),z=(0,V.Z)((e=>{const t=Z();return!!(t&&e&&e instanceof Element)&&e.closest(".semi-tagInput")===t.tagInputElem})),$=(0,V.Z)((e=>!!(e&&e instanceof Element)&&null!==e.closest(".semi-tag"))),W=(0,V.Z)((e=>{const t=e.target,i=Z();if(!i||!z(t))return;const{tagInput:s,tagInputElem:a,inputElem:n}=i,{selectionStart:r,selectionEnd:l}=n;return T.length>0&&$(t)?(U(),null==n||n.setSelectionRange(0,0),void s.focus()):void 0})),H=(0,V.Z)((e=>{const t=e.target;Z()&&z(t)&&$(t)&&(z(e.relatedTarget)&&$(e.relatedTarget)||b([]))}));(0,a.useEffect)((()=>{const e=e=>{"Delete"===e.code||"Backspace"===e.code?(h.current=!0,W(e)):h.current=!1};return window.addEventListener("keydown",e,!0),window.addEventListener("blur",H,!0),()=>{window.removeEventListener("keydown",e,!0),window.removeEventListener("blur",H,!0)}}),[]);const q=(0,V.Z)((e=>{e.replace(/ {1,}/g,"")===f.replace(/ {1,}/g,"")&&O("")})),J=async e=>{const[t]=e;Promise.resolve().then((()=>O(f)));const i=t.replace(/ {1,}/g,"");if(0===i.length)return;await E(i)&&(k(i),q(f))},K=async e=>{if(x.current)return void _(e);const t=e.replace(/ {1,}$/,""),i=t.replace(/ {1,}/g,"");if(O(t),t===e||!t||h.current)return;await E(i)&&(k(i),q(f))};(0,a.useEffect)((()=>{var e;const t=null===(e=R.current)||void 0===e?void 0:e.inputRef.current;if(!t)return;const i=()=>{x.current=!0,_(t.value)},s=()=>(0,Os.unstable_batchedUpdates)((()=>{x.current=!1,_(""),K(t.value)}));return t.addEventListener("compositionstart",i),t.addEventListener("compositionend",s),()=>{t.removeEventListener("compositionstart",i),t.removeEventListener("compositionend",s)}}),[]);(0,a.useEffect)((()=>{u&&g("")}),[u]);return(0,w.jsxs)("div",{className:ea,children:[(0,w.jsx)(B.Lt,{position:"bottomLeft",trigger:"focus",className:ia,style:{maxHeight:200,overflow:"scroll"},render:(0,w.jsx)(B.Lt.Menu,{children:C.map((e=>(0,w.jsx)(B.Lt.Item,{className:ta,onClick:()=>D(e),children:e},e)))}),children:(0,w.jsx)(B.EG,{ref:R,inputValue:y,onInputChange:K,value:t,placeholder:c,renderTagItem:(e,t,i)=>(0,w.jsx)(Hs,{value:e,selected:T.includes(e),disabled:s,onClick:A},e),onAdd:J,onBlur:e=>{if(e.relatedTarget&&e.relatedTarget instanceof Element){const t=[`.${ia}`,p].filter((e=>e)).join(",");if(null!==e.relatedTarget.closest(t)||$(e.relatedTarget))return}J([f])},disabled:s})}),!1,!s&&!l&&(0,w.jsx)(Ys,{value:t,onSelect:e=>{D(e),null==m||m()}})]})})),aa=(0,B.Q2)(sa);var na=i(75107);let ra;const la=new WeakMap;function oa(e){let t=la.get(e);return t||(t=new Set,la.set(e,t)),t}const ca="46px",da="2px",ua="modal-iFkPHk",pa="root-Zq2UXx",ma="title-RjRwF3",ha="content-pMppxf",fa="loading-J12Xi0",ga="footer-otMNTQ",va="buttonContainer-aC2XIN",_a="button-ekKG5u",xa="previewImg-tCoExU",wa="invisible-Kg_ArH",ya="frameViewer-cEhK3e",Ta="frameList-YrZVfi",ba="frame-XEvw9I",Ca="slider-RraD19",Sa="isSliding-I3_Tp0",Fa=(0,s.Pi)((e=>{const{fetchData:t,onOK:i,onClose:s}=e,r=(0,ni.fv)((()=>({dataFrameList:[],dataFrameIndex:0,setDataFrameIndex(e){r.dataFrameIndex=Math.max(0,Math.min(e,r.dataFrameList.length-1))},fetchOp:new Ei({fetchFirstPage:async()=>{const{list:e,index:i}=await t();return()=>{r.dataFrameList=e,r.dataFrameIndex=i,r.initSliderIfNeeded()}},slardarErrorLog:(e,t,i)=>(0,gt.RF)(`[FramePicker] ${e} failed`,t,i)}),frameListWidth:0,halfSliderWidth:Number.parseInt(da,10)/2,frameWidth:Number.parseInt(ca,10),get frameList(){const{dataFrameList:e,frameListWidth:t}=r;if(!e.length||!t)return[];const i=Math.ceil(t/r.frameWidth);return Array(i).fill(0).map(((t,s)=>{if(0===s)return e[0];if(s===i-1)return e[e.length-1];{const t=Math.floor(e.length*(s+.5)/i);return e[t]}}))},setWidth(e){r.frameListWidth=e,r.initSliderIfNeeded()},sliderCenterOffset:0,initSliderIfNeeded(){const{dataFrameList:e,frameListWidth:t}=r;e.length&&t&&(r.dataFrameIndex===r.dataFrameList.length-1?r.setSliderCenterOffset(t):r.setSliderCenterOffset(t*r.dataFrameIndex/r.dataFrameList.length))},setSliderCenterOffset(e){const t=r.halfSliderWidth,i=r.frameListWidth-r.halfSliderWidth;r.sliderCenterOffset=Math.max(t,Math.min(i,e))},handleOK(){i(r.dataFrameIndex)}}))),{handleRef:l}=function(e){const t=(0,V.Z)(((t,i)=>e.onResize(t,i))),i=(0,a.useMemo)((()=>({element:null,observer:(ra||(ra=new na.Z((e=>{let t=null;if(e.forEach((e=>{const i=oa(e.target),s=e.target.getBoundingClientRect();i.forEach((e=>{try{e.props.onResize(s,e)}catch(i){null===t&&(t=i)}}))})),null!==t)throw t}))),ra),props:{onResize:t},rect:null,unobserve:null})),[]),s=(0,V.Z)((e=>{var t;null===(t=i.unobserve)||void 0===t||t.call(i),e&&(i.observer.observe(e),i.element=e,i.rect=null,oa(e).add(i),i.unobserve=()=>{i.unobserve=null,i.element=null,i.rect=null,i.observer.unobserve(e),oa(e).delete(i)})}));return(0,a.useLayoutEffect)((()=>{if(i.element){const e=i.element.getBoundingClientRect();i.rect=null,t(e,i)}}),[]),(0,a.useEffect)((()=>()=>{var e;null===(e=i.unobserve)||void 0===e||e.call(i)}),[]),{resizeData:i,handleRef:s}}({onResize:(e,t)=>{t.element&&r.setWidth(t.element.clientWidth)}}),o=(0,a.useRef)(null),c=(0,a.useRef)({isSliding:!1,destroy:null}),u=e=>{var t,i;if(null===(t=(i=c.current).destroy)||void 0===t||t.call(i),!o.current)return;const s=o.current.getBoundingClientRect().left,a=(0,ft.aD)((e=>{c.current.isSliding||(document.body.classList.add(Sa),c.current.isSliding=!0),e.preventDefault(),r.setSliderCenterOffset(e.clientX-s);const t=Math.floor(r.dataFrameList.length*r.sliderCenterOffset/r.frameListWidth);r.setDataFrameIndex(t)})),n=()=>{var e,t;null===(e=(t=c.current).destroy)||void 0===e||e.call(t)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",n),a(e.nativeEvent),c.current.destroy=()=>{c.current.destroy=null,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",n),c.current.isSliding=!1,document.body.classList.remove(Sa)},document.activeElement instanceof HTMLElement&&document.activeElement.blur()};(0,a.useEffect)((()=>{r.fetchOp.initFetchFirstPage(null)}),[]);const{isPending:p}=r.fetchOp.fetchStatus,m=r.frameList.length>0,{t:h}=(0,n.$)();return(0,w.jsxs)("div",{className:pa,children:[(0,w.jsx)("div",{className:ma,children:h("pc_stickers_release_cover_edit_web")}),p?(0,w.jsx)("div",{className:fa,children:(0,w.jsx)(Q,{status:"loading",children:h("loading_web")})}):(0,w.jsxs)("div",{className:ha,children:[(0,w.jsx)("img",{className:d()(xa,!m&&wa),src:m?r.dataFrameList[r.dataFrameIndex]:""}),(0,w.jsxs)("div",{ref:o,className:ya,onMouseDown:u,children:[(0,w.jsx)("div",{ref:l,className:Ta,children:r.frameList.map(((e,t)=>(0,w.jsx)("img",{src:e,className:ba},t)))}),m&&(0,w.jsx)("div",{className:Ca,style:{left:r.sliderCenterOffset}})]})]}),(0,w.jsx)("div",{className:ga,children:(0,w.jsxs)("div",{className:va,children:[(0,w.jsx)(B.zx,{className:_a,type:"primary",theme:"solid",disabled:!m,onClick:r.handleOK,children:h("pc_text_template_complete_web")}),(0,w.jsx)(B.zx,{className:_a,type:"secondary",theme:"solid",onClick:s,children:h("pc_text_template_cancel_n_web")})]})})]})}));const ka="authGroup-Yuaspf",Ia="label-EV9bRs",ja="right-pmBY1Y",La="root-Hmk_Iv",Na="fieldLabel-OCVTxU",Ea="useAll-oywefT",Pa="showRequired-ORkP2V",Ra="box-eWwoEb",Ma=(0,a.memo)((e=>{const{text:t,className:i}=e,{handleMouseEnter:s}=me({content:({target:e})=>e.textContent});return(0,w.jsx)("div",{className:d()(Ia,i),onMouseEnter:s,children:t})})),Oa=e=>{const{t}=(0,n.$)(),{className:i,boxClassName:s,title:a,children:r,onClickUseAll:l,hiddenFieldLabel:o=!1,required:c=!1}=e;return(0,w.jsxs)("div",{className:d()(La,i),children:[!o&&(0,w.jsxs)("div",{className:Na,children:[(0,w.jsx)("div",{className:d()({[Pa]:c}),children:null!=a?a:t("pc_template_authorize_settings_web")}),l&&(0,w.jsx)("span",{className:Ea,onClick:l,children:t("pc_material_release_apply_all")})]}),(0,w.jsx)("div",{className:d()(Ra,s),children:r})]})};var Da;function Aa(){return Aa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},Aa.apply(null,arguments)}const Ua=e=>a.createElement("svg",Aa({xmlns:"http://www.w3.org/2000/svg",width:10,height:10,fill:"none",viewBox:"0 0 10 10"},e),Da||(Da=a.createElement("path",{fill:"currentColor",d:"M5.005 10c2.735 0 5-2.265 5-5S7.735 0 5 0 0 2.265 0 5s2.27 5 5.005 5m0-.888A4.096 4.096 0 0 1 .898 5 4.09 4.09 0 0 1 5 .888 4.11 4.11 0 0 1 9.118 5a4.097 4.097 0 0 1-4.113 4.112m-.108-3.116c.253 0 .413-.15.418-.346v-.062c.005-.263.17-.433.5-.655.475-.31.805-.599.805-1.171 0-.816-.727-1.26-1.568-1.26-.836 0-1.394.393-1.538.842a.8.8 0 0 0-.041.247c0 .227.175.351.36.351.28 0 .331-.144.486-.325.16-.258.382-.413.696-.413.429 0 .702.243.702.599 0 .32-.206.48-.63.774-.345.242-.603.5-.603.965v.057c0 .268.15.397.413.397m-.01 1.47a.527.527 0 0 0 .541-.516c0-.294-.242-.516-.542-.516a.53.53 0 0 0-.541.516c0 .29.253.516.541.516"})));var Za;function za(){return za=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},za.apply(null,arguments)}const $a=e=>a.createElement("svg",za({xmlns:"http://www.w3.org/2000/svg",width:12,height:12,fill:"none",viewBox:"0 0 12 12"},e),Za||(Za=a.createElement("path",{fill:"#D4D4D4",d:"M6.708 6 11 10.292l-.708.708L6 6.708 1.708 11 1 10.292 5.292 6 1 1.708 1.708 1 6 5.292 10.292 1l.708.708z"}))),Va="protocol-VspS8l",Ba="content-OyCrKs",Wa="withBorder-jbe4Zm",Ha="flexHeight-OlM20e",qa="footer-PL68kt",Ja="btn-az9uHG",Ka="confirmArea-HME5C1",Ga="confirmCheckbox-lf6E1b",Xa="confirmCheckboxText-Tkueuw",Qa="confirmCheckboxProtocolTitle-WvrrOC",Ya="protocolContent-jt8xnN",en="root-QktMQ3",tn="title-QI6laf",sn="right-vx9IoL",an="closeIcon-Z6vdI8";let nn=function(e){return e.Origin="originUserAuthProtocol",e.OriginalForSubscription="originalWorkProtocolForSubscription",e.OriginalForCommercial="originalWorkProtocolForCommercial",e.Creator="createProtocol",e.AuthorAgreement="AuthorAgreementProtocol",e}({});const rn={[nn.Origin]:"https://www.capcut.com/clause/original-work-notice?lang=en",[nn.OriginalForSubscription]:"https://www.capcut.com/clause/original-work-notice?lang=en",[nn.OriginalForCommercial]:"https://www.capcut.com/clause/original-work-notice-commercial-material?lang=en",[nn.Creator]:wi({}),[nn.AuthorAgreement]:"https://www.capcut.com/clause/paid-materials?lang=en"},ln={[nn.Origin]:"Original Work Notice",[nn.OriginalForSubscription]:"Original Work Notice",[nn.OriginalForCommercial]:"Original Work Notice",[nn.Creator]:yt.I18n.t("pc_capcut_creator_agreement_web"),[nn.AuthorAgreement]:yt.I18n.t("cc_pc_material_publish_paid_authorize_popup_title_web")},on=(0,s.Pi)((({onCancel:e,onOk:t,protocol:i,handleBtnText:s,closeIcon:r=!1,needReview:l=!0,useIframe:o=!0,needHasRead:c=!0,renderConfirmExtra:u,getCanConfirmExtra:p})=>{const{t:m}=(0,n.$)(),[h,f]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!1),_=!c||h,x=()=>!l||_&&g&&(!p||p()),{handleMouseEnter:y}=pe({content:m("pc_template_authorize_read_all_web"),cursor:"not-allowed"}),T=(0,a.useRef)(null),b={disabled:!_,handleMouseEnter:!l||_?void 0:y},C=()=>{x()&&(null==t||t())};(0,a.useEffect)((()=>{const e=e=>{const t=e.data;try{const e=JSON.parse(t),i=document.getElementById("protocol-content"),s="protocal"===e.from||"protocol"===e.from;if(s&&"load"===e.event)if(i){const{clientHeight:t}=i;e.scrollHeight<=t&&f(!0)}else f(!0);s&&"bottom"===e.event&&f(!0)}catch(i){f(!0),(0,gt.RF)("[Protocol] handle protocol message",i,{text:t})}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[]);const S=()=>{if(T.current&&!o){const{scrollHeight:e,clientHeight:t,scrollTop:i}=T.current;!_&&i+t>=e&&f(!0)}};return(0,a.useEffect)((()=>{var e;return null===(e=T.current)||void 0===e||e.addEventListener("scroll",S),()=>{var e;null===(e=T.current)||void 0===e||e.removeEventListener("scroll",S)}}),[T.current]),(0,a.useLayoutEffect)((()=>{const e=document.getElementById("protocol-content");if(e&&!o){const{scrollHeight:t,clientHeight:i}=e;f(!(t>i)),T.current=e}}),[]),(0,w.jsxs)("div",{className:Va,children:[(0,w.jsxs)("div",{className:en,children:[(0,w.jsx)("div",{className:tn,children:ln[i]}),(0,w.jsx)("div",{className:sn,children:r&&(0,w.jsx)($a,{className:an,onClick:()=>{null==e||e("close")}})})]}),(0,w.jsx)("div",{className:d()(Ba,!l&&Wa,l&&Ha),id:"protocol-content",children:o?(0,w.jsx)("iframe",{id:"frame",src:rn[i]}):(0,w.jsx)("div",{className:Ya,children:null})}),s&&l?(0,w.jsxs)("div",{className:Ka,children:[(0,w.jsx)(B.XZ,{className:Ga,checked:g,disabled:b.disabled,onMouseEnter:b.handleMouseEnter,onChange:e=>v(Boolean(e.target.checked)),autoFocus:!1,children:(0,w.jsx)("span",{className:Xa,children:m("pc_template_authorize_read_agree_web",{X:(0,w.jsx)("span",{className:Qa,children:ln[i]},"X")})})}),null==u?void 0:u()]}):null,(()=>{const e=s;return e?(0,w.jsx)("div",{className:d()(qa,l&&Wa),children:(0,w.jsx)(B.zx,{className:Ja,type:"primary",theme:"solid",disabled:!x(),onClick:C,children:e})}):null})()]})})),cn=e=>{const{onCancel:t,onOk:i}=e,[s,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)({}),c=(0,a.useRef)({}),{i18n:d,t:u}=(0,n.$)(),p=e=>{null==t||t(e),r(!1)},m=()=>{l.withoutReview||null==i||i(),r(!1)};return(0,a.useEffect)((()=>()=>{var e,t;return null==c||null===(e=c.current)||void 0===e||null===(t=e.destroy)||void 0===t?void 0:t.call(e)}),[]),(0,a.useEffect)((()=>{var t,i;s?(()=>{const t={...e,...l.withoutReview&&{handleBtnText:u("pc_i_see_web"),needReview:!1,closeIcon:!0}},{destroy:i}=B.u_.info({width:376,height:e.needReview?"auto":564,maskClosable:!1,header:null,title:null,icon:null,centered:!0,content:(0,w.jsx)(ae.a,{i18n:d,children:(0,w.jsx)(on,{...t,onCancel:p,onOk:m})}),footer:null});c.current.destroy=i})():null==c||null===(t=c.current)||void 0===t||null===(i=t.destroy)||void 0===i||i.call(t)}),[s]),{visible:s,showModal:()=>{r(!0),o({})},showModalWithoutReview:()=>{r(!0),o({withoutReview:!0})}}};const dn="root-HoHMo9",un="disabled-VOcU3h",pn="help-Q9jnn3",mn=(0,B.Q2)((e=>{const{t}=(0,n.$)(),{value:i,onChange:s,sendLogService:a,disabledTooltip:r,tooltip:l,...o}=e,{className:c,disabled:u}=o,p=nn.AuthorAgreement,{showModal:m,showModalWithoutReview:h}=cn({handleBtnText:t("pc_template_authorize_confirm_web"),closeIcon:!0,protocol:p,needReview:!0,onOk:()=>{!function(e){const t=bt.$.userInfo.uid;t&&Zs(As.UseHasAgree,t).set("add",[e])}(p),null==s||s(!0),a.sendSubscriptionStatementLog({action:"confirm",entry_from:"checkbox"}),a.sendClickSubscriptionCheckboxLog(!0)}}),{handleMouseEnter:f}=pe({cursor:"not-allowed",content:r}),{handleMouseEnter:g}=pe({content:l}),{handleMouseOver:v}=me({checkIsTarget:e=>null!==e.closest(".semi-checkbox-addon")}),_=d()(o.className);return(0,w.jsxs)("div",{className:d()(dn,u&&un,c),onMouseEnter:e=>{u&&r?f(e):l&&g(e)},onMouseOver:u&&r?void 0:v,children:[(0,w.jsx)(B.XZ,{...o,className:_,checked:i,onChange:e=>{const t=Boolean(e.target.checked);if(t&&!function(e){const t=bt.$.userInfo.uid;return!!t&&Zs(As.UseHasAgree,t).get().includes(e)}(p))return m(),a.sendSubscriptionStatementLog({action:"show",entry_from:"checkbox"}),void a.sendPageActionLog({action:"choose_subscription_authorize"});a.sendClickSubscriptionCheckboxLog(t),null==s||s(t)},children:t("cc_pc_material_visual_effect_publish_authorize_desc_web")}),(0,w.jsx)(Ua,{className:pn,onClick:()=>{h(),a.sendSubscriptionStatementLog({action:"show",entry_from:"question_mark"}),a.sendPageActionLog({action:"click_subscription_detail"})}})]})}));var hn,fn=i(43792);function gn(){return gn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},gn.apply(null,arguments)}const vn=e=>a.createElement("svg",gn({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none","aria-hidden":"true",viewBox:"0 0 24 24"},e),hn||(hn=a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M21.352 4.265a1.5 1.5 0 0 1 .383 2.087l-10 14.5a1.5 1.5 0 0 1-2.334.169l-6.5-7a1.5 1.5 0 0 1 2.198-2.042l5.228 5.63 8.938-12.96a1.5 1.5 0 0 1 2.087-.384",clipRule:"evenodd"}))),_n="root-gly6Qn",xn="link-pZCc56",wn="selectWrapper-PYDCrg",yn="activitySelect-pwnL0y",Tn=e=>{const{t}=(0,n.$)(),{value:i,onChange:s,taskList:a,loading:r,viewMoreUrl:l,onOrientationViewMoreClick:o}=e,[c,d]=(0,fn.Z)(void 0,{dimension:"width"}),u=e=>{var t;null==s||s({postChannel:null!==(t=null==i?void 0:i.postChannel)&&void 0!==t?t:Ct.iu.Targeted,activityId:e})};return(0,w.jsxs)("div",{className:_n,children:[(0,w.jsxs)(B.FX,{type:"card",value:null==i?void 0:i.postChannel,onChange:e=>{null==s||s({postChannel:e.target.value})},direction:"horizontal",name:"material-publish-group-pureCard",children:[(0,w.jsx)(B.Y8,{value:Ct.iu.Targeted,extra:(0,w.jsxs)("div",{style:{height:"100%"},children:[(0,w.jsx)("div",{children:t("cc_pc_material_visual_effect_publish_creation_type_event_desc_web")}),(0,w.jsx)("span",{className:xn,onClick:e=>{null==o||o(),e.preventDefault(),(0,R.Z)({url:l})},children:t("cc_pc_material_visual_effect_publish_creation_type_event_detail_web")})]}),children:t("cc_pc_material_visual_effect_publish_creation_type_event_web")}),(0,w.jsx)(B.Y8,{value:Ct.iu.Open,extra:(0,w.jsx)("div",{style:{height:"100%"},children:(0,w.jsx)("div",{children:t("cc_pc_material_visual_effect_publish_creation_type_free_desc_web")})}),children:t("cc_pc_material_visual_effect_publish_creation_type_free_web")})]}),(0,w.jsx)("div",{className:wn,ref:c,onClick:()=>{const e=document.getElementById("formAreaWrapper");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},children:(null==i?void 0:i.postChannel)===Ct.iu.Targeted&&(0,w.jsx)(B.Ph,{maxHeight:180,value:null==i?void 0:i.activityId,loading:r,placeholder:t("cc_pc_material_visual_effect_publish_creation_type_event_select_web"),className:yn,optionList:a,renderOptionItem:t=>{var i;const{label:s,desc:a,value:n,onClick:r}=t,l=n===(null===(i=e.value)||void 0===i?void 0:i.activityId);return(0,w.jsxs)("div",{className:"custom-select-option",onClick:e=>{null==r||r(e),null==u||u(n)},style:{maxWidth:d.width-12},children:[l&&(0,w.jsx)(vn,{className:"checkedIcon"}),!l&&(0,w.jsx)("div",{className:"placeholder"}),s]})}})})]})};var bn=i(67411);let Cn=function(e){return e[e.Deleted=22]="Deleted",e[e.Offline=23]="Offline",e[e.Banned=25]="Banned",e[e.Online=102]="Online",e[e.Reviewing=141]="Reviewing",e[e.SelfView=144]="SelfView",e[e.HomepageOnline=103]="HomepageOnline",e}({}),Sn=function(e){return e[e.Unknown=0]="Unknown",e[e.WaitReview=1]="WaitReview",e[e.RiskReviewing=2]="RiskReviewing",e[e.QualityReviewing=3]="QualityReviewing",e[e.RiskReviewFailed=4]="RiskReviewFailed",e[e.QualityReviewFailed=5]="QualityReviewFailed",e[e.CopyrightReviewing=6]="CopyrightReviewing",e[e.CopyrightReviewFailed=7]="CopyrightReviewFailed",e[e.Passed=100]="Passed",e}({});const{t:Fn}=yt.I18n;let kn=function(e){return e.all="all",e.paster="paster",e.wordart="wordart",e.soundEffect="soundEffect",e.textTemplate="textTemplate",e.subtitleTemplate="subtitleTemplate",e.video="video",e.stickerFramePack="sticker_frame_zip",e.emoticons="emoticons",e.formula="formula",e.filter="filter",e.filterCollection="filter_collection",e.stickerCollection="sticker_collection",e}({});let In=function(e){return e[e.all=0]="all",e[e.wordart=1]="wordart",e[e.paster=2]="paster",e[e.soundEffect=3]="soundEffect",e[e.video=4]="video",e[e.Song=5]="Song",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Filter=12]="Filter",e[e.StickerCollection=102]="StickerCollection",e[e.FilterCollection=112]="FilterCollection",e[e.emoticons=105]="emoticons",e[e.stickerFramePack=1e3]="stickerFramePack",e[e.formula=50]="formula",e}({});In.all,kn.all,In.paster,kn.paster,In.wordart,kn.wordart,In.soundEffect,kn.soundEffect,In.video,kn.video,In.emoticons,kn.emoticons,In.formula,kn.formula,In.Filter,kn.filter,In.FilterCollection,kn.filterCollection,In.TextTemplate,kn.textTemplate,In.SubtitleTemplate,kn.subtitleTemplate,In.StickerCollection,kn.stickerCollection,kn.wordart,In.wordart,kn.paster,In.paster,kn.soundEffect,In.soundEffect,kn.video,In.video,kn.emoticons,In.emoticons,kn.formula,In.formula,kn.filter,In.Filter,kn.filterCollection,In.FilterCollection,kn.textTemplate,In.TextTemplate,In.SubtitleTemplate,kn.subtitleTemplate,kn.stickerCollection,In.StickerCollection,kn.all,kn.paster,kn.wordart,kn.soundEffect,kn.video,kn.emoticons,kn.formula,In.paster,In.StickerCollection,In.wordart,In.soundEffect,In.video,In.stickerFramePack,In.emoticons,In.formula,In.Image,In.Special,In.FaceSpecial,In.TextTemplate,In.SubtitleTemplate,In.Filter,In.FilterCollection,In.paster,In.wordart,In.soundEffect,In.video,In.emoticons,In.TextTemplate,In.SubtitleTemplate;let jn=function(e){return e[e.default=0]="default",e[e.latest=1]="latest",e[e.hotest=2]="hotest",e}({});jn.default,jn.latest,jn.hotest,In.all,In.paster,In.video,In.soundEffect,In.wordart;Cn.Offline,Cn.Online,Cn.HomepageOnline,Cn.HomepageOnline,Sn.Passed,Sn.Passed,Cn.Reviewing,Cn.SelfView,Cn.HomepageOnline,Cn.SelfView,Sn.WaitReview,Sn.RiskReviewing,Sn.QualityReviewing,Sn.CopyrightReviewing,Cn.HomepageOnline,Sn.WaitReview,Sn.RiskReviewing,Sn.QualityReviewing,Sn.CopyrightReviewing,Sn.WaitReview,Sn.RiskReviewing,Sn.QualityReviewing,Sn.CopyrightReviewing,Cn.HomepageOnline,Cn.SelfView,Cn.Banned,Cn.HomepageOnline,Sn.Unknown,Sn.RiskReviewFailed,Sn.QualityReviewFailed,Sn.CopyrightReviewFailed,Cn.SelfView,Sn.Unknown,Sn.RiskReviewFailed,Sn.QualityReviewFailed,Sn.CopyrightReviewFailed,Sn.Passed,Sn.Unknown,Sn.RiskReviewFailed,Sn.QualityReviewFailed,Sn.CopyrightReviewFailed,Cn.HomepageOnline,Sn.QualityReviewFailed,Sn.CopyrightReviewFailed,Cn.SelfView,Sn.QualityReviewFailed,Sn.CopyrightReviewFailed,Sn.Passed;let Ln=function(e){return e[e.Douyin=0]="Douyin",e[e.Heycon=1]="Heycon",e[e.VideoCut=2]="VideoCut",e[e.WebVideoCut=3]="WebVideoCut",e[e.Ulike=4]="Ulike",e[e.Effect=5]="Effect",e}({});Ln.Douyin,Ln.Heycon,Ln.VideoCut,Ln.WebVideoCut,Ln.Ulike,Ln.Effect,Ln.Douyin,Ln.Heycon,Ln.VideoCut,Ln.WebVideoCut,Ln.Ulike,Ln.Effect,Ln.Douyin,Ln.Heycon,Ln.VideoCut,Ln.WebVideoCut,Ln.Ulike,Ln.Effect;const Nn="originFlag-Lhtbs4",En="row-yLNK03",Pn="help-yUKWDh",Rn={[In.paster]:yt.I18n.t("original_stickers_web"),[In.SubtitleTemplate]:yt.I18n.t("pc_subtitle_original"),[In.TextTemplate]:yt.I18n.t("pc_text_template_origial_material_web"),[In.wordart]:yt.I18n.t("original_cursive"),[In.soundEffect]:yt.I18n.t("pc_material_release_original_material"),[In.Filter]:yt.I18n.t("pc_material_release_original_material"),[In.Special]:yt.I18n.t("pc_material_release_original_material")},Mn=e=>{const{value:t,onChange:i,...s}=e,[r,l]=(0,a.useState)([]),{t:o}=(0,n.$)(),{itemType:c,className:u,checkboxCls:p}=e,{get:m,set:h}=zs(As.UseHasAgree,bt.$.userInfo.uid),{showModal:f}=cn({handleBtnText:o("pc_i_see_web"),needReview:!1,protocol:nn.Origin,onOk:()=>{if(!bt.$.userInfo.uid)return;h("add",[nn.Origin]);const e=m();l(e)}});return(0,a.useEffect)((()=>{if(bt.$.userInfo.uid){const e=m();l(e)}}),[bt.$.userInfo.uid]),(0,w.jsx)("div",{className:d()([Nn,u]),children:(0,w.jsxs)("div",{className:En,children:[(0,w.jsx)(B.XZ,{...s,checked:t,className:p,onChange:e=>{e.target.checked&&(r.includes(nn.Origin)||f()),null==i||i(e.target.checked)},children:Rn[c]}),(0,w.jsx)(bn.Z,{size:"small",className:Pn,onClick:f})]})})},On=((0,B.Q2)(Mn),"root-j3LlEm"),Dn="cover-jaNzlL",An="title-U5EHzZ",Un="main-MmgxyZ",Zn="container-WuIo82",zn="language-pBRH5f",$n="langText-So03cx",Vn={zh:yt.I18n.t("pc_text_tamplate_language_cn_web"),en:yt.I18n.t("pc_text_tamplate_language_en_web"),ja:yt.I18n.t("pc_text_tamplate_language_jp_web"),ko:yt.I18n.t("pc_text_tamplate_language_kr_web")},Bn=(0,s.Pi)((e=>{const{className:t,loading:i,languages:s}=e,r=(0,ni.fv)((()=>({coverSrcMap:new Map,copyCoverSrcFromProps(e){const t=new Set;for(const i of e.languages){const{src:e}=i.cover;e&&(t.add(e),r.coverSrcMap.has(e)||(r.coverSrcMap.set(e,""),r.copyOneCoverSrc(e)))}for(const[i,s]of r.coverSrcMap)t.has(i)||(r.destroyCopyedSrc(s),r.coverSrcMap.delete(i))},async copyOneCoverSrc(e){if(e.startsWith("data:"))return void r.coverSrcMap.set(e,e);const t=await(async e=>{const t=await fetch(e),i=await t.blob();return Nt(i)})(e);r.coverSrcMap.has(e)?(0,ft.z)((()=>{r.coverSrcMap.set(e,t)})):r.destroyCopyedSrc(t)},destroyCopyedSrc(e){e.startsWith("blob")&&URL.revokeObjectURL(e)},destroy(){for(const e of r.coverSrcMap.values())r.destroyCopyedSrc(e)}})));(0,a.useEffect)((()=>{r.copyCoverSrcFromProps(e)})),(0,a.useEffect)((()=>()=>r.destroy()),[]);const{t:l}=(0,n.$)(),{handleMouseEnter:o}=me({}),c=e=>{if(i)return"";return r.coverSrcMap.get(e.src)||""};return(0,w.jsxs)("div",{className:d()(On,t),children:[(0,w.jsx)("div",{className:An,children:l("pc_text_template_language_version_web")}),(0,w.jsx)("div",{className:Un,children:(0,w.jsx)("div",{className:Zn,children:s.map((({lang:e,cover:t})=>(0,w.jsxs)("div",{className:zn,children:[(0,w.jsx)(ze,{className:Dn,src:c(t),isSelected:!1,isInvalid:!1,size:80}),(0,w.jsx)("div",{className:$n,onMouseEnter:o,children:Vn[e]})]},e)))})})]})})),Wn=()=>{const{i18n:e}=(0,n.$)();return{getDisplayLength:(0,V.Z)((t=>(0,Di.xB)({len:t,i18n:e})))}},Hn="labelHeader-YVMW2T",qn="applyToAll-TCdMm4",Jn="root-cfCey4",Kn="cover-dDrlQQ",Gn="selectStaticFrame-NNvpkG",Xn="titleField-iDfKhY",Qn="highPriorityWrapper-FAAiT9",Yn="multiLangVersionList-AhxC2q",{Label:er}=B.Form,tr=(0,s.Pi)((e=>{const{textTemplate:t}=e,{t:i}=(0,n.$)(),s=xs(),{authConfig:l}=qi,{mustPaidAuth:o}=l,{targetedActivityId:c,postChannel:d}=t,[u,p]=(0,a.useState)([]);(0,a.useLayoutEffect)((()=>s.initTextTemplateForm(t)),[]),(0,a.useEffect)((()=>{u.length||async function(){return(await(0,Ct.ip)({effect_type:r.TextTemplate})).tasks.map((e=>({label:e.title,value:e.task_id})))}().then((e=>{p(e)}))}),[]),(0,a.useEffect)((()=>{bt.$.isEnableAuthorization&&v(!0)}),[bt.$.isEnableAuthorization]);const{getDisplayLength:m}=Wn(),h=Ji(t),{openFramePicker:f}=function(){const{i18n:e}=(0,n.$)(),t=(0,a.useRef)(null);return(0,a.useEffect)((()=>()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}),[]),{openFramePicker:i=>{var s;const a=B.u_.info({width:"auto",height:"auto",header:null,footer:null,centered:!0,maskClosable:!1,closable:!1,className:ua,icon:null,closeOnEsc:!1,content:(0,w.jsx)(ae.a,{i18n:e,children:(0,w.jsx)(Fa,{...i,onOK:e=>{var s;i.onOK(e),null===(s=t.current)||void 0===s||s.call(t)},onClose:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}})})});return null===(s=t.current)||void 0===s||s.call(t),t.current=()=>{t.current=null,a.destroy()},a}}}(),g=fi({watch:()=>Ji(t).staticFrame.list.length>0}),v=e=>{var i;t.isVip=e,null===(i=s.formApi)||void 0===i||i.setValue("textTemplate",{...s.formApi.getValue("textTemplate"),isVip:e})},_=Boolean(t.languages[0].staticFrame.src),x=(0,a.useMemo)((()=>(0,ft.Fl)((()=>t.languages.map((e=>({lang:e.lang,cover:e.cover})))))),[]),y=Boolean(t.onlineData.resourceId);return(0,w.jsxs)("div",{className:Jn,children:[(0,w.jsx)(ze,{className:Kn,src:h.staticFrame.src,isInvalid:!1,isSelected:!1,size:128}),(0,w.jsx)("div",{className:Gn,onClick:()=>{f({onOK:e=>s.handleStaticFrameChange(t,e),fetchData:async()=>{await g.start();const{list:e,index:t}=h.staticFrame;return{list:e,index:t}}})},children:i("pc_stickers_release_cover_edit_web")}),(0,w.jsx)(Ms,{fieldClassName:Xn,label:i("pc_text_template_name_n_web"),field:"textTemplate.title",maxLength:40,allowEnter:!1,placeholder:i("pc_stickers_release_xy_name_web",{X:1,Y:m(40)}),rules:[{required:!0,message:""}],onChange:(0,ft.aD)((e=>t.title=e))}),(0,w.jsx)(aa,{label:(0,w.jsx)("div",{className:Hn,children:(0,w.jsx)(B.Form.Label,{required:!0,children:i("pc_text_template_tag_settings_web")})}),placeholder:i("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"textTemplate.tags",itemType:r.TextTemplate,recommendConfig:{title:t.title,uri:h.cover.uri},ignoreAddTagOnBlurSelector:`.${qn}`,onChange:(0,ft.aD)((e=>t.tags=e))}),(0,w.jsxs)("div",{children:[(0,w.jsx)(er,{required:!0,text:i("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,w.jsx)(Tn,{value:{postChannel:d,activityId:c},onChange:e=>{var i;t.postChannel=e.postChannel,t.targetedActivityId=e.activityId,null===(i=s.formApi)||void 0===i||i.setValue("textTemplate",{...s.formApi.getValue("textTemplate"),postChannel:e.postChannel,targetedActivityId:e.activityId})},taskList:u,loading:!u.length,viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/XPbkdNb0qoSdGwxdjSTl3lTjgtf",onOrientationViewMoreClick:()=>{s.sendLogService.sendPageActionLog({action:"click_more_official_task"})}})]}),t.isMultiLang&&(0,w.jsx)(Bn,{className:Yn,loading:!_,languages:x.get()}),!1,(0,w.jsx)(Oa,{required:o,children:(0,w.jsx)("div",{className:ka,children:(0,w.jsx)(mn,{noLabel:!0,field:"textTemplate.isVip",disabled:bt.$.isEnableAuthorization,disabledTooltip:i("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:o?i("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:s.sendLogService,onChange:e=>{e&&s.sendLogService.sendPageActionLog({action:"choose_subscription_authorize"}),v(e)}})})}),s.field.canHighPrio&&(0,w.jsx)(Oa,{className:Qn,hiddenFieldLabel:!0,children:(0,w.jsxs)("div",{className:ka,children:[(0,w.jsx)(Ma,{text:i("pc_text_template_release_settings_web")}),(0,w.jsx)("div",{className:ja,children:(0,w.jsx)(B.z8,{noLabel:!0,field:"textTemplate.isHighPriority",disabled:y,children:i("pc_text_template_release_priority_web")})})]})})]})})),ir="root-pah7_M",sr="cover-LvEjU2",ar="titleField-XvANc3",{Label:nr}=B.Form,rr=(0,s.Pi)((e=>{const{flowerText:t,initFlowerTextForm:i,applyTagsToAll:s,maxTitleLength:l}=e,{t:o}=(0,n.$)(),c=xs(),{targetedActivityId:d,postChannel:u}=t;(0,a.useLayoutEffect)((()=>{i(t)}),[]);const{getDisplayLength:p}=Wn(),{authConfig:m}=gs,{mustPaidAuth:h}=m,f=function(e){return e.subFlowerTexts[0]}(t),[g,v]=(0,a.useState)([]);const _=e=>{var i;t.isVip=e,null===(i=c.formApi)||void 0===i||i.setValue("flowerText",{...c.formApi.getValue("flowerText"),isVip:e})};return(0,a.useEffect)((()=>{g.length||async function(){return(await(0,Ct.ip)({effect_type:1})).tasks.map((e=>({label:e.title,value:e.task_id})))}().then((e=>{v(e)}))}),[]),console.log("==x",bt.$),(0,w.jsxs)("div",{className:ir,children:[(0,w.jsx)(ze,{className:sr,src:f.cover.src,isInvalid:!1,isSelected:!1,size:128}),(0,w.jsx)(Ms,{fieldClassName:ar,label:o("pc_text_template_name_n_web"),field:"flowerText.title",maxLength:l,allowEnter:!1,placeholder:o("pc_stickers_release_xy_name_web",{X:1,Y:p(l)}),rules:[{required:!0,message:""}],onChange:(0,ft.aD)((e=>t.title=e))}),(0,w.jsx)(aa,{label:(0,w.jsxs)("div",{className:Hn,children:[(0,w.jsx)(B.Form.Label,{required:!0,children:o("pc_text_template_tag_settings_web")}),(0,w.jsx)("div",{className:qn,tabIndex:-1,onClick:()=>s([...t.tags]),children:o("pc_text_template_apply_all_effect_web")})]}),placeholder:o("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"flowerText.tags",itemType:r.WordArt,recommendConfig:{title:t.title,uri:f.cover.uri},ignoreAddTagOnBlurSelector:`.${qn}`,onChange:(0,ft.aD)((e=>t.tags=e))}),(0,w.jsxs)("div",{children:[(0,w.jsx)(nr,{required:!0,text:o("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,w.jsx)(Tn,{value:{postChannel:u,activityId:d},onChange:e=>{var i;t.postChannel=e.postChannel,t.targetedActivityId=e.activityId,null===(i=c.formApi)||void 0===i||i.setValue("flowerText",{...c.formApi.getValue("flowerText"),postChannel:e.postChannel,targetedActivityId:e.activityId})},taskList:g,loading:!g.length,viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/XPbkdNb0qoSdGwxdjSTl3lTjgtf",onOrientationViewMoreClick:()=>{c.sendLogService.sendPageActionLog({action:"click_more_official_task"})}})]}),(0,w.jsx)(Oa,{required:h,children:(0,w.jsx)("div",{className:ka,children:(0,w.jsx)(mn,{noLabel:!0,field:"flowerText.isVip",disabled:bt.$.isEnableAuthorization,disabledTooltip:o("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:h?o("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:c.sendLogService,onChange:e=>{e&&c.sendLogService.sendPageActionLog({action:"choose_subscription_authorize"}),_(e)}})})})]})})),lr=(0,s.Pi)((e=>{const{className:t}=e,i=xs(),{t:s}=(0,n.$)(),r=(0,V.Z)((()=>{})),l=(0,a.useRef)(null);return be({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:"",titleForMainForm:s("pc_text_template_add_click_web"),subTitle:"",draggingTitle:"",draggingDisabled:!0,disabled:!0,disabledTooltip:"",onClick:r,onDrop:r},setFormApi:i.setFormApi,renderImportArea:e=>(0,w.jsx)(w.Fragment,{children:i.flowerTextList.length>0&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(ke,{title:s("pc_text_template_affiliated_web",{X:i.flowerTextList.length})}),(0,w.jsx)(bs,{})]})}),renderFormArea:()=>i.textTemplateList.selected?(0,w.jsx)(tr,{textTemplate:i.textTemplateList.selected},i.textTemplateList.selectedId):i.flowerTextList.selected?(0,w.jsx)(rr,{flowerText:i.flowerTextList.selected,initFlowerTextForm:i.initFlowerTextForm,applyTagsToAll:i.applyTagsToAll,maxTitleLength:40},i.flowerTextList.selectedId):null,scrollAreaRef:l,onRetry:i.retryInit})}));var or=i(16652);var cr=function(e){return e[e.Unknown=0]="Unknown",e[e.InfoDialog=1]="InfoDialog",e[e.AlertDialog=2]="AlertDialog",e}(cr||{});let dr=function(e){return e.Unknown="Unknown",e.Confirm="confirm",e.Cancel="cancel",e.Optional="optional",e.CheckboxClick="checkboxClick",e}({});class ur{static async callDialog(e,t){const{onConfirm:i,onCancel:s,...a}=t,n={id:"pc_heycan",type:e,...a},r=await(0,or.ZP)(n);let l=dr.Cancel;return l=void 0!==r.data?r.data.actionType:r.actionType,l===dr.Confirm&&(null==i||i()),l===dr.Cancel&&(null==s||s()),l}static async confirm(e){return this.callDialog(cr.InfoDialog,e)}static async warn(e){return this.callDialog(cr.AlertDialog,e)}}const pr="root-EgNFDI",mr="left-E5g9si",hr="right-rFTuHS",fr="remind-yX4spY",gr="protocol-M9K9e5",vr="buttonContainer-pqhOLs",_r="button-G4gKq0",xr=({className:e,leftText:t,isPublishDisabled:i,isPublishing:s,needConfirmModalOnClose:r,onPublish:l,beforeCancel:o,onCancel:c})=>{const{t:u}=(0,n.$)(),p=(0,V.Z)((async()=>{if(o&&o(),r){if(await ur.warn({mainText:u("pc_sticker_cancel_web"),subText:u("pc_sticker_click_unrecoverable_web"),confirmBtnText:u("pc_stickers_release_confirm_quit_web"),cancelBtnText:u("pc_stickers_release_cancel_web")})!==dr.Confirm)return}c?c():(0,vi.Nt)()})),m=nn.Creator,{language:h,region:f}=Tt.appModel.appInfo,g=(0,a.useMemo)((()=>wi({lang:h,region:f})),[h,f]);return(0,w.jsxs)("div",{className:d()(e,pr),children:[(0,w.jsx)("div",{className:mr,onClick:undefined,children:t}),(0,w.jsxs)("div",{className:hr,children:[(0,w.jsx)("span",{className:fr,onClick:()=>{window.open(g,"_blank")},children:u("pc_sticker_release_agree_{X}_web",{X:(0,w.jsx)("span",{className:gr,children:ln[m]},"protocol")})}),(0,w.jsxs)("div",{className:vr,children:[(0,w.jsx)(B.zx,{className:_r,type:"primary",theme:"solid",disabled:i,loading:s,onClick:l,children:u("pc_stickers_release_web")}),(0,w.jsx)(B.zx,{className:_r,type:"secondary",theme:"solid",onClick:p,children:u("pc_stickers_release_cancel_web")})]})]})]})},wr="modal-uSGTo3",yr="title-h7CfEL",Tr="detail-JFW1Vi",br="retryText-b6tno6",Cr="progress-WRObzP",Sr="cancelButton-zcznQe",Fr=(0,a.forwardRef)(((e,t)=>{const{uploadStats:i,onRetryUpload:s,onCancel:r,onShowUploadFail:l,onPromptConfirmToCancel:o}=e,{pending:c,succeeded:d,failed:u,uninited:p=0}=i,m=c+d+u,h=Math.floor(d/m*100)||0,{t:f}=(0,n.$)(),[g,v]=(0,a.useState)(!1),_=c<=p&&u>0,x=(0,V.Z)((async()=>{try{return await ur.warn({mainText:f("pc_stickers_release_confirm_delete_web"),subText:f("pc_stickers_release_uploading_web"),confirmBtnText:f("pc_stickers_release_confirm_quit_web"),cancelBtnText:f("pc_stickers_release_cancel_web")})===dr.Confirm}catch{return!1}})),y=(0,V.Z)((async()=>{if(!_){const e=x();o(e);if(!await e)return}r(),v(!1)})),T=()=>(0,w.jsx)(B.zx,{className:Sr,theme:"solid",type:"secondary",onClick:y,children:f("pc_stickers_release_cancel_web")});return(0,a.useImperativeHandle)(t,(()=>({show:()=>v(!0),hide:()=>v(!1)}))),(0,a.useEffect)((()=>{g&&_&&l()}),[g&&_]),(0,w.jsx)(B.u_,{visible:g,className:wr,header:null,footer:null,width:"auto",centered:!0,maskClosable:!1,closable:!1,children:_?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{className:yr,children:f("pc_stickers_release_network_anomaly_web")}),(0,w.jsx)("div",{className:Tr,children:(0,w.jsx)("span",{children:f("pc_stickers_release_upload_error_again_web",{X:(0,w.jsx)("span",{className:br,onClick:s,children:f("pc_sticker_retry_web")},"X")})})}),(0,w.jsx)(B.Ex,{className:Cr,percent:100,size:"small",stroke:"var(--yellow-0)"}),T()]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{className:yr,children:f("pc_stickers_release_uploading_material_web")}),(0,w.jsx)("div",{className:Tr,children:f("pc_stickers_release_upload details_web",{X:d,Y:m,Z:h})}),(0,w.jsx)(B.Ex,{className:Cr,percent:h,size:"small",stroke:"var(--cyan-2)"}),T()]})})})),kr=(0,s.Pi)((e=>{const{className:t}=e,i=xs(),{t:s}=(0,n.$)(),r=(0,a.useRef)(null);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(xr,{className:t,leftText:"",isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>{i.uploadAndPublish(r.current)},onCancel:()=>(0,vi.gk)({showHomePage:!1})}),(0,w.jsx)(Fr,{ref:r,uploadStats:i.uploadStats,onRetryUpload:i.retryUploadAndPublishDeps,onCancel:i.handleUploadCancel,onShowUploadFail:()=>{},onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));(0,s.Pi)((e=>{const[t,i]=(0,a.useState)(!1);(0,a.useEffect)((()=>{window.showStickerDebugWindow=()=>{var e,t;i(!0),null===(e=window.getSelection())||void 0===e||e.removeAllRanges(),null===(t=window.vconsole)||void 0===t||t.showSwitch()}}),[]);const s=(0,a.useRef)(null),{store:n}=window;return t?(0,w.jsxs)("div",{style:{position:"fixed",top:10,left:0,bottom:10,width:250,zIndex:2,backgroundColor:"white",padding:8,display:"flex",flexDirection:"column",overflow:"auto",color:"black"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,w.jsx)("div",{children:"\u5bfc\u5165\u7684\u6587\u5b57\u6a21\u677f\u72b6\u6001"}),(0,w.jsxs)("div",{style:{display:"flex"},children:[(0,w.jsx)("div",{style:{cursor:"pointer",marginInlineEnd:8},onClick:()=>{var e,t;const i=(null===(e=s.current)||void 0===e?void 0:e.innerText)||"",a=document.createElement("textarea");a.value=i,document.body.append(a),a.select(),document.execCommand("copy"),a.blur(),B.FN.info("\u590d\u5236\u6210\u529f"),null===(t=a.parentNode)||void 0===t||t.removeChild(a)},children:"\u590d\u5236"}),(0,w.jsx)("div",{style:{cursor:"pointer"},onClick:()=>i(!1),children:"\u5173\u95ed"})]})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"60px 1fr",rowGap:10,columnGap:8,marginTop:10},ref:s,children:[n.textTemplateList.materials.map(((e,t)=>(0,w.jsxs)(a.Fragment,{children:[e.languages.map(((i,s)=>(0,w.jsxs)(a.Fragment,{children:[(0,w.jsxs)("div",{children:["\u6587\u5b57\u6a21\u677f",t+1,(0,w.jsx)("br",{}),i.lang," ",0===s&&"\u4e3b"]}),(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",rowGap:6},children:[0===s&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{children:["id: ",e.id]}),(0,w.jsx)("div",{children:e.isMultiLang?`\u591a\u8bed\u8a00 resourceId: ${e.resourceId||"\u65e0"}`:"\u5355\u8bed\u8a00"})]}),(0,w.jsxs)("div",{children:["\u5355\u54c1 resourceId: ",i.resourceId||"\u65e0"]}),i.templateZipData.flowerTexts.map((e=>(0,w.jsxs)("div",{children:["\u9644\u5c5e\u82b1\u5b57: ",e.id]},e.id))),i.templateZipData.stickers.map((e=>(0,w.jsxs)("div",{children:["\u9644\u5c5e\u8d34\u7eb8: ",e.id]},e.id)))]})]},i.lang))),(0,w.jsx)("div",{children:"=========="}),(0,w.jsx)("div",{children:"===================="})]},t))),n.flowerTextList.materials.map(((e,t)=>(0,w.jsxs)(a.Fragment,{children:[e.subFlowerTexts.map(((i,s)=>(0,w.jsxs)(a.Fragment,{children:[(0,w.jsxs)("div",{children:["\u82b1\u5b57",t+1,(0,w.jsx)("br",{}),i.lang," ",0===s&&"\u4e3b"]}),(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",rowGap:6},children:[0===s&&(0,w.jsxs)("div",{children:["groupId: ",e.groupId]}),(0,w.jsxs)("div",{children:["id: ",i.id]}),(0,w.jsxs)("div",{children:["resourceId: ",i.resourceId||"\u65e0"]})]})]},i.lang))),(0,w.jsx)("div",{children:"=========="}),(0,w.jsx)("div",{children:"==================="})]},t))),n.stickers.map(((e,t)=>(0,w.jsxs)(a.Fragment,{children:[(0,w.jsxs)("div",{children:["\u8d34\u7eb8",t+1]}),(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",rowGap:6},children:(0,w.jsxs)("div",{children:["id: ",e.id]})})]},t)))]})]}):null}));function Ir(){const e=(0,a.useRef)(!1);var t;e.current||(e.current=!0,null===(t=hs)||void 0===t||t.addRenderTiming("renderInitPage"))}const jr="page-HRk3ka",Lr="content-LGuZmP",Nr="instruction-eUXPJ0",Er="mainForm-PzQVLp",Pr="footer-t1kXBF",Rr=(0,s.Pi)((e=>{const t=vs(),i=o();var s;return s={title:i.pageTitle,pid:i.pid},(0,a.useEffect)((()=>{(0,vi.Td)({title:s.title}),(0,gt.$G)({pid:s.pid})}),[]),Ir(),(0,a.useEffect)((()=>{t.sendLogService.sendPageActionLog({action:"detail_page_show"})})),(0,w.jsxs)(_s.Provider,{value:t,children:[(0,w.jsxs)("div",{className:jr,children:[(0,w.jsxs)("div",{className:Lr,children:[(0,w.jsx)(Z,{className:Nr}),(0,w.jsx)(lr,{className:Er})]}),(0,w.jsx)(kr,{className:Pr})]}),!1]})}))}}]);