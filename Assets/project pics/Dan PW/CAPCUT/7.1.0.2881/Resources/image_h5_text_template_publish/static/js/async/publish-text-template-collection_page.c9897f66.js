/*! For license information please see publish-text-template-collection_page.c9897f66.js.LICENSE.txt */
(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[243],{4157:(e,t,o)=>{"use strict";o.d(t,{GO:()=>g,ID:()=>u,UW:()=>c,Xh:()=>d,np:()=>h,ql:()=>p,vY:()=>m});var l=o(76997),r=o(4911),i=o(36104),n=o(18571),s=o(72839),a=o(97313);function c(e,t){e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),!t&&e.nativeEvent&&"function"==typeof e.nativeEvent.stopImmediatePropagation&&e.nativeEvent.stopImmediatePropagation()}function d(e,t){return(0,i.Z)(e,(e=>{if("function"==typeof t)return t(e);if("function"==typeof e||n.isValidElement(e))return e;if("[object Error]"===Object.prototype.toString.call(e))return e;if(Array.isArray(e)&&0===e.length){const t=Object.keys(e);if(t.length){const i=[];t.forEach((t=>{(0,r.Z)(i,t,e[t])}));try{(0,s.Z)("production"!==(0,l.Z)(process,"env.NODE_ENV"),"[Semi] You may use an out-of-bounds array. In some cases, your program may not behave as expected.\n                    The maximum length of an array is 4294967295.\n                    Please check whether the array subscript in your data exceeds the maximum value of the JS array subscript")}catch(o){}return i}}else;}))}const p=(e,t)=>{let{match:o,unmatch:l,callInInit:r=!0}=t;if("undefined"!=typeof window){const i=window.matchMedia(e);function n(e){e.matches?o&&o(e):l&&l(e)}return r&&n(i),Object.prototype.hasOwnProperty.call(i,"addEventListener")?(i.addEventListener("change",n),()=>i.removeEventListener("change",n)):(i.addListener(n),()=>i.removeListener(n))}return()=>{}},u=e=>n.isValidElement(e)&&"Icon"===(0,l.Z)(e.type,"elementType");function m(){return document?document.activeElement:null}function g(e){if(!(0,a.Z)(e))return[];const t=["input:not([disabled]):not([tabindex='-1'])","textarea:not([disabled]):not([tabindex='-1'])","button:not([disabled]):not([tabindex='-1'])","a[href]:not([tabindex='-1'])","select:not([disabled]):not([tabindex='-1'])","area[href]:not([tabindex='-1'])","iframe:not([tabindex='-1'])","object:not([tabindex='-1'])","*[tabindex]:not([tabindex='-1'])","*[contenteditable]:not([tabindex='-1'])"].join(",");return Array.from(e.querySelectorAll(t))}function h(){return globalThis&&"[object Window]"===Object.prototype.toString.call(globalThis)?window.innerWidth-document.documentElement.clientWidth:0}},79337:(e,t,o)=>{"use strict";o.d(t,{EG:()=>u.Z,Ex:()=>c.Z,FN:()=>m.Z,Form:()=>h.Z,J2:()=>a.Z,Kx:()=>s.Z,Lt:()=>n.Z,Q2:()=>f.Z,Vp:()=>p.Z,XZ:()=>r.ZP,u:()=>g.Z,u_:()=>i.Z,yC:()=>d.Z,zx:()=>l.Z});o(38109);var l=o(46995),r=o(47225),i=o(74970),n=o(49230),s=o(48905),a=o(54810),c=o(15842),d=o(52985),p=o(8050),u=o(75082),m=o(76538),g=o(44601),h=o(63803),f=o(95113)},62027:(e,t,o)=>{"use strict";o.d(t,{YW:()=>v,rr:()=>x});var l=o(18571),r=o(65625),i=o(18751),n=o.n(i),s=o(79292),a=o(9995),c=o(79337),d=o(69687),p=o(84312),u=o(71995),m=o(92304),g=o(95108),h=o(24307),f=o(72322);let v=function(e){return e.Origin="originUserAuthProtocol",e.OriginalForSubscription="originalWorkProtocolForSubscription",e.OriginalForCommercial="originalWorkProtocolForCommercial",e.Creator="createProtocol",e.AuthorAgreement="AuthorAgreementProtocol",e}({});const _={[v.Origin]:(0,p.OD)(),[v.OriginalForSubscription]:(0,p.OD)(),[v.OriginalForCommercial]:(0,p.NZ)(),[v.Creator]:(0,p.dr)({}),[v.AuthorAgreement]:(0,p.kx)()},x={[v.Origin]:"Original Work Notice",[v.OriginalForSubscription]:"Original Work Notice",[v.OriginalForCommercial]:"Original Work Notice",[v.Creator]:s.I18n.t("pc_capcut_creator_agreement_web"),[v.AuthorAgreement]:s.I18n.t("cc_pc_material_publish_paid_authorize_popup_title_web")};(0,r.Pi)((({onCancel:e,onOk:t,protocol:o,handleBtnText:r,closeIcon:i=!1,needReview:s=!0,useIframe:p=!0,needHasRead:v=!0,renderConfirmExtra:b,getCanConfirmExtra:y})=>{const{t:C}=(0,a.$)(),[w,j]=(0,l.useState)(!1),[S,T]=(0,l.useState)(!1),N=!v||w,P=()=>!s||N&&S&&(!y||y()),{handleMouseEnter:O}=(0,m.w)({content:C("pc_template_authorize_read_all_web"),cursor:"not-allowed"}),I=(0,l.useRef)(null),E={disabled:!N,handleMouseEnter:!s||N?void 0:O},k=()=>{P()&&(null==t||t())};(0,l.useEffect)((()=>{const e=e=>{const t=e.data;try{const e=JSON.parse(t),o=document.getElementById("protocol-content"),l="protocal"===e.from||"protocol"===e.from;if(l&&"load"===e.event)if(o){const{clientHeight:t}=o;e.scrollHeight<=t&&j(!0)}else j(!0);l&&"bottom"===e.event&&j(!0)}catch(o){j(!0),(0,u.RF)("[Protocol] handle protocol message",o,{text:t})}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[]);const Z=()=>{if(I.current&&!p){const{scrollHeight:e,clientHeight:t,scrollTop:o}=I.current;!N&&o+t>=e&&j(!0)}};return(0,l.useEffect)((()=>{var e;return null===(e=I.current)||void 0===e||e.addEventListener("scroll",Z),()=>{var e;null===(e=I.current)||void 0===e||e.removeEventListener("scroll",Z)}}),[I.current]),(0,l.useLayoutEffect)((()=>{const e=document.getElementById("protocol-content");if(e&&!p){const{scrollHeight:t,clientHeight:o}=e;j(!(t>o)),I.current=e}}),[]),(0,f.jsxs)("div",{className:g.Z.protocol,children:[(0,f.jsxs)("div",{className:h.Z.root,children:[(0,f.jsx)("div",{className:h.Z.title,children:x[o]}),(0,f.jsx)("div",{className:h.Z.right,children:i&&(0,f.jsx)(d.r,{className:h.Z.closeIcon,onClick:()=>{null==e||e("close")}})})]}),(0,f.jsx)("div",{className:n()(g.Z.content,!s&&g.Z.withBorder,s&&g.Z.flexHeight),id:"protocol-content",children:p?(0,f.jsx)("iframe",{id:"frame",src:_[o]}):(0,f.jsx)("div",{className:g.Z.protocolContent,children:null})}),r&&s?(0,f.jsxs)("div",{className:g.Z.confirmArea,children:[(0,f.jsx)(c.XZ,{className:g.Z.confirmCheckbox,checked:S,disabled:E.disabled,onMouseEnter:E.handleMouseEnter,onChange:e=>T(Boolean(e.target.checked)),autoFocus:!1,children:(0,f.jsx)("span",{className:g.Z.confirmCheckboxText,children:C("pc_template_authorize_read_agree_web",{X:(0,f.jsx)("span",{className:g.Z.confirmCheckboxProtocolTitle,children:x[o]},"X")})})}),null==b?void 0:b()]}):null,(()=>{const e=r;return e?(0,f.jsx)("div",{className:n()(g.Z.footer,s&&g.Z.withBorder),children:(0,f.jsx)(c.zx,{className:g.Z.btn,type:"primary",theme:"solid",disabled:!P(),onClick:k,children:e})}):null})()]})}))},2811:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>lo});var l=o(65625),r=o(9995),i=o(18571),n=o(71443),s=o(56366),a=o(60963),c=o(75255),d=o(79337),p=o(65751),u=o(1536),m=o(13805),g=o(88154),h=o(31062),f=o(65656),v=o(42012),_=o(71995),x=o(61053),b=o(45394);function y(e){return Boolean(e.id)}class C{constructor(){(0,g.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const o of(0,h.Z)(e,10)){const e=await Promise.all(o.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:o,onResult:l,onUpdateResult:r}=e,i=JSON.parse(JSON.stringify(e.req));let n=this.itemMap.get(o);if(null!==(t=n)&&void 0!==t&&t.promise&&(0,f.Z)(n.req,i))try{return await n.promise}catch(s){(0,_.c6)("[MaterialPublishService] publish failed, start to retry",{id:o})}return n={promise:null,id:o,req:i,onResult:l,onUpdateResult:r},this.itemMap.set(o,n),n.promise=this.publishImpl(n),n.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),o=async(o,l)=>{try{const n={error:o,errorText:this.getErrorText(o),time:Math.round(performance.now()-t),resourceId:l};var r,i;if(y(e.req))await(null===(r=e.onUpdateResult)||void 0===r?void 0:r.call(e,{req:e.req,...n}));else await(null===(i=e.onResult)||void 0===i?void 0:i.call(e,{req:e.req,...n}))}catch(n){(0,_.RF)("[MaterialPublishService] callOnResult failed",n)}};let l;try{l=await this.postOrUpdate(e)}catch(r){throw e.promise=null,o(r,""),r}return await o(null,l.resource_id),l}async postOrUpdate(e){return y(e.req)?(await(0,b.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,b.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new x.B).timeout(5e3)])}catch(t){(0,_.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const o=performance.now(),l=new x.B,r={count:50,effect_types:t,uid:v.$.userInfo.uid,cursor:0};for(;performance.now()-o<5e3;){const t=await(0,b.Js)(r).catch((()=>null));if(null!=t&&t.effect_item_list){const o=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>o.has(e))))return}await l.timeout(500)}}}var w=o(21798),j=o(18651),S=o(72383),T=o(59359),N=o(21386),P=o(71166);var O=o(21135),I=o(61604),E=Object.defineProperty,k=Object.defineProperties,Z=Object.getOwnPropertyDescriptors,F=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,M=(e,t,o)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,L=(e,t)=>{for(var o in t||(t={}))A.call(t,o)&&M(e,o,t[o]);if(F)for(var o of F(t))U.call(t,o)&&M(e,o,t[o]);return e};const R={version:void 0};var D=(e,t={})=>{return I.Z.call("getTextTemplateCollectionInitialData",e,(o=L({},t),l={customOptions:L({jsb_rules:R},t.customOptions)},k(o,Z(l))));var o,l};var z=Object.defineProperty,$=Object.defineProperties,q=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,V=(e,t,o)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,X=(e,t)=>{for(var o in t||(t={}))W.call(t,o)&&V(e,o,t[o]);if(B)for(var o of B(t))H.call(t,o)&&V(e,o,t[o]);return e};const Y={version:void 0};var J=(e,t={})=>{return I.Z.call("openOnlineTextTemplatePicker",e,(o=X({},t),l={customOptions:X({jsb_rules:Y},t.customOptions)},$(o,q(l))));var o,l},G=Object.defineProperty,K=Object.defineProperties,Q=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,le=(e,t,o)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,re=(e,t)=>{for(var o in t||(t={}))te.call(t,o)&&le(e,o,t[o]);if(ee)for(var o of ee(t))oe.call(t,o)&&le(e,o,t[o]);return e};const ie={version:void 0};var ne=(e,t={})=>{return I.Z.call("openTextTemplateImageEditor",e,(o=re({},t),l={customOptions:re({jsb_rules:ie},t.customOptions)},K(o,Q(l))));var o,l},se=Object.defineProperty,ae=Object.defineProperties,ce=Object.getOwnPropertyDescriptors,de=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable,me=(e,t,o)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,ge=(e,t)=>{for(var o in t||(t={}))pe.call(t,o)&&me(e,o,t[o]);if(de)for(var o of de(t))ue.call(t,o)&&me(e,o,t[o]);return e};const he={version:void 0};var fe=(e,t={})=>{return I.Z.call("retryUploadTextTemplateFiles",e,(o=ge({},t),l={customOptions:ge({jsb_rules:he},t.customOptions)},ae(o,ce(l))));var o,l};const ve="CollectionActionLockKey";var _e=o(3703),xe=o(15027);o(57705);const be=async e=>{const t=await fetch(e);return(e=>URL.createObjectURL(e))(await t.blob())};var ye=o(76937),Ce=o(50291);function we(e){return Boolean(e.title&&e.tags.length&&e.cover.id)}var je=o(45725);var Se=o(61679);function Te(){const e=(0,S.G)({watch:()=>l.isAllUploaded}),t=new m.l,{t:o}=(0,r.$)(),l=(0,c.fv)((()=>({formApi:null,setFormApi:e=>{l.formApi=e},performanceTimingCollector:(0,Se.uY)(),initOp:new xe.q({fetchFirstPage:async()=>{u.appModel.isInited||await(0,_e.cb)({throwOnError:!0}),l.performanceTimingCollector.addTiming("initFullAppInfoDone"),(0,_.c6)("[CollectionStore] getTextTemplateCollectionInitialData req --\x3e");const e=await(0,O.oh)(D,"getTextTemplateCollectionInitialData",{});return(0,_.c6)("[CollectionStore] getTextTemplateCollectionInitialData resp <--",{singles:e.singles}),()=>{l.handleNewSingles(e.singles),l.selectCollectionCard(),l.performanceTimingCollector.addSetStateTiming(Se.Pk)}},slardarErrorLog:(e,t)=>{l.performanceTimingCollector.addSetStateTiming(Se.Pk,{scene:"initFailed"}),(0,_.RF)(`[CollectionStore] ${e} failed`,t)}}),get mainFormLayout(){const{fetchStatus:e}=l.initOp;return e.isFailed?"error":e.hasFetched?"mainForm":"loading"},get needConfirmModalOnClose(){return!0},pubServ:new C,authorSignService:new w.I({signScene:N.d.BusinessArtist}),authFileUploadServiceManager:new j.r({}),uploadConfigService:new P.w,isAllUploadedWatcher:e,textTemplateIds:[],textTemplateMap:new Map,get textTemplates(){return l.textTemplateIds.map((e=>l.textTemplateMap.get(e)))},selectedTextTemplateId:"",get selectedTextTemplate(){var e;return l.textTemplateIds.includes(l.selectedTextTemplateId)&&null!==(e=l.textTemplateMap.get(l.selectedTextTemplateId))&&void 0!==e?e:null},isCollectionCardSelected:!1,collection:{id:(0,ye.V)("text-template-collection"),title:"",description:"",tags:[],cover:{id:"",uri:"",src:"",isUploadFailed:!1}},async init(){l.initOp.initFetchFirstPage(null)},async retryInit(){l.initOp.retryFetchFirstPage()},openOnlineTextTemplatePicker(){t.lock(ve,(async()=>{const e=[...l.textTemplateIds];(0,_.c6)("[CollectionStore] openOnlineTextTemplatePicker req --\x3e",{singles:e});const t=await J({singles:e});(0,_.c6)("[CollectionStore] openOnlineTextTemplatePicker resp <--",{singles:t.singles}),0!==t.singles.length&&l.handleNewSingles(t.singles)}))},async handleNewSingles(e){if(!e)return;const t=[];if(e.forEach((e=>{const{id:o,source:r,title:i,cover:n,isVip:s}=e;l.textTemplateMap.has(e.id)||(t.push(o),l.textTemplateMap.set(o,{id:o,source:r,title:i,coverSrc:"",tags:[],isOriginal:!1,isVip:s,isBusiness:!1}),l.updateWithBlobUrl(o,n))})),l.textTemplateIds=e.map((e=>e.id)),0===t.length)return void(0,_.c6)("[CollectionStore] handleNewSingles no addedIds");(0,_.c6)("[CollectionStore] handleNewSingles mgetItem start",{ids:t});const o=await(0,b.yF)({items:t.map((e=>({id:e,source:l.textTemplateMap.get(e).source,effect_type:p.Ab.TextTemplate}))),pack_optional:{need_tag:!0,need_parent_tag:!1}});(0,_.c6)("[CollectionStore] handleNewSingles mgetItem success",{ids:o.effect_item_list.map((e=>e.common_attr.id))}),(0,a.z)((()=>{o.effect_item_list.forEach((e=>{var t;const{id:o,business_info:r,is_business:i,is_original:n,tag_list:s}=e.common_attr,a=l.textTemplateMap.get(o);if(!a)return;const c=[...new Set((s||[]).map((e=>e.name)))];a.tags=c,a.isOriginal=n,a.isVip=Boolean(null===(t=r.json)||void 0===t?void 0:t.is_vip),a.isBusiness=i,l.selectedTextTemplateId===o&&l.updateSingleForm({tags:[...c]})}))})),(0,_.c6)("[CollectionStore] handleNewSingles updated with online data")},async updateWithBlobUrl(e,t){try{const o=await be(t),r=l.textTemplateMap.get(e);if(!r)return;(0,a.z)((()=>{r.coverSrc=o}))}catch(o){(0,_.RF)("[CollectionStore] updateWithBlobUrl error",o,{id:e,src:t})}},selectTextTemplateCard(e){l.saveCurrentForm(),l.isCollectionCardSelected=!1,l.selectedTextTemplateId=e.id},selectCollectionCard(){l.saveCurrentForm(),l.isCollectionCardSelected=!0,l.selectedTextTemplateId=""},initSingleForm(e){l.updateSingleForm({title:e.title,tags:[...e.tags]})},updateSingleForm(e){var t;null===(t=l.formApi)||void 0===t||t.setValues({single:{...l.formApi.getValue("single"),...e}})},initCollectionForm(){var e;const{collection:t}=l;null===(e=l.formApi)||void 0===e||e.setValues({collection:{title:t.title,description:t.description,tags:t.tags}})},updateCollection(e){Object.assign(l.collection,e)},saveCurrentForm(){if(l.isCollectionCardSelected){var e;const t=null===(e=l.formApi)||void 0===e?void 0:e.getValue("collection");if(!t)return;l.collection.title=t.title,l.collection.description=t.description,l.collection.tags=t.tags}},fileEventDispatcher:new Ce.r({initData:()=>null}),openCoverImageEditor(){t.lock(ve,(async()=>{await l.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openCoverImageEditor"});const{imageUploadConfig:e,objectUploadConfig:t}=await l.uploadConfigService.getUploadConfigs("openCoverImageEditor"),o={collectionId:l.collection.id,type:"CoverImage",singles:l.textTemplateIds,thumbnailSize:200,minImageSize:320,maxImageSize:1e3,maxFileSize:20971520,imageUploadConfig:e,objectUploadConfig:t};(0,_.c6)("[CollectionStore] openTextTemplateImageEditor req --\x3e",{...(0,s.Z)(o,"singles")});const{id:r}=await ne(o);(0,_.c6)("[CollectionStore] openTextTemplateImageEditor resp <--",{id:r}),r&&l.replaceCover(r)}))},replaceCover(e){l.collection.cover.id&&l.fileEventDispatcher.removeFile(l.collection.cover.id),l.collection.cover={id:e,uri:"",src:"",isUploadFailed:!1},l.fileEventDispatcher.register("Thumbnail",e,(t=>{l.collection.cover.id===e?t.base64?(0,a.z)((()=>{const{cover:e}=l.collection;e.src=((e,t="")=>`data:${t};base64,${e}`)(t.base64)})):(0,_.RF)(`[CollectionStore] cover thumbnail failed {${e}}`):(0,_.c6)(`[CollectionStore] cover thumbnail ignored {${e}}`,{coverId:l.collection.cover.id})})),l.fileEventDispatcher.register("Upload",e,(t=>{if(l.collection.cover.id!==e)return void(0,_.c6)(`[CollectionStore] cover upload ignored {${e}}`,{coverId:l.collection.cover.id});const{cover:o}=l.collection,{uri:r}=t;(0,a.z)((()=>{if(r)o.uri=r,(0,_.c6)(`[CollectionStore] cover upload success {${e}}`,{uri:r});else{o.isUploadFailed=!0;const l=t.error||"unknown";(0,_.RF)(`[CollectionStore] cover upload failed {${e}}`,null,{error:l})}}))}))},async retryUpload(){const e=[],{collection:t}=l;t.cover.isUploadFailed&&e.push(t.cover.id),e.length&&((0,_.c6)("[CollectionStore] retryUploadTextTemplateFiles req --\x3e",{ids:e}),await fe({ids:e}),(0,_.c6)("[CollectionStore] retryUploadTextTemplateFiles resp <--",{}),(0,a.z)((()=>{e.includes(t.cover.id)&&(t.cover.isUploadFailed=!1)})))},get uploadStats(){let e=0,t=0,o=0;const{cover:r}=l.collection;return r.isUploadFailed?o+=1:r.uri?t+=1:e+=1,{pending:e,succeeded:t,failed:o}},get isAllUploaded(){const{pending:e,failed:t}=l.uploadStats;return!e&&!t},get isReadyToPublish(){const e=l.textTemplates.length;return Boolean(e>=3&&e<=20&&we(l.collection)&&!l.isPublishSucceeded)},async uploadAndPublish(e){l.sendMaterialToolClickPublishLog(),l.isAllUploaded||(await l.retryUpload(),null==e||e.show(),await l.isAllUploadedWatcher.start());try{await l.publish()}finally{null==e||e.hide()}},isPublishing:!1,isPublishSucceeded:!1,async publish(){l.isPublishing=!0;try{await l.publishImpl()}catch(e){return d.FN.error(o("pc_sticker_release_failed_retry_web")),(0,a.z)((()=>{l.isPublishing=!1})),void(0,_.RF)("[CollectionStore] publish failed",e)}(0,a.z)((()=>{l.isPublishing=!1,l.isPublishSucceeded=!0})),(0,_.c6)("[CollectionStore] publish success"),setTimeout((()=>(0,T.gk)({showHomePage:!0})),1e3)},async publishImpl(){l.saveCurrentForm();const{collection:e,textTemplates:t,textTemplateIds:o}=l,{cover:r,title:i,description:n,tags:s}=e,a={effect_type:p.Ab.TextTemplateCollection,is_vip:!1,common_data:{title:i,description:n,icon:{image_uri:r.uri},source:b.r0.UserPostPcCollection,tags:[...s],is_business:!1,is_original:!1},collection_info:{resource_id_list:o}};(0,_.c6)("[CollectionStore] collection publish start",{resourceIdList:o});const{resource_id:c}=await l.pubServ.publish({id:e.id,req:a,onResult:({error:e,resourceId:t})=>{!function(e){const{multiLang:t,...o}=e,l=e=>({zh:"cn",en:"en",ja:"jp",ko:"kr"}[e]||""),r=e=>{var o;return null!==(o=null==t?void 0:t.map(e).join(","))&&void 0!==o?o:""};(0,je.g)({eventName:"material_tool_publish_status",params:{...o,...t&&{language_setting:r((({isMultiLang:e})=>e?"multi":"single")),language_type:r((({langs:e})=>l(e[0]))),language_total_type:r((({langs:e})=>e.map(l).join(";")))}}})}({text_template_cnt:o.length,material_type:"collection",status:e?"fail":"success",success_cnt:1}),e?(0,_.RF)("[CollectionStore] collection publish failed",e):(0,_.c6)("[CollectionStore] collection publish success",{resourceId:t})}});(0,_.c6)("[CollectionStore] collection publish done",{resourceId:c}),await l.pubServ.pollUntilAllInEffectList({ids:[c],types:[p.Ab.TextTemplateCollection]}),(0,_.c6)("[CollectionStore] poll done")},sendMaterialToolClickPublishLog(){const{textTemplateIds:e}=l;!function(e){const{caption_template_cnt:t,captionAnimationIds:o=[],text_template_cnt:l,material_type:r,text_special_effect_cnt:i}=e;(0,je.g)({eventName:"material_tool_click_publish_confirm",params:{caption_template_cnt:t,caption_animation_id:o.join(","),text_template_cnt:l,material_type:r,text_special_effect_cnt:i}})}({text_template_cnt:e.length,material_type:"collection"})}})));return function(e){const t=(0,c.fv)((()=>({get watchResult(){return e.watch()}})));(0,i.useEffect)((()=>{const e=(0,a.EH)((()=>{const e=t.watchResult;(0,T.c0)({isNeed:e})}));return()=>{e()}}),[])}({watch:()=>l.needConfirmModalOnClose}),(0,i.useEffect)((()=>{window.store=l,l.init(),l.uploadConfigService.uploadConfigsCache.update();const e=(0,T.KS)("TextTemplateFileProcessResult",(e=>{(0,_.c6)(`[JSB] TextTemplateFileProcessResult ${null==e?void 0:e.type} {${null==e?void 0:e.id}}`,{...(0,s.Z)(e,["result","uri","error"])}),l.fileEventDispatcher.dispatch(e)}));return()=>{e()}}),[]),l}const Ne=(0,i.createContext)(null),Pe=()=>(0,i.useContext)(Ne);var Oe=o(72322);const Ie=(0,l.Pi)((e=>{const{className:t}=e,{t:o}=(0,r.$)(),l=(0,i.useMemo)((()=>[{key:"collection",title:o("pc_text_template_collection_desc_web"),instructions:[{key:"",title:o("pc_text_template_release_combination_web")}]},{key:"single",title:o("pc_text_template_desc_web"),instructions:[{key:"",title:o("pc_text_template_release_effect_web")}]}]),[]),{isCollectionCardSelected:s,selectedTextTemplateId:a}=Pe(),c=(0,i.useMemo)((()=>()=>"init"),[]);return(0,Oe.jsx)(n.v,{className:t,groups:l,initGroup:"collection",activeGroup:s?"collection":"single",resetExpandedGroupKey:s?"collection":`single-${a}`,getStatus:c})}));var Ee=o(54275),ke=o(62369),Ze=o(84117),Fe=o(18751),Ae=o.n(Fe),Ue=o(59217),Me=o(61673),Le=o(33311),Re=o(6109),De=o(33310),ze=o(92304),$e=o(7059),qe=o(605);const Be=e=>{const{className:t,loadingText:o}=e,{t:l}=(0,r.$)(),{handleMouseEnter:i}=(0,ze.S)();return(0,Oe.jsxs)("div",{className:Ae()(qe.Z.root,t),children:[(0,Oe.jsx)(De.a,{className:qe.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,Oe.jsx)("div",{className:qe.Z.text,onMouseEnter:i,children:o||l("pc_stickers_release_in_web")})]})},We=e=>{const{className:t,tooltip:o}=e,{t:l}=(0,r.$)(),{handleMouseEnter:n}=(0,ze.w)({content:o,className:qe.Z.tooltip}),s=(0,i.useRef)(null),{setIsMarqueeLoopRunning:a,reactNode:c}=(0,$e.J)({text:l("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>s.current});return(0,Oe.jsxs)("div",{className:Ae()(qe.Z.root,t,qe.Z.error),onMouseEnter:e=>{a(!0),n(e)},onMouseLeave:()=>a(!1),children:[(0,Oe.jsx)(Me.r,{className:qe.Z.icon}),(0,Oe.jsx)("div",{ref:s,className:qe.Z.text,children:c})]})},He=e=>{const{className:t,text:o}=e,{handleMouseEnter:l}=(0,ze.S)();return(0,Oe.jsxs)("div",{className:Ae()(qe.Z.root,t,qe.Z.checked),children:[(0,Oe.jsx)(Re.r,{className:qe.Z.icon}),(0,Oe.jsx)("div",{className:qe.Z.text,onMouseEnter:l,children:o})]})},Ve=e=>{const{className:t}=e,{t:o}=(0,r.$)(),{handleMouseEnter:l}=(0,ze.S)();return(0,Oe.jsxs)("div",{className:Ae()(qe.Z.root,t),children:[(0,Oe.jsx)("div",{className:Ae()(qe.Z.icon,qe.Z.yellowIcon),children:(0,Oe.jsx)("div",{className:qe.Z.yellowPoint})}),(0,Oe.jsx)("div",{className:qe.Z.text,onMouseEnter:l,children:o("pc_stickers_release_editing_web")}),(0,Oe.jsx)(Le.r,{className:qe.Z.icon})]})},Xe=e=>{const{className:t,loading:o,invalid:l,errorToolip:r,isInfoComplete:i,title:n,loadingText:s}=e;return o?(0,Oe.jsx)(Be,{className:t,loadingText:s}):l?(0,Oe.jsx)(We,{className:t,tooltip:r}):i?(0,Oe.jsx)(He,{className:t,text:n}):(0,Oe.jsx)(Ve,{className:t})},Ye="root-W9YKLd",Je="selected-MfKVC9",Ge="cover-Sg1bSx",Ke="icon-NjGS_M",Qe="textInfo-zYCck9",et="title-PHGLK_",tt="description-W4AGHI",ot="statusBar-wU3FIA",lt="checkedStatusBar-YMzSep",rt=({className:e,selected:t,coverSrc:o,title:l,description:i,isInfoComplete:n,onClick:s})=>{const{t:a}=(0,r.$)(),{handleMouseEnter:c}=(0,ze.S)();return(0,Oe.jsxs)("div",{className:Ae()(e,Ye,t&&Je),onClick:s,children:[(0,Oe.jsx)("div",{className:Ge,children:o?(0,Oe.jsx)("img",{className:Ke,src:o}):(0,Oe.jsx)(Ue.t,{className:Ke,iconWidth:28})}),(0,Oe.jsxs)("div",{className:Qe,children:[(0,Oe.jsx)("div",{className:et,onMouseEnter:c,children:l||a("pc_stickers_release_group_name_web")}),(0,Oe.jsx)("div",{className:tt,onMouseEnter:c,children:i||a("pc_stickers_release_details_recommend_web")})]}),n?(0,Oe.jsx)(He,{className:lt,text:a("pc_stickers_release_finish_fill_web")}):(0,Oe.jsx)(Ve,{className:ot})]})},it=(0,l.Pi)((e=>{const{className:t}=e,o=Pe(),{collection:l}=o;return(0,Oe.jsx)(rt,{className:t,selected:o.isCollectionCardSelected,coverSrc:l.cover.src,title:l.title,description:l.description,isInfoComplete:we(l),onClick:o.selectCollectionCard})}));var nt=o(85543);const st="menu-v4m02G",at="menuItemContainer-K5Eent",ct="menuItem-eU7buP";function dt(e){const{items:t}=e,o=e=>{e.currentTarget===e.target&&e.stopPropagation()};return(0,Oe.jsx)("div",{className:st,onClick:o,children:(0,Oe.jsx)("div",{className:at,onClick:o,children:t.map((({key:e,render:t},o)=>t({key:e,index:o,className:ct})))})})}var pt=o(70126),ut=o(56220),mt=o(4281);const gt="root-qThJ3Y",ht="point-ytHHVg",ft=e=>{const{position:t,getPopupContainer:o,onClosePopover:l,popoverProps:r}=e,[n,s]=(0,i.useState)(!0),a=(0,Ee.Z)((()=>s(!1))),c=(0,i.useRef)(null);return(0,i.useLayoutEffect)((()=>{var e;null===(e=c.current)||void 0===e||e.focus()}),[]),(0,Oe.jsx)(d.J2,{autoAdjustOverflow:!0,position:"bottomLeft",clickToHide:!0,...r,className:Ae()(r.className,mt.i.heycanPopoverWrapperClearStyle),trigger:"custom",visible:n,onEscKeyDown:a,onClickOutSide:a,getPopupContainer:o,onVisibleChange:e=>{var t;!e&&l(),null===(t=r.onVisibleChange)||void 0===t||t.call(r,e)},children:(0,Oe.jsx)("div",{className:ht,tabIndex:-1,ref:c,style:{...t}})})};function vt(e){const{zIndex:t=1e3,...o}=e,[l,n]=(0,i.useState)(null),[s,a]=(0,i.useState)(null),{i18n:c}=(0,r.$)(),d=(0,Ee.Z)((()=>{l&&(l.destroy(),n(null),a(null))})),p=(0,Ee.Z)((()=>{null==l||l.destroy()})),u=(0,Ee.Z)((e=>{if(l)return;const o=document.createElement("div");o.className=gt,o.style.zIndex=`${t}`;o.addEventListener("wheel",(e=>{e.currentTarget===o&&(e.preventDefault(),e.stopPropagation())}),!1),window.addEventListener("resize",d),document.body.appendChild(o);const r=(0,pt.createRoot)(o);n({container:o,reactRoot:r,destroy:()=>{o.remove(),Promise.resolve().then((()=>r.unmount())),window.removeEventListener("resize",d)}}),a(e)})),m=(0,Ee.Z)((e=>{e.preventDefault(),e.stopPropagation(),u({left:e.clientX,top:e.clientY})}));return(0,i.useLayoutEffect)((()=>p),[]),(0,i.useLayoutEffect)((()=>{l&&s&&l.reactRoot.render((0,Oe.jsx)(ut.a,{i18n:c,children:(0,Oe.jsx)(ft,{popoverProps:o,getPopupContainer:()=>l.container,onClosePopover:d,position:s})})),l&&(l.container.style.zIndex=`${t}`)})),{handleContextMenu:m}}const _t="root-NGa4yU",xt="statusBar-z9k5q0",bt="contextMenuItem-MQ4rUL",yt=(0,l.Pi)((e=>{const{className:t,textTemplate:o,isSelected:l,onClick:i,onDelete:n}=e,{t:s}=(0,r.$)(),{handleContextMenu:a}=vt({content:(0,Oe.jsx)(dt,{items:[{key:"remove",render:({key:e,className:t})=>(0,Oe.jsx)("div",{className:Ae()(t,bt),onClick:()=>n(o),children:s("pc_stickers_release_delete_web")},e)}]})});return(0,Oe.jsxs)("div",{className:Ae()(_t,t),onClick:()=>{i(o)},children:[(0,Oe.jsx)(nt.Y,{src:o.coverSrc,isInvalid:!1,isSelected:l,size:80,onContextMenu:e=>{e.preventDefault(),i(o)}}),(0,Oe.jsx)(Xe,{className:xt,loading:!1,invalid:!1,errorToolip:"",isInfoComplete:!0,title:o.title})]})}));var Ct=o(45092);const wt=(0,l.Pi)((e=>{const{className:t}=e,o=Pe();return(0,Oe.jsx)("div",{className:Ae()(Ct.Z.root,t),children:(0,Oe.jsx)("div",{className:Ct.Z.container,children:o.textTemplates.map(((e,t)=>(0,Oe.jsx)(yt,{className:Ct.Z.card,textTemplate:e,isSelected:o.selectedTextTemplateId===e.id,onClick:o.selectTextTemplateCard,onDelete:()=>{}},e.id)))})})})),jt="root-SiuXcn",St="icon-pvz0IF",Tt=e=>{const{className:t,src:o}=e,l=Ae()(jt,t);return(0,Oe.jsx)("div",{className:l,children:o?(0,Oe.jsx)("img",{className:St,src:o}):(0,Oe.jsx)(Ue.t,{className:St,iconWidth:28})})};var Nt;function Pt(){return Pt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(e[l]=o[l])}return e},Pt.apply(this,arguments)}const Ot=e=>i.createElement("svg",Pt({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),Nt||(Nt=i.createElement("path",{fill:"#D4A500",d:"M8 14c3.292 0 6-2.71 6-6.003S11.292 2 8 2 2 4.703 2 7.997 4.708 14 8 14m0-5.142c-.391 0-.62-.217-.638-.614l-.09-2.493c-.024-.421.277-.704.722-.704s.752.289.728.71l-.09 2.48c-.018.404-.247.621-.632.621m0 2.047c-.445 0-.794-.283-.794-.71 0-.428.349-.717.794-.717.451 0 .788.29.788.717s-.343.71-.788.71"}))),It="root-OOqubc",Et="loadingText-blkQ9S",kt="errorText-b8vNmn",Zt="retryText-cBAROb",Ft="warnText-XizvZZ",At=e=>{const{className:t,isUploadFailed:o,onRetry:l,needImport:i,loading:n}=e,s=Ae()(It,t),{t:a}=(0,r.$)();return o?(0,Oe.jsx)("div",{className:s,children:(0,Oe.jsx)("span",{className:kt,children:a("pc_stickers_release_error_x_web",{X:(0,Oe.jsx)("span",{className:Zt,onClick:l,children:a("pc_stickers_release_click_again_web")},"X")})})}):i?(0,Oe.jsxs)("div",{className:s,children:[(0,Oe.jsx)(Ot,{height:14,width:14}),(0,Oe.jsx)("span",{className:Ft,children:a("pc_stickers_release_add_cover_web")})]}):n?(0,Oe.jsxs)("div",{className:s,children:[(0,Oe.jsx)(De.a,{size:12,arcColor:"var(--grey-1)"}),(0,Oe.jsx)("span",{className:Et,children:a("pc_stickers_release_in_web")})]}):(0,Oe.jsx)("div",{className:s})},Ut="root-RGRrw_",Mt="statusBar-g7EX3X",Lt="edit-gNJiPH",Rt=(0,l.Pi)((e=>{const{t}=(0,r.$)(),o=Pe(),{cover:l}=o.collection;return(0,Oe.jsxs)("div",{className:Ut,children:[(0,Oe.jsx)(Tt,{src:l.src}),(0,Oe.jsx)("div",{className:Lt,onClick:o.openCoverImageEditor,children:t("pc_stickers_release_cover_edit_web")}),(0,Oe.jsx)(At,{className:Mt,isUploadFailed:l.isUploadFailed,onRetry:o.retryUpload,needImport:!l.id,loading:Boolean(l.id&&!l.src)})]})}));var Dt=o(12625),zt=o(23725),$t=o(39106);const qt="root-rKCzio",Bt="titleField-DfDWNz",Wt=(0,l.Pi)((()=>{const{t:e}=(0,r.$)(),t=Pe(),{collection:o}=t;(0,i.useLayoutEffect)((()=>t.initCollectionForm()),[]);const{getDisplayLength:l}=(0,$t._)();return(0,Oe.jsxs)("div",{className:qt,children:[(0,Oe.jsx)(Rt,{}),(0,Oe.jsx)(Dt.l,{fieldClassName:Bt,label:e("pc_text_template_name_n_web"),field:"collection.title",maxLength:40,allowEnter:!1,placeholder:e("pc_stickers_release_xy_name_web",{X:1,Y:l(40)}),rules:[{required:!0,message:""}],onChange:e=>t.updateCollection({title:e})}),(0,Oe.jsx)(Dt.l,{label:e("pc_stickers_release_details_recommend_web"),field:"collection.description",maxLength:52,allowEnter:!1,placeholder:e("pc_stickers_release_xy_details_web",{X:1,Y:l(52)}),onChange:e=>t.updateCollection({description:e})}),(0,Oe.jsx)(zt.u,{label:e("pc_text_template_tag_settings_web"),placeholder:e("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"collection.tags",itemType:p.Ab.TextTemplate,recommendConfig:{title:o.title,uri:o.cover.uri},rules:[{required:!0,message:""}],onChange:e=>t.updateCollection({tags:e})})]})})),Ht="root-l6malL",Vt="cover-NC1s_6",Xt="titleField-GmjT0V",Yt=(0,l.Pi)((e=>{const{t}=(0,r.$)(),o=Pe(),l=o.selectedTextTemplate;(0,i.useLayoutEffect)((()=>{l&&o.initSingleForm(l)}),[l]);const{getDisplayLength:n}=(0,$t._)();return l?(0,Oe.jsxs)("div",{className:Ht,children:[(0,Oe.jsx)(nt.Y,{className:Vt,src:l.coverSrc,isInvalid:!1,isSelected:!1,size:128}),(0,Oe.jsx)(Dt.l,{fieldClassName:Xt,label:t("pc_stickers_release_set_title_web"),disabled:!0,field:"single.title",maxLength:40,allowEnter:!1,placeholder:t("pc_stickers_release_xy_name_web",{X:1,Y:n(40)}),rules:[{required:!0,message:""}]}),(0,Oe.jsx)(zt.u,{label:t("pc_stickers_release_tag_set_web"),placeholder:t("please_enter_the_label_enter_key_to_confirm_the_input_web"),disabled:!0,field:"single.tags",max:15,itemType:p.Ab.TextTemplate,rules:[{required:!0,message:""}]})]}):null})),Jt=(0,l.Pi)((e=>{const{className:t}=e,o=Pe(),{t:l}=(0,r.$)(),n=(0,Ee.Z)((()=>{})),s=(0,i.useRef)(null);return(0,ke.O)({className:t,layout:o.mainFormLayout,uploadAreaProps:{titleForUploadArea:"",titleForMainForm:l("pc_text_template_add_click_web"),draggingDisabled:!0,disabled:!1,onClick:o.openOnlineTextTemplatePicker,onDrop:n},setFormApi:o.setFormApi,renderImportArea:e=>(0,Oe.jsxs)(Oe.Fragment,{children:[e,(0,Oe.jsx)(Ze.S,{title:l("pc_text_template_collection_web")}),(0,Oe.jsx)(it,{}),(0,Oe.jsx)(Ze.S,{title:l("pc_text_template_n_collection_web",{X:o.textTemplateIds.length})}),(0,Oe.jsx)(wt,{})]}),renderFormArea:()=>o.isCollectionCardSelected?(0,Oe.jsx)(Wt,{}):o.selectedTextTemplate?(0,Oe.jsx)(Yt,{}):null,scrollAreaRef:s,onRetry:o.retryInit})}));var Gt=o(85877),Kt=o(15906);const Qt=(0,l.Pi)((e=>{const{className:t}=e,o=Pe(),{t:l}=(0,r.$)(),n=(0,i.useRef)(null);return(0,Oe.jsxs)(Oe.Fragment,{children:[(0,Oe.jsx)(Gt.P,{className:t,leftText:l("pc_text_template_import_web",{X:o.textTemplateIds.length,Y:3,Z:20}),isPublishDisabled:!o.isReadyToPublish,isPublishing:o.isPublishing,needConfirmModalOnClose:o.needConfirmModalOnClose,onPublish:()=>o.uploadAndPublish(n.current),onCancel:()=>(0,T.gk)({showHomePage:!0})}),(0,Oe.jsx)(Kt.q,{ref:n,uploadStats:o.uploadStats,onRetryUpload:o.retryUpload,onCancel:o.isAllUploadedWatcher.stop,onShowUploadFail:()=>{},onPromptConfirmToCancel:o.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var eo=o(39931),to=o(71025),oo=o(67037);const lo=(0,l.Pi)((e=>{const t=Te(),{t:o}=(0,r.$)();return(0,eo.F)({title:o("pc_text_template_collection_release_web"),pid:"publish-text-template-collection"}),(0,to.d)(),(0,Oe.jsx)(Ne.Provider,{value:t,children:(0,Oe.jsxs)("div",{className:oo.Z.page,children:[(0,Oe.jsxs)("div",{className:oo.Z.content,children:[(0,Oe.jsx)(Ie,{className:oo.Z.instruction}),(0,Oe.jsx)(Jt,{className:oo.Z.mainForm})]}),(0,Oe.jsx)(Qt,{className:oo.Z.footer})]})})}))},55326:(e,t,o)=>{"use strict";o.d(t,{Qt:()=>l,cF:()=>i});o(18571);let l=function(e){return e.TagEachUser="TagEachUser",e.UseHasAgree="useHasAgree",e}({});const r={TagEachUser:20};function i(e,t,o=r[e]){return{get:()=>JSON.parse(localStorage.getItem(e)||"{}")[t]||[],set:(l,r)=>{const i=JSON.parse(localStorage.getItem(e)||"{}"),n=i[t]||[];let s=[];"add"===l?(Array.isArray(r)?n.unshift(...r):n.unshift(r),s=Array.isArray(r)?Array.from(new Set(n.slice(0,o))):r):"remove"===l?s=n.filter((e=>Array.isArray(r)?r.includes(e):e!==r)):"change"===l&&(s=r),i[t]=s;const a=JSON.stringify(i);localStorage.setItem(e,a)}}}},18751:(e,t)=>{var o;!function(){"use strict";var l={}.hasOwnProperty;function r(){for(var e="",t=0;t<arguments.length;t++){var o=arguments[t];o&&(e=n(e,i(o)))}return e}function i(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return r.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var o in e)l.call(e,o)&&e[o]&&(t=n(t,o));return t}function n(e,t){return t?e?e+" "+t:e+t:e}e.exports?(r.default=r,e.exports=r):void 0===(o=function(){return r}.apply(t,[]))||(e.exports=o)}()}}]);