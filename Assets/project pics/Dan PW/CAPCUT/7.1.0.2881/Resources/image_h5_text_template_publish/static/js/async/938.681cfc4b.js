"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[938],{62027:(e,t,i)=>{i.d(t,{YW:()=>w,ZP:()=>b,rr:()=>y});var s=i(18571),a=i(65625),r=i(18751),n=i.n(r),l=i(79292),o=i(9995),c=i(56220),d=i(79337),u=i(69687),p=i(84312),m=i(71995),f=i(92304),h=i(95108),g=i(24307),v=i(72322);let w=function(e){return e.Origin="originUserAuthProtocol",e.OriginalForSubscription="originalWorkProtocolForSubscription",e.OriginalForCommercial="originalWorkProtocolForCommercial",e.Creator="createProtocol",e.AuthorAgreement="AuthorAgreementProtocol",e}({});const _={[w.Origin]:(0,p.OD)(),[w.OriginalForSubscription]:(0,p.OD)(),[w.OriginalForCommercial]:(0,p.NZ)(),[w.Creator]:(0,p.dr)({}),[w.AuthorAgreement]:(0,p.kx)()},y={[w.Origin]:"Original Work Notice",[w.OriginalForSubscription]:"Original Work Notice",[w.OriginalForCommercial]:"Original Work Notice",[w.Creator]:l.I18n.t("pc_capcut_creator_agreement_web"),[w.AuthorAgreement]:l.I18n.t("cc_pc_material_publish_paid_authorize_popup_title_web")},x=(0,a.Pi)((({onCancel:e,onOk:t,protocol:i,handleBtnText:a,closeIcon:r=!1,needReview:l=!0,useIframe:c=!0,needHasRead:p=!0,renderConfirmExtra:w,getCanConfirmExtra:x})=>{const{t:b}=(0,o.$)(),[F,T]=(0,s.useState)(!1),[C,S]=(0,s.useState)(!1),k=!p||F,I=()=>!l||k&&C&&(!x||x()),{handleMouseEnter:N}=(0,f.w)({content:b("pc_template_authorize_read_all_web"),cursor:"not-allowed"}),R=(0,s.useRef)(null),E={disabled:!k,handleMouseEnter:!l||k?void 0:N},Z=()=>{I()&&(null==t||t())};(0,s.useEffect)((()=>{const e=e=>{const t=e.data;try{const e=JSON.parse(t),i=document.getElementById("protocol-content"),s="protocal"===e.from||"protocol"===e.from;if(s&&"load"===e.event)if(i){const{clientHeight:t}=i;e.scrollHeight<=t&&T(!0)}else T(!0);s&&"bottom"===e.event&&T(!0)}catch(i){T(!0),(0,m.RF)("[Protocol] handle protocol message",i,{text:t})}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[]);const O=()=>{if(R.current&&!c){const{scrollHeight:e,clientHeight:t,scrollTop:i}=R.current;!k&&i+t>=e&&T(!0)}};return(0,s.useEffect)((()=>{var e;return null===(e=R.current)||void 0===e||e.addEventListener("scroll",O),()=>{var e;null===(e=R.current)||void 0===e||e.removeEventListener("scroll",O)}}),[R.current]),(0,s.useLayoutEffect)((()=>{const e=document.getElementById("protocol-content");if(e&&!c){const{scrollHeight:t,clientHeight:i}=e;T(!(t>i)),R.current=e}}),[]),(0,v.jsxs)("div",{className:h.Z.protocol,children:[(0,v.jsxs)("div",{className:g.Z.root,children:[(0,v.jsx)("div",{className:g.Z.title,children:y[i]}),(0,v.jsx)("div",{className:g.Z.right,children:r&&(0,v.jsx)(u.r,{className:g.Z.closeIcon,onClick:()=>{null==e||e("close")}})})]}),(0,v.jsx)("div",{className:n()(h.Z.content,!l&&h.Z.withBorder,l&&h.Z.flexHeight),id:"protocol-content",children:c?(0,v.jsx)("iframe",{id:"frame",src:_[i]}):(0,v.jsx)("div",{className:h.Z.protocolContent,children:null})}),a&&l?(0,v.jsxs)("div",{className:h.Z.confirmArea,children:[(0,v.jsx)(d.XZ,{className:h.Z.confirmCheckbox,checked:C,disabled:E.disabled,onMouseEnter:E.handleMouseEnter,onChange:e=>S(Boolean(e.target.checked)),autoFocus:!1,children:(0,v.jsx)("span",{className:h.Z.confirmCheckboxText,children:b("pc_template_authorize_read_agree_web",{X:(0,v.jsx)("span",{className:h.Z.confirmCheckboxProtocolTitle,children:y[i]},"X")})})}),null==w?void 0:w()]}):null,(()=>{const e=a;return e?(0,v.jsx)("div",{className:n()(h.Z.footer,l&&h.Z.withBorder),children:(0,v.jsx)(d.zx,{className:h.Z.btn,type:"primary",theme:"solid",disabled:!I(),onClick:Z,children:e})}):null})()]})})),b=e=>{const{onCancel:t,onOk:i}=e,[a,r]=(0,s.useState)(!1),[n,l]=(0,s.useState)({}),u=(0,s.useRef)({}),{i18n:p,t:m}=(0,o.$)(),f=e=>{null==t||t(e),r(!1)},h=()=>{n.withoutReview||null==i||i(),r(!1)};return(0,s.useEffect)((()=>()=>{var e,t;return null==u||null===(e=u.current)||void 0===e||null===(t=e.destroy)||void 0===t?void 0:t.call(e)}),[]),(0,s.useEffect)((()=>{var t,i;a?(()=>{const t={...e,...n.withoutReview&&{handleBtnText:m("pc_i_see_web"),needReview:!1,closeIcon:!0}},{destroy:i}=d.u_.info({width:376,height:e.needReview?"auto":564,maskClosable:!1,header:null,title:null,icon:null,centered:!0,content:(0,v.jsx)(c.a,{i18n:p,children:(0,v.jsx)(x,{...t,onCancel:f,onOk:h})}),footer:null});u.current.destroy=i})():null==u||null===(t=u.current)||void 0===t||null===(i=t.destroy)||void 0===i||i.call(t)}),[a]),{visible:a,showModal:()=>{r(!0),l({})},showModalWithoutReview:()=>{r(!0),l({withoutReview:!0})}}}},69434:(e,t,i)=>{i.d(t,{_:()=>h,Z:()=>g});var s=i(18571),a=i(18751),r=i.n(a),n=i(9995),l=i(92304),o=i(8318);const c="root-Hmk_Iv",d="fieldLabel-OCVTxU",u="useAll-oywefT",p="showRequired-ORkP2V",m="box-eWwoEb";var f=i(72322);const h=(0,s.memo)((e=>{const{text:t,className:i}=e,{handleMouseEnter:s}=(0,l.S)({content:({target:e})=>e.textContent});return(0,f.jsx)("div",{className:r()(o.Z.label,i),onMouseEnter:s,children:t})})),g=e=>{const{t}=(0,n.$)(),{className:i,boxClassName:s,title:a,children:l,onClickUseAll:o,hiddenFieldLabel:h=!1,required:g=!1}=e;return(0,f.jsxs)("div",{className:r()(c,i),children:[!h&&(0,f.jsxs)("div",{className:d,children:[(0,f.jsx)("div",{className:r()({[p]:g}),children:null!=a?a:t("pc_template_authorize_settings_web")}),o&&(0,f.jsx)("span",{className:u,onClick:o,children:t("pc_material_release_apply_all")})]}),(0,f.jsx)("div",{className:r()(m,s),children:l})]})}},89252:(e,t,i)=>{i.d(t,{ir:()=>_});var s=i(18571),a=i(18751),r=i.n(a),n=i(9995),l=i(61673),o=i(33311),c=i(6109),d=i(33310),u=i(92304),p=i(7059),m=i(605),f=i(72322);const h=e=>{const{className:t,loadingText:i}=e,{t:s}=(0,n.$)(),{handleMouseEnter:a}=(0,u.S)();return(0,f.jsxs)("div",{className:r()(m.Z.root,t),children:[(0,f.jsx)(d.a,{className:m.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,f.jsx)("div",{className:m.Z.text,onMouseEnter:a,children:i||s("pc_stickers_release_in_web")})]})},g=e=>{const{className:t,tooltip:i}=e,{t:a}=(0,n.$)(),{handleMouseEnter:o}=(0,u.w)({content:i,className:m.Z.tooltip}),c=(0,s.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:h}=(0,p.J)({text:a("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,f.jsxs)("div",{className:r()(m.Z.root,t,m.Z.error),onMouseEnter:e=>{d(!0),o(e)},onMouseLeave:()=>d(!1),children:[(0,f.jsx)(l.r,{className:m.Z.icon}),(0,f.jsx)("div",{ref:c,className:m.Z.text,children:h})]})},v=e=>{const{className:t,text:i}=e,{handleMouseEnter:s}=(0,u.S)();return(0,f.jsxs)("div",{className:r()(m.Z.root,t,m.Z.checked),children:[(0,f.jsx)(c.r,{className:m.Z.icon}),(0,f.jsx)("div",{className:m.Z.text,onMouseEnter:s,children:i})]})},w=e=>{const{className:t}=e,{t:i}=(0,n.$)(),{handleMouseEnter:s}=(0,u.S)();return(0,f.jsxs)("div",{className:r()(m.Z.root,t),children:[(0,f.jsx)("div",{className:r()(m.Z.icon,m.Z.yellowIcon),children:(0,f.jsx)("div",{className:m.Z.yellowPoint})}),(0,f.jsx)("div",{className:m.Z.text,onMouseEnter:s,children:i("pc_stickers_release_editing_web")}),(0,f.jsx)(o.r,{className:m.Z.icon})]})},_=e=>{const{className:t,loading:i,invalid:s,errorToolip:a,isInfoComplete:r,title:n,loadingText:l}=e;return i?(0,f.jsx)(h,{className:t,loadingText:l}):s?(0,f.jsx)(g,{className:t,tooltip:a}):r?(0,f.jsx)(v,{className:t,text:n}):(0,f.jsx)(w,{className:t})}},58861:(e,t,i)=>{i.d(t,{v:()=>C});var s=i(18571),a=i(65625),r=i(75255),n=i(18751),l=i.n(n),o=i(79337),c=i(9995),d=i(56220),u=i(60963),p=i(98227),m=i(15027),f=i(71995),h=i(54275),g=i(75107);let v;const w=new WeakMap;function _(e){let t=w.get(e);return t||(t=new Set,w.set(e,t)),t}const y="46px",x="2px",b={macos:"macos",windows:"windows",heycanRatioGroupEllipsis:"heycan-ratio-group-ellipsis",heycanCheckboxEllipsis:"heycan-checkbox-ellipsis",heycanFormFieldEllipsis:"heycan-form-field-ellipsis",heycanPopoverWrapperClearStyle:"heycan-popover-wrapper-clear-style",heycanTextareaThemeGrey:"heycan-textarea-theme-grey",heycanInputThemeGrey:"heycan-input-theme-grey",frameWidth:"46px",sliderWidth:"2px",modal:"modal-iFkPHk",root:"root-Zq2UXx",title:"title-RjRwF3",content:"content-pMppxf",loading:"loading-J12Xi0",footer:"footer-otMNTQ",buttonContainer:"buttonContainer-aC2XIN",button:"button-ekKG5u",previewImg:"previewImg-tCoExU",invisible:"invisible-Kg_ArH",frameViewer:"frameViewer-cEhK3e",frameList:"frameList-YrZVfi",frame:"frame-XEvw9I",slider:"slider-RraD19",isSliding:"isSliding-I3_Tp0"};var F=i(72322);const T=(0,a.Pi)((e=>{const{fetchData:t,onOK:i,onClose:a}=e,n=(0,r.fv)((()=>({dataFrameList:[],dataFrameIndex:0,setDataFrameIndex(e){n.dataFrameIndex=Math.max(0,Math.min(e,n.dataFrameList.length-1))},fetchOp:new m.q({fetchFirstPage:async()=>{const{list:e,index:i}=await t();return()=>{n.dataFrameList=e,n.dataFrameIndex=i,n.initSliderIfNeeded()}},slardarErrorLog:(e,t,i)=>(0,f.RF)(`[FramePicker] ${e} failed`,t,i)}),frameListWidth:0,halfSliderWidth:Number.parseInt(x,10)/2,frameWidth:Number.parseInt(y,10),get frameList(){const{dataFrameList:e,frameListWidth:t}=n;if(!e.length||!t)return[];const i=Math.ceil(t/n.frameWidth);return Array(i).fill(0).map(((t,s)=>{if(0===s)return e[0];if(s===i-1)return e[e.length-1];{const t=Math.floor(e.length*(s+.5)/i);return e[t]}}))},setWidth(e){n.frameListWidth=e,n.initSliderIfNeeded()},sliderCenterOffset:0,initSliderIfNeeded(){const{dataFrameList:e,frameListWidth:t}=n;e.length&&t&&(n.dataFrameIndex===n.dataFrameList.length-1?n.setSliderCenterOffset(t):n.setSliderCenterOffset(t*n.dataFrameIndex/n.dataFrameList.length))},setSliderCenterOffset(e){const t=n.halfSliderWidth,i=n.frameListWidth-n.halfSliderWidth;n.sliderCenterOffset=Math.max(t,Math.min(i,e))},handleOK(){i(n.dataFrameIndex)}}))),{handleRef:d}=function(e){const t=(0,h.Z)(((t,i)=>e.onResize(t,i))),i=(0,s.useMemo)((()=>({element:null,observer:(v||(v=new g.Z((e=>{let t=null;if(e.forEach((e=>{const i=_(e.target),s=e.target.getBoundingClientRect();i.forEach((e=>{try{e.props.onResize(s,e)}catch(i){null===t&&(t=i)}}))})),null!==t)throw t}))),v),props:{onResize:t},rect:null,unobserve:null})),[]),a=(0,h.Z)((e=>{var t;null===(t=i.unobserve)||void 0===t||t.call(i),e&&(i.observer.observe(e),i.element=e,i.rect=null,_(e).add(i),i.unobserve=()=>{i.unobserve=null,i.element=null,i.rect=null,i.observer.unobserve(e),_(e).delete(i)})}));return(0,s.useLayoutEffect)((()=>{if(i.element){const e=i.element.getBoundingClientRect();i.rect=null,t(e,i)}}),[]),(0,s.useEffect)((()=>()=>{var e;null===(e=i.unobserve)||void 0===e||e.call(i)}),[]),{resizeData:i,handleRef:a}}({onResize:(e,t)=>{t.element&&n.setWidth(t.element.clientWidth)}}),w=(0,s.useRef)(null),T=(0,s.useRef)({isSliding:!1,destroy:null}),C=e=>{var t,i;if(null===(t=(i=T.current).destroy)||void 0===t||t.call(i),!w.current)return;const s=w.current.getBoundingClientRect().left,a=(0,u.aD)((e=>{T.current.isSliding||(document.body.classList.add(b.isSliding),T.current.isSliding=!0),e.preventDefault(),n.setSliderCenterOffset(e.clientX-s);const t=Math.floor(n.dataFrameList.length*n.sliderCenterOffset/n.frameListWidth);n.setDataFrameIndex(t)})),r=()=>{var e,t;null===(e=(t=T.current).destroy)||void 0===e||e.call(t)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",r),a(e.nativeEvent),T.current.destroy=()=>{T.current.destroy=null,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",r),T.current.isSliding=!1,document.body.classList.remove(b.isSliding)},document.activeElement instanceof HTMLElement&&document.activeElement.blur()};(0,s.useEffect)((()=>{n.fetchOp.initFetchFirstPage(null)}),[]);const{isPending:S}=n.fetchOp.fetchStatus,k=n.frameList.length>0,{t:I}=(0,c.$)();return(0,F.jsxs)("div",{className:b.root,children:[(0,F.jsx)("div",{className:b.title,children:I("pc_stickers_release_cover_edit_web")}),S?(0,F.jsx)("div",{className:b.loading,children:(0,F.jsx)(p.Y,{status:"loading",children:I("loading_web")})}):(0,F.jsxs)("div",{className:b.content,children:[(0,F.jsx)("img",{className:l()(b.previewImg,!k&&b.invisible),src:k?n.dataFrameList[n.dataFrameIndex]:""}),(0,F.jsxs)("div",{ref:w,className:b.frameViewer,onMouseDown:C,children:[(0,F.jsx)("div",{ref:d,className:b.frameList,children:n.frameList.map(((e,t)=>(0,F.jsx)("img",{src:e,className:b.frame},t)))}),k&&(0,F.jsx)("div",{className:b.slider,style:{left:n.sliderCenterOffset}})]})]}),(0,F.jsx)("div",{className:b.footer,children:(0,F.jsxs)("div",{className:b.buttonContainer,children:[(0,F.jsx)(o.zx,{className:b.button,type:"primary",theme:"solid",disabled:!k,onClick:n.handleOK,children:I("pc_text_template_complete_web")}),(0,F.jsx)(o.zx,{className:b.button,type:"secondary",theme:"solid",onClick:a,children:I("pc_text_template_cancel_n_web")})]})})]})}));function C(){const{i18n:e}=(0,c.$)(),t=(0,s.useRef)(null);return(0,s.useEffect)((()=>()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}),[]),{openFramePicker:i=>{var s;const a=o.u_.info({width:"auto",height:"auto",header:null,footer:null,centered:!0,maskClosable:!1,closable:!1,className:b.modal,icon:null,closeOnEsc:!1,content:(0,F.jsx)(d.a,{i18n:e,children:(0,F.jsx)(T,{...i,onOK:e=>{var s;i.onOK(e),null===(s=t.current)||void 0===s||s.call(t)},onClose:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}})})});return null===(s=t.current)||void 0===s||s.call(t),t.current=()=>{t.current=null,a.destroy()},a}}}},80495:(e,t,i)=>{var s=i(18571),a=i(79337),r=i(67411),n=i(79292),l=i(9995),o=i(18751),c=i.n(o),d=i(42012),u=i(55326),p=i(62027);let m=function(e){return e[e.Deleted=22]="Deleted",e[e.Offline=23]="Offline",e[e.Banned=25]="Banned",e[e.Online=102]="Online",e[e.Reviewing=141]="Reviewing",e[e.SelfView=144]="SelfView",e[e.HomepageOnline=103]="HomepageOnline",e}({}),f=function(e){return e[e.Unknown=0]="Unknown",e[e.WaitReview=1]="WaitReview",e[e.RiskReviewing=2]="RiskReviewing",e[e.QualityReviewing=3]="QualityReviewing",e[e.RiskReviewFailed=4]="RiskReviewFailed",e[e.QualityReviewFailed=5]="QualityReviewFailed",e[e.CopyrightReviewing=6]="CopyrightReviewing",e[e.CopyrightReviewFailed=7]="CopyrightReviewFailed",e[e.Passed=100]="Passed",e}({});const{t:h}=n.I18n;let g=function(e){return e.all="all",e.paster="paster",e.wordart="wordart",e.soundEffect="soundEffect",e.textTemplate="textTemplate",e.subtitleTemplate="subtitleTemplate",e.video="video",e.stickerFramePack="sticker_frame_zip",e.emoticons="emoticons",e.formula="formula",e.filter="filter",e.filterCollection="filter_collection",e.stickerCollection="sticker_collection",e}({});let v=function(e){return e[e.all=0]="all",e[e.wordart=1]="wordart",e[e.paster=2]="paster",e[e.soundEffect=3]="soundEffect",e[e.video=4]="video",e[e.Song=5]="Song",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Filter=12]="Filter",e[e.StickerCollection=102]="StickerCollection",e[e.FilterCollection=112]="FilterCollection",e[e.emoticons=105]="emoticons",e[e.stickerFramePack=1e3]="stickerFramePack",e[e.formula=50]="formula",e}({});v.all,g.all,v.paster,g.paster,v.wordart,g.wordart,v.soundEffect,g.soundEffect,v.video,g.video,v.emoticons,g.emoticons,v.formula,g.formula,v.Filter,g.filter,v.FilterCollection,g.filterCollection,v.TextTemplate,g.textTemplate,v.SubtitleTemplate,g.subtitleTemplate,v.StickerCollection,g.stickerCollection,g.wordart,v.wordart,g.paster,v.paster,g.soundEffect,v.soundEffect,g.video,v.video,g.emoticons,v.emoticons,g.formula,v.formula,g.filter,v.Filter,g.filterCollection,v.FilterCollection,g.textTemplate,v.TextTemplate,v.SubtitleTemplate,g.subtitleTemplate,g.stickerCollection,v.StickerCollection,g.all,g.paster,g.wordart,g.soundEffect,g.video,g.emoticons,g.formula,v.paster,v.StickerCollection,v.wordart,v.soundEffect,v.video,v.stickerFramePack,v.emoticons,v.formula,v.Image,v.Special,v.FaceSpecial,v.TextTemplate,v.SubtitleTemplate,v.Filter,v.FilterCollection,v.paster,v.wordart,v.soundEffect,v.video,v.emoticons,v.TextTemplate,v.SubtitleTemplate;let w=function(e){return e[e.default=0]="default",e[e.latest=1]="latest",e[e.hotest=2]="hotest",e}({});w.default,w.latest,w.hotest,v.all,v.paster,v.video,v.soundEffect,v.wordart;m.Offline,m.Online,m.HomepageOnline,m.HomepageOnline,f.Passed,f.Passed,m.Reviewing,m.SelfView,m.HomepageOnline,m.SelfView,f.WaitReview,f.RiskReviewing,f.QualityReviewing,f.CopyrightReviewing,m.HomepageOnline,f.WaitReview,f.RiskReviewing,f.QualityReviewing,f.CopyrightReviewing,f.WaitReview,f.RiskReviewing,f.QualityReviewing,f.CopyrightReviewing,m.HomepageOnline,m.SelfView,m.Banned,m.HomepageOnline,f.Unknown,f.RiskReviewFailed,f.QualityReviewFailed,f.CopyrightReviewFailed,m.SelfView,f.Unknown,f.RiskReviewFailed,f.QualityReviewFailed,f.CopyrightReviewFailed,f.Passed,f.Unknown,f.RiskReviewFailed,f.QualityReviewFailed,f.CopyrightReviewFailed,m.HomepageOnline,f.QualityReviewFailed,f.CopyrightReviewFailed,m.SelfView,f.QualityReviewFailed,f.CopyrightReviewFailed,f.Passed;let _=function(e){return e[e.Douyin=0]="Douyin",e[e.Heycon=1]="Heycon",e[e.VideoCut=2]="VideoCut",e[e.WebVideoCut=3]="WebVideoCut",e[e.Ulike=4]="Ulike",e[e.Effect=5]="Effect",e}({});_.Douyin,_.Heycon,_.VideoCut,_.WebVideoCut,_.Ulike,_.Effect,_.Douyin,_.Heycon,_.VideoCut,_.WebVideoCut,_.Ulike,_.Effect,_.Douyin,_.Heycon,_.VideoCut,_.WebVideoCut,_.Ulike,_.Effect;const y="originFlag-Lhtbs4",x="row-yLNK03",b="help-yUKWDh";var F=i(72322);const T={[v.paster]:n.I18n.t("original_stickers_web"),[v.SubtitleTemplate]:n.I18n.t("pc_subtitle_original"),[v.TextTemplate]:n.I18n.t("pc_text_template_origial_material_web"),[v.wordart]:n.I18n.t("original_cursive"),[v.soundEffect]:n.I18n.t("pc_material_release_original_material"),[v.Filter]:n.I18n.t("pc_material_release_original_material"),[v.Special]:n.I18n.t("pc_material_release_original_material")},C=e=>{const{value:t,onChange:i,...n}=e,[o,m]=(0,s.useState)([]),{t:f}=(0,l.$)(),{itemType:h,className:g,checkboxCls:v}=e,{get:w,set:_}=(0,u.ZP)(u.Qt.UseHasAgree,d.$.userInfo.uid),{showModal:C}=(0,p.ZP)({handleBtnText:f("pc_i_see_web"),needReview:!1,protocol:p.YW.Origin,onOk:()=>{if(!d.$.userInfo.uid)return;_("add",[p.YW.Origin]);const e=w();m(e)}});return(0,s.useEffect)((()=>{if(d.$.userInfo.uid){const e=w();m(e)}}),[d.$.userInfo.uid]),(0,F.jsx)("div",{className:c()([y,g]),children:(0,F.jsxs)("div",{className:x,children:[(0,F.jsx)(a.XZ,{...n,checked:t,className:v,onChange:e=>{e.target.checked&&(o.includes(p.YW.Origin)||C()),null==i||i(e.target.checked)},children:T[h]}),(0,F.jsx)(r.Z,{size:"small",className:b,onClick:C})]})})};(0,a.Q2)(C)},58845:(e,t,i)=>{i.d(t,{M:()=>p});var s=i(65625),a=i(18751),r=i.n(a),n=i(85543),l=i(89252),o=i(65284);const c="root-ITIgwH",d="statusBar-PBKTou";var u=i(72322);const p=(0,s.Pi)((e=>{const{className:t,flowerText:i,isSelected:s,onClick:a}=e;return(0,u.jsxs)("div",{className:r()(c,t),onClick:()=>{a(i)},children:[(0,u.jsx)(n.Y,{src:(0,o.Pc)(i).cover.src,isInvalid:!1,isSelected:s,size:80,onContextMenu:e=>{e.preventDefault(),a(i)}}),(0,u.jsx)(l.ir,{className:d,loading:!1,invalid:!1,errorToolip:"",isInfoComplete:(0,o.QX)(i),title:i.title})]})}))},43738:(e,t,i)=>{i.d(t,{p:()=>_});var s=i(18571),a=i(60963),r=i(65625),n=i(9995),l=i(79337),o=i(85543),c=i(12625),d=i(23725),u=i(65751),p=i(39106),m=i(65284),f=i(35178);const h="root-ti0rBz",g="cover-FWyxQo",v="titleField-gXEG6N";var w=i(72322);const _=(0,r.Pi)((e=>{const{flowerText:t,initFlowerTextForm:i,applyTagsToAll:r,maxTitleLength:_}=e,{t:y}=(0,n.$)();(0,s.useLayoutEffect)((()=>{i(t)}),[]);const{getDisplayLength:x}=(0,p._)(),b=(0,m.Pc)(t);return(0,w.jsxs)("div",{className:h,children:[(0,w.jsx)(o.Y,{className:g,src:b.cover.src,isInvalid:!1,isSelected:!1,size:128}),(0,w.jsx)(c.l,{fieldClassName:v,label:y("pc_text_template_name_n_web"),field:"flowerText.title",maxLength:_,allowEnter:!1,placeholder:y("pc_stickers_release_xy_name_web",{X:1,Y:x(_)}),rules:[{required:!0,message:""}],onChange:(0,a.aD)((e=>t.title=e))}),(0,w.jsx)(d.u,{label:(0,w.jsxs)("div",{className:f.Z.labelHeader,children:[(0,w.jsx)(l.Form.Label,{required:!0,children:y("pc_text_template_tag_settings_web")}),(0,w.jsx)("div",{className:f.Z.applyToAll,tabIndex:-1,onClick:()=>r([...t.tags]),children:y("pc_text_template_apply_all_effect_web")})]}),placeholder:y("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"flowerText.tags",itemType:u.Ab.WordArt,recommendConfig:{title:t.title,uri:b.cover.uri},ignoreAddTagOnBlurSelector:`.${f.Z.applyToAll}`,onChange:(0,a.aD)((e=>t.tags=e))})]})}))},62185:(e,t,i)=>{i.d(t,{B:()=>C});var s=i(18571),a=i(60963),r=i(65625),n=i(75255),l=i(79292),o=i(9995),c=i(18751),d=i.n(c),u=i(79337),p=i(85543),m=i(92304),f=i(55364);const h="root-j3LlEm",g="cover-jaNzlL",v="title-U5EHzZ",w="main-MmgxyZ",_="container-WuIo82",y="language-pBRH5f",x="checkbox-QAUlOy",b="langText-So03cx";var F=i(72322);const T={zh:l.I18n.t("pc_text_tamplate_language_cn_web"),en:l.I18n.t("pc_text_tamplate_language_en_web"),ja:l.I18n.t("pc_text_tamplate_language_jp_web"),ko:l.I18n.t("pc_text_tamplate_language_kr_web")},C=(0,r.Pi)((e=>{const{className:t,loading:i,languages:r,onToggleSelection:l}=e,c=(0,n.fv)((()=>({coverSrcMap:new Map,copyCoverSrcFromProps(e){const t=new Set;for(const i of e.languages){const{src:e}=i.cover;e&&(t.add(e),c.coverSrcMap.has(e)||(c.coverSrcMap.set(e,""),c.copyOneCoverSrc(e)))}for(const[i,s]of c.coverSrcMap)t.has(i)||(c.destroyCopyedSrc(s),c.coverSrcMap.delete(i))},async copyOneCoverSrc(e){if(e.startsWith("data:"))return void c.coverSrcMap.set(e,e);const t=await(0,f.J9)(e);c.coverSrcMap.has(e)?(0,a.z)((()=>{c.coverSrcMap.set(e,t)})):c.destroyCopyedSrc(t)},destroyCopyedSrc(e){e.startsWith("blob")&&URL.revokeObjectURL(e)},destroy(){for(const e of c.coverSrcMap.values())c.destroyCopyedSrc(e)}})));(0,s.useEffect)((()=>{c.copyCoverSrcFromProps(e)})),(0,s.useEffect)((()=>()=>c.destroy()),[]);const{t:C}=(0,o.$)(),{handleMouseEnter:S}=(0,m.S)({}),k=e=>{if(i)return"";return c.coverSrcMap.get(e.src)||""};return(0,F.jsxs)("div",{className:d()(h,t),children:[(0,F.jsx)("div",{className:v,children:C("pc_text_template_language_version_web")}),(0,F.jsx)("div",{className:w,children:(0,F.jsx)("div",{className:_,children:r.map((({lang:e,cover:t,title:i,isSelected:s})=>(0,F.jsxs)("div",{className:y,onClick:()=>null==l?void 0:l(e),children:[(0,F.jsx)(p.Y,{className:g,src:k(t),isSelected:!1,isInvalid:!1,size:80}),(0,F.jsx)("div",{className:b,onMouseEnter:S,children:i||T[e]}),l&&(0,F.jsx)(u.XZ,{className:x,checked:s})]},e)))})})]})}))},21886:(e,t,i)=>{i.d(t,{D5:()=>d});var s=i(88154),a=(i(18571),i(65751)),r=i(55364),n=i(45394),l=i(44783),o=i(1117);const c={[a.Ab.Sticker]:"sticker",[a.Ab.Filter]:"filter",[a.Ab.FilterCollection]:"filter",[a.Ab.AudioEffect]:"audio",[a.Ab.Video]:"video",[a.Ab.TextTemplate]:"text_template",[a.Ab.SubtitleTemplate]:"caption_template",[a.Ab.WordArt]:"flower",[a.Ab.LocalEffects]:"effect"};class d{constructor({itemType:e,materialCategory:t}){(0,s.Z)(this,"materialTypeParams",{material_category:"",material_type:""}),(0,s.Z)(this,"isCollection",!1),this.isCollection=e>100,this.materialTypeParams={material_category:t||c[e]||"",material_type:e>100?"collection":"single"}}sendPageActionLog(e){(0,l.iL)({...this.materialTypeParams,...e,...this.isCollection&&{collection_detail:e.collection_detail||"collection_all"}})}sendMaterialUploadStatusLog(e){(0,l.j2)({...this.materialTypeParams,...e})}sendMaterialImportErrorLog(e){return(0,l.DV)({...this.materialTypeParams,...e})}sendMaterialPublishErrorLog(e){return(0,l.Sj)(e.map((e=>({...this.materialTypeParams,...e}))))}sendMaterialPublishStatusLog(e,t){var i;const{status:s,error_type:a,cover_type:c,resolution:d,time:u,path:p,targetedActivityId:m}=e,{common_data:f,is_vip:h}=e.publishParams,g=[];return f.is_business&&g.push("business"),h&&g.push("subscribe"),(0,l.$v)({...this.materialTypeParams,status:s,title:f.title,isOriginal:Boolean(f.is_original),tags:f.tags||[],material_format:(0,r.lm)(p),material_size:null===(i=f.file)||void 0===i?void 0:i.size,description:f.description,resolution:d,error_type:a,time:u,cover_type:c,authorize_range:g.join(","),isVipAuthorized:(0,o.$X)(e.publishParams.copyright,n.$x.Vip),isBusinessAuthorized:(0,o.$X)(e.publishParams.copyright,n.$x.Business),is_official_task:f.post_channel===n.iu.Open?0:1,task_id:m,...t})}sendMaterialPublishPageResultLog(e){(0,l.S4)({...this.materialTypeParams,...e})}sendClickSubscriptionCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_subscription":"cancel_check_box_subscription"})}sendSubscriptionStatementLog(e){(0,l.ce)({...this.materialTypeParams,...e})}sendClickCommercialCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_commercial":"cancel_check_box_commercial"})}sendCommercialStatementLog(e){(0,l.Ad)({...this.materialTypeParams,...e})}sendAuthorSignLog(e){(0,l._4)({...this.materialTypeParams,...e})}}},24238:(e,t,i)=>{i.d(t,{T:()=>r});var s=i(88154),a=i(60963);class r{get materials(){return this.ids.map((e=>this.data.get(e)))}get selected(){var e;return this.ids.includes(this.selectedId)&&null!==(e=this.data.get(this.selectedId))&&void 0!==e?e:null}get length(){return this.ids.length}select(e){this.selectedId=e&&this.ids.includes(e.id)?e.id:""}constructor(e){this.options=e,(0,s.Z)(this,"ids",[]),(0,s.Z)(this,"data",new Map),(0,s.Z)(this,"selectedId",""),(0,s.Z)(this,"op",null),(0,a.ky)(this),this.options.createOp&&(this.op=this.options.createOp(this))}get(e){return this.ids.includes(e)&&this.data.get(e)||null}add(...e){for(const t of e)this.ids.includes(t.id)||(this.ids.push(t.id),this.data.set(t.id,t))}replaceByMap(e,t){const i=this.ids;if(e.forEach((e=>{var i;const s=null!==(i=this.data.get(e.id))&&void 0!==i?i:null;this.data.set(e.id,t(e,s))})),this.ids=e.map((e=>e.id)),this.ids.includes(this.selectedId)||(this.selectedId=""),!this.options.keepDataOnDelete){const e=new Set(this.ids);i.filter((t=>!e.has(t))).forEach((e=>this.deleteData(e)))}}delete(e){const t=this.ids.findIndex((t=>t===e.id));-1!==t&&(this.ids.splice(t,1),e.id===this.selectedId&&(this.selectedId=""),this.options.keepDataOnDelete||this.deleteData(e.id))}deleteData(e){var t,i;const s=this.data.get(e);this.data.delete(e),s&&(null===(t=(i=this.options).onDeleteData)||void 0===t||t.call(i,s))}updateAll(e){this.materials.forEach((t=>e(t)))}}},35930:(e,t,i)=>{i.d(t,{Z:()=>p,f:()=>d});var s=i(88154),a=i(31062),r=i(65656),n=i(42012),l=i(71995),o=i(61053),c=i(45394);const d=10;function u(e){return Boolean(e.id)}class p{constructor(){(0,s.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,a.Z)(e,d)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:s,onUpdateResult:a}=e,n=JSON.parse(JSON.stringify(e.req));let o=this.itemMap.get(i);if(null!==(t=o)&&void 0!==t&&t.promise&&(0,r.Z)(o.req,n))try{return await o.promise}catch(c){(0,l.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return o={promise:null,id:i,req:n,onResult:s,onUpdateResult:a},this.itemMap.set(i,o),o.promise=this.publishImpl(o),o.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,s)=>{try{const n={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:s};var a,r;if(u(e.req))await(null===(a=e.onUpdateResult)||void 0===a?void 0:a.call(e,{req:e.req,...n}));else await(null===(r=e.onResult)||void 0===r?void 0:r.call(e,{req:e.req,...n}))}catch(n){(0,l.RF)("[MaterialPublishService] callOnResult failed",n)}};let s;try{s=await this.postOrUpdate(e)}catch(a){throw e.promise=null,i(a,""),a}return await i(null,s.resource_id),s}async postOrUpdate(e){return u(e.req)?(await(0,c.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,c.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new o.B).timeout(5e3)])}catch(t){(0,l.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),s=new o.B,a={count:50,effect_types:t,uid:n.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,c.Js)(a).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await s.timeout(500)}}}},52081:(e,t,i)=>{i.d(t,{L:()=>l});var s=i(71412),a=i(18571),r=i(60963);const n=5e3;function l({watch:e,collect:t}){const i=(0,a.useMemo)((()=>(0,s.Z)((async()=>{await Promise.resolve(),t()}),n)),[]);(0,a.useEffect)((()=>{const t=(0,r.EH)((()=>{e(),i()}));return()=>{t(),i.cancel()}}),[])}},86486:(e,t,i)=>{i.d(t,{N0:()=>R,r:()=>N,B4:()=>S,Dz:()=>k,wt:()=>I});var s=i(88154),a=i(65656),r=i(60963),n=i(71995),l=i(50291),o=i(22816),c=i(33876),d=i(55364),u=i(45394);class p{constructor(){(0,s.Z)(this,"uploadConfigService",null),(0,s.Z)(this,"fileEventDispatcher",null),(0,s.Z)(this,"map",new Map)}init(e){const{uploadConfigService:t,fileEventDispatcher:i}=e;this.uploadConfigService=t,this.fileEventDispatcher=i}async initUpload(e){return this.map.set(e.id,e),this.upload(e.id)}async retryUpload(e){return this.upload(e)}async upload(e){const t={type:"Upload",result:"Error",id:e,uri:"",size:0,md5:"",error:""},{uploadConfigService:i,fileEventDispatcher:s}=this;if(!i||!s){const t=new o.w("not inited",{id:e});throw(0,n.RF)("[SimpleFileUploader] init upload failed",t),t}const a=this.map.get(e);if(!a){const i=new o.w("data not set",{id:e});throw(0,n.RF)("[SimpleFileUploader] init upload failed",i),t.error=i.message,s.dispatch(t),i}const{type:r,file:l}=a,p=async()=>{const{imageUploadConfig:e,videoUploadConfig:t,objectUploadConfig:s}=await i.getUploadConfigs("SimpleFileUploader");let a;return a=r===u.AJ.Image?e:r===u.AJ.Video?t:s,{current_time:a.currentTime,expired_time:a.expiredTime,access_key_id:a.accessKey,secret_access_key:a.secretKey,session_token:a.sessionToken,upload_domain:a.hostDomain,space_name:a.serviceId||a.nameSpace,space_type:a.serviceId?2:1,region:a.region||""}};try{const i=await(0,c.ws)({file:l,getUploadToken:p});t.result="Success",t.uri=i.uploadResult.Uri,t.size=i.fileSize,t.md5=a.withMD5?await(0,d.C3)(l):"",s.dispatch(t),this.map.delete(e)}catch(f){var m;throw(0,n.RF)("[SimpleFileUploader] upload failed",f),t.result="Error",t.uri="",t.size=0,t.error=null!=f&&f.message?`${f.message}, code=${null===(m=f.context)||void 0===m?void 0:m.code}`:JSON.stringify(f||{}),s.dispatch(t),f}}}var m=i(83701),f=i(91449);const h=({frame:e,tempCanvas:t,tempCtx:i,gifCanvas:s,gifCtx:a})=>{const{disposalType:r}=e,{dims:n}=e;t.width=n.width,t.height=n.height;const l=i.createImageData(n.width,n.height);l.data.set(e.patch),1!==r&&a.clearRect(0,0,s.width,s.height),i.putImageData(l,0,0),a.drawImage(t,n.left,n.top);return s.toDataURL("image/png")},g=e=>{const t=[],i=(0,f.vq)(e),s=(0,f.zw)(i,!0),a=document.createElement("canvas"),r=a.getContext("2d"),n=document.createElement("canvas"),l=n.getContext("2d");n.width=s[0].dims.width,n.height=s[0].dims.height;for(let o=0;o<=s.length-1;o++){const e=h({frame:s[o],tempCanvas:a,tempCtx:r,gifCanvas:n,gifCtx:l});t.push(e)}return{base64List:t,gifWidth:n.width,gifHeight:n.height,delay:s[0].delay}};var v=i(61053);async function w(e){const{base64List:t}=await(e=>new Promise((t=>{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{const e=i.response,s=[];if(e){const i=(0,f.vq)(e),a=(0,f.zw)(i,!0),r=document.createElement("canvas"),n=r.getContext("2d"),l=document.createElement("canvas"),o=l.getContext("2d");l.width=a[0].dims.width,l.height=a[0].dims.height;for(let e=0;e<=a.length-1;e++){const t=h({frame:a[e],tempCanvas:r,tempCtx:n,gifCanvas:l,gifCtx:o});s.push(t)}t({base64List:s,gifWidth:l.width,gifHeight:l.height,delay:a[0].delay})}},i.send(null)})))(e);return t}function _(e){const{base64List:t}=g(e);return t}function y(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}function x(e){const t=y(e);let i=0;for(let s=0;s<e.length;s++){const a=e[s];i+=(a-t)*(a-t)}return Math.sqrt(i/e.length)}const b=async e=>{const t=await e.arrayBuffer();return g(t).base64List},F=e=>new Promise(((t,i)=>{const s=new Image;s.src=e,s.setAttribute("crossOrigin","Anonymous"),s.onload=()=>{const e=document.createElement("canvas"),i=e.getContext("2d");e.width=s.width,e.height=s.height,null==i||i.drawImage(s,0,0,e.width,e.height);const a=async function(e){const t=e.width,i=e.height,s=Array(i*t).fill(0),a=Array(i*t).fill(0);let r=0,n=performance.now();for(let u=0;u<i;u++){for(let i=0;i<t;i++){const t=4*(i+u*i),n=e.data[t],l=e.data[t+1],o=e.data[t+2];s[r]=Math.abs(n-l),a[r]=Math.abs((n+l)/2-o),r+=1}performance.now()-n>16&&(await(0,v.N)(),n=performance.now())}await(0,v.N)();const l=y(s),o=x(s),c=y(a),d=x(a);return Math.sqrt(o*o+d*d)+.3*Math.sqrt(l*l+c*c)}(null==i?void 0:i.getImageData(0,0,e.width,e.height));t(a)}}));var T=i(76937),C=i(65284);function S(e){return{id:"",src:"",uri:"",isUploadFailed:!1,file:new File([],""),...e}}function k(e){return{id:"",uri:"",isUploadFailed:!1,file:new File([],""),md5:"",size:0,...e}}function I(e){return{id:"",src:"",uri:"",isUploadFailed:!1,file:new File([],""),index:0,duration:3,list:[],...e}}function N(e,...t){for(const i of t)i.id||null==e.uninited||(e.uninited+=1),i.isUploadFailed?e.failed+=1:i.uri?e.succeeded+=1:e.pending+=1}class R{constructor(e){this.props=e,(0,s.Z)(this,"fileEventDispatcher",new l.r({initData:()=>null})),(0,s.Z)(this,"fileUploader",new p),(0,s.Z)(this,"prevDepResourceIdMap",{}),(0,s.Z)(this,"templateZipCacheMap",new Map),(0,r.ky)(this),this.fileUploader.init({fileEventDispatcher:this.fileEventDispatcher,uploadConfigService:this.props.uploadConfigService})}async initUploadCover(e){const t=e.getCover();if(!t||t.id)return;if((0,m.L)(t,{...e.getInitValues(),uri:"",isUploadFailed:!1}),!t.file.size&&!t.file.name){const e=new o.w("file is empty",{id:t.id});throw(0,n.RF)("[TemplateFileOperator] initUploadCover failed",e),e}const{id:i}=t;this.fileUploader.initUpload({id:i,type:u.AJ.Image,file:t.file}),this.fileEventDispatcher.register("Upload",t.id,(0,r.aD)((t=>{const s=e.getCover();var a;if(!s||s.id!==i)return void(0,n.c6)(`[TemplateFileOperator] cover upload ignored {${i}}`,{coverId:null!==(a=null==s?void 0:s.id)&&void 0!==a?a:"null"});const{uri:r}=t;if(r)s.uri=r,(0,n.c6)(`[TemplateFileOperator] cover upload success {${i}}`,{uri:r});else{s.isUploadFailed=!0;const e=t.error||"unknown";(0,n.RF)(`[TemplateFileOperator] cover upload failed {${i}}`,null,{error:e})}})))}async initUploadFile(e){const{typeName:t}=e,i=e.getFile();if(!i||i.id)return;if((0,m.L)(i,{...e.getInitValues(),uri:"",isUploadFailed:!1,md5:"",size:0}),!i.file.size&&!i.file.name){const e=new o.w("file is empty",{id:i.id,type:t});throw(0,n.RF)("[TemplateFileOperator] initUploadFile failed",e),e}const{id:s}=i;this.fileUploader.initUpload({id:s,type:u.AJ.Object,file:i.file,withMD5:!0}),this.fileEventDispatcher.register("Upload",s,(0,r.aD)((i=>{const a=e.getFile();var r;if(!a||a.id!==s)return void(0,n.c6)(`[TemplateFileOperator] ${t} upload ignored {${s}}`,{fileId:null!==(r=null==a?void 0:a.id)&&void 0!==r?r:"null"});const{uri:l,size:o,md5:c}=i;if(l)a.uri=l,a.size=o,a.md5=c,(0,n.c6)(`[TemplateFileOperator] ${t} upload success {${s}}`,{uri:l});else{a.isUploadFailed=!0;const e=i.error||"unknown";(0,n.RF)(`[TemplateFileOperator] ${t} upload failed {${s}}`,null,{error:e})}})))}retryUpload(...e){for(const t of e)t.id&&t.isUploadFailed&&(t.isUploadFailed=!1,this.fileUploader.retryUpload(t.id))}async getStaticFrame(e,t){if(null==t){const{maxIndex:t,frameList:i}=await(async e=>{var t;let i=[];if("string"==typeof e&&(i=await w(e)),e instanceof ArrayBuffer&&(i=await _(e)),e instanceof File&&(i=await b(e)),null===(t=i)||void 0===t||!t.length)throw new Error("Invalid GIF file");const s=[];let a=0,r=0;for(let n=0;n<i.length;n++){const e=i[n],t=await F(e);s.push(t),t>a&&(a=t,r=n)}return{max:a,maxIndex:r,frameList:i,frame:i[r]}})(e);return{index:t,frameList:i}}return{index:t,frameList:await b(e)}}async initStaticFrame(e){var t;const{id:i,templateZipData:s,staticFrame:a}=e,{coverFile:r}=s.template;(0,n.c6)(`[TemplateFileOperator] getGifColorFrame start {${i}}`);const{index:l,frameList:o}=await this.getStaticFrame(r,null===(t=e.getInitIndex)||void 0===t?void 0:t.call(e));(0,n.c6)(`[TemplateFileOperator] getGifColorFrame done {${i}}`),(0,m.L)(a,{id:"",uri:"",isUploadFailed:!1,src:o[l],index:l,list:o})}updateStaticFrame(e,t){const{list:i}=e;0!==i.length&&(0,m.L)(e,{id:"",uri:"",isUploadFailed:!1,src:i[t],index:t})}saveTemplateZipCache(e,t,i){i.id&&!i.isUploadFailed&&i.uri&&this.templateZipCacheMap.set(`${t}-${e}`,{...i}),(0,m.L)(i,{...k({}),extraJson:{}})}async initUploadTemplateZip(e){const{zipFile:t,templateZipData:i,staticFrame:s,depResourceIdMap:r,checkIsCanceled:l}=e,o=`${e.lang}-${e.id}`,c=this.templateZipCacheMap.get(o),d=(0,a.Z)(r,this.prevDepResourceIdMap);d&&(this.prevDepResourceIdMap=r);const u=s.index/s.list.length*s.duration;if(c&&u===c.previewTime&&d)return(0,m.L)(t,c),void(0,n.c6)(`[TemplateFileOperator] zip reuse cache success {${o}}`,{uri:c.uri});const p=(0,C.ii)(e.lang,i,r),{file:f,extraJson:h}=await i.createNewZipFile({previewTime:u,depResourceIdMap:p});(0,n.c6)(`[SingleStore] createNewZipFile success {${o}}`,{depResourceIdMap:p}),l()||this.initUploadFile({getFile:()=>t,typeName:"zip",getInitValues:()=>({id:(0,T.V)("template-zip"),file:f,previewTime:u,extraJson:h})})}}},97775:(e,t,i)=>{i.d(t,{v:()=>h});var s=i(88154),a=i(17773),r=i.n(a),n=i(59359),l=i(65751);async function o(e,t={}){const i=new(r());return(await i.loadAsync(e,t)).files}var c=i(71995),d=i(88269);async function u(e,t){try{const i=await e.async("blob"),s=await i.text();return(0,d.ZP)(s,t)}catch(i){throw(0,c.RF)("[TextTmp] file error",i,e),i}}i(45394);var p=i(22816);const m="content.json",f="extra.json";l.Ab.Font,l.Ab.Font,l.Ab.WordArt,l.Ab.Sticker;class h{constructor(e){this.options=e,(0,s.Z)(this,"_effectType",void 0),(0,s.Z)(this,"timing",{}),(0,s.Z)(this,"sdkVersion",""),(0,s.Z)(this,"rootFiles",{}),(0,s.Z)(this,"_template",null),(0,s.Z)(this,"flowerTexts",[]),(0,s.Z)(this,"stickers",[]),this._effectType=e.effectType}get effectType(){return this._effectType}get template(){if(!this._template)throw new p.w("template not inited",{id:this.options.id});return this._template}async init(){this.timing.startTime=performance.now();const{id:e,fetchZipBase64:t}=this.options;(0,c.c6)(`[TemplateZipData] init start {${e}}`);let i="";try{[i,this.sdkVersion]=await Promise.all([t(e),(0,n.mI)().then((e=>e.sdk))])}catch(r){throw(0,c.RF)(`[TemplateZipData] fetch from native failed {${e}}`,r),r}this.timing.fetchZipBase64EndTime=performance.now(),(0,c.c6)("[TemplateZipData] fetchZipBase64 done"),this.rootFiles=await o(i,{base64:!0}),this.timing.decompressRootEndTime=performance.now(),(0,c.c6)("[TemplateZipData] decompress root done",{files:Object.keys(this.rootFiles)});const s=[this.initFlowerTexts()],a=this.rootFiles["template_sticker.zip"];if(a){const e=await a.async("blob"),t=await o(e);(0,c.c6)("[TemplateZipData] decompress template_sticker.zip done",{files:Object.keys(t)});const i=t["caption_animation.json"],[r,n,l]=await Promise.all([u(t[f],{}),u(t[m],{root:{duration:3,preview_time:0},children:[]}),i&&u(i,{caption_animation:[]})]);r.depend_resource_list&&(r.depend_resource_list=r.depend_resource_list.filter((e=>e.resource_id))),this._template={files:t,extraJson:r,contentJson:n,captionAnimationJson:l,coverFile:new File([],""),notBusinessEffectTypes:[]},this.timing.decompressTemplateZipEndTime=performance.now(),(0,c.c6)("[TemplateZipData] decompress template.zip done",{files:Object.keys(t),extraJson:r,contentJson:n}),s.push(this.initTemplateFiles(this.template),this.initNonBusinessInfo(this.template),this.initStickers(this.template))}await Promise.all(s),this.timing.endTime=performance.now(),(0,c.c6)(`[TemplateZipData] all done {${e}}`)}async initTemplateFiles(e){const t=await this.rootFiles["preview_gif.gif"].async("blob");e.coverFile=new File([t],"text.gif",{type:"image/gif"}),this.timing.initTemplateFilesEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initTemplateFiles done")}async initNonBusinessInfo(e){}async initFlowerTexts(){const e=this.rootFiles["flower_text.json"];if(!e)return;const{text_template:t=[],local:i=[]}=await u(e,{});if((0,c.c6)("[TemplateZipData] flower_text.json",{text_template:t,local:i}),!t.length&&!i.length)return;const s=await Promise.all(t.map((async e=>{const t=e.local_id,i=this.rootFiles[`${t}.zip`];if(!i)return null;const s=await i.async("blob"),a=new File([s],"flower.zip",{type:"application/zip"}),r=await o(s);if((0,c.c6)(`[TemplateZipData] decompress flower.zip done {${t}}`,{id:t,files:Object.keys(r)}),!r["cover_icon.png"])return null;const n=await r["cover_icon.png"].async("blob"),l=new File([n],"flower.png",{type:"image/png"}),{version:d="1.0.0"}=await u(r["config.json"],{});return{id:t,isDepMaterial:!0,file:a,coverFile:l,sdkVersion:d,groupId:e.group_id||""}})));this.flowerTexts=s.filter((e=>null!==e)),this.timing.initFlowerTextsEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initFlowerTexts done",{flowers:this.flowerTexts.map((e=>e.id))})}async initStickers(e){const t=this.rootFiles["local_sticker.json"];if(!t)return;const{text_template:i=[],local:s=[]}=await u(t,{});(0,c.c6)("[TemplateZipData] local_sticker.json",{text_template:i,local:s});const a=await Promise.all(i.map((async t=>{var i;const s=t.local_id,a="true"===t.is_sequence,r=t.type,n=null===(i=e.contentJson.children)||void 0===i?void 0:i.find((e=>e.name===t.local_id)),l="sticker"===(null==n?void 0:n.type)&&n.sticker_path||"",o=e.files[l];if(!o)return null;const c=await o.async("blob");return{id:s,isDepMaterial:!0,file:new File([c],o.name,{type:`image/${r}`}),isSequence:a}})));this.stickers=a.filter((e=>null!==e)),this.timing.initStickersEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initStickers done",{stickers:this.stickers.map((e=>e.id))})}generateNewTemplateContentJsonChild(e,t){var i;if("text"===e.type&&null!==(i=e.text_params)&&void 0!==i&&i.richText){let i=e.text_params.richText;return Object.entries(t).forEach((([e,t])=>{const s=new RegExp(e,"g");i=i.replace(s,t)})),{...e,text_params:{...e.text_params,richText:i}}}return"sticker"===e.type&&!e.sticker_resource_id&&t[e.name]&&e.sticker_path?{...e,sticker_path:"",sticker_design_type:0,sticker_resource_id:t[e.name]}:e}async createNewZipFile(e){return this._effectType===l.Ab.TextTemplate?this.createNewTextTemplateZipFile(e):this._effectType===l.Ab.SubtitleTemplate?this.createNewSubtitleTemplateZipFile(e):this.createDefaultZipFile()}async createNewTextTemplateZipFile(e){var t;const{previewTime:i,depResourceIdMap:s}=e,{files:a,contentJson:n,extraJson:l}=this.template,o={...n,root:{...n.root,preview_time:i},children:n.children.map((e=>this.generateNewTemplateContentJsonChild(e,s)))},c={...l,depend_resource_list:null===(t=l.depend_resource_list)||void 0===t?void 0:t.map((e=>{const t=s[e.resource_id];return t?{...e,resource_id:t,source:1}:e}))},d=new(r());d.file(m,JSON.stringify(o)),d.file(f,JSON.stringify(c)),d.files={...a,...d.files};const u=await d.generateAsync({type:"blob"});return{file:new File([u],"text_template.zip",{type:"application/zip"}),contentJson:o,extraJson:c}}async createNewSubtitleTemplateZipFile(e){var t;const{previewTime:i,depResourceIdMap:s}=e,{files:a,contentJson:n,extraJson:l}=this.template,o={...n,root:{...n.root,preview_time:i},children:n.children.map((e=>this.generateNewTemplateContentJsonChild(e,s)))};if(n.sub_template_info){const e={...n.sub_template_info,elements:n.sub_template_info.elements.map((e=>({...e,root:{...e.root,preview_time:i},children:e.children.map((e=>this.generateNewTemplateContentJsonChild(e,s)))})))};o.sub_template_info=e}const c={...l,depend_resource_list:null===(t=l.depend_resource_list)||void 0===t?void 0:t.map((e=>{const t=s[e.resource_id];return t?{...e,resource_id:t,source:1}:e}))},d=new(r());d.file(m,JSON.stringify(o)),d.file(f,JSON.stringify(c)),d.files={...a,...d.files};const u=await d.generateAsync({type:"blob"});return{file:new File([u],"text_template.zip",{type:"application/zip"}),contentJson:o,extraJson:c}}async createDefaultZipFile(){const{files:e,contentJson:t,extraJson:i}=this.template,s=new(r());s.file(m,JSON.stringify(t)),s.file(f,JSON.stringify(i)),s.files={...e,...s.files};const a=await s.generateAsync({type:"blob"});return{file:new File([a],"text_template.zip",{type:"application/zip"}),contentJson:t,extraJson:i}}}},65284:(e,t,i)=>{i.d(t,{Id:()=>w,Kl:()=>_,Pc:()=>h,QX:()=>f,Rd:()=>y,Sv:()=>m,Wl:()=>x,er:()=>v,ii:()=>b,wu:()=>g});var s=i(56366),a=i(60963),r=i(86486),n=i(55364),l=i(76937),o=i(71995),c=i(10878),d=i(44783),u=i(45394),p=i(1117);function m(e){const t=e.subFlowerTexts.map(((e,t)=>function(e,t){const{lang:i,data:s}=e,{id:a,coverFile:l,file:o}=s;return{id:a,lang:i,resourceId:"",cover:(0,r.B4)({src:t.needSrc?(0,n.y8)(l):"",file:l}),file:(0,r.Dz)({file:o})}}(e,{needSrc:0===t}))),{isDepMaterial:i,sdkVersion:s}=e.subFlowerTexts[0].data;return(0,a.LO)({id:t[0].id,groupId:e.groupId,isDepMaterial:i,sdkVersion:s,title:"",tags:[],subFlowerTexts:t})}function f(e){return Boolean(e.title&&e.tags.length)}function h(e){return e.subFlowerTexts[0]}function g(e){const{id:t,isDepMaterial:i,isSequence:s,file:a}=e;return{id:t,resourceId:"",isDepMaterial:i,title:"",tags:[],isSequence:s,cover:(0,r.B4)({file:a})}}function v(e,t){for(const i of t.flowerTexts)for(const t of i.subFlowerTexts)e.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:(0,l.V)("flower-text-cover")})}),e.initUploadFile({getFile:()=>t.file,typeName:"zip",getInitValues:()=>({id:(0,l.V)("flower-text-zip")})});for(const i of t.stickers)e.initUploadCover({getCover:()=>i.cover,getInitValues:()=>({id:(0,l.V)("sticker-cover")})})}function w(e,t){for(const i of t.flowerTexts)for(const t of i.subFlowerTexts)e.retryUpload(t.cover,t.file);for(const i of t.stickers)e.retryUpload(i.cover)}function _(e,t,i=[]){return e.map((e=>{let r=e.subFlowerTexts;(null==i?void 0:i.length)>0&&(r=e.subFlowerTexts.filter((e=>i.includes(e.lang))));return r.map((i=>{const{lang:r}=i,n=i.id;return{id:n,req:(0,c.h$)({...(0,s.Z)(e,["tags","sdkVersion"]),...(0,s.Z)(i,["cover","file"]),...t,title:e.title,baseSource:u.r0.UserPostPcInTextTemplate,lang:r}),onResult:(0,a.aD)((({resourceId:e,error:t,req:s,time:a,errorText:l})=>{var c;(0,d.$v)({status:t?"fail":"success",material_category:"flower",material_type:"single",title:s.common_data.title,isOriginal:Boolean(s.common_data.is_original),tags:null!==(c=s.common_data.tags)&&void 0!==c?c:[],time:a,isVipAuthorized:(0,p.$X)(s.copyright,u.$x.Vip),isBusinessAuthorized:(0,p.$X)(s.copyright,u.$x.Business),error_type:l}),t?(0,o.RF)(`[DepMaterial] dep publish failed {${n}}`,t,{lang:r}):(i.resourceId=e,(0,o.c6)(`[DepMaterial] dep publish success {${n}}`,{resourceId:e,lang:r}))}))}}))})).flat()}function y(e,t){const{getTitle:i,...r}=t;return e.map(((e,t)=>{const{id:n}=e,l=i(e,t),d=e.isSequence?u.r0.UserPostPcInTextTemplateSequence:u.r0.UserPostPcInTextTemplate;return{id:n,req:(0,c.td)({...(0,s.Z)(e,["tags","isSequence","cover"]),...r,title:l,baseSource:d}),onResult:(0,a.aD)((({resourceId:t,error:i})=>{i?(0,o.RF)(`[DepMaterial] dep publish failed {${n}}`,i):(e.id===n&&(e.resourceId=t),(0,o.c6)(`[DepMaterial] dep publish success {${n}}`,{resourceId:t,latestId:e.id}))}))}})).flat()}function x(e){const t={};for(const i of e.flowerTexts)for(const e of i.subFlowerTexts)t[`${e.lang}-${e.id}`]=e.resourceId;for(const i of e.stickers)t[i.id]=i.resourceId;return t}function b(e,t,i){const s={};for(const a of t.flowerTexts){const t=`${e}-${a.id}`;a.isDepMaterial&&i[t]&&(s[a.id]=i[t])}for(const a of t.stickers)a.isDepMaterial&&i[a.id]&&(s[a.id]=i[a.id]);return s}},10878:(e,t,i)=>{i.d(t,{Ob:()=>o,h$:()=>n,td:()=>l,xo:()=>c});var s=i(65751),a=i(1117),r=i(45394);function n(e){const{title:t,isHighPriority:i,isVip:r,isBusiness:n,isOriginal:l,tags:o,sdkVersion:c,baseSource:d,cover:u,file:p,lang:m}=e,f=i?`${d}_without_review`:d,h=(0,a.pn)({isVip:r,isBusiness:n});return{effect_type:s.Ab.WordArt,is_vip:r,...h.root,common_data:{title:t,description:t,icon:{image_uri:u.uri},file:{file_md5:p.md5,file_uri:p.uri,size:p.size},sdk_version:c,source:f,tags:o,is_original:l,is_business:n,...h.commonData,...m&&{item_language:m}}}}function l(e){const{title:t,isHighPriority:i,isVip:n,isBusiness:l,isOriginal:o,tags:c,baseSource:d,cover:u}=e,p=i?`${d}_without_review`:d,m=(0,a.pn)({isVip:n,isBusiness:l}),f=u.file.name.split(".").pop();return{effect_type:s.Ab.Sticker,is_vip:n,...m.root,common_data:{title:t,description:t,icon:{image_uri:u.uri},sdk_version:"1.0.0",source:p,tags:c,is_original:o,is_business:l,...m.commonData},sticker:{large_image:{image_uri:u.uri},sticker_type:"gif"===f?r.Ic.Dynamic:r.Ic.Static}}}function o(e){var t,i;const{effectType:n,title:l,tags:o,isHighPriority:c,isVip:d,postChannel:u,targetedActivityId:p,isBusiness:m,isOriginal:f,templateZipData:h,cover:g,staticFrame:v,file:w,lang:_,extraJson:y,authFiles:x,baseSource:b}=e,{sdkVersion:F}=h,T=(0,a.pn)({isVip:d,isBusiness:m,authFiles:x}),C=c?`${b}_without_review`:b,S=n===s.Ab.SubtitleTemplate?"subtitle_template":"text_template";return{effect_type:n,is_vip:d,...T.root,common_data:{title:l,description:l,icon:{image_uri:g.uri,static_uri:v.uri},file:{file_md5:w.md5,file_uri:w.uri,size:w.size},sdk_version:F,source:C,tags:o,is_original:f,is_business:m,post_channel:u===r.iu.Targeted?`${r.iu.Targeted}_${p}`:u,web_extra:JSON.stringify({targeted_id:p}),...T.commonData,..._&&{item_language:_}},[S]:{depend_resource_list:null!==(t=y.depend_resource_list)&&void 0!==t?t:[],script_template_version:null!==(i=y.script_template_version)&&void 0!==i?i:"",...y.texts&&{texts:y.texts}}}}function c(e){const{id:t,title:i,tags:s,isVip:r,isBusiness:n,isOriginal:l,cover:o,staticFrame:c,file:d,authFiles:u,onlineData:p}=e,m=(0,a.sR)({isOriginal:l,isVip:r,isBusiness:n,authFiles:u,onlineData:p});return{id:t,title:i,description:i,icon:{image_uri:o.uri,static_uri:c.uri},file:{file_md5:d.md5,file_uri:d.uri,size:d.size},tags:s,...m}}},13647:(e,t,i)=>{i.d(t,{F:()=>n,K:()=>r});var s=i(42012),a=i(55326);function r(e){const t=s.$.userInfo.uid;return!!t&&(0,a.cF)(a.Qt.UseHasAgree,t).get().includes(e)}function n(e){const t=s.$.userInfo.uid;t&&(0,a.cF)(a.Qt.UseHasAgree,t).set("add",[e])}},55364:(e,t,i)=>{i.d(t,{C3:()=>o,J9:()=>l,Jr:()=>r,lm:()=>c,y8:()=>n});var s=i(57705),a=i.n(s);const r=(e,t="image/png")=>{let i=e;e.startsWith("data:")&&(i=e.split(",")[1]);const s=atob(i),a=new Array(s.length);for(let n=0;n<s.length;n++)a[n]=s.charCodeAt(n);const r=new Uint8Array(a);return new Blob([r],{type:t})},n=e=>URL.createObjectURL(e),l=async e=>{const t=await fetch(e),i=await t.blob();return n(i)};const o=async e=>{const t=await e.arrayBuffer(),i=new Uint8Array(t);return a()(i)},c=e=>e.toLowerCase().split(".").pop()},55326:(e,t,i)=>{i.d(t,{Qt:()=>a,ZP:()=>l,cF:()=>n});var s=i(18571);let a=function(e){return e.TagEachUser="TagEachUser",e.UseHasAgree="useHasAgree",e}({});const r={TagEachUser:20};function n(e,t,i=r[e]){return{get:()=>JSON.parse(localStorage.getItem(e)||"{}")[t]||[],set:(s,a)=>{const r=JSON.parse(localStorage.getItem(e)||"{}"),n=r[t]||[];let l=[];"add"===s?(Array.isArray(a)?n.unshift(...a):n.unshift(a),l=Array.isArray(a)?Array.from(new Set(n.slice(0,i))):a):"remove"===s?l=n.filter((e=>Array.isArray(a)?a.includes(e):e!==a)):"change"===s&&(l=a),r[t]=l;const o=JSON.stringify(r);localStorage.setItem(e,o)}}}const l=(e,t,i)=>(0,s.useMemo)((()=>n(e,t,i)),[e,t,i])},83701:(e,t,i)=>{i.d(t,{L:()=>a});var s=i(60963);function a(e,...t){return(0,s.z)((()=>Object.assign(e,...t)))}},77209:(e,t,i)=>{i.d(t,{r:()=>n});var s,a=i(18571);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},r.apply(this,arguments)}const n=e=>a.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",width:10,height:10,fill:"none",viewBox:"0 0 10 10"},e),s||(s=a.createElement("path",{fill:"currentColor",d:"M5.005 10c2.735 0 5-2.265 5-5S7.735 0 5 0 0 2.265 0 5s2.27 5 5.005 5m0-.888A4.096 4.096 0 0 1 .898 5 4.09 4.09 0 0 1 5 .888 4.11 4.11 0 0 1 9.118 5a4.097 4.097 0 0 1-4.113 4.112m-.108-3.116c.253 0 .413-.15.418-.346v-.062c.005-.263.17-.433.5-.655.475-.31.805-.599.805-1.171 0-.816-.727-1.26-1.568-1.26-.836 0-1.394.393-1.538.842a.8.8 0 0 0-.041.247c0 .227.175.351.36.351.28 0 .331-.144.486-.325.16-.258.382-.413.696-.413.429 0 .702.243.702.599 0 .32-.206.48-.63.774-.345.242-.603.5-.603.965v.057c0 .268.15.397.413.397m-.01 1.47a.527.527 0 0 0 .541-.516c0-.294-.242-.516-.542-.516a.53.53 0 0 0-.541.516c0 .29.253.516.541.516"})))},8318:(e,t,i)=>{i.d(t,{Z:()=>s});const s={group:"group-m_Apv3",authGroup:"authGroup-Yuaspf",label:"label-EV9bRs",right:"right-pmBY1Y"}},35178:(e,t,i)=>{i.d(t,{Z:()=>s});const s={labelHeader:"labelHeader-YVMW2T",applyToAll:"applyToAll-TCdMm4"}}}]);