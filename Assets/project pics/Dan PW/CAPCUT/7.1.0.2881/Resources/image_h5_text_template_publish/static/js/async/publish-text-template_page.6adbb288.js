"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[124],{1117:(e,t,i)=>{i.d(t,{$X:()=>r,eD:()=>n,pn:()=>s,sR:()=>l});var a=i(45394);function s({isVip:e,isBusiness:t,authFiles:i}){var s;const l=null!==(s=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==s?s:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:a.$x.Vip,auth_status:e?a.U9.Authorized:a.U9.Unauthorized,third_party_agreements:[]},{scene:a.$x.Business,auth_status:t?a.U9.Authorized:a.U9.Unauthorized,third_party_agreements:t?l:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function l(e){const{isOriginal:t=!1,isVip:i=!1,isBusiness:a=!1,authFiles:l}=e;const{root:r}=s({isVip:i,isBusiness:a,authFiles:l});return{copyright:r.copyright}}function r(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===a.U9.Authorized)))}function n(e){const t=function(e){const t={isBusiness:!1,isVip:!1,uris:[]};return null==e||e.copyright_info.forEach((e=>{switch(e.scene){case a.$x.Vip:return void(t.isVip=e.auth_status===a.U9.Authorized);case a.$x.Business:return t.isBusiness=e.auth_status===a.U9.Authorized,void(e.thrid_party_agreements&&(t.uris=e.thrid_party_agreements.filter((({uri:e})=>e)).map((({uri:e})=>e))));default:return}})),t}(e.copyright);return{isBusiness:t.isBusiness,isVip:t.isVip,authFiles:t.uris.map(((e,t)=>({uri:e,file:new File([],String(t+1).padStart(2,"0"))})))}}},44783:(e,t,i)=>{i.d(t,{$v:()=>d,Ad:()=>m,DV:()=>o,Es:()=>_,S4:()=>u,SB:()=>h,Sj:()=>c,_4:()=>g,ce:()=>p,iL:()=>r,j2:()=>n});var a=i(45725);function s(e){return void 0===e?e:String(Math.round(e/1024))}function l(e){const{material_category:t,material_type:i,collection_detail:a}=e;return{material_category:t,material_type:i,...a&&"collection"===i&&{collection_detail:a}}}function r(e){const{action:t,extra:i={},material_cnt:s}=e;(0,a.g)({eventName:"personal_page_material_publish_page_action",params:{action:t,material_cnt:s,...l(e),...i}})}function n(e){const{error_report:t,upload_status:i,time:r,isCompressed:n,sizeBeforeCompress:o,sizeAfterCompress:c,resolutionBeforeCompress:d,resolutionAfterCompress:u,extra:p={}}=e;(0,a.g)({eventName:"personal_page_material_upload_status",params:{...l(e),error_report:t,upload_status:i,time:r,is_compressed:n?1:0,...n&&{material_size_before_compress:s(o),material_size_after_compress:s(c),material_resolution_before_compress:d,material_resolution_after_compress:u},...p}})}function o(e){const{error_report:t}=e;(0,a.g)({eventName:"personal_page_material_import_error_report",params:{...l(e),error_report:t}})}function c(e){if(0===e.length)return;const t=function(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,i])=>{const a=i||"";t[e]=t[e]?`${t[e]},${a}`:a}))})),t}(e),i=new Set(t.material_type.split(","));1===i.size&&(t.material_type=i.values().next().value),(0,a.g)({eventName:"personal_page_material_publish_error_report",params:t})}function d(e){const{status:t,material_type:i,material_category:l,title:r,description:n,isOriginal:o,tags:c,material_format:d,material_size:u,resolution:p,error_type:m,cover_type:g,time:_,extra:h={},authorize_range:f,isVipAuthorized:x,isBusinessAuthorized:v,is_official_task:T,task_id:y,material_id:b,material_subcategory:w,effect_type_title:S,effect_type_id:L,material_group_id:I,material_language:F}=e;return(0,a.g)({eventName:"personal_page_material_publish_status",params:{status:t,material_type:i,material_category:l,material_title:r,material_introduction:n,is_original:o?"1":"0",hashtag:c.join(","),material_format:d,material_size:s(u),resolution:p,authorize_range:f,is_official_task:T,task_id:y,material_id:b,material_subcategory:w,material_language:F,material_group_id:I,effect_type_title:S,effect_type_id:L,..."fail"===t&&{error_type:m},cover_type:g,time:_,is_subscription_authorized:x?1:0,is_commercial_authorized:v?1:0,...h}})}function u(e){return(0,a.g)({eventName:"personal_page_material_publish_page_result",params:e})}function p(e){const{action:t,material_category:i,material_type:s,entry_from:l}=e;return(0,a.g)({eventName:"ugc_material_subscription_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:l}})}function m(e){const{action:t,material_category:i,material_type:s,entry_from:l,hasCopyrightAuthorization:r}=e;return(0,a.g)({eventName:"ugc_material_commercial_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:l,..."boolean"==typeof r&&{has_copyright_authorization:r?"1":"0"}}})}function g(e){const{action:t,page_type:i,material_category:s,material_type:l,button_name:r}=e;return(0,a.g)({eventName:"ugc_material_creator_sign_agreement",params:{action:t,page_type:i,material_category:s,material_type:l,...r&&{button_name:r}}})}function _(e){const{multiLang:t,...i}=e,s=e=>({zh:"cn",en:"en",ja:"jp",ko:"kr"}[e]||""),l=e=>{var i;return null!==(i=null==t?void 0:t.map(e).join(","))&&void 0!==i?i:""};return(0,a.g)({eventName:"material_tool_publish_status",params:{...i,...t&&{language_setting:l((({isMultiLang:e})=>e?"multi":"single")),language_type:l((({langs:e})=>s(e[0]))),language_total_type:l((({langs:e})=>e.map(s).join(";")))}}})}function h(e){const{caption_template_cnt:t,captionAnimationIds:i=[],text_template_cnt:s,material_type:l,text_special_effect_cnt:r}=e;return(0,a.g)({eventName:"material_tool_click_publish_confirm",params:{caption_template_cnt:t,caption_animation_id:i.join(","),text_template_cnt:s,material_type:l,text_special_effect_cnt:r}})}},45498:(e,t,i)=>{i.r(t),i.d(t,{default:()=>nt});var a=i(65625),s=i(9995),l=i(18571),r=i(71443),n=i(72322);const o=(0,a.Pi)((e=>{const{className:t}=e,{t:i}=(0,s.$)(),a=(0,l.useMemo)((()=>[{key:"textTemplate",title:i("pc_text_template_desc_web"),instructions:[{key:"",title:i("pc_text_template_release_effect_web")}]}]),[]),o=(0,l.useMemo)((()=>()=>"init"),[]);return(0,n.jsx)(r.v,{className:t,groups:a,initGroup:"textTemplate",activeGroup:"textTemplate",resetExpandedGroupKey:"textTemplate",getStatus:o})}));var c=i(54275),d=i(62369),u=i(84117),p=i(18751),m=i.n(p),g=i(85543),_=i(89252),h=i(56366),f=i(60963);var x=i(55364),v=i(86486),T=i(10878),y=i(45394),b=i(1117),w=i(65751),S=i(71995),L=i(42012),I=i(88154);function F(e){const{id:t,resourceId:i,isMultiLang:a}=e,s=e.languages.map(((e,t)=>function(e,t){const{lang:i,resourceId:a,templateZipData:s}=e,{coverFile:l,extraJson:r}=s.template;return{lang:i,resourceId:a,templateZipData:s,cover:(0,v.B4)({src:t.needSrc?(0,x.y8)(l):"",file:l}),staticFrame:(0,v.wt)({}),file:(0,f.LO)({...(0,v.Dz)({}),previewTime:0,extraJson:r},{extraJson:f.LO.ref}),publishType:a?"update":"create",title:e.title}}(e,{needSrc:!0}))),l=L.$.isEnableAuthorization,r=s.map((e=>e.lang));return(0,f.LO)({id:t,resourceId:a?i:s[0].resourceId,title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:l,isHighPriority:!1,isMultiLang:a,languages:s,onlineData:{isOriginal:!1,isVip:!1,isBusiness:!1,resourceId:i,langResourceIds:[],langResourceIdMap:{}},selectedLanguages:r},{onlineData:f.LO.ref})}const C=new class{constructor(e){(0,I.Z)(this,"_effectType",void 0),(0,I.Z)(this,"_isInitialized",!1),(0,I.Z)(this,"authConfig",{mustPaidAuth:!1,mustCommerceAuth:!1}),(0,I.Z)(this,"resourceCommonConfig",{maxTitleLen:0}),this._effectType=e,this.init()}async init(){{const e=await(0,y.A1)({effect_type:this._effectType});this.authConfig={mustPaidAuth:e.auth_config.must_paid_auth,mustCommerceAuth:e.auth_config.must_commerce_auth}}this._isInitialized=!0}}(w.Ab.TextTemplate);function j(e){const{mustPaidAuth:t}=C.authConfig,{postChannel:i,targetedActivityId:a}=e,s=i===y.iu.Open||i===y.iu.Targeted&&Boolean(a);return Boolean(e.title&&e.tags.length&&e.languages[0].staticFrame.src&&(t&&e.isVip||!t)&&s)}function P(e){return e.languages[0]}function A(e,t){const i=e.languages[0],{resourceId:a,title:s,tags:l,isVip:r,isBusiness:n,isOriginal:o,isHighPriority:c,onlineData:d,postChannel:u,targetedActivityId:p}=e,{sdkVersion:m}=i.templateZipData,g=t.authFileUploadServiceManager.getUploadedFiles(e.id),_=y.r0.UserPostPcMultiLangTextTemplate,h=c?`${_}_without_review`:_,f=e.languages.filter((t=>e.selectedLanguages.includes(t.lang)));if(d.resourceId){const t=(0,b.sR)({isOriginal:o,isVip:r,isBusiness:n,authFiles:g,onlineData:d}),{newResourceIdList:c}=function(e){const{onlineData:t,languages:i}=e;let a=!1;const s=[...t.langResourceIds];for(const l of i){const e=t.langResourceIdMap[l.lang];if(e&&e===l.resourceId)continue;const i=s.findIndex((t=>t===(null!=e?e:l.resourceId)));-1===i?s.push(l.resourceId):s[i]=l.resourceId,(0,S.c6)("[TextTemplateService] makeMultiLangTextTemplateReq update resourceIdList",{existingId:e,updatedId:l.resourceId,isAdd:-1===i,languageResourceIds:t.langResourceIds,langResourceIdMap:t.langResourceIdMap}),a=!0}return{newResourceIdList:s,isResourceIdListUpdated:a}}(e);return{id:a,..."en"===i.lang&&{title:s,description:s,icon:{image_uri:i.cover.uri,static_uri:i.staticFrame.uri},tags:l,...t},collection_info:{resource_id_list:c}}}const x=(0,b.pn)({isVip:r,isBusiness:n,authFiles:g}),v=f.map((e=>e.resourceId));return{effect_type:w.Ab.MultiLanguageTextTemplate,is_vip:r,...x.root,common_data:{title:s,description:s,icon:{image_uri:i.cover.uri,static_uri:i.staticFrame.uri},sdk_version:m,source:h,tags:l,is_original:o,is_business:n,post_channel:u===y.iu.Targeted?`${y.iu.Targeted}_${p}`:u,web_extra:JSON.stringify({targeted_id:p}),...x.commonData},collection_info:{resource_id_list:v}}}const D="root-Pqbzod",k="statusBar-LA3WnC",O=(0,a.Pi)((e=>{const{className:t,textTemplate:i,isSelected:a,onClick:s}=e,l=P(i),r=!l.staticFrame.src;return(0,n.jsxs)("div",{className:m()(D,t),onClick:()=>{s(i)},children:[(0,n.jsx)(g.Y,{src:r?"":l.cover.src,isInvalid:!1,isSelected:a,size:80,onContextMenu:e=>{e.preventDefault(),s(i)}}),(0,n.jsx)(_.ir,{className:k,loading:r,invalid:!1,errorToolip:"",isInfoComplete:j(i),title:i.title})]})}));var M=i(75255),U=i(79337),Z=i(35930),N=i(21798),R=i(18651),B=i(72383),V=i(59359),z=i(21386),$=i(71166),E=i(15027),q=i(1536),H=i(3703),W=i(97775),G=i(76937),J=i(24238),Y=i(21886),X=i(44783),Q=i(83701),K=i(22816);const ee={[w.Ab.TextTemplate]:w.Ab.MultiLanguageTextTemplate};var te=i(52081),ie=i(21135),ae=i(85138),se=i(74102);var le=i(61053),re=i(61679),ne=i(81071),oe=i(65284);let ce=null;const de=new Map;function ue(){const e=(0,B.G)({watch:()=>n.isAllUploadEnded}),t=(0,B.G)({watch:()=>n.isDepUploaded&&!n.isAllUploadEndedWatcher.isPromptingConfirmToCancel}),i=(0,ne.e)({watch:()=>n.textTemplateList.materials.every((e=>e.languages.every((e=>e.staticFrame.src))))}),a=(0,l.useMemo)((()=>new $.w),[]),{t:r}=(0,s.$)(),n=(0,M.fv)((()=>({publishStartTime:0,formApi:null,setFormApi:e=>{n.formApi=e},performanceTimingCollector:(0,re.uY)(),initOp:new E.q({fetchFirstPage:async()=>{q.appModel.isInited||await(0,H.cb)({throwOnError:!0}),n.performanceTimingCollector.addTiming("initFullAppInfoDone"),(0,S.c6)("[SingleStore] getTextTemplateSingleInitialData req --\x3e");const e=await(0,ie.oh)(ae.Z,"getTextTemplateSingleInitialData",{});(0,S.c6)("[SingleStore] getTextTemplateSingleInitialData resp <--",(0,h.Z)(e,"type","singles")),n.performanceTimingCollector.addTiming("getInitialDataDone");const t=n.fetchOnlineTextTemplates(e),i=[],a=[],s=[];for(const c of e.singles){const e=await n.makeInitTextTemplate(c,a,s);i.push(e)}n.performanceTimingCollector.addTiming("initTextTemplateDone"),(0,S.c6)("[SingleStore] await fetchOnlineTextTemplates start");const l=await t;n.performanceTimingCollector.addTiming("fetchOnlineDataDone"),(0,S.c6)("[SingleStore] mergeOnlineTextTemplate start");for(const c of i)n.mergeOnlineTextTemplate(c,l);(0,S.c6)("[SingleStore] make init flowerText sticker start");const r=a.map((e=>(0,oe.Sv)(e))),o=s.map((e=>(0,oe.wu)(e)));return()=>{n.textTemplateList.replaceByMap(i,(e=>e)),n.flowerTextList.replaceByMap(r,(e=>e)),n.stickers=o;const e=n.textTemplateList.materials[0];n.textTemplateList.select(e),n.initStaticFrame(n.textTemplateList.materials),n.initUploadFiles(),n.performanceTimingCollector.addSetStateTiming(re.Pk)}},slardarErrorLog:(e,t)=>{(0,S.RF)(`[SingleStore] ${e} failed`,t),n.performanceTimingCollector.addSetStateTiming(re.Pk,{scene:"initFailed"})}}),async makeInitTextTemplate(e,t,i){const{id:a,isMultiLang:s}=e,l=[];(0,S.c6)("[SingleStore] makeInitTextTemplate start",{id:a});const r=s?e.languages:e.languages.slice(0,1);for(const n of r){const{lang:s}=n;(0,S.c6)("[SingleStore] makeInitTextTemplate one language start",{id:a,lang:s});const r=new W.v({id:`${s}-${e.id}`,effectType:w.Ab.TextTemplate,fetchZipBase64:async()=>{const{zipData:t}=await(0,V.FI)({id:e.id,lang:s});return t}});await r.init(),l.push({lang:s,title:n.title||"",resourceId:n.resourceId,templateZipData:r});for(const e of r.flowerTexts){const i=e.id;let a=t.find((e=>e.groupId&&e.groupId===i));a||(a={groupId:i,subFlowerTexts:[]},t.push(a)),a.subFlowerTexts.push({lang:s,data:e})}for(const e of r.stickers)i.some((t=>t.id===e.id))||i.push(e)}return(0,S.c6)("[SingleStore] makeInitTextTemplate done",{id:a}),F({id:a,isMultiLang:s,resourceId:e.resourceId,languages:l})},fetchOnlineTextTemplates:async({type:e,singles:t})=>"update"!==e?{}:async function({effectType:e,singles:t}){const i=ee[e],a={},s=[];for(const c of t){var l;const t=c.isMultiLang?c.resourceId:null===(l=c.languages[0])||void 0===l?void 0:l.resourceId;if(!t)continue;const a=c.isMultiLang?i:e;if(void 0===a)throw new K.w(`effectType=${e} doesn't support multi lang`,{effectType:e});s.push({id:t,effect_type:a,source:1})}if(0===s.length)return(0,S.c6)("[OnlineData] fetchOnlineTemplates no reqItems"),a;(0,S.c6)("[OnlineData] fetchOnlineTemplates mgetItem start",{ids:s.map((e=>e.id))});const r=await(0,y.yF)({items:s,pack_optional:{need_tag:!0,need_parent_tag:!1,need_copyright:!0},controller_policy_optional:{from_cache:!1}});(0,S.c6)("[OnlineData] fetchOnlineTemplates mgetItem success",{ids:r.effect_item_list.map((e=>e.common_attr.id))});const n=[];if(r.effect_item_list.forEach((t=>{var s;a[t.common_attr.id]=t,t.common_attr.effect_type===i&&(null===(s=t.collection)||void 0===s||s.resource_id_list.forEach((t=>n.push({id:t,effect_type:e,source:1}))))})),0===n.length)return(0,S.c6)("[OnlineData] fetchOnlineTemplates no subLangReqItems"),a;(0,S.c6)("[OnlineData] fetchOnlineTemplates subLanguage mgetItem start",{ids:n.map((e=>e.id))});const o=await(0,y.yF)({items:n,pack_optional:{need_tag:!0,need_parent_tag:!1,need_copyright:!0},filter_optional:{no_filter_by_rule:!0},controller_policy_optional:{from_cache:!1}});return(0,S.c6)("[OnlineData] fetchOnlineTemplates subLanguage mgetItem success",{ids:o.effect_item_list.map((e=>e.common_attr.id))}),o.effect_item_list.forEach((e=>{a[e.common_attr.id]=e})),a}({effectType:w.Ab.TextTemplate,singles:t}),mergeOnlineTextTemplate(e,t){const i=function({effectType:e,resourceId:t,mainLang:i,firstLanguage:a,onlineTemplates:s}){var l,r;if(!t)return null;const n=s[a.lang===i?t:a.resourceId||t];if(!n)return(0,S.RF)("[OnlineData] extractOnlineTemplate item not found",null,{id:t,firstLanguage:a,mainLang:i}),null;const{title:o,tag_list:c=[],is_original:d}=n.common_attr,{isBusiness:u,isVip:p,authFiles:m}=(0,b.eD)(n),g={form:{title:o,tags:Array.from(new Set(c.map((e=>e.name)))),isOriginal:d,isBusiness:u,isVip:p,isHighPriority:String(n.common_attr.publish_source).endsWith("_without_review")},authFiles:m,onlineData:{isOriginal:d,isBusiness:u,isVip:p,copyright:n.copyright,langResourceIds:[],langResourceIdMap:{}}},_=s[t],h=ee[e];if(!h||(null==_?void 0:_.common_attr.effect_type)!==h)return g;g.onlineData.langResourceIds=null!==(l=null===(r=_.collection)||void 0===r?void 0:r.resource_id_list)&&void 0!==l?l:[],g.onlineData.langResourceIdMap={};for(const x of g.onlineData.langResourceIds){var f;const e=null===(f=s[x])||void 0===f?void 0:f.common_attr.item_language;e?g.onlineData.langResourceIdMap[e]=x:(0,S.RF)("[OnlineData] extractOnlineTemplate lang is empty",null,{id:x,hasItem:Boolean(s[x])})}return g}({effectType:w.Ab.TextTemplate,resourceId:e.resourceId,mainLang:"en",firstLanguage:e.languages[0],onlineTemplates:t});i&&((0,Q.L)(e,i.form),(0,Q.L)(e.onlineData,i.onlineData),i.authFiles.length&&n.authFileUploadServiceManager.ensure(e.id).addOnlineFiles(i.authFiles))},get mainFormLayout(){const{fetchStatus:e}=n.initOp;return e.isFailed?"error":e.hasFetched?"mainForm":"loading"},get needConfirmModalOnClose(){return!0},get field(){return{canBusiness:L.$.permissions.includes(L.v.EffectSetBusiness),canVip:L.$.permissions.includes(L.v.EffectSetVip),canHighPrio:L.$.permissions.includes(L.v.EffectHighPrio)}},pubService:new Z.Z,sendLogService:new Y.D5({itemType:w.Ab.TextTemplate}),authorSignService:new N.I({signScene:z.d.BusinessArtist}),authFileUploadServiceManager:new R.r({}),isAllUploadEndedWatcher:e,fileOp:new v.N0({uploadConfigService:a}),textTemplateList:new J.T({}),flowerTextList:new J.T({}),stickers:[],init(){n.initOp.initFetchFirstPage(null)},retryInit(){n.initOp.retryFetchFirstPage()},selectTextTemplateCard(e){n.saveCurrentForm(),n.textTemplateList.select(e),n.flowerTextList.select(null)},selectFlowerTextCard(e){n.saveCurrentForm(),n.flowerTextList.select(e),n.textTemplateList.select(null)},initTextTemplateForm(e){var t;null===(t=n.formApi)||void 0===t||t.setValues({textTemplate:{title:e.title,tags:[...e.tags],isOriginal:e.isOriginal,isVip:e.isVip,isBusiness:e.isBusiness,isHighPriority:e.isHighPriority}})},saveTextTemplateForm(e){var t;const i=null===(t=n.formApi)||void 0===t?void 0:t.getValues().textTemplate;i&&(0,Q.L)(e,{title:i.title||"",tags:i.tags,isOriginal:i.isOriginal||!1,isVip:i.isVip||!1,isBusiness:i.isBusiness||!1,isHighPriority:i.isHighPriority||!1})},initFlowerTextForm(e){var t;null===(t=n.formApi)||void 0===t||t.setValues({flowerText:{title:e.title,tags:[...e.tags]}})},applyTagsToAll(e){n.flowerTextList.updateAll((t=>{t.tags=[...e]}))},saveFlowerTextForm(e){var t;const i=null===(t=n.formApi)||void 0===t?void 0:t.getValues().flowerText;i&&(0,Q.L)(e,{title:i.title||"",tags:i.tags})},saveCurrentForm(){n.textTemplateList.selected?n.saveTextTemplateForm(n.textTemplateList.selected):n.flowerTextList.selected&&n.saveFlowerTextForm(n.flowerTextList.selected)},initStaticFrameTimer:new le.B,async initStaticFrame(e){for(const t of e){const{id:e,languages:i}=t;for(let a=0;a<i.length;a+=1){const s=i[a];await n.fileOp.initStaticFrame({id:`${s.lang}-${e}`,getInitIndex:()=>0===a?null:t.languages[0].staticFrame.index,staticFrame:s.staticFrame,templateZipData:s.templateZipData}),await n.initStaticFrameTimer.timeout(100)}}},async initUploadFiles(){try{await a.getUploadConfigs("initUploadFiles")}catch{}for(const e of n.textTemplateList.materials)n.initUploadTextTemplateFiles(e);(0,oe.er)(n.fileOp,{flowerTexts:n.flowerTextList.materials,stickers:n.stickers})},initUploadTextTemplateFiles(e){for(const t of e.languages)n.fileOp.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:(0,G.V)("text-template-cover")})})},async retryUpload(){n.depPublishStatus.isCanceled=!1;try{await a.getUploadConfigs("retryUploadFiles")}catch{n.depPublishStatus.isFailed=!0}for(const e of n.textTemplateList.materials)for(const t of n.getSelectedLanguages(e))n.fileOp.retryUpload(t.cover,t.staticFrame,t.file);(0,oe.Id)(n.fileOp,{flowerTexts:n.flowerTextList.materials,stickers:n.stickers})},handleUploadCancel(){ce={status:"cancel"},this.sendPublishPageResultLog(),t.stop(),i.stop(),n.isAllUploadEndedWatcher.stop(),n.depPublishStatus.isCanceled=!0},async initUploadStaticFrame(e){await i.start();for(const t of n.getSelectedLanguages(e))n.fileOp.initUploadCover({getCover:()=>t.staticFrame,getInitValues:()=>({id:(0,G.V)("text-template-static-frame"),file:new File([(0,x.Jr)(t.staticFrame.src)],"icon.png",{type:"image/png"})})})},handleStaticFrameChange(e,t){for(const i of e.languages)n.fileOp.updateStaticFrame(i.staticFrame,t)},async publishDeps(){const{textTemplateList:e,flowerTextList:t,stickers:i}=n,a=e.materials[0],s=a.selectedLanguages,l=(0,h.Z)(a,"isVip","isBusiness","isOriginal","isHighPriority"),r=(0,oe.Kl)(t.materials,l,s),o=(0,oe.Rd)(i,{...l,getTitle:(e,t)=>{const i=String(t+1).padStart(2,"0");return`${a.title}-${i}`}}),c=await n.pubService.batchPublish([...r,...o]),d=(0,oe.Wl)({flowerTexts:n.flowerTextList.materials,stickers:n.stickers}),u=c.map((e=>e.resource_id));return(0,S.c6)("[SingleStore] deps publish success",{resourceIdList:u,depResourceIdMap:d}),{depResourceIdMap:d}},getSelectedLanguages:e=>e.languages.filter((t=>e.selectedLanguages.includes(t.lang))),clearTextTemplateZip(){n.fileOp.templateZipCacheMap.clear();for(const e of n.textTemplateList.materials)for(const t of e.languages)n.fileOp.saveTemplateZipCache(e.id,t.lang,t.file)},async initUploadTextTemplateZip(e,t){const{textTemplateList:i}=n;for(const a of i.materials)for(const i of n.getSelectedLanguages(a)){const{lang:s,staticFrame:l,templateZipData:r}=i;if(await n.fileOp.initUploadTemplateZip({id:a.id,lang:s,zipFile:i.file,staticFrame:l,templateZipData:r,depResourceIdMap:e,checkIsCanceled:()=>t.isCanceled}),t.isCanceled)return}},depPublishStatus:{isFailed:!1,isCanceled:!1,isDone:!1},async startUploadAndPublishDeps(e){try{for(const e of n.textTemplateList.materials)n.initUploadStaticFrame(e);await t.start();const{depResourceIdMap:i}=await n.publishDeps();if(e.isCanceled)return void(ce={status:"cancel"});await n.initUploadTextTemplateZip(i,e),(0,f.z)((()=>{e.isDone=!0}))}catch(i){(0,f.z)((()=>{e.isFailed=!0})),(0,S.RF)("[SingleStore] startUploadAndPublishDeps failed",i),ce={status:"fail",error:i}}},sendPublishPageResultLog(){var e;if(!ce)return;const t=n.textTemplateList.materials.map((e=>n.getSelectedLanguages(e))).flat();n.sendLogService.sendMaterialPublishPageResultLog({status:ce.status,time:Date.now()-n.publishStartTime,material_cnt:t.length,material_id:t.map((e=>e.resourceId)).join(","),error_type:null===(e=ce.error)||void 0===e?void 0:e.message}),ce=null},sendMaterialPubishStatusLog(){de.forEach(((e,t)=>{n.sendLogService.sendMaterialPublishStatusLog({time:e.time,status:e.error?"fail":"success",error_type:e.errorText,publishParams:e.req,path:"",targetedActivityId:e.activityId},{material_id:e.resourceId,material_language:e.lang,material_group_id:e.groupId})})),de.clear()},get depUploadStats(){const e={pending:0,succeeded:0,failed:0};for(const i of n.flowerTextList.materials){var t;let a=i.subFlowerTexts;const s=null===(t=n.textTemplateList)||void 0===t||null===(t=t.materials)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.selectedLanguages;null!=s&&s.length&&(a=a.filter((e=>s.includes(e.lang))));for(const t of a)(0,v.r)(e,t.cover,t.file)}for(const i of n.stickers)(0,v.r)(e,i.cover);return e},get isDepUploaded(){const{pending:e,failed:t}=n.depUploadStats;return!e&&!t},get uploadStats(){const e={uninited:0,...n.depUploadStats};for(const a of n.textTemplateList.materials)for(const t of n.getSelectedLanguages(a))(0,v.r)(e,t.cover,t.staticFrame,t.file);const{isFailed:t,isDone:i}=n.depPublishStatus;return t?e.failed+=1:i?e.succeeded+=1:e.pending+=1,e},get isAllUploaded(){const{pending:e,failed:t}=n.uploadStats;return!e&&!t},get isAllUploadEnded(){const{pending:e}=n.uploadStats;return 0===e},get isUploadHasFailure(){const{failed:e}=n.uploadStats;return e>0},get isReadyToPublish(){const{textTemplateList:e,flowerTextList:t}=n;return e.length>0&&e.materials.every((e=>j(e)))&&t.materials.every((e=>(0,oe.QX)(e)))&&!n.isPublishSucceeded},async uploadAndPublish(e){n.publishStartTime=Date.now(),ce=null,de.clear(),n.saveCurrentForm(),n.sendMaterialToolClickPublishLog(),n.retryUploadAndPublishDeps(),null==e||e.show();try{await n.isAllUploadEndedWatcher.start(),n.isUploadHasFailure?ce={...ce||{},status:"fail"}:await n.publish()}finally{null==e||e.hide()}this.sendMaterialPubishStatusLog(),this.sendPublishPageResultLog()},async retryUploadAndPublishDeps(){n.clearTextTemplateZip(),n.depPublishStatus={isFailed:!1,isCanceled:!1,isDone:!1};const{depPublishStatus:e}=n;await n.retryUpload(),n.startUploadAndPublishDeps(e)},isPublishing:!1,isPublishSucceeded:!1,async publish(){n.isPublishing=!0;try{await n.publishImpl()}catch(e){return ce||(ce={status:"fail",error:e}),U.FN.error(r("pc_sticker_release_failed_retry_web")),(0,f.z)((()=>{n.isPublishing=!1})),n.sendMaterialToolPublishLog("fail"),void(0,S.RF)("[SingleStore] publish failed",e)}(0,f.z)((()=>{n.isPublishing=!1,n.isPublishSucceeded=!0})),U.FN.info({content:r("pc_text_template_release_success_web",{num:n.textTemplateList.length}),textMaxWidth:"80vw"}),n.sendMaterialToolPublishLog("success"),(0,S.c6)("[SingleStore] publish success"),setTimeout((()=>(0,V.gk)({showHomePage:!0})),3e3)},async publishImpl(){const e=n.textTemplateList.materials.map((e=>{const{isMultiLang:t}=e,{authFileUploadServiceManager:i}=n;return n.getSelectedLanguages(e).map((a=>{const s=`${a.lang}-${e.id}`,l=t?function(e,t){const i={...(0,h.Z)(e,["title","tags","isHighPriority","isVip","isBusiness","isOriginal","postChannel","targetedActivityId"]),...(0,h.Z)(t,"lang","cover","staticFrame","file"),authFiles:[],baseSource:y.r0.UserPostPcInMultiLangTextTemplate};return"update"===t.publishType?(0,T.xo)({id:t.resourceId,onlineData:e.onlineData,...i}):(0,T.Ob)({effectType:w.Ab.TextTemplate,templateZipData:t.templateZipData,extraJson:t.file.extraJson,...i})}(e,a):function(e,t){const i=P(e),a={...(0,h.Z)(e,["title","tags","isHighPriority","isVip","isBusiness","isOriginal","postChannel","targetedActivityId"]),...(0,h.Z)(i,"cover","staticFrame","file"),authFiles:t.authFileUploadServiceManager.getUploadedFiles(e.id),baseSource:y.r0.UserPostPc};return"update"===i.publishType?(0,T.xo)({id:i.resourceId,onlineData:e.onlineData,...a}):(0,T.Ob)({effectType:w.Ab.TextTemplate,templateZipData:i.templateZipData,extraJson:i.file.extraJson,...a})}(e,{authFileUploadServiceManager:i});return{id:s,req:l,onResult:(0,f.aD)((({req:i,resourceId:l,error:r,errorText:n,time:o})=>{de.set(s,{req:i,lang:a.lang,time:o,error:r,errorText:n,resourceId:l,activityId:e.targetedActivityId}),r?(0,S.RF)(`[SingleStore] single publish failed {${s}}`,r):(a.resourceId=l,t||(e.resourceId=l),(0,S.c6)(`[SingleStore] single publish success {${s}}`,{resourceId:l}))})),onUpdateResult:(0,f.aD)((({req:e,resourceId:t,error:i,errorText:a,time:l})=>{i?(0,S.RF)(`[SingleStore] single update failed {${s}}`,i):(0,S.c6)(`[SingleStore] single update success {${s}}`,{resourceId:t})}))}}))})).flat();(0,S.c6)("[SingleStore] single publish start",{resourceIdList:e.map((e=>e.id))});const t=await n.pubService.batchPublish(e);(0,S.c6)("[SingleStore] single publish done",{resourceIdList:t.map((e=>e.resource_id))});const i=n.textTemplateList.materials.filter((e=>e.isMultiLang)).map((e=>{const{authFileUploadServiceManager:t}=n,{id:i}=e;return{id:i,req:A(e,{authFileUploadServiceManager:t}),onResult:(0,f.aD)((({req:t,resourceId:a,error:s,errorText:l,time:r})=>{s?(0,S.RF)(`[SingleStore] multi lang publish failed {${i}}`,s):(e.resourceId=a,(0,S.c6)(`[SingleStore] multi lang publish success {${i}}`,{resourceId:a}))})),onUpdateResult:(0,f.aD)((({req:e,resourceId:t,error:a,errorText:s,time:l})=>{a?(0,S.RF)(`[SingleStore] multi lang update failed {${i}}`,a):(0,S.c6)(`[SingleStore] multi lang update success {${i}}`,{resourceId:t})}))}}));(0,S.c6)("[SingleStore] multi lang publish start",{resourceIdList:i.map((e=>e.id))}),await n.pubService.batchPublish(i).then((e=>{var t;const i=null==e||null===(t=e[0])||void 0===t?void 0:t.resource_id;return de.forEach((e=>e.groupId=i)),ce={status:"success",resourceId:i},e}),(e=>{throw ce={status:"fail",error:e},e}));const a=n.textTemplateList.materials.map((e=>e.resourceId));(0,S.c6)("[SingleStore] multi lang publish done",{resourceIdList:a});const s=n.textTemplateList.materials.filter((e=>e.isMultiLang&&!e.onlineData.resourceId)).map((e=>({id:e.id,resourceId:e.resourceId})));var l;s.length&&((0,S.c6)("[SingleStore] syncTemplateResourceId req --\x3e",{templates:s}),await(l={templates:s},(0,ie.oh)(se.Z,"syncTemplateResourceId",l)),(0,S.c6)("[SingleStore] syncTemplateResourceId resp <--"));n.textTemplateList.materials.some((e=>!e.onlineData.resourceId))?(await n.pubService.pollUntilAllInEffectList({ids:a.slice(-Z.f),types:[w.Ab.TextTemplate,w.Ab.MultiLanguageTextTemplate]}),(0,S.c6)("[SingleStore] poll done")):(0,S.c6)("[SingleStore] no need to poll")},sendMaterialToolClickPublishLog(){const{textTemplateList:e,flowerTextList:t}=n;(0,X.SB)({text_template_cnt:e.length,material_type:"single",text_special_effect_cnt:t.length})},sendMaterialToolPublishLog(e){const{textTemplateList:t,flowerTextList:i}=n;(0,X.Es)({text_template_cnt:t.length,text_special_effect_cnt:i.length,material_type:"single",status:e,success_cnt:t.materials.filter((e=>e.resourceId)).length,multiLang:t.materials.map((e=>({isMultiLang:e.isMultiLang,langs:e.languages.map((e=>e.lang))})))})},collectLogData(){const e=["id","uri","isUploadFailed"],t=n.textTemplateList.materials.map((t=>({...(0,h.Z)(t,"id","resourceId","isMultiLang"),languages:t.languages.map((t=>({...(0,h.Z)(t,"lang","resourceId"),cover:(0,h.Z)(t.cover,e),staticFrame:(0,h.Z)(t.staticFrame,[...e,"index"]),file:(0,h.Z)(t.file,e),extraJson:t.file.extraJson})))}))),i=n.flowerTextList.materials.map((t=>({...(0,h.Z)(t,"id","isDepMaterial","sdkVersion"),subFlowerTexts:t.subFlowerTexts.map((t=>({...(0,h.Z)(t,"id","lang","resourceId"),cover:(0,h.Z)(t.cover,e),file:(0,h.Z)(t.file,e)})))}))),a=n.stickers.map((t=>({...(0,h.Z)(t,"id","resourceId","isDepMaterial","isSequence"),cover:(0,h.Z)(t.cover,e)}))),s={textTemplates:t,textTemplateCount:t.length,flowerTexts:i,stickers:a,isReadyToPublish:n.isReadyToPublish,depPublishStatus:{...n.depPublishStatus},uploadStats:{...n.uploadStats}};(0,S.c6)("[SingleStore] collectLogData",s)}})));return(0,te.L)({watch:()=>{n.uploadStats,n.isReadyToPublish},collect:n.collectLogData}),(0,l.useEffect)((()=>(window.store=n,n.init(),n.authorSignService.init(),()=>{n.initStaticFrameTimer.cancel()})),[]),n}const pe=(0,l.createContext)(null),me=()=>(0,l.useContext)(pe);var ge=i(45092);const _e=(0,a.Pi)((e=>{const{className:t}=e,i=me();return(0,n.jsx)("div",{className:m()(ge.Z.root,t),children:(0,n.jsx)("div",{className:ge.Z.container,children:i.textTemplateList.materials.map(((e,t)=>(0,n.jsx)(O,{className:ge.Z.card,textTemplate:e,isSelected:i.textTemplateList.selectedId===e.id,onClick:i.selectTextTemplateCard},e.id)))})})}));var he=i(58845);const fe=(0,a.Pi)((e=>{const{className:t}=e,i=me();return(0,n.jsx)("div",{className:m()(ge.Z.root,t),children:(0,n.jsx)("div",{className:ge.Z.container,children:i.flowerTextList.materials.map(((e,t)=>(0,n.jsx)(he.M,{className:ge.Z.card,flowerText:e,isSelected:i.flowerTextList.selectedId===e.id,onClick:i.selectFlowerTextCard},e.id)))})})}));var xe=i(12625),ve=i(23725),Te=i(58861),ye=i(69434),be=i(77209),we=i(62027),Se=i(92304),Le=i(13647);const Ie="root-HoHMo9",Fe="disabled-VOcU3h",Ce="help-Q9jnn3",je=(0,U.Q2)((e=>{const{t}=(0,s.$)(),{value:i,onChange:a,sendLogService:l,disabledTooltip:r,tooltip:o,...c}=e,{className:d,disabled:u}=c,p=we.YW.AuthorAgreement,{showModal:g,showModalWithoutReview:_}=(0,we.ZP)({handleBtnText:t("pc_template_authorize_confirm_web"),closeIcon:!0,protocol:p,needReview:!0,onOk:()=>{(0,Le.F)(p),null==a||a(!0),l.sendSubscriptionStatementLog({action:"confirm",entry_from:"checkbox"}),l.sendClickSubscriptionCheckboxLog(!0)}}),{handleMouseEnter:h}=(0,Se.w)({cursor:"not-allowed",content:r}),{handleMouseEnter:f}=(0,Se.w)({content:o}),{handleMouseOver:x}=(0,Se.S)({checkIsTarget:e=>null!==e.closest(".semi-checkbox-addon")}),v=m()(c.className);return(0,n.jsxs)("div",{className:m()(Ie,u&&Fe,d),onMouseEnter:e=>{u&&r?h(e):o&&f(e)},onMouseOver:u&&r?void 0:x,children:[(0,n.jsx)(U.XZ,{...c,className:v,checked:i,onChange:e=>{const t=Boolean(e.target.checked);if(t&&!(0,Le.K)(p))return g(),l.sendSubscriptionStatementLog({action:"show",entry_from:"checkbox"}),void l.sendPageActionLog({action:"choose_subscription_authorize"});l.sendClickSubscriptionCheckboxLog(t),null==a||a(t)},children:t("cc_pc_material_visual_effect_publish_authorize_desc_web")}),(0,n.jsx)(be.r,{className:Ce,onClick:()=>{_(),l.sendSubscriptionStatementLog({action:"show",entry_from:"question_mark"}),l.sendPageActionLog({action:"click_subscription_detail"})}})]})}));var Pe,Ae=i(43792);function De(){return De=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},De.apply(this,arguments)}const ke=e=>l.createElement("svg",De({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none","aria-hidden":"true",viewBox:"0 0 24 24"},e),Pe||(Pe=l.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M21.352 4.265a1.5 1.5 0 0 1 .383 2.087l-10 14.5a1.5 1.5 0 0 1-2.334.169l-6.5-7a1.5 1.5 0 0 1 2.198-2.042l5.228 5.63 8.938-12.96a1.5 1.5 0 0 1 2.087-.384",clipRule:"evenodd"})));var Oe=i(77642);const Me="root-gly6Qn",Ue="link-pZCc56",Ze="selectWrapper-PYDCrg",Ne="activitySelect-pwnL0y",Re=e=>{const{t}=(0,s.$)(),{value:i,onChange:a,taskList:l,loading:r,viewMoreUrl:o,onOrientationViewMoreClick:c}=e,[d,u]=(0,Ae.Z)(void 0,{dimension:"width"}),p=e=>{var t;null==a||a({postChannel:null!==(t=null==i?void 0:i.postChannel)&&void 0!==t?t:y.iu.Targeted,activityId:e})};return(0,n.jsxs)("div",{className:Me,children:[(0,n.jsxs)(U.FX,{type:"card",value:null==i?void 0:i.postChannel,onChange:e=>{null==a||a({postChannel:e.target.value})},direction:"horizontal",name:"material-publish-group-pureCard",children:[(0,n.jsx)(U.Y8,{value:y.iu.Targeted,extra:(0,n.jsxs)("div",{style:{height:"100%"},children:[(0,n.jsx)("div",{children:t("cc_pc_material_visual_effect_publish_creation_type_event_desc_web")}),(0,n.jsx)("span",{className:Ue,onClick:e=>{null==c||c(),e.preventDefault(),(0,Oe.Z)({url:o})},children:t("cc_pc_material_visual_effect_publish_creation_type_event_detail_web")})]}),children:t("cc_pc_material_visual_effect_publish_creation_type_event_web")}),(0,n.jsx)(U.Y8,{value:y.iu.Open,extra:(0,n.jsx)("div",{style:{height:"100%"},children:(0,n.jsx)("div",{children:t("cc_pc_material_visual_effect_publish_creation_type_free_desc_web")})}),children:t("cc_pc_material_visual_effect_publish_creation_type_free_web")})]}),(0,n.jsx)("div",{className:Ze,ref:d,onClick:()=>{const e=document.getElementById("formAreaWrapper");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},children:(null==i?void 0:i.postChannel)===y.iu.Targeted&&(0,n.jsx)(U.Ph,{maxHeight:180,value:null==i?void 0:i.activityId,loading:r,placeholder:t("cc_pc_material_visual_effect_publish_creation_type_event_select_web"),className:Ne,optionList:l,renderOptionItem:t=>{var i;const{label:a,desc:s,value:l,onClick:r}=t,o=l===(null===(i=e.value)||void 0===i?void 0:i.activityId);return(0,n.jsxs)("div",{className:"custom-select-option",onClick:e=>{null==r||r(e),null==p||p(l)},style:{maxWidth:u.width-12},children:[o&&(0,n.jsx)(ke,{className:"checkedIcon"}),!o&&(0,n.jsx)("div",{className:"placeholder"}),a]})}})})]})};i(80495);var Be=i(62185),Ve=i(39106),ze=i(8318),$e=i(35178);const Ee="root-Q49OJq",qe="cover-gS1Ikh",He="selectStaticFrame-ts9UIy",We="titleField-B79mNJ",Ge="highPriorityWrapper-zaPxnc",Je="multiLangVersionList-YvOCYN",{Label:Ye}=U.Form,Xe=(0,a.Pi)((e=>{const{textTemplate:t}=e,{t:i}=(0,s.$)(),a=me(),{authConfig:r}=C,{mustPaidAuth:o}=r,{targetedActivityId:c,postChannel:d}=t,[u,p]=(0,l.useState)([]);(0,l.useLayoutEffect)((()=>a.initTextTemplateForm(t)),[]),(0,l.useEffect)((()=>{u.length||async function(){return(await(0,y.ip)({effect_type:w.Ab.TextTemplate})).tasks.map((e=>({label:e.title,value:e.task_id})))}().then((e=>{p(e)}))}),[]),(0,l.useEffect)((()=>{L.$.isEnableAuthorization&&v(!0)}),[L.$.isEnableAuthorization]);const{getDisplayLength:m}=(0,Ve._)(),_=P(t),{openFramePicker:h}=(0,Te.v)(),x=(0,ne.e)({watch:()=>P(t).staticFrame.list.length>0}),v=e=>{var i;t.isVip=e,null===(i=a.formApi)||void 0===i||i.setValue("textTemplate",{...a.formApi.getValue("textTemplate"),isVip:e})},T=Boolean(t.languages[0].staticFrame.src),b=(0,l.useMemo)((()=>(0,f.Fl)((()=>t.languages.map((e=>({lang:e.lang,cover:e.cover,title:e.title,isSelected:t.selectedLanguages.includes(e.lang)})))))),[]),S=Boolean(t.onlineData.resourceId);return(0,n.jsxs)("div",{className:Ee,children:[(0,n.jsx)(g.Y,{className:qe,src:_.staticFrame.src,isInvalid:!1,isSelected:!1,size:128}),(0,n.jsx)("div",{className:He,onClick:()=>{h({onOK:e=>a.handleStaticFrameChange(t,e),fetchData:async()=>{await x.start();const{list:e,index:t}=_.staticFrame;return{list:e,index:t}}})},children:i("pc_stickers_release_cover_edit_web")}),(0,n.jsx)(xe.l,{fieldClassName:We,label:i("pc_text_template_name_n_web"),field:"textTemplate.title",maxLength:40,allowEnter:!1,placeholder:i("pc_stickers_release_xy_name_web",{X:1,Y:m(40)}),rules:[{required:!0,message:""}],onChange:(0,f.aD)((e=>t.title=e))}),(0,n.jsx)(ve.u,{label:(0,n.jsx)("div",{className:$e.Z.labelHeader,children:(0,n.jsx)(U.Form.Label,{required:!0,children:i("pc_text_template_tag_settings_web")})}),placeholder:i("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"textTemplate.tags",itemType:w.Ab.TextTemplate,recommendConfig:{title:t.title,uri:_.cover.uri},ignoreAddTagOnBlurSelector:`.${$e.Z.applyToAll}`,onChange:(0,f.aD)((e=>t.tags=e))}),(0,n.jsxs)("div",{children:[(0,n.jsx)(Ye,{required:!0,text:i("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,n.jsx)(Re,{value:{postChannel:d,activityId:c},onChange:e=>{var i;t.postChannel=e.postChannel,t.targetedActivityId=e.activityId,null===(i=a.formApi)||void 0===i||i.setValue("textTemplate",{...a.formApi.getValue("textTemplate"),postChannel:e.postChannel,targetedActivityId:e.activityId})},taskList:u,loading:!u.length,viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/XPbkdNb0qoSdGwxdjSTl3lTjgtf",onOrientationViewMoreClick:()=>{a.sendLogService.sendPageActionLog({action:"click_more_official_task"})}})]}),t.isMultiLang&&(0,n.jsx)(Be.B,{className:Je,loading:!T,languages:b.get(),onToggleSelection:e=>{t.selectedLanguages.includes(e)?t.selectedLanguages.length>1&&(t.selectedLanguages=t.selectedLanguages.filter((t=>t!==e))):t.selectedLanguages.push(e)}}),!1,(0,n.jsx)(ye.Z,{required:o,children:(0,n.jsx)("div",{className:ze.Z.authGroup,children:(0,n.jsx)(je,{noLabel:!0,field:"textTemplate.isVip",disabled:L.$.isEnableAuthorization,disabledTooltip:i("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:o?i("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:a.sendLogService,onChange:e=>{e&&a.sendLogService.sendPageActionLog({action:"choose_subscription_authorize"}),v(e)}})})}),a.field.canHighPrio&&(0,n.jsx)(ye.Z,{className:Ge,hiddenFieldLabel:!0,children:(0,n.jsxs)("div",{className:ze.Z.authGroup,children:[(0,n.jsx)(ye._,{text:i("pc_text_template_release_settings_web")}),(0,n.jsx)("div",{className:ze.Z.right,children:(0,n.jsx)(U.z8,{noLabel:!0,field:"textTemplate.isHighPriority",disabled:S,children:i("pc_text_template_release_priority_web")})})]})})]})}));var Qe=i(43738);const Ke="topSectionHeader-r1QPRt",et=(0,a.Pi)((e=>{const{className:t}=e,i=me(),{t:a}=(0,s.$)(),r=(0,c.Z)((()=>{})),o=(0,l.useRef)(null);return(0,d.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:"",titleForMainForm:a("pc_text_template_add_click_web"),subTitle:"",draggingTitle:"",draggingDisabled:!0,disabled:!0,disabledTooltip:"",onClick:r,onDrop:r},setFormApi:i.setFormApi,renderImportArea:e=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.S,{className:Ke,title:a("pc_text_template_n_collection_web",{X:i.textTemplateList.length})}),(0,n.jsx)(_e,{}),i.flowerTextList.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.S,{title:a("pc_text_template_affiliated_web",{X:i.flowerTextList.length})}),(0,n.jsx)(fe,{})]})]}),renderFormArea:()=>i.textTemplateList.selected?(0,n.jsx)(Xe,{textTemplate:i.textTemplateList.selected},i.textTemplateList.selectedId):i.flowerTextList.selected?(0,n.jsx)(Qe.p,{flowerText:i.flowerTextList.selected,initFlowerTextForm:i.initFlowerTextForm,applyTagsToAll:i.applyTagsToAll,maxTitleLength:40},i.flowerTextList.selectedId):null,scrollAreaRef:o,onRetry:i.retryInit})}));var tt=i(85877),it=i(15906);const at=(0,a.Pi)((e=>{const{className:t}=e,i=me(),{t:a}=(0,s.$)(),r=(0,l.useRef)(null);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tt.P,{className:t,leftText:"",isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>{i.uploadAndPublish(r.current)},onCancel:()=>(0,V.gk)({showHomePage:!1})}),(0,n.jsx)(it.q,{ref:r,uploadStats:i.uploadStats,onRetryUpload:i.retryUploadAndPublishDeps,onCancel:i.handleUploadCancel,onShowUploadFail:()=>{},onPromptConfirmToCancel:i.isAllUploadEndedWatcher.handlePromptConfirmToCancel})]})}));(0,a.Pi)((e=>{const[t,i]=(0,l.useState)(!1);(0,l.useEffect)((()=>{window.showStickerDebugWindow=()=>{var e,t;i(!0),null===(e=window.getSelection())||void 0===e||e.removeAllRanges(),null===(t=window.vconsole)||void 0===t||t.showSwitch()}}),[]);const a=(0,l.useRef)(null),{store:s}=window;return t?(0,n.jsxs)("div",{style:{position:"fixed",top:10,left:0,bottom:10,width:250,zIndex:2,backgroundColor:"white",padding:8,display:"flex",flexDirection:"column",overflow:"auto",color:"black"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,n.jsx)("div",{children:"\u5bfc\u5165\u7684\u6587\u5b57\u6a21\u677f\u72b6\u6001"}),(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)("div",{style:{cursor:"pointer",marginInlineEnd:8},onClick:()=>{var e,t;const i=(null===(e=a.current)||void 0===e?void 0:e.innerText)||"",s=document.createElement("textarea");s.value=i,document.body.append(s),s.select(),document.execCommand("copy"),s.blur(),U.FN.info("\u590d\u5236\u6210\u529f"),null===(t=s.parentNode)||void 0===t||t.removeChild(s)},children:"\u590d\u5236"}),(0,n.jsx)("div",{style:{cursor:"pointer"},onClick:()=>i(!1),children:"\u5173\u95ed"})]})]}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"60px 1fr",rowGap:10,columnGap:8,marginTop:10},ref:a,children:[s.textTemplateList.materials.map(((e,t)=>(0,n.jsxs)(l.Fragment,{children:[e.languages.map(((i,a)=>(0,n.jsxs)(l.Fragment,{children:[(0,n.jsxs)("div",{children:["\u6587\u5b57\u6a21\u677f",t+1,(0,n.jsx)("br",{}),i.lang," ",0===a&&"\u4e3b"]}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",rowGap:6},children:[0===a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:["id: ",e.id]}),(0,n.jsx)("div",{children:e.isMultiLang?`\u591a\u8bed\u8a00 resourceId: ${e.resourceId||"\u65e0"}`:"\u5355\u8bed\u8a00"})]}),(0,n.jsxs)("div",{children:["\u5355\u54c1 resourceId: ",i.resourceId||"\u65e0"]}),i.templateZipData.flowerTexts.map((e=>(0,n.jsxs)("div",{children:["\u9644\u5c5e\u82b1\u5b57: ",e.id]},e.id))),i.templateZipData.stickers.map((e=>(0,n.jsxs)("div",{children:["\u9644\u5c5e\u8d34\u7eb8: ",e.id]},e.id)))]})]},i.lang))),(0,n.jsx)("div",{children:"=========="}),(0,n.jsx)("div",{children:"===================="})]},t))),s.flowerTextList.materials.map(((e,t)=>(0,n.jsxs)(l.Fragment,{children:[e.subFlowerTexts.map(((i,a)=>(0,n.jsxs)(l.Fragment,{children:[(0,n.jsxs)("div",{children:["\u82b1\u5b57",t+1,(0,n.jsx)("br",{}),i.lang," ",0===a&&"\u4e3b"]}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",rowGap:6},children:[0===a&&(0,n.jsxs)("div",{children:["groupId: ",e.groupId]}),(0,n.jsxs)("div",{children:["id: ",i.id]}),(0,n.jsxs)("div",{children:["resourceId: ",i.resourceId||"\u65e0"]})]})]},i.lang))),(0,n.jsx)("div",{children:"=========="}),(0,n.jsx)("div",{children:"==================="})]},t))),s.stickers.map(((e,t)=>(0,n.jsxs)(l.Fragment,{children:[(0,n.jsxs)("div",{children:["\u8d34\u7eb8",t+1]}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",rowGap:6},children:(0,n.jsxs)("div",{children:["id: ",e.id]})})]},t)))]})]}):null}));var st=i(39931),lt=i(71025),rt=i(67037);const nt=(0,a.Pi)((e=>{const t=ue(),{t:i}=(0,s.$)();return(0,st.F)({title:i("pc_text_template_item_release_web"),pid:"publish-text-template-single"}),(0,lt.d)(),(0,n.jsxs)(pe.Provider,{value:t,children:[(0,n.jsxs)("div",{className:rt.Z.page,children:[(0,n.jsxs)("div",{className:rt.Z.content,children:[(0,n.jsx)(o,{className:rt.Z.instruction}),(0,n.jsx)(et,{className:rt.Z.mainForm})]}),(0,n.jsx)(at,{className:rt.Z.footer})]}),!1]})}))}}]);