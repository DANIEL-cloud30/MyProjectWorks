"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[294],{38823:(e,t,i)=>{i.d(t,{i:()=>l});var a=i(95113),s=i(93553);const l=(0,a.Z)(s.Z);l.Option=s.Z.Option,l.OptGroup=s.Z.OptGroup},56475:(e,t,i)=>{i.d(t,{Z:()=>l});var a=i(18571),s=i(43230);function l(){return(0,a.useContext)(s.mC)}},79337:(e,t,i)=>{i.d(t,{EG:()=>p.Z,Ex:()=>c.Z,FN:()=>m.Z,Form:()=>h.Z,II:()=>n.Z,Kx:()=>o.Z,Lt:()=>r.Z,Q2:()=>f.Z,Vp:()=>d.Z,XQ:()=>_.Z,XZ:()=>s.ZP,ih:()=>b.i,u:()=>g.Z,u_:()=>l.Z,yC:()=>u.Z,z8:()=>v.z,zx:()=>a.Z});i(38109);var a=i(46995),s=i(47225),l=i(74970),r=i(49230),n=i(56027),o=i(48905),c=i(15842),u=i(52985),d=i(8050),p=i(75082),m=i(76538),g=i(44601),h=i(63803),_=i(56475),f=i(95113),b=i(38823),v=i(17404)},1117:(e,t,i)=>{i.d(t,{$X:()=>r,pn:()=>s,sR:()=>l});var a=i(45394);function s({isVip:e,isBusiness:t,authFiles:i}){var s;const l=null!==(s=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==s?s:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:a.$x.Vip,auth_status:e?a.U9.Authorized:a.U9.Unauthorized,third_party_agreements:[]},{scene:a.$x.Business,auth_status:t?a.U9.Authorized:a.U9.Unauthorized,third_party_agreements:t?l:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function l(e){const{isOriginal:t=!1,isVip:i=!1,isBusiness:a=!1,authFiles:l}=e;const{root:r}=s({isVip:i,isBusiness:a,authFiles:l});return{copyright:r.copyright}}function r(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===a.U9.Authorized)))}},44783:(e,t,i)=>{i.d(t,{$v:()=>u,Ad:()=>m,DV:()=>o,S4:()=>d,SB:()=>h,Sj:()=>c,_4:()=>g,ce:()=>p,iL:()=>r,j2:()=>n});var a=i(45725);function s(e){return void 0===e?e:String(Math.round(e/1024))}function l(e){const{material_category:t,material_type:i,collection_detail:a}=e;return{material_category:t,material_type:i,...a&&"collection"===i&&{collection_detail:a}}}function r(e){const{action:t,extra:i={},material_cnt:s}=e;(0,a.g)({eventName:"personal_page_material_publish_page_action",params:{action:t,material_cnt:s,...l(e),...i}})}function n(e){const{error_report:t,upload_status:i,time:r,isCompressed:n,sizeBeforeCompress:o,sizeAfterCompress:c,resolutionBeforeCompress:u,resolutionAfterCompress:d,extra:p={}}=e;(0,a.g)({eventName:"personal_page_material_upload_status",params:{...l(e),error_report:t,upload_status:i,time:r,is_compressed:n?1:0,...n&&{material_size_before_compress:s(o),material_size_after_compress:s(c),material_resolution_before_compress:u,material_resolution_after_compress:d},...p}})}function o(e){const{error_report:t}=e;(0,a.g)({eventName:"personal_page_material_import_error_report",params:{...l(e),error_report:t}})}function c(e){if(0===e.length)return;const t=function(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,i])=>{const a=i||"";t[e]=t[e]?`${t[e]},${a}`:a}))})),t}(e),i=new Set(t.material_type.split(","));1===i.size&&(t.material_type=i.values().next().value),(0,a.g)({eventName:"personal_page_material_publish_error_report",params:t})}function u(e){const{status:t,material_type:i,material_category:l,title:r,description:n,isOriginal:o,tags:c,material_format:u,material_size:d,resolution:p,error_type:m,cover_type:g,time:h,extra:_={},authorize_range:f,isVipAuthorized:b,isBusinessAuthorized:v,is_official_task:S,task_id:y,material_id:w,material_subcategory:x,effect_type_title:T,effect_type_id:L,material_group_id:F,material_language:C}=e;return(0,a.g)({eventName:"personal_page_material_publish_status",params:{status:t,material_type:i,material_category:l,material_title:r,material_introduction:n,is_original:o?"1":"0",hashtag:c.join(","),material_format:u,material_size:s(d),resolution:p,authorize_range:f,is_official_task:S,task_id:y,material_id:w,material_subcategory:x,material_language:C,material_group_id:F,effect_type_title:T,effect_type_id:L,..."fail"===t&&{error_type:m},cover_type:g,time:h,is_subscription_authorized:b?1:0,is_commercial_authorized:v?1:0,..._}})}function d(e){return(0,a.g)({eventName:"personal_page_material_publish_page_result",params:e})}function p(e){const{action:t,material_category:i,material_type:s,entry_from:l}=e;return(0,a.g)({eventName:"ugc_material_subscription_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:l}})}function m(e){const{action:t,material_category:i,material_type:s,entry_from:l,hasCopyrightAuthorization:r}=e;return(0,a.g)({eventName:"ugc_material_commercial_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:l,..."boolean"==typeof r&&{has_copyright_authorization:r?"1":"0"}}})}function g(e){const{action:t,page_type:i,material_category:s,material_type:l,button_name:r}=e;return(0,a.g)({eventName:"ugc_material_creator_sign_agreement",params:{action:t,page_type:i,material_category:s,material_type:l,...r&&{button_name:r}}})}function h(e){const{caption_template_cnt:t,captionAnimationIds:i=[],text_template_cnt:s,material_type:l,text_special_effect_cnt:r}=e;return(0,a.g)({eventName:"material_tool_click_publish_confirm",params:{caption_template_cnt:t,caption_animation_id:i.join(","),text_template_cnt:s,material_type:l,text_special_effect_cnt:r}})}},1882:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Wt});var a=i(65625),s=i(9995),l=i(18571),r=i(71443),n=i(72322);const o=(0,a.Pi)((e=>{const{className:t}=e,{t:i}=(0,s.$)(),a=(0,l.useMemo)((()=>[{key:"subtitleTemplate",title:i("pc_subtitle_template_description_web"),instructions:[{key:"",title:i("pc_subtitle_template_effect_release_web")}]}]),[]),o=(0,l.useMemo)((()=>()=>"init"),[]);return(0,n.jsx)(r.v,{className:t,groups:a,initGroup:"subtitleTemplate",activeGroup:"subtitleTemplate",resetExpandedGroupKey:"subtitleTemplate",getStatus:o})}));var c=i(54275),u=i(62369),d=i(84117),p=i(18751),m=i.n(p),g=i(85543),h=i(89252),_=i(56366),f=i(60963);var b=i(55364),v=i(86486),S=i(10878),y=i(1117),w=i(13647),x=i(62027),T=i(45394),L=i(65751);function F(e){const{id:t,resourceId:i,isMultiLang:a}=e,s=e.languages.map(((e,t)=>function(e,t){const{lang:i,title:a,resourceId:s,templateZipData:l}=e,{coverFile:r,extraJson:n}=l.template;return{lang:i,title:a||"",resourceId:s,templateZipData:l,cover:(0,v.B4)({src:t.needSrc?(0,b.y8)(r):"",file:r}),staticFrame:(0,v.wt)({}),file:(0,f.LO)({...(0,v.Dz)({}),previewTime:0,extraJson:n},{extraJson:f.LO.ref}),publishType:s?"update":"create"}}(e,{needSrc:!0}))),l=s.map((e=>e.lang));return(0,f.LO)({id:t,resourceId:a?i:s[0].resourceId,title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:(0,w.K)(x.YW.OriginalForSubscription),isHighPriority:!1,isMultiLang:a,languages:s,selectedLanguages:l,onlineData:{isOriginal:!1,isVip:!1,isBusiness:!1,resourceId:i,langResourceIds:[],langResourceIdMap:{}}},{onlineData:f.LO.ref})}function C(e){return Boolean(e.title&&e.tags.length&&e.languages[0].staticFrame.src)}function I(e){return e.languages[0]}function j(e,t){const{resourceId:i,title:a,tags:s,isVip:l,isBusiness:r,isOriginal:n,isHighPriority:o,onlineData:c}=e,u=e.languages.filter((t=>e.selectedLanguages.includes(t.lang))),d=u[0],{sdkVersion:p}=d.templateZipData,m=t.authFileUploadServiceManager.getUploadedFiles(e.id),g=T.r0.UserPostPcMultiLangSubtitleTemplate,h=o?`${g}_without_review`:g;if(c.resourceId){const t=(0,y.sR)({isOriginal:n,isVip:l,isBusiness:r,authFiles:m,onlineData:c}),{newResourceIdList:o}=function(e){var t;const{onlineData:i}=e;let a=!1;const s=[...i.langResourceIds];let l=e.languages;(null===(t=e.selectedLanguages)||void 0===t?void 0:t.length)>0&&(l=l.filter((t=>e.selectedLanguages.includes(t.lang))));for(const r of l){const e=i.langResourceIdMap[r.lang];if(e&&e===r.resourceId)continue;const t=s.findIndex((t=>t===(null!=e?e:r.resourceId)));-1===t?s.push(r.resourceId):s[t]=r.resourceId,a=!0}return{newResourceIdList:s,isResourceIdListUpdated:a}}(e);return{id:i,..."en"===d.lang&&{title:a,description:a,icon:{image_uri:d.cover.uri,static_uri:d.staticFrame.uri},tags:s,...t},collection_info:{resource_id_list:o}}}const _=(0,y.pn)({isVip:l,isBusiness:r,authFiles:m}),f=u.map((e=>e.resourceId));return{effect_type:L.Ab.MultiLanguageSubtitleTemplate,is_vip:l,..._.root,common_data:{title:a,description:a,icon:{image_uri:d.cover.uri,static_uri:d.staticFrame.uri},sdk_version:p,source:h,tags:s,is_original:n,is_business:r,post_channel:T.iu.Open,..._.commonData},collection_info:{resource_id_list:f}}}const k="root-yJbCk1",P="statusBar-p1WeHS",N=(0,a.Pi)((e=>{const{className:t,subtitleTemplate:i,isSelected:a,onClick:s}=e,l=I(i),r=!l.staticFrame.src;return(0,n.jsxs)("div",{className:m()(k,t),onClick:()=>{s(i)},children:[(0,n.jsx)(g.Y,{src:r?"":l.cover.src,isInvalid:!1,isSelected:a,size:80,onContextMenu:e=>{e.preventDefault(),s(i)}}),(0,n.jsx)(h.ir,{className:P,loading:r,invalid:!1,errorToolip:"",isInfoComplete:C(i),title:i.title})]})}));var A=i(75255),Z=i(79337),M=i(35930),z=i(71995),D=i(21798),O=i(18651),U=i(72383),B=i(59359),R=i(21386),E=i(71166),V=i(15027),$=i(1536),H=i(3703),q=i(97775),W=i(76937),G=i(24238),J=i(21886),Q=i(42012),X=i(83701),Y=i(52081),K=i(61053),ee=i(61679),te=i(81071),ie=i(65284),ae=i(44783);let se=null;const le=new Map;function re(){const e=(0,U.G)({watch:()=>n.isAllUploadEnded}),t=(0,U.G)({watch:()=>n.isDepUploaded&&!n.isAllUploadEndedWatcher.isPromptingConfirmToCancel}),i=(0,te.e)({watch:()=>n.subtitleTemplateList.materials.every((e=>n.getSelectedLanguages(e).every((e=>e.staticFrame.src))))}),a=(0,l.useMemo)((()=>new E.w),[]),{t:r}=(0,s.$)(),n=(0,A.fv)((()=>({publishStartTime:0,formApi:null,setFormApi:e=>{n.formApi=e},performanceTimingCollector:(0,ee.uY)(),initOp:new V.q({fetchFirstPage:async()=>{$.appModel.isInited||await(0,H.cb)({throwOnError:!0}),n.performanceTimingCollector.addTiming("initFullAppInfoDone"),(0,z.c6)("[SingleStore] getSubtitleTemplateSingleInitialData req --\x3e");const e=await(0,B.HY)();(0,z.c6)("[SingleStore] getSubtitleTemplateSingleInitialData resp <--",(0,_.Z)(e,"type","singles")),n.performanceTimingCollector.addTiming("getInitialDataDone");const t=[],i=[],a=[];for(const r of e.singles){const e=await n.makeInitSubtitleTemplate(r,i,a);t.push(e)}n.performanceTimingCollector.addTiming("initSubtitleTemplateDone"),(0,z.c6)("[SingleStore] make init flowerText sticker start");const s=i.map((e=>(0,ie.Sv)(e))),l=a.map((e=>(0,ie.wu)(e)));return()=>{n.subtitleTemplateList.replaceByMap(t,(e=>e)),n.flowerTextList.replaceByMap(s,(e=>e)),n.stickers=l;const e=n.subtitleTemplateList.materials[0];n.subtitleTemplateList.select(e),n.initStaticFrame(n.subtitleTemplateList.materials),n.initUploadFiles(),n.performanceTimingCollector.addSetStateTiming(ee.Pk)}},slardarErrorLog:(e,t)=>{(0,z.RF)(`[SingleStore] ${e} failed`,t),n.performanceTimingCollector.addSetStateTiming(ee.Pk,{scene:"initFailed"})}}),async makeInitSubtitleTemplate(e,t,i){const{id:a,resourceId:s,isMultiLang:l,languages:r}=e,n=[];(0,z.c6)("[SingleStore] makeInitSubtitleTemplate start",{id:a});for(const o of r){const{lang:e,resourceId:s,title:l}=o;(0,z.c6)("[SingleStore] makeInitSubtitleTemplate one language start",{id:a,lang:e});const r=new q.v({id:`${e}-${a}`,effectType:L.Ab.SubtitleTemplate,fetchZipBase64:async()=>{const{zipData:t}=await(0,B.Qy)({id:a,lang:e});return t}});await r.init(),n.push({lang:e,title:l||"",resourceId:s,templateZipData:r});for(const i of r.flowerTexts){const a=i.id;let s=t.find((e=>e.groupId&&e.groupId===a));s||(s={groupId:a,subFlowerTexts:[]},t.push(s)),s.subFlowerTexts.push({lang:e,data:i})}for(const t of r.stickers)i.some((e=>e.id===t.id))||i.push(t)}return(0,z.c6)("[SingleStore] makeInitSubtitleTemplate done",{id:a}),F({id:a,isMultiLang:l,resourceId:s,languages:n})},get mainFormLayout(){const{fetchStatus:e}=n.initOp;return e.isFailed?"error":e.hasFetched?"mainForm":"loading"},get needConfirmModalOnClose(){return!0},get field(){return{canBusiness:Q.$.permissions.includes(Q.v.EffectSetBusiness),canVip:Q.$.permissions.includes(Q.v.EffectSetVip),canHighPrio:Q.$.permissions.includes(Q.v.EffectHighPrio)}},pubService:new M.Z,sendLogService:new J.D5({itemType:L.Ab.SubtitleTemplate}),authorSignService:new D.I({signScene:R.d.BusinessArtist}),authFileUploadServiceManager:new O.r({}),isAllUploadEndedWatcher:e,fileOp:new v.N0({uploadConfigService:a}),subtitleTemplateList:new G.T({}),flowerTextList:new G.T({}),stickers:[],getSelectedLanguages:e=>e.languages.filter((t=>e.selectedLanguages.includes(t.lang))),init(){n.initOp.initFetchFirstPage(null)},retryInit(){n.initOp.retryFetchFirstPage()},selectSubtitleTemplateCard(e){n.saveCurrentForm(),n.subtitleTemplateList.select(e),n.flowerTextList.select(null)},selectFlowerTextCard(e){n.saveCurrentForm(),n.flowerTextList.select(e),n.subtitleTemplateList.select(null)},initSubtitleTemplateForm(e){var t;null===(t=n.formApi)||void 0===t||t.setValues({subtitleTemplate:{title:e.title,tags:[...e.tags],isOriginal:e.isOriginal,isVip:e.isVip,isBusiness:e.isBusiness,isHighPriority:e.isHighPriority}})},saveSubtitleTemplateForm(e){var t;const i=null===(t=n.formApi)||void 0===t?void 0:t.getValues().subtitleTemplate;i&&(0,X.L)(e,{title:i.title||"",tags:i.tags,isOriginal:i.isOriginal||!1,isVip:i.isVip||!1,isBusiness:i.isBusiness||!1,isHighPriority:i.isHighPriority||!1})},initFlowerTextForm(e){var t;null===(t=n.formApi)||void 0===t||t.setValues({flowerText:{title:e.title,tags:[...e.tags]}})},applyTagsToAll(e){n.flowerTextList.updateAll((t=>{t.tags=[...e]}))},saveFlowerTextForm(e){var t;const i=null===(t=n.formApi)||void 0===t?void 0:t.getValues().flowerText;i&&(0,X.L)(e,{title:i.title||"",tags:i.tags})},saveCurrentForm(){n.subtitleTemplateList.selected?n.saveSubtitleTemplateForm(n.subtitleTemplateList.selected):n.flowerTextList.selected&&n.saveFlowerTextForm(n.flowerTextList.selected)},initStaticFrameTimer:new K.B,async initStaticFrame(e){for(const t of e){const{id:e,languages:i}=t;for(let a=0;a<i.length;a+=1){const s=i[a];await n.fileOp.initStaticFrame({id:`${s.lang}-${e}`,getInitIndex:()=>0===a?null:t.languages[0].staticFrame.index,staticFrame:s.staticFrame,templateZipData:s.templateZipData}),await n.initStaticFrameTimer.timeout(100)}}},async initUploadFiles(){try{await a.getUploadConfigs("initUploadFiles")}catch{}for(const e of n.subtitleTemplateList.materials)n.initUploadSubtitleTemplateFiles(e);(0,ie.er)(n.fileOp,{flowerTexts:n.flowerTextList.materials,stickers:n.stickers})},initUploadSubtitleTemplateFiles(e){for(const t of n.getSelectedLanguages(e))n.fileOp.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:(0,W.V)("subtitle-template-cover")})})},async retryUpload(){n.depPublishStatus.isCanceled=!1;try{await a.getUploadConfigs("retryUploadFiles")}catch{n.depPublishStatus.isFailed=!0}for(const e of n.subtitleTemplateList.materials)for(const t of n.getSelectedLanguages(e))n.fileOp.retryUpload(t.cover,t.staticFrame,t.file);(0,ie.Id)(n.fileOp,{flowerTexts:n.flowerTextList.materials,stickers:n.stickers})},handleUploadCancel(){t.stop(),i.stop(),n.isAllUploadEndedWatcher.stop(),n.depPublishStatus.isCanceled=!0,se={status:"cancel"}},async initUploadStaticFrame(e){await i.start();for(const t of n.getSelectedLanguages(e))n.fileOp.initUploadCover({getCover:()=>t.staticFrame,getInitValues:()=>({id:(0,W.V)("subtitle-template-static-frame"),file:new File([(0,b.Jr)(t.staticFrame.src)],"icon.png",{type:"image/png"})})})},handleStaticFrameChange(e,t){for(const i of e.languages)n.fileOp.updateStaticFrame(i.staticFrame,t)},async publishDeps(){const{subtitleTemplateList:e,flowerTextList:t,stickers:i}=n,a=e.materials[0],s=a.selectedLanguages,l=(0,_.Z)(a,"isVip","isBusiness","isOriginal","isHighPriority"),r=(0,ie.Kl)(t.materials,l,s),o=(0,ie.Rd)(i,{...l,getTitle:(e,t)=>{const i=String(t+1).padStart(2,"0");return`${a.title}-${i}`}}),c=await n.pubService.batchPublish([...r,...o]),u=(0,ie.Wl)({flowerTexts:n.flowerTextList.materials,stickers:n.stickers}),d=c.map((e=>e.resource_id));return(0,z.c6)("[SingleStore] deps publish success",{resourceIdList:d,depResourceIdMap:u}),{depResourceIdMap:u}},clearSubtitleTemplateZip(){n.fileOp.templateZipCacheMap.clear();for(const e of n.subtitleTemplateList.materials)for(const t of e.languages)n.fileOp.saveTemplateZipCache(e.id,t.lang,t.file)},async initUploadSubtitleTemplateZip(e,t){const{subtitleTemplateList:i}=n;for(const a of i.materials)for(const i of n.getSelectedLanguages(a)){const{lang:s,staticFrame:l,templateZipData:r}=i;if(await n.fileOp.initUploadTemplateZip({id:a.id,lang:s,zipFile:i.file,staticFrame:l,templateZipData:r,depResourceIdMap:e,checkIsCanceled:()=>t.isCanceled}),t.isCanceled)return}},depPublishStatus:{isFailed:!1,isCanceled:!1,isDone:!1},async startUploadAndPublishDeps(e){try{for(const e of n.subtitleTemplateList.materials)n.initUploadStaticFrame(e);await t.start();const{depResourceIdMap:i}=await n.publishDeps();if(e.isCanceled)return void(se={status:"cancel"});await n.initUploadSubtitleTemplateZip(i,e),(0,f.z)((()=>{e.isDone=!0}))}catch(i){(0,f.z)((()=>{e.isFailed=!0})),se={status:"fail",error:i},(0,z.RF)("[SingleStore] startUploadAndPublishDeps failed",i)}},get depUploadStats(){const e={pending:0,succeeded:0,failed:0};for(const i of n.flowerTextList.materials){var t;let a=i.subFlowerTexts;const s=null===(t=n.subtitleTemplateList)||void 0===t||null===(t=t.materials)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.selectedLanguages;null!=s&&s.length&&(a=a.filter((e=>s.includes(e.lang))));for(const t of a)(0,v.r)(e,t.cover,t.file)}for(const i of n.stickers)(0,v.r)(e,i.cover);return e},get isDepUploaded(){const{pending:e,failed:t}=n.depUploadStats;return!e&&!t},get uploadStats(){const e={uninited:0,...n.depUploadStats};for(const a of n.subtitleTemplateList.materials)for(const t of n.getSelectedLanguages(a))(0,v.r)(e,t.cover,t.staticFrame,t.file);const{isFailed:t,isDone:i}=n.depPublishStatus;return t?e.failed+=1:i?e.succeeded+=1:e.pending+=1,e},get isAllUploaded(){const{pending:e,failed:t}=n.uploadStats;return!e&&!t},get isAllUploadEnded(){const{pending:e}=n.uploadStats;return 0===e},get isUploadHasFailure(){const{failed:e}=n.uploadStats;return e>0},get isReadyToPublish(){const{subtitleTemplateList:e,flowerTextList:t}=n;return e.length>0&&e.materials.every((e=>C(e)))&&t.materials.every((e=>(0,ie.QX)(e)))&&!n.isPublishSucceeded},async uploadAndPublish(e){n.publishStartTime=Date.now(),se=null,le.clear(),n.saveCurrentForm(),n.sendMaterialToolClickPublishLog(),n.retryUploadAndPublishDeps(),null==e||e.show();try{await n.isAllUploadEndedWatcher.start(),n.isUploadHasFailure?se={...se||{},status:"fail"}:await n.publish()}finally{null==e||e.hide()}this.sendMaterialPubishStatusLog(),this.sendPublishPageResultLog()},async retryUploadAndPublishDeps(){n.clearSubtitleTemplateZip(),n.depPublishStatus={isFailed:!1,isCanceled:!1,isDone:!1};const{depPublishStatus:e}=n;await n.retryUpload(),n.startUploadAndPublishDeps(e)},isPublishing:!1,isPublishSucceeded:!1,async publish(){n.isPublishing=!0;try{await n.publishImpl()}catch(e){return se||(se={status:"fail",error:e}),Z.FN.error(r("pc_sticker_release_failed_retry_web")),(0,f.z)((()=>{n.isPublishing=!1})),void(0,z.RF)("[SingleStore] publish failed",e)}(0,f.z)((()=>{n.isPublishing=!1,n.isPublishSucceeded=!0})),Z.FN.info({content:r("pc_subtitle_template_release_successful_check_web",{num:n.subtitleTemplateList.length}),textMaxWidth:"80vw"}),(0,z.c6)("[SingleStore] publish success"),setTimeout((()=>(0,B.gk)({showHomePage:!0})),3e3)},async publishImpl(){const e=n.subtitleTemplateList.materials.map((e=>{const{isMultiLang:t}=e,{authFileUploadServiceManager:i}=n;return n.getSelectedLanguages(e).map((a=>{const s=`${a.lang}-${e.id}`,l=function(e,t,i){const a=I(e),s={...(0,_.Z)(e,["title","tags","isHighPriority","isVip","isBusiness","isOriginal"]),...(0,_.Z)(a,"cover","staticFrame","file"),...(0,_.Z)(t,"lang","cover","staticFrame","file"),authFiles:i.authFileUploadServiceManager.getUploadedFiles(e.id),baseSource:i.baseSource};return"update"===a.publishType?(0,S.xo)({id:a.resourceId,onlineData:e.onlineData,...s}):(0,S.Ob)({effectType:L.Ab.SubtitleTemplate,templateZipData:a.templateZipData,extraJson:a.file.extraJson,...s})}(e,a,{authFileUploadServiceManager:i,baseSource:T.r0.UserPostPcMultiLangSubtitleTemplate});return{id:s,req:l,onResult:(0,f.aD)((({req:i,resourceId:l,error:r,errorText:n,time:o})=>{le.set(s,{req:i,lang:a.lang,time:o,error:r,errorText:n,resourceId:l,activityId:void 0}),r?(0,z.RF)(`[SingleStore] single publish failed {${s}}`,r):(a.resourceId=l,t||(e.resourceId=l),(0,z.c6)(`[SingleStore] single publish success {${s}}`,{resourceId:l}))})),onUpdateResult:(0,f.aD)((({req:e,resourceId:t,error:i,errorText:a,time:l})=>{i?(0,z.RF)(`[SingleStore] single update failed {${s}}`,i):(0,z.c6)(`[SingleStore] single update success {${s}}`,{resourceId:t})}))}}))})).flat();(0,z.c6)("[SingleStore] single publish start",{resourceIdList:e.map((e=>e.id))});const t=(await n.pubService.batchPublish(e)).map((e=>e.resource_id));(0,z.c6)("[SingleStore] single publish done",{resourceIdList:t});const i=n.subtitleTemplateList.materials.filter((e=>e.isMultiLang)).map((e=>{const{authFileUploadServiceManager:t}=n,i=e.id;return{id:i,req:j(e,{authFileUploadServiceManager:t,baseSource:T.r0.UserPostPc}),onResult:(0,f.aD)((({req:t,resourceId:a,error:s,errorText:l,time:r})=>{s?(0,z.RF)(`[SingleStore] multi lang publish failed {${i}}`,s):(e.resourceId=a,(0,z.c6)(`[SingleStore] multi lang publish success {${i}}`,{resourceId:a}))})),onUpdateResult:(0,f.aD)((({req:e,resourceId:t,error:a,errorText:s,time:l})=>{a?(0,z.RF)(`[SingleStore] multi lang update failed {${i}}`,a):(0,z.c6)(`[SingleStore] multi lang update success {${i}}`,{resourceId:t})}))}}));(0,z.c6)("[SingleStore] multi lang publish start",{resourceIdList:i.map((e=>e.id))}),await n.pubService.batchPublish(i).then((e=>{var t;const i=null==e||null===(t=e[0])||void 0===t?void 0:t.resource_id;return le.forEach((e=>e.groupId=i)),se={status:"success",resourceId:i},e}),(e=>{throw se={status:"fail",error:e},e}));n.subtitleTemplateList.materials.some((e=>!e.onlineData.resourceId))?(await n.pubService.pollUntilAllInEffectList({ids:t.slice(-M.f),types:[L.Ab.SubtitleTemplate]}),(0,z.c6)("[SingleStore] poll done")):(0,z.c6)("[SingleStore] no need to poll")},async sendMaterialToolClickPublishLog(){const{subtitleTemplateList:e}=n,t=e.materials.map((e=>{var t;const i=e.languages[0].templateZipData.template.captionAnimationJson;return null!==(t=null==i?void 0:i.caption_animation.map((e=>e.resource_id)).filter((e=>Boolean(e))))&&void 0!==t?t:[]}));(0,z.c6)("[SingleStore] sendMaterialToolClickPublishConfirm",{caption_template_cnt:e.length,captionAnimationIds:t.flat()}),(0,ae.SB)({caption_template_cnt:e.length,captionAnimationIds:t.flat(),material_type:"single"})},sendPublishPageResultLog(){var e;if(!se)return;const t=n.subtitleTemplateList.materials.map((e=>n.getSelectedLanguages(e))).flat();n.sendLogService.sendMaterialPublishPageResultLog({status:se.status,time:Date.now()-n.publishStartTime,material_cnt:t.length,material_id:t.map((e=>e.resourceId)).join(","),error_type:null===(e=se.error)||void 0===e?void 0:e.message}),se=null},sendMaterialPubishStatusLog(){le.forEach(((e,t)=>{n.sendLogService.sendMaterialPublishStatusLog({time:e.time,status:e.error?"fail":"success",error_type:e.errorText,publishParams:e.req,path:"",targetedActivityId:e.activityId},{material_id:e.resourceId,material_language:e.lang,material_group_id:e.groupId})})),le.clear()},collectLogData(){const e=["id","uri","isUploadFailed"],t=n.subtitleTemplateList.materials.map((t=>({...(0,_.Z)(t,"id","resourceId","isMultiLang"),languages:t.languages.map((t=>({...(0,_.Z)(t,"lang","resourceId"),cover:(0,_.Z)(t.cover,e),staticFrame:(0,_.Z)(t.staticFrame,[...e,"index"]),file:(0,_.Z)(t.file,e),extraJson:t.file.extraJson})))}))),i=n.flowerTextList.materials.map((t=>({...(0,_.Z)(t,"id","isDepMaterial","sdkVersion"),subFlowerTexts:t.subFlowerTexts.map((t=>({...(0,_.Z)(t,"id","lang","resourceId"),cover:(0,_.Z)(t.cover,e),file:(0,_.Z)(t.file,e)})))}))),a=n.stickers.map((t=>({...(0,_.Z)(t,"id","resourceId","isDepMaterial","isSequence"),cover:(0,_.Z)(t.cover,e)}))),s={subtitleTemplates:t,subtitleTemplateCount:t.length,flowerTexts:i,stickers:a,isReadyToPublish:n.isReadyToPublish,depPublishStatus:{...n.depPublishStatus},uploadStats:{...n.uploadStats}};(0,z.c6)("[SingleStore] collectLogData",s)}})));return(0,Y.L)({watch:()=>{n.uploadStats,n.isReadyToPublish},collect:n.collectLogData}),(0,l.useEffect)((()=>(window.store=n,n.init(),n.authorSignService.init(),()=>{n.initStaticFrameTimer.cancel()})),[]),n}const ne=(0,l.createContext)(null),oe=()=>(0,l.useContext)(ne);var ce=i(45092);const ue=(0,a.Pi)((e=>{const{className:t}=e,i=oe();return(0,n.jsx)("div",{className:m()(ce.Z.root,t),children:(0,n.jsx)("div",{className:ce.Z.container,children:i.subtitleTemplateList.materials.map(((e,t)=>(0,n.jsx)(N,{className:ce.Z.card,subtitleTemplate:e,isSelected:i.subtitleTemplateList.selectedId===e.id,onClick:i.selectSubtitleTemplateCard},e.id)))})})}));var de=i(58845);const pe=(0,a.Pi)((e=>{const{className:t}=e,i=oe();return(0,n.jsx)("div",{className:m()(ce.Z.root,t),children:(0,n.jsx)("div",{className:ce.Z.container,children:i.flowerTextList.materials.map(((e,t)=>(0,n.jsx)(de.M,{className:ce.Z.card,flowerText:e,isSelected:i.flowerTextList.selectedId===e.id,onClick:i.selectFlowerTextCard},e.id)))})})}));var me=i(12625),ge=i(23725),he=i(58861),_e=i(69434),fe=(i(80495),i(77209)),be=i(92304),ve=i(4281);const Se="root-ff5Go9",ye="disabled-gDaIdV",we="help-zq6k5a",xe=(0,Z.Q2)((e=>{const{t}=(0,s.$)(),{value:i,onChange:a,sendLogService:l,disabledTooltip:r,...o}=e,{className:c,disabled:u}=o,d=x.YW.OriginalForSubscription,{showModal:p,showModalWithoutReview:g}=(0,x.ZP)({handleBtnText:t("pc_template_authorize_confirm_web"),closeIcon:!0,protocol:d,needReview:!0,onOk:()=>{(0,w.F)(d),null==a||a(!0),l.sendSubscriptionStatementLog({action:"confirm",entry_from:"checkbox"}),l.sendClickSubscriptionCheckboxLog(!0)}}),{handleMouseEnter:h}=(0,be.w)({cursor:"not-allowed",content:r}),{handleMouseOver:_}=(0,be.S)({checkIsTarget:e=>null!==e.closest(".semi-checkbox-addon")}),f=m()(o.className,ve.i.heycanCheckboxEllipsis);return(0,n.jsxs)("div",{className:m()(Se,u&&ye,c),onMouseEnter:u&&r?h:void 0,onMouseOver:u&&r?void 0:_,children:[(0,n.jsx)(Z.XZ,{...o,className:f,checked:i,onChange:e=>{const t=Boolean(e.target.checked);if(t&&!(0,w.K)(d))return p(),void l.sendSubscriptionStatementLog({action:"show",entry_from:"checkbox"});l.sendClickSubscriptionCheckboxLog(t),null==a||a(t)},children:t("pc_template_authorize_pro_web")}),(0,n.jsx)(fe.r,{className:we,onClick:()=>{g(),l.sendSubscriptionStatementLog({action:"show",entry_from:"question_mark"})}})]})}));var Te=i(99084),Le=i(56220);const Fe="modal-S_b8i3",Ce="content-oiSfAy",Ie="title-N9LwzD",je="description-Hachtj",ke="buttonContainer-k71Pqw",Pe="button-TW07qH",Ne=e=>{const{title:t,description:i,primaryButtonProps:a,secondaryButtonProps:s}=e;return(0,n.jsxs)("div",{className:Ce,children:[(0,n.jsx)("div",{className:Ie,children:t}),(0,n.jsx)("div",{className:je,children:i}),(0,n.jsxs)("div",{className:ke,children:[a&&(0,n.jsx)(Z.zx,{className:Pe,type:"primary",theme:"solid",...a}),s&&(0,n.jsx)(Z.zx,{className:Pe,type:"secondary",theme:"solid",...s})]})]})};const Ae=(0,i(46036).A)((function(e){return l.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.08 7.6a1.5 1.5 0 0 1 2.12 0l5.66 5.65 5.66-5.65a1.5 1.5 0 1 1 2.12 2.12l-6.72 6.72a1.5 1.5 0 0 1-2.12 0L4.08 9.72a1.5 1.5 0 0 1 0-2.12Z",fill:"currentColor"}))}),"chevron_down");var Ze=i(69687),Me=i(12599),ze=i(77936);const De="input-gRb1O6",Oe=(0,Z.Q2)((e=>{const{className:t,maxLength:i,onChange:a,onCompositionStart:s,onCompositionEnd:r}=e,[o,u]=(0,l.useState)(""),d=(0,l.useRef)(!1),p=(0,c.Z)((e=>void 0===i?e:(0,Me.aF)(e,i))),g=(0,c.Z)((e=>{d.current=!0,u(e.currentTarget.value),null==s||s(e)})),h=(0,l.useRef)(null),{saveSelectionIfNeeded:_}=(0,ze.u)({getInputElem:()=>h.current}),f=(0,c.Z)(((e,t)=>{_(e),null==a||a(e,t)})),b=(0,c.Z)((e=>{const t=p(e.currentTarget.value);d.current=!1,u(""),f(t,null),null==r||r(e)})),v=(0,c.Z)(((e,t)=>{if(d.current)return void u(e);if(void 0===i)return void f(e,t);const a=p(e);f(a,t)}));return(0,n.jsx)(Z.II,{autoComplete:"off",...e,ref:h,className:m()(t,De),value:d.current?o:e.value,maxLength:void 0,onChange:v,onCompositionStart:g,onCompositionEnd:b})}));var Ue=i(90343);const Be="modal-j03Zu2",Re="content-RVu02C",Ee="form-LCc7yN",Ve="idFieldTextarea-QYFmBa",$e="description-uzXbJF",He="regionFieldSelect-g4Dn88",qe="idFieldRow-N48L3C",We="regionField-qLH6NJ",Ge="idFieldLabel-KHst6y",Je="emailField-GN3qXQ",Qe="idTypeField-YlcpiJ",Xe="idField-YtQw4I",Ye="idTypeFieldSelect-xwFQHv",Ke="submitButton-LEfESg";var et=i(24307);const tt=(0,a.Pi)((e=>{const{authorSignService:t,onSubmitStart:i,onSubmitted:a,onClose:r}=e,{t:o}=(0,s.$)(),c=(0,A.fv)((()=>({formApi:null,setFormApi:e=>c.formApi=e,regionList:[],idTypeListMap:{},idTypeList:[],async fetchRegionAndIDTypeList(){let e=null;try{e=await t.fetchRegionData()}catch(l){return Z.FN.error(o("pc_template_authorize_error_web")),void(0,z.RF)("[FormModalContent] fetchRegionData failed",l)}const{country_code_list:i,doc_type_info:a,region:s}=e;(0,f.z)((()=>{var e;c.idTypeListMap=a,c.regionList=Object.entries(i).map((([e,t])=>({label:t,value:e}))).sort(((e,t)=>e.label.localeCompare(t.label)));const t=c.regionList.some((({value:e})=>e===s))?s:"";null===(e=c.formApi)||void 0===e||e.setValue("region",t),c.updateIdFieldsByRegion(t)}))},updateIdFieldsByRegion(e){var t,i,a,s,l,r,n,o,u;const d=null!==(t=c.idTypeListMap[e])&&void 0!==t?t:[],p=$.appModel.appInfo.language.split("-")[0].toLowerCase(),m=(null!==(i=null!==(a=d[p])&&void 0!==a?a:d.en)&&void 0!==i?i:[]).map((({code:e,name:t})=>({label:t,value:e})));(null!==(s=null!==(l=c.idTypeListMap.GLOBAL[p])&&void 0!==l?l:c.idTypeListMap.GLOBAL.en)&&void 0!==s?s:[]).forEach((({code:e,name:t})=>{m.some((t=>t.value===e))||m.push({label:t,value:e})})),m.sort(((e,t)=>e.label.localeCompare(t.label))),(0,f.z)((()=>{c.idTypeList=m})),null===(r=c.formApi)||void 0===r||r.setValue("id",""),null===(n=c.formApi)||void 0===n||n.setValue("idType",null!==(o=null===(u=c.idTypeList[0])||void 0===u?void 0:u.code)&&void 0!==o?o:"")},async fetchBindingEmail(){const e=await(0,Ue.cF)().catch((()=>""));c.formApi&&e&&!c.formApi.getTouched("email")&&c.formApi.setValue("email",e)},isSubmitting:!1,isSubmitable:!1,calcIsSubmitable(e){const{values:t,errors:i}=e;return!!(t&&t.name&&t.region&&t.idType&&t.id&&t.email)&&(!i||!i.email)},handleFormChange:e=>{c.isSubmitable=c.calcIsSubmitable(e)},submitContract:async()=>{var e;const s=await(null===(e=c.formApi)||void 0===e?void 0:e.validate().catch((()=>null)));if(s){c.isSubmitting=!0;try{i();const{contract_id:e}=await t.createContract({identity_nationality:s.region,identity_id_type:s.idType,identity_id:s.id,identity_email:s.email,identity_name:s.name});(0,z.c6)("[FormModalContent] createContract success",{contract_id:e})}catch(l){return Z.FN.error(o("pc_template_authorize_error_web")),void(0,z.RF)("[FormModalContent] createContract failed",l)}finally{c.isSubmitting=!1}a(),r()}}})));return(0,l.useEffect)((()=>{c.formApi&&(c.formApi.setValues({name:"",region:"",idType:"",id:"",email:""}),c.fetchRegionAndIDTypeList(),c.fetchBindingEmail(),window.formStore=c)}),[c.formApi]),(0,n.jsxs)("div",{className:Re,children:[(0,n.jsxs)("div",{className:et.Z.root,children:[(0,n.jsx)("div",{className:et.Z.title,children:o("pc_template_authorize_info_web")}),(0,n.jsx)("div",{className:et.Z.right,children:(0,n.jsx)(Ze.r,{className:et.Z.closeIcon,onClick:r})})]}),(0,n.jsxs)(Z.Form,{className:Ee,getFormApi:c.setFormApi,onChange:c.handleFormChange,children:[(0,n.jsx)("div",{className:$e,children:o("pc_template_authorize_info_contract_web")}),(0,n.jsx)(Oe,{label:o("pc_template_authorize_name_web"),field:"name",placeholder:o("pc_template_authorize_enter_web"),rules:[{required:!0,message:""}]}),(0,n.jsx)(Z.ih,{field:"region",label:o("pc_template_authorize_region_web"),size:"small",fieldClassName:We,className:He,optionList:c.regionList,placeholder:o("pc_template_authorize_select_web"),arrowIcon:(0,n.jsx)(Ae,{}),rules:[{required:!0,message:""}],onChange:e=>c.updateIdFieldsByRegion(e)}),(0,n.jsx)("div",{className:m()(Ge,"semi-form-field"),children:(0,n.jsx)(Z.Form.Label,{required:!0,children:o("pc_template_authorize_certificate_num_web")})}),(0,n.jsxs)("div",{className:qe,children:[(0,n.jsx)(Z.ih,{field:"idType",noLabel:!0,size:"small",fieldClassName:Qe,className:Ye,optionList:c.idTypeList,placeholder:o("pc_template_authorize_select_web"),arrowIcon:(0,n.jsx)(Ae,{}),onChange:()=>{var e;return null===(e=c.formApi)||void 0===e?void 0:e.setValue("id","")},rules:[{required:!0,message:""}]}),(0,n.jsx)(Oe,{noLabel:!0,field:"id",fieldClassName:Xe,className:m()(Ve,ve.i.heycanInputThemeGrey),placeholder:o("pc_template_authorize_enter_n_web"),rules:[{required:!0,message:""}]})]}),(0,n.jsx)(Oe,{fieldClassName:Je,label:o("pc_template_authorize_email_web"),field:"email",placeholder:o("pc_template_enter_email_web"),trigger:"blur",rules:[{required:!0,message:""},{type:"email",message:o("pc_template_authorize_email_error_web")}],onChange:()=>{var e;return null===(e=c.formApi)||void 0===e?void 0:e.setError("email",null)}}),(0,n.jsx)(Z.zx,{className:Ke,type:"primary",theme:"solid",loading:c.isSubmitting,disabled:!c.isSubmitable,onClick:c.submitContract,children:o("pc_template_submit_web")})]})]})})),it=e=>{const{authorSignService:t,sendLogService:i}=e,{t:a}=(0,s.$)(),{openInfoModal:r}=(()=>{const{i18n:e}=(0,s.$)(),t=(0,l.useRef)(null);return(0,l.useEffect)((()=>()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}),[]),{openInfoModal:i=>{var a;const{primaryButtonProps:s,secondaryButtonProps:l,...r}=i,o=Z.u_.info({width:"auto",height:"auto",header:null,footer:null,centered:!0,maskClosable:!1,closable:!1,className:Fe,icon:null,content:(0,n.jsx)(Le.a,{i18n:e,children:(0,n.jsx)(Ne,{...r,primaryButtonProps:s&&{...s,onClick:e=>{var t;null===(t=s.onClick)||void 0===t||t.call(s,e),o.destroy()}},secondaryButtonProps:l&&{...l,onClick:e=>{var t;null===(t=l.onClick)||void 0===t||t.call(l,e),o.destroy()}}})})});return null===(a=t.current)||void 0===a||a.call(t),t.current=()=>{t.current=null,o.destroy()},o}}})(),{openFormModal:o}=(()=>{const{i18n:e}=(0,s.$)(),t=(0,l.useRef)(null);return(0,l.useEffect)((()=>()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}),[]),{openFormModal:i=>{var a;const s=Z.u_.info({width:"auto",height:"auto",header:null,footer:null,centered:!0,maskClosable:!1,closable:!1,className:Be,icon:null,closeOnEsc:!1,content:(0,n.jsx)(Le.a,{i18n:e,children:(0,n.jsx)(tt,{...i,onClose:()=>s.destroy()})})});return null===(a=t.current)||void 0===a||a.call(t),t.current=()=>{t.current=null,s.destroy()},s}}})(),c=()=>{o({authorSignService:t,onSubmitStart:()=>i.sendAuthorSignLog({action:"confirm",page_type:"information",button_name:"submit"}),onSubmitted:u}),i.sendAuthorSignLog({action:"show",page_type:"information"})},u=()=>{r({title:a("pc_template_authorize_submitted_web"),description:a("pc_template_authorize_email_sign_web"),primaryButtonProps:{children:a("pc_template_authorize_ok_web")}}),i.sendAuthorSignLog({action:"show",page_type:"submitted"})};return{openModal:()=>{const{signCode:e}=t;switch(e){case R.Z.Unsigned:return r({title:a("pc_template_authorize_sign_web"),description:a("pc_template_authorize_business_copyright_web"),primaryButtonProps:{children:a("pc_template_authorize_sign_n_web"),onClick:()=>{i.sendAuthorSignLog({action:"confirm",page_type:"sign_agreement",button_name:"sign"}),c()}},secondaryButtonProps:{children:a("pc_template_authorize_cancel_web")}}),void i.sendAuthorSignLog({action:"show",page_type:"sign_agreement"});case R.Z.Signing:return r({title:a("pc_template_authorize_sign_web"),description:a("pc_template_authorize_email_sign_check_web"),primaryButtonProps:{children:a("pc_template_authorize_i_know_web")}}),void i.sendAuthorSignLog({action:"show",page_type:"signed"});default:return}}}};var at;function st(){return st=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},st.apply(this,arguments)}const lt=e=>l.createElement("svg",st({xmlns:"http://www.w3.org/2000/svg",width:21,height:20,fill:"none",viewBox:"0 0 21 20"},e),at||(at=l.createElement("path",{stroke:"#FAFAFA",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.7,d:"M6.5 10h8M10.5 14V6"})));var rt;function nt(){return nt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},nt.apply(this,arguments)}const ot=e=>l.createElement("svg",nt({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),rt||(rt=l.createElement("path",{stroke:"#E5E5E5",strokeWidth:1.188,d:"M4.986 4.672h6.066v7.135H4.986zM8.02 3.188v1.481M3.47 4.671h9.099"})));var ct;function ut(){return ut=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},ut.apply(this,arguments)}const dt=e=>l.createElement("svg",ut({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),ct||(ct=l.createElement("path",{stroke:"#999",strokeWidth:1.2,d:"M5.485 6.734 4.228 7.991A2.667 2.667 0 1 0 8 11.762l1.258-1.256M10.514 9.25l1.257-1.257A2.667 2.667 0 0 0 8 4.222L6.742 5.479M9.886 6.102 6.743 9.244"}))),pt="root-l9tBJC",mt="button-d7ObAP",gt="addIcon-az6RxQ",ht="fileList-xgrNuo",_t="fileInfo-FSzbb0",ft="hoverIcon-aRWO5l",bt="mainIcon-fYnws9",vt="fileIconArea-yRTZz9",St="fileName-RVW4y3",yt=(0,a.Pi)((e=>{const{service:t}=e,{t:i}=(0,s.$)(),a=(0,l.useRef)(null);return(0,n.jsxs)("div",{className:pt,children:[(0,n.jsx)(Z.zx,{className:mt,type:"secondary",theme:"solid",icon:(0,n.jsx)(lt,{className:gt}),onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.click()},children:i("pc_template_authorize_upload_web")}),(0,n.jsx)("input",{ref:a,type:"file",hidden:!0,onChange:e=>{const a=Array.from(e.target.files||[]).filter((e=>{const t=e.name.split(".").pop().toLowerCase();return["png","jpg","jpeg","webp"].includes(t)}));a.length>0?t.addFiles(a):Z.FN.error(i("the_uploaded_file_format_please_try_another_file")),e.target.value=""}}),t.fileList.length>0&&(0,n.jsx)("div",{className:ht,children:t.fileList.map((e=>(0,n.jsxs)("div",{className:_t,children:[(0,n.jsxs)("div",{className:vt,onClick:()=>t.deleteFile(e.id),children:[(0,n.jsx)(ot,{className:ft}),e.uri&&(0,n.jsx)(dt,{className:bt}),!e.uri&&(0,n.jsx)(Z.Ex,{className:bt,percent:Math.ceil(100*e.progress),type:"circle",size:"small",stroke:"rgba(246, 247, 254, 0.7)",orbitStroke:"rgba(255, 255, 255, 0.2)",strokeLinecap:"round",strokeWidth:2,width:10})]}),(0,n.jsx)("div",{className:St,children:e.file.name})]},e.id)))})]})})),wt="root-OIPT3k",xt="disabled-MDJgVh",Tt="help-eVD2Tx",Lt=(0,Z.Q2)((e=>{const{t}=(0,s.$)(),i=(0,Z.XQ)(),{value:a,onChange:l,authorSignService:r,sendLogService:o,getAuthFileUploadService:c,disabledTooltip:u,vipField:d,...p}=e,{className:g,disabled:h}=p,_=x.YW.OriginalForCommercial,{showModal:f,showModalWithoutReview:b}=(0,x.ZP)({handleBtnText:t("pc_template_authorize_confirm_web"),closeIcon:!0,protocol:_,needReview:!0,onOk:()=>{var e;(0,w.F)(_),null==l||l(!0),d&&(null===(e=i.setValue)||void 0===e||e.call(i,d,!0)),o.sendCommercialStatementLog({action:"confirm",entry_from:"checkbox",hasCopyrightAuthorization:c().fileList.length>0}),o.sendClickCommercialCheckboxLog(!0)},renderConfirmExtra:()=>(0,n.jsx)(yt,{service:c()}),getCanConfirmExtra:()=>c().isAllUploaded}),{openModal:v}=it({authorSignService:r,sendLogService:o}),{handleMouseEnter:S}=(0,be.w)({cursor:"not-allowed",content:u}),{handleMouseOver:y}=(0,be.S)({checkIsTarget:e=>null!==e.closest(".semi-checkbox-addon")}),T=m()(p.className,ve.i.heycanCheckboxEllipsis);return(0,n.jsxs)("div",{className:m()(wt,h&&xt,g),onMouseEnter:h&&u?S:void 0,onMouseOver:h&&u?void 0:y,children:[(0,n.jsx)(Z.XZ,{...p,className:T,checked:a,onChange:async e=>{if(Boolean(e.target.checked)){if(r.isRefreshing)return;let e=!1;try{await Te.c.show((async()=>{e=await r.checkAuthorHasSigned()}))}catch(i){return Z.FN.error(t("pc_template_authorize_error_web")),void(0,z.RF)("[AuthBusinessCheckbox] checkAuthorHasSigned failed",i)}e?(f(),o.sendCommercialStatementLog({action:"show",entry_from:"checkbox"})):v()}else o.sendClickCommercialCheckboxLog(!1),null==l||l(!1)},children:t("pc_template_authorize_business_web")}),(0,n.jsx)(fe.r,{className:Tt,onClick:h?void 0:()=>{b(),o.sendCommercialStatementLog({action:"show",entry_from:"question_mark"})}})]})}));var Ft=i(62185),Ct=i(39106),It=i(8318),jt=i(35178);const kt="root-pUimlh",Pt="cover-UHqwrX",Nt="selectStaticFrame-QFz5WO",At="titleField-ln4TF0",Zt="businessCheckbox-GzKVjp",Mt="highPriorityWrapper-mVBX2P",zt="multiLangVersionList-GlVDtu",Dt=(0,a.Pi)((e=>{var t;const{subtitleTemplate:i}=e,{t:a}=(0,s.$)(),r=oe();(0,l.useLayoutEffect)((()=>r.initSubtitleTemplateForm(i)),[]);const{getDisplayLength:o}=(0,Ct._)(),c=I(i),{openFramePicker:u}=(0,he.v)(),d=(0,te.e)({watch:()=>I(i).staticFrame.list.length>0}),p=(0,l.useMemo)((()=>(0,f.Fl)((()=>i.languages.map((e=>({lang:e.lang,cover:e.cover,title:e.title,isSelected:i.selectedLanguages.includes(e.lang)})))))),[]),m=Boolean(null===(t=i.languages[0])||void 0===t?void 0:t.staticFrame.src),h=Boolean(i.onlineData.resourceId);return(0,n.jsxs)("div",{className:kt,children:[(0,n.jsx)(g.Y,{className:Pt,src:c.staticFrame.src,isInvalid:!1,isSelected:!1,size:128}),(0,n.jsx)("div",{className:Nt,onClick:()=>{u({onOK:e=>r.handleStaticFrameChange(i,e),fetchData:async()=>{await d.start();const{list:e,index:t}=c.staticFrame;return{list:e,index:t}}})},children:a("pc_stickers_release_cover_edit_web")}),(0,n.jsx)(me.l,{fieldClassName:At,label:a("pc_text_template_name_n_web"),field:"subtitleTemplate.title",maxLength:40,allowEnter:!1,placeholder:a("pc_stickers_release_xy_name_web",{X:1,Y:o(40)}),rules:[{required:!0,message:""}],onChange:(0,f.aD)((e=>i.title=e))}),(0,n.jsx)(ge.u,{label:(0,n.jsx)("div",{className:jt.Z.labelHeader,children:(0,n.jsx)(Z.Form.Label,{required:!0,children:a("pc_text_template_tag_settings_web")})}),placeholder:a("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"subtitleTemplate.tags",itemType:L.Ab.SubtitleTemplate,recommendConfig:{title:i.title,uri:c.cover.uri},ignoreAddTagOnBlurSelector:`.${jt.Z.applyToAll}`,onChange:(0,f.aD)((e=>i.tags=e))}),i.isMultiLang&&(0,n.jsx)("div",{className:zt,children:(0,n.jsx)(Ft.B,{className:zt,loading:!m,languages:p.get(),onToggleSelection:e=>{i.selectedLanguages.includes(e)?i.selectedLanguages.length>1&&(i.selectedLanguages=i.selectedLanguages.filter((t=>t!==e))):i.selectedLanguages.push(e)}})}),!1,(0,n.jsx)(_e.Z,{children:(0,n.jsxs)("div",{className:It.Z.authGroup,children:[(0,n.jsx)(_e._,{text:a("pc_template_authorize_range_web")}),(0,n.jsxs)("div",{className:It.Z.right,children:[(0,n.jsx)(xe,{noLabel:!0,field:"subtitleTemplate.isVip",sendLogService:r.sendLogService}),(0,n.jsx)(Lt,{fieldClassName:Zt,noLabel:!0,field:"subtitleTemplate.isBusiness",vipField:"subtitleTemplate.isVip",authorSignService:r.authorSignService,getAuthFileUploadService:()=>r.authFileUploadServiceManager.ensure(i.id),sendLogService:r.sendLogService})]})]})}),r.field.canHighPrio&&(0,n.jsx)(_e.Z,{className:Mt,hiddenFieldLabel:!0,children:(0,n.jsxs)("div",{className:It.Z.authGroup,children:[(0,n.jsx)(_e._,{text:a("pc_text_template_release_settings_web")}),(0,n.jsx)("div",{className:It.Z.right,children:(0,n.jsx)(Z.z8,{noLabel:!0,field:"subtitleTemplate.isHighPriority",disabled:h,children:a("pc_text_template_release_priority_web")})})]})})]})}));var Ot=i(43738);const Ut="topSectionHeader-FDUHM7",Bt=(0,a.Pi)((e=>{const{className:t}=e,i=oe(),{t:a}=(0,s.$)(),r=(0,c.Z)((()=>{})),o=(0,l.useRef)(null);return(0,u.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:"",titleForMainForm:a("pc_subtitle_template_add_web"),subTitle:"",draggingTitle:"",draggingDisabled:!0,disabled:!0,disabledTooltip:"",onClick:r,onDrop:r},setFormApi:i.setFormApi,renderImportArea:e=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.S,{className:Ut,title:a("pc_subtitle_template_web",{X:i.subtitleTemplateList.length})}),(0,n.jsx)(ue,{}),i.flowerTextList.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.S,{title:a("pc_subtitle_effect_web",{X:i.flowerTextList.length})}),(0,n.jsx)(pe,{})]})]}),renderFormArea:()=>i.subtitleTemplateList.selected?(0,n.jsx)(Dt,{subtitleTemplate:i.subtitleTemplateList.selected},i.subtitleTemplateList.selectedId):i.flowerTextList.selected?(0,n.jsx)(Ot.p,{flowerText:i.flowerTextList.selected,initFlowerTextForm:i.initFlowerTextForm,applyTagsToAll:i.applyTagsToAll,maxTitleLength:40},i.flowerTextList.selectedId):null,scrollAreaRef:o,onRetry:i.retryInit})}));var Rt=i(85877),Et=i(15906);const Vt=(0,a.Pi)((e=>{const{className:t}=e,i=oe(),{t:a}=(0,s.$)(),r=(0,l.useRef)(null);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Rt.P,{className:t,leftText:"",isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>{i.uploadAndPublish(r.current)},onCancel:()=>(0,B.gk)({showHomePage:!1})}),(0,n.jsx)(Et.q,{ref:r,uploadStats:i.uploadStats,onRetryUpload:i.retryUploadAndPublishDeps,onCancel:i.handleUploadCancel,onShowUploadFail:()=>{},onPromptConfirmToCancel:i.isAllUploadEndedWatcher.handlePromptConfirmToCancel})]})}));var $t=i(39931),Ht=i(71025),qt=i(67037);const Wt=(0,a.Pi)((e=>{const t=re(),{t:i}=(0,s.$)();return(0,$t.F)({title:i("pc_subtitle_template_item_release_web"),pid:"publish-subtitle-template-single"}),(0,Ht.d)(),(0,n.jsx)(ne.Provider,{value:t,children:(0,n.jsxs)("div",{className:qt.Z.page,children:[(0,n.jsxs)("div",{className:qt.Z.content,children:[(0,n.jsx)(o,{className:qt.Z.instruction}),(0,n.jsx)(Bt,{className:qt.Z.mainForm})]}),(0,n.jsx)(Vt,{className:qt.Z.footer})]})})}))}}]);