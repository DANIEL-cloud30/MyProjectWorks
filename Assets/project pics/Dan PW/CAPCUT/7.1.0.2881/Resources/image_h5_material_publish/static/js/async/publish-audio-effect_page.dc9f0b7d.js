"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[2829],{54290:(e,o,i)=>{i.d(o,{Ab:()=>a});let a=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},34030:(e,o,i)=>{i.r(o),i.d(o,{default:()=>Oo});var a=i(65625),t=i(42716),l=i(18571),r=i(43130),s=i(79292);let n=function(e){return e.File="file",e}({}),d=function(e){return e.Format="format",e.FileDuration="fileDuration",e.RecommendFileSize="RecommendFileSize",e}({});const c={[n.File]:{[d.Format]:s.I18n.t("pc_sound_form"),[d.FileDuration]:s.I18n.t("pc_filter_time_limit"),[d.RecommendFileSize]:s.I18n.t("pc_filter_file_size_ten_m")}},u=100,p=10485760,m="ImportAudio";var f=i(73221),v=i(20165),A=i(60963),g=i(79337),h=i(54290),y=i(71157),F=i(15621),_=i(85918),b=i(10806),x=i(38432),w=i(5065),C=i(23818),S=i(48647);const L=e=>{const{id:o,path:i,duration:a,size:t=0}=e,l=(0,_.lm)(i),r=[];["mp3","wav"].includes(l)||r.push(d.Format),t>p&&r.push(d.RecommendFileSize),a>60&&r.push(d.FileDuration);const s=(0,C.YB)(i,{maxLength:b.S8});return{effect_type:h.Ab.AudioEffect,common_data:{title:s,description:"",tags:[],source:S.r0.UserPostPc,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:"",width:200,height:200},file:{file_uri:"",file_md5:"",size:t}},is_vip:(0,x.K)(w.YW.OriginalForSubscription),payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:r,localId:o,path:i,fileBase64:"",isUploadFailed:!1,uploadFailedText:""},audio:{audio_id:"",duration:a}}};var j=i(18552),I=i(83305),E=i(85108),P=i(82686),k=i(57494),R=i(47791),U=i(39110),O=i(47573),N=i(57102),T=Object.defineProperty,M=Object.defineProperties,B=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,V=(e,o,i)=>o in e?T(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,Q=(e,o)=>{for(var i in o||(o={}))z.call(o,i)&&V(e,i,o[i]);if(D)for(var i of D(o))W.call(o,i)&&V(e,i,o[i]);return e};const Y={version:void 0};var Z=(e,o={})=>{return N.Z.call("openAudioFilePicker",e,(i=Q({},o),a={customOptions:Q({jsb_rules:Y},o.customOptions)},M(i,B(a))));var i,a},q=Object.defineProperty,K=Object.defineProperties,G=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,X=(e,o,i)=>o in e?q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,ee=(e,o)=>{for(var i in o||(o={}))H.call(o,i)&&X(e,i,o[i]);if(J)for(var i of J(o))$.call(o,i)&&X(e,i,o[i]);return e};const oe={version:void 0};var ie=(e,o={})=>{return N.Z.call("uploadDroppedAudioFiles",e,(i=ee({},o),a={customOptions:ee({jsb_rules:oe},o.customOptions)},K(i,G(a))));var i,a};var ae=Object.defineProperty,te=Object.defineProperties,le=Object.getOwnPropertyDescriptors,re=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,de=(e,o,i)=>o in e?ae(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,ce=(e,o)=>{for(var i in o||(o={}))se.call(o,i)&&de(e,i,o[i]);if(re)for(var i of re(o))ne.call(o,i)&&de(e,i,o[i]);return e};const ue={version:void 0};var pe=(e,o={})=>{return N.Z.call("cancelAudioUpload",e,(i=ce({},o),a={customOptions:ce({jsb_rules:ue},o.customOptions)},te(i,le(a))));var i,a};const me=new class{async openAudioFilePicker(e){(0,I.c6)("[JSB] openAudioFilePicker req --\x3e",{...(0,f.Z)(e,["objectUploadConfig","imageUploadConfig","videoUploadConfig"])});const o=await Z(e);return(0,I.c6)("[JSB] openAudioFilePicker resp <--",o),o}async uploadDroppedAudioFiles(e){var o;(0,I.c6)("[JSB] uploadDroppedAudioFiles req --\x3e",{...(0,f.Z)(e,["objectUploadConfig","imageUploadConfig","videoUploadConfig"])});const i=await ie(e);return(0,I.c6)("[JSB] uploadDroppedAudioFiles resp <--",{imagesCount:null==i||null===(o=i.audios)||void 0===o?void 0:o.length}),i}registerAudioFileProcessResultEvent(e){return(e=>{const o=N.Z.on("audioFileProcessResult",(o=>{o.data&&e(o.data)}));return()=>N.Z.off("audioFileProcessResult",o)})((o=>{(0,I.c6)(`[JSB] audioFileProcessResult {${null==o?void 0:o.id}}`,o),e(o)}))}async cancelAudioUpload(e){(0,I.c6)("[JSB] cancelAudioUploadRequest req --\x3e",{...e}),await pe(e)}};var fe=i(52272),ve=i(76664),Ae=i(22531),ge=i(33452);const he=(0,l.createContext)(null),ye=()=>(0,l.useContext)(he);var Fe=i(72322);const _e=(0,a.Pi)((({className:e})=>{var o,i;const{t:a}=(0,t.$)(),s=(0,l.useMemo)((()=>{return[{key:n.File,title:a("pc_sound_specification"),instructions:(e=n.File,Object.entries(c[e]).map((([e,o])=>({key:e,title:o}))))}];var e}),[]),d=ye().selectedAudio;return(0,Fe.jsx)(r.v,{className:e,groups:s,initGroup:n.File,activeGroup:n.File,resetExpandedGroupKey:null!==(o=null==d||null===(i=d.payload)||void 0===i?void 0:i.localId)&&void 0!==o?o:null,getStatus:e=>{var o;return d?null!==(o=d.payload)&&void 0!==o&&null!==(o=o.unmetRequirements)&&void 0!==o&&o.includes(e.key)?"error":"success":"init"}})}));var be=i(14986),xe=i(67509);const we=(0,a.Pi)((({className:e})=>{const o=ye(),{t:i}=(0,t.$)(),a=(0,l.useRef)(null),r=(0,l.useMemo)((()=>o.audioList.length),[o.audioList]);return(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsx)(be.Z,{className:e,leftText:i("pc_sticker_import_zero_to_hundred_web",{X:r,Y:u}),isPublishDisabled:!o.isAllReadyPublish,isPublishing:o.isPublishing,needConfirmModalOnClose:o.needConfirmModalOnClose,onPublish:()=>o.uploadAndPublish(a.current),beforeCancel:()=>{var e;return null===(e=o.audioRef.current)||void 0===e?void 0:e.pause()}}),(0,Fe.jsx)(xe.q,{ref:a,uploadStats:o.uploadStats,onRetryUpload:o.retryUpload,onCancel:o.isAllUploadedWatcher.stop,onShowUploadFail:o.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:o.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var Ce=i(21418),Se=i(40358),Le=i(54275),je=i(18751),Ie=i.n(je),Ee=i(48660);var Pe=i(18329),ke=i(68288),Re=i(84133),Ue=i(33921);const Oe="root-l5vahz",Ne="statusBar-oVVULl",Te="contextMenuItem-ELwi1D",Me=(0,a.Pi)((({className:e,audio:o,isSelected:i,onClick:a,onReimport:l,onRemove:r})=>{var s,d;const{t:u}=(0,t.$)(),{common_data:p,payload:m}=o,f=m.fileBase64,v=Boolean(null==m||null===(s=m.unmetRequirements)||void 0===s?void 0:s.length),A=Boolean(p.title&&(null===(d=p.tags)||void 0===d?void 0:d.length)),{handleContextMenu:g}=(0,Ue.D)({content:(0,Fe.jsx)(Re.m,{items:[{key:"reimport",render:({key:e,className:i})=>Boolean(v)&&(0,Fe.jsx)("div",{className:Ie()(i,Te),onClick:()=>l(o),children:u("pc_material_release_import_again")},e)},{key:"remove",render:({key:e,className:i})=>(0,Fe.jsx)("div",{className:Ie()(i,Te),onClick:()=>r(o),children:u("pc_material_release_delete")},e)}]})});return(0,Fe.jsxs)("div",{className:Ie()(e,Oe),onClick:()=>{a(o.payload.localId)},children:[(0,Fe.jsx)(Pe.Y,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK/SURBVHgB7Z0xbhNBGIXfOiYQiAFRBNLQcQA4ABegRIIDpEWipKCloEWCMgegoEWihQPQE/oIOgMxEEzM/zwzhJDYsvOKnZXeJ72ss+vq0//PjFbr2Qb/MZlMzsbhfGQt0och+znDpml+/3uhKR9CHD9fjlyIfM85gCH9HLrZQxI54YWpwCzvKpKwrzwFcxL0RImU+YkSe/kCK28c+QLLmwfdfIuwjS/xRC+qbwVpzNuDWRRKXOd80cSfK0it+wNmGdjKB2zhVaT2NcvBgluzwNPDcbDfg5GwQBELFLFAEQsUsUARCxSxQBELFLFAEQsUsUARCxSxQBELFLFAEQsUsUARCxSxQBELFLFAEQsU6YLA25E3kceRa6iMLgi8ERlE7kReRLZQEV1q4buR90gCXyFVZut0SeBu5EnkUf5/HRXQxUd43+VUgWdhEQsUqamFb0buI826HO92Ii9ROTUI5GTwNHIL6QF3jm9c71EmZ9odVEwNArksobxnOFpxm5HnqGS5Mou2x8BSads43q5s4wdIVVktbQss1fV6xnVKrGbJchJtCxzk4+6c78y71jptCyztuTnnO5yVP6BS2hZYWvfejOscI9nmH1EpbQvkL344+3IieYijt6u4LuTdF7bwNiqFv1S6HsfPaJctHN6mojCuDQc4nIlrHQc3ahFIOA6yEstdlrc5NVOVwC6y4ZsJIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIUyN0rV2CWhc72KZAbbp+DWZYzkV8UOELaBrmBWZSyIfew1zTNT+R9kWEWhfJG4W5cJpEhUk9ToitxNnRzEenh/GE5MWUymW4Lz+3Ny67mY3h75AKLi/ME33BRXkYwfVHDsWoLkbRLkRwkV2EIC4mT7SgPeX/5A5B3gyFEXzzuAAAAAElFTkSuQmCC",isSelected:i,isInvalid:Boolean(v),size:80,onContextMenu:e=>{g(e),a(o.payload.localId)}}),(0,Fe.jsx)(ke.ir,{className:Ne,loading:!f,invalid:v,errorToolip:v&&(null===(h=o.payload)||void 0===h||null===(h=h.unmetRequirements)||void 0===h?void 0:h.map((e=>{const o=c[n.File][e];return o?(0,Fe.jsx)("div",{children:o},e):null}))),isInfoComplete:A,title:p.title})]});var h})),Be="root-vGN3fF",De="container-Z43yJw",ze="cardDragWrapper-tHHY7g",We="audioCard-Jqin4l",Ve="hover-right-UhQwRW",Qe="hover-left-glFzow",Ye=(0,a.Pi)((()=>{const e=ye(),o=(0,Le.Z)(((o,i)=>{e.selectedId!==o.payload.localId&&e.selectMaterial(o.payload.localId)})),i=(0,Le.Z)(((o,i)=>{var a;return(0,Fe.jsx)(Me,{className:Ie()(We,{[Ve]:"right"===i,[Qe]:"left"===i}),audio:o,onClick:e.selectMaterial,isSelected:e.selectedId===o.payload.localId,onRemove:e.removeAudio,onReimport:e.reimportAudio},null===(a=o.payload)||void 0===a?void 0:a.localId)}));return(0,Fe.jsx)("div",{className:Be,children:(0,Fe.jsx)("div",{className:De,children:(0,Fe.jsx)(Ee.y,{list:e.audioList,renderCard:i,onMoveCard:e.dragInsert,className:ze,getId:e=>e.payload.localId,scrollAreaRef:e.scrollAreaRef,onCardClick:o})})})}));var Ze,qe,Ke,Ge,Je,He=i(33094),$e=i(45220),Xe=(i(94443),i(63e3)),eo=i(86807),oo=i(56230),io=i(93585);function ao(){return ao=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var i=arguments[o];for(var a in i)({}).hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},ao.apply(null,arguments)}const to=e=>l.createElement("svg",ao({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},e),Ze||(Ze=l.createElement("circle",{cx:9,cy:9,r:9,fill:"#29292D",opacity:.5})),qe||(qe=l.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",d:"M6.975 12.15v-6.3z",clipRule:"evenodd"})),Ke||(Ke=l.createElement("path",{stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.62,d:"M6.975 12.15v-6.3"})),Ge||(Ge=l.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",d:"M11.025 12.15v-6.3z",clipRule:"evenodd"})),Je||(Je=l.createElement("path",{stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.62,d:"M11.025 12.15v-6.3"})));var lo,ro;function so(){return so=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var i=arguments[o];for(var a in i)({}).hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},so.apply(null,arguments)}const no=e=>l.createElement("svg",so({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},e),lo||(lo=l.createElement("circle",{cx:9,cy:9,r:9,fill:"#29292D",opacity:.5})),ro||(ro=l.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.35,d:"m12.375 9-5.25 3.375v-6.75z",clipRule:"evenodd"}))),co="icon-box-YEUJAD",uo="content-lkyAWs",po="iconWraper-YgV3wS",mo="icon-HXRhiF",fo="desc-JTU6u4",vo="text-aeq8p1",Ao="time-Y_QjIl",go=e=>`${`${Math.floor(e/60)}`.padStart(2,"0")}:${`${Math.floor(e%60)}`.padStart(2,"0")}`,ho=({audio:e,audioRef:o})=>{const{fileBase64:i}=e.payload,[a,t]=(0,l.useState)(!1),[r,s]=(0,l.useState)("00:00"),[n,d]=(0,l.useState)(0),c=(0,l.useMemo)((()=>go(n)),[n]),u=(0,l.useMemo)((()=>{var o;return(0,C.Bc)((null===(o=e.payload)||void 0===o?void 0:o.path)||"")}),[e]);return(0,l.useEffect)((()=>{if(o.current)return t(!1),s("00:00"),o.current.load(),()=>{var e;null===(e=o.current)||void 0===e||e.pause()}}),[i,o]),(0,Fe.jsxs)("div",{className:co,children:[(0,Fe.jsxs)("audio",{ref:o,onCanPlay:()=>{var e;d(null===(e=o.current)||void 0===e?void 0:e.duration)},onEnded:()=>t(!1),onPause:()=>t(!1),onTimeUpdate:()=>{var e;const i=go((null===(e=o.current)||void 0===e?void 0:e.currentTime)||0);s(i)},children:[(0,Fe.jsx)("source",{src:`data:audio/x-mpeg;base64,${i}`}),(0,Fe.jsx)("source",{src:`data:audio/wav;base64,${i}`})]}),(0,Fe.jsxs)("div",{className:uo,onClick:()=>{var e,i;a?null===(e=o.current)||void 0===e||e.pause():null===(i=o.current)||void 0===i||i.play(),t(!a)},children:[a?(0,Fe.jsx)("div",{className:po,children:(0,Fe.jsx)(to,{className:mo})}):(0,Fe.jsx)("div",{className:mo,children:(0,Fe.jsx)(no,{})}),(0,Fe.jsxs)("div",{className:fo,children:[(0,Fe.jsx)("div",{className:vo,children:u}),(0,Fe.jsxs)("div",{className:Ao,children:[r," | ",c]})]})]})]})};var yo=i(26851);const Fo="root-F4oZT7",_o="label-JWNfR2",bo="useAll-UNQhcm",xo="input-K5QDCm",wo="businessCheckbox-gZGrLh",Co=(0,a.Pi)((({audio:e})=>{const{t:o}=(0,t.$)(),i=ye();(0,l.useLayoutEffect)((()=>{var o,a;return null===(o=i.formApi)||void 0===o||o.reset(),null===(a=i.formApi)||void 0===a||a.setValues(e,{isOverride:!0}),()=>i.syncFormData(e)}),[e]);const{getDisplayLength:a}=(0,oo._)(),r=(o,a)=>{i.updateFormState(e,{common_data:{...e.common_data,[a]:o}})};return(0,Fe.jsxs)("div",{className:Fo,children:[(0,Fe.jsx)(ho,{audio:e,audioRef:i.audioRef}),(0,Fe.jsx)(He.l,{fieldClassName:xo,label:o("pc_filter_voice_effect_name"),field:"common_data.title",maxLength:b.S8,placeholder:o("pc_stickers_release_xy_name_web",{X:1,Y:a(b.S8)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>r(e,"title")}),(0,Fe.jsxs)("div",{className:_o,children:[(0,Fe.jsx)($e.u,{fieldClassName:xo,label:o("pc_stickers_release_tag_set_web"),placeholder:o("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"common_data.tags",itemType:h.Ab.AudioEffect,recommendConfig:{title:e.common_data.title},rules:[{required:!0,message:""}],onChange:e=>r(e,"tags"),temporaryId:e.payload.localId}),(0,Fe.jsx)("span",{className:bo,onClick:()=>{var e;const{tags:o}=(null===(e=i.formApi)||void 0===e?void 0:e.getValue("common_data"))||{};null!=o&&o.length&&i.applyForTags({tags:o})},children:o("pc_material_release_apply_all")})]}),!1,(0,Fe.jsx)(io.Z,{onClickUseAll:()=>{var e;const o=null===(e=i.formApi)||void 0===e?void 0:e.getValues();o&&i.applyAuthSettingsToAll({isVip:o.is_vip,isOriginal:o.common_data.is_original,isBusiness:o.common_data.is_business})},children:(0,Fe.jsxs)("div",{className:yo.Z.authGroup,children:[(0,Fe.jsx)(io._,{text:o("pc_template_authorize_range_web")}),(0,Fe.jsxs)("div",{className:yo.Z.right,children:[(0,Fe.jsx)(Xe.l,{noLabel:!0,field:"is_vip",sendLogService:i.sendLogServ}),(0,Fe.jsx)(eo.R,{fieldClassName:wo,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:i.authorSignService,getAuthFileUploadService:()=>i.authFileUploadServiceManager.ensure(e.payload.localId),sendLogService:i.sendLogServ})]})]})})]})})),So=(0,a.Pi)((({className:e})=>{const o=ye(),{t:i}=(0,t.$)(),a=(0,l.useCallback)((()=>o.selectedAudio&&(0,Fe.jsx)(Co,{audio:o.selectedAudio})),[o.selectedAudio]),r=(0,l.useMemo)((()=>o.audioList.length>=u),[o.audioList]);return(0,P.pg)({mainFormLayout:o.mainFormLayout,sendLogServ:o.sendLogServ}),(0,Ce.O)({className:e,layout:o.mainFormLayout,uploadAreaProps:{titleForUploadArea:i("pc_material_release_click"),titleForMainForm:i("pc_stickers_release_drag_in_web"),subTitle:".mp3/.wav",draggingTitle:i("pc_sticker_release_mouse_web"),disabled:r,disabledTooltip:"",onClick:o.openAudioPicker,onDrop:o.droppedAudioFiles},setFormApi:o.setFormApi,renderImportArea:e=>(0,Fe.jsxs)(Fe.Fragment,{children:[e,(0,Fe.jsx)(Ye,{})]}),renderFormArea:a,scrollAreaRef:o.scrollAreaRef,onRetry:Se.cb})}));var Lo=i(62293),jo=i(90856);const Io="page-1cbeHL",Eo="content-Y3uYfw",Po="requirement-zgTG7N",ko="mainForm-CN2Z8q",Ro="footer-Klb8rU",Uo=(0,a.Pi)((()=>{const e=function(){const{t:e}=(0,t.$)(),o=new F.l,i=new j.w,a=new P.D5({itemType:h.Ab.AudioEffect}),r=(0,O.G)({watch:()=>s.isAllUploaded}),s=(0,v.fv)((()=>({audioList:[],formApi:null,isPublishing:!1,pubServ:new E.Z,sendLogServ:a,authorSignService:new k.I({signScene:ve.d.BusinessArtist}),authFileUploadServiceManager:new R.r({}),scrollAreaRef:(0,l.createRef)(),audioRef:(0,l.createRef)(),performanceTimingCollector:(0,ge.uY)(),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return"uploadArea"===s.mainFormLayoutAfterLoading&&y.appModel.isInitFailed?"error":s.mainFormLayoutAfterLoading},get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get importMinMaxCount(){const e=s.audioList.length;return{minCount:1,maxCount:Math.max(0,u-e),maxTotalCount:u}},get needConfirmModalOnClose(){return s.audioList.length>0},selectedId:"",get selectedAudio(){return s.selectedId?s.getAudio(s.selectedId):null},getAudio:e=>{var o;return null!==(o=s.audioList.find((o=>{var i;return(null===(i=o.payload)||void 0===i?void 0:i.localId)===e})))&&void 0!==o?o:null},getAudioIndex:e=>s.audioList.findIndex((o=>{var i;return(null===(i=o.payload)||void 0===i?void 0:i.localId)===e})),selectMaterial(e){s.selectedId=e,s.selectedAudio&&(s.selectedAudio.payload.hasEverSelected=!0)},updateFormState(e,o){Object.assign(e,o)},setIsPublishing:(0,A.aD)((e=>s.isPublishing=e)),setFormApi:(0,A.aD)((e=>s.formApi=e)),applyForTags:({tags:e})=>{s.audioList.forEach((o=>{o.common_data.tags=e}))},applyAuthSettingsToAll:({isOriginal:e,isBusiness:o,isVip:i})=>{s.audioList.forEach((a=>{a.is_vip=Boolean(i),a.common_data.is_original=Boolean(e),a.common_data.is_business=Boolean(o)}))},dragInsert(e,o){const i=s.audioList.splice(e,1),a=e>o?o+1:o;s.audioList.splice(a,0,...i)},addAudios(e){0!==e.length&&(s.audioList=[...s.audioList,...e],s.selectMaterial(e[0].payload.localId),"uploadArea"===s.mainFormLayoutAfterLoading&&(s.mainFormLayoutAfterLoading="mainForm"))},async removeAudio(e){await me.cancelAudioUpload({id:e.payload.localId}),s.audioList=s.audioList.filter((o=>{var i,a;return(null===(i=o.payload)||void 0===i?void 0:i.localId)!==(null===(a=e.payload)||void 0===a?void 0:a.localId)}))},getUploadParams:async(e,o)=>(await i.refreshUploadConfigsIfNeeded({when:o,logPrefix:"[AudioStore]"}),{...await i.getUploadConfigs("openAudioPicker"),accept:"mp3-wav",maxFileDuration:60,maxFileSize:p,...e}),async handleAudioFileProcessResult(e){const o=s.getAudio(e.id);if(o)if("Success"===e.result)switch(e.type){case"AudioBase64":o.payload.fileBase64=e.base64;break;case"AudioFile":const{audio_id:i,size:a,file_uri:t}=e;o.audio.audio_id=i,o.common_data.file={file_md5:"",size:a,file_uri:t};break;default:return}else"Error"===e.result&&"AudioFile"===e.type&&(o.payload.isUploadFailed=!0,o.payload.uploadFailedText=e.error||"")},initAudios({audios:e}){if(!e.length)return[];const o=[];for(const i of e){const e=L(i);o.push(e)}return o},async openAudioPicker(){o.lock(m,(async()=>{try{a.sendPageActionLog({action:"mainForm"===s.mainFormLayout?"upload_more":"upload"});const e=await s.getUploadParams({...s.importMinMaxCount,multiple:!0},"openAudioPicker"),o=await me.openAudioFilePicker(e),i=s.initAudios(o);s.addAudios(i)}catch(e){(0,I.RF)("openAudioFilePicker jsb failed ",e,{action:"openAudioPicker"})}}))},async droppedAudioFiles(){o.lock(m,(async()=>{try{a.sendPageActionLog({action:"mainForm"===s.mainFormLayout?"upload_more":"upload"});const e=await s.getUploadParams({...s.importMinMaxCount,multiple:!0},"droppedAudioFiles"),o=await me.uploadDroppedAudioFiles(e),i=s.initAudios(o);s.addAudios(i)}catch(e){(0,I.RF)("uploadDroppedAudioFiles jsb failed ",e,{action:"droppedAudioFiles"})}}))},async reimportAudio(e){o.lock(m,(async()=>{var o;await me.cancelAudioUpload({id:e.payload.localId});const i=await s.getUploadParams({minCount:1,maxCount:1,maxTotalCount:1,multiple:!1},"reimportAudio"),a=await me.openAudioFilePicker(i),t=L(a.audios[0]),l=s.getAudioIndex(e.payload.localId);-1!==l&&(s.audioList[l]=t,s.selectMaterial(null===(o=t.payload)||void 0===o?void 0:o.localId))}))},isAllUploadedWatcher:r,async retryUpload(){const e=s.audioList.filter((e=>e.payload.isUploadFailed)).map((e=>e.payload.localId));if(!e.length)return;e.forEach((e=>{const o=s.getAudio(e);o&&(o.payload.isUploadFailed=!1)}));const o=await s.getUploadParams({multiple:!0,minCount:1,maxCount:e.length,maxTotalCount:e.length,retryUploadIds:e},"retryUpload");await me.openAudioFilePicker(o)},sendUploadProgressModalShowErrorLog(){const e=s.audioList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.uploadFailedText})));a.sendMaterialPublishErrorLog(e)},get uploadStats(){let e=0,o=0,i=0;return s.audioList.forEach((a=>{var t;a.payload.isUploadFailed?o+=1:(null===(t=a.common_data.file)||void 0===t?void 0:t.file_uri)&&a.audio.audio_id?e+=1:i+=1})),{pending:i,succeeded:e,failed:o}},get isAllReadyPublish(){const e=s.audioList.every((e=>{var o,i;return e.common_data.title&&(null===(o=e.common_data.tags)||void 0===o?void 0:o.length)&&!(null!==(i=e.payload.unmetRequirements)&&void 0!==i&&i.length)}));return s.audioList.length>0&&e},get isAllUploaded(){const{pending:e,failed:o}=s.uploadStats;return!e&&!o},syncFormData(e){var o;const i=null===(o=s.formApi)||void 0===o?void 0:o.getValues();e&&i&&s.updateFormState(e,{is_vip:i.is_vip||!1,common_data:{...e.common_data,title:i.common_data.title||"",tags:i.common_data.tags||[],is_original:i.common_data.is_original||!1,is_business:i.common_data.is_business||!1}})},async uploadAndPublish(e){var o;a.sendPageActionLog({action:"publish"}),null===(o=s.audioRef.current)||void 0===o||o.pause(),s.selectedAudio&&s.syncFormData(s.selectedAudio),s.isAllUploaded||(await s.retryUpload(),null==e||e.show(),await s.isAllUploadedWatcher.start());try{await s.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{s.setIsPublishing(!0);const o=s.audioList.map((e=>{const o=(0,U.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:s.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)});return{id:e.payload.localId,req:{...(0,f.Z)(e,["payload"]),...o.root,common_data:{...e.common_data,...o.commonData}},onResult:o=>{const{req:i,error:t,errorText:l,time:r,resourceId:n}=o;t||s.updateFormState(e,{payload:{...e.payload,itemId:n}}),a.sendMaterialPublishStatusLog({status:t?"fail":"success",time:r,error_type:l,publishParams:i,path:e.payload.path})}}}));(0,I.c6)("[AudioStore] audios publish start",{ids:o.map((e=>e.id))});const i=(await s.pubServ.batchPublish(o)).map((e=>e.resource_id));(0,I.c6)("[AudioStore] audios publish done",{resourceIdList:i}),await s.pubServ.pollUntilAllInEffectList({ids:i.slice(-E.f),types:[h.Ab.AudioEffect]}),(0,I.c6)("[AudioStore] poll done"),g.FN.success(e("pc_filter_release_successful")),(0,fe.ZM)({effect_type:h.Ab.AudioEffect}),setTimeout((()=>(0,fe.Nt)({item_type:h.Ab.AudioEffect})),1e3)}catch(o){g.FN.error(e("pc_sticker_release_failed_retry_web")),(0,I.RF)("[AudioStore] publish fail",o)}finally{s.setIsPublishing(!1)}}})));return(0,Ae.u)({watch:()=>s.needConfirmModalOnClose}),(0,l.useEffect)((()=>{window.store=s,i.uploadConfigsCache.update(),s.authorSignService.init(),s.performanceTimingCollector.addRenderTiming(ge.Pk)}),[]),(0,l.useEffect)((()=>{const e=me.registerAudioFileProcessResultEvent(s.handleAudioFileProcessResult),o=(0,fe.ih)((()=>{var e;return null===(e=s.audioRef.current)||void 0===e?void 0:e.pause()}));return()=>{e(),o()}}),[]),s}(),{t:o}=(0,t.$)();return(0,Lo.F)({title:o("pc_filter_voice_effect"),pid:"audio-publish-single"}),(0,jo.d)(),(0,P.t9)(e.sendLogServ),(0,Fe.jsx)(he.Provider,{value:e,children:(0,Fe.jsxs)("div",{className:Io,children:[(0,Fe.jsxs)("div",{className:Eo,children:[(0,Fe.jsx)(_e,{className:Po}),(0,Fe.jsx)(So,{className:ko})]}),(0,Fe.jsx)(we,{className:Ro})]})})})),Oo=()=>(0,Fe.jsx)(Uo,{})},23818:(e,o,i)=>{i.d(o,{Bc:()=>r,YB:()=>l,xB:()=>t});var a=i(13928);function t(e){const{len:o,i18n:i}=e,[a]=(i.language||"").split("-");return"zh"===a?Math.floor(o/2):o}function l(e,o){const i=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,a.aF)(i,null==o?void 0:o.maxLength)}function r(e){return e.replace(/^.*[\\\/]/,"")}}}]);