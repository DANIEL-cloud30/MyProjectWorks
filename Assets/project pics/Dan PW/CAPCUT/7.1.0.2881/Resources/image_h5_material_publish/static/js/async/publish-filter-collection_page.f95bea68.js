"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[5960],{54290:(e,t,l)=>{l.d(t,{Ab:()=>o});let o=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},68288:(e,t,l)=>{l.d(t,{Bo:()=>f,LU:()=>C,ir:()=>v});var o=l(18571),i=l(18751),a=l.n(i),r=l(42716),s=l(12247),n=l(77991),c=l(92644),d=l(17150),m=l(37964),p=l(71410),u=l(7890),_=l(72322);const g=e=>{const{className:t,loadingText:l}=e,{t:o}=(0,r.$)(),{handleMouseEnter:i}=(0,m.S)();return(0,_.jsxs)("div",{className:a()(u.Z.root,t),children:[(0,_.jsx)(d.a,{className:u.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,_.jsx)("div",{className:u.Z.text,onMouseEnter:i,children:l||o("pc_stickers_release_in_web")})]})},h=e=>{const{className:t,tooltip:l}=e,{t:i}=(0,r.$)(),{handleMouseEnter:n}=(0,m.w)({content:l,className:u.Z.tooltip}),c=(0,o.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:g}=(0,p.J)({text:i("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,_.jsxs)("div",{className:a()(u.Z.root,t,u.Z.error),onMouseEnter:e=>{d(!0),n(e)},onMouseLeave:()=>d(!1),children:[(0,_.jsx)(s.r,{className:u.Z.icon}),(0,_.jsx)("div",{ref:c,className:u.Z.text,children:g})]})},f=e=>{const{className:t,text:l}=e,{handleMouseEnter:o}=(0,m.S)();return(0,_.jsxs)("div",{className:a()(u.Z.root,t,u.Z.checked),children:[(0,_.jsx)(c.r,{className:u.Z.icon}),(0,_.jsx)("div",{className:u.Z.text,onMouseEnter:o,children:l})]})},C=e=>{const{className:t}=e,{t:l}=(0,r.$)(),{handleMouseEnter:o}=(0,m.S)();return(0,_.jsxs)("div",{className:a()(u.Z.root,t),children:[(0,_.jsx)("div",{className:a()(u.Z.icon,u.Z.yellowIcon),children:(0,_.jsx)("div",{className:u.Z.yellowPoint})}),(0,_.jsx)("div",{className:u.Z.text,onMouseEnter:o,children:l("pc_stickers_release_editing_web")}),(0,_.jsx)(n.r,{className:u.Z.icon})]})},v=e=>{const{className:t,loading:l,invalid:o,errorToolip:i,isInfoComplete:a,title:r,loadingText:s}=e;return l?(0,_.jsx)(g,{className:t,loadingText:s}):o?(0,_.jsx)(h,{className:t,tooltip:i}):a?(0,_.jsx)(f,{className:t,text:r}):(0,_.jsx)(C,{className:t})}},32950:(e,t,l)=>{l.d(t,{Cz:()=>a,KD:()=>p,Mc:()=>n,Mn:()=>d,OQ:()=>r,Pc:()=>g,S8:()=>s,Tb:()=>m,ZV:()=>u,Zk:()=>_,dr:()=>h,t2:()=>c});var o=l(79292),i=l(96461);const a=3,r=10,s=24,n=24,c=80,d=120,m=20971520,p="#BB984B",u={[i.nb.File]:{[i.id.Format]:o.I18n.t("pc_filter_form"),[i.id.MaxFileSize]:o.I18n.t("pc_filter_size_eight_m"),[i.id.CollectionNum]:o.I18n.t("pc_filter_collection_number")},[i.nb.Cover]:{[i.id.CoverCopyright]:o.I18n.t("pc_filter_original_cover_copyright"),[i.id.CoverLut]:o.I18n.t("pc_filter_lut_match"),[i.id.CoverFormat]:o.I18n.t("pc_filter_file_format"),[i.id.CoverMinImageSize]:o.I18n.t("pc_filter_pixel_size"),[i.id.CoverMaxFileSize]:o.I18n.t("pc_filter_file_size_ten_m")}},_={accept:"cube-3dl",multiple:!0,thumbnailSize:210,maxFileSize:20971520},g={accept:"png-jpg-jpeg",thumbnailSize:210,maxFileSize:10485760,minImageSize:720},h="ImportFilter"},66688:(e,t,l)=>{l.r(t),l.d(t,{default:()=>et});var o=l(18571),i=l(65625),a=l(42716),r=l(62293),s=l(82686),n=l(43130),c=l(96461),d=l(10277),m=l(78007),p=l(93471),u=l(73221),_=l(20165),g=l(60963),h=l(79337),f=l(79292),C=l(54290),v=l(88154),b=l(31062),y=l(7561),S=l(1234),x=l(83305),I=l(12803),F=l(48647);function L(e){return Boolean(e.id)}class M{constructor(){(0,v.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const l of(0,b.Z)(e,10)){const e=await Promise.all(l.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:l,onResult:o,onUpdateResult:i}=e,a=JSON.parse(JSON.stringify(e.req));let r=this.itemMap.get(l);if(null!==(t=r)&&void 0!==t&&t.promise&&(0,y.Z)(r.req,a))try{return await r.promise}catch(s){(0,x.c6)("[MaterialPublishService] publish failed, start to retry",{id:l})}return r={promise:null,id:l,req:a,onResult:o,onUpdateResult:i},this.itemMap.set(l,r),r.promise=this.publishImpl(r),r.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),l=async(l,o)=>{try{const r={error:l,errorText:this.getErrorText(l),time:Math.round(performance.now()-t),resourceId:o};var i,a;if(L(e.req))await(null===(i=e.onUpdateResult)||void 0===i?void 0:i.call(e,{req:e.req,...r}));else await(null===(a=e.onResult)||void 0===a?void 0:a.call(e,{req:e.req,...r}))}catch(r){(0,x.RF)("[MaterialPublishService] callOnResult failed",r)}};let o;try{o=await this.postOrUpdate(e)}catch(i){throw e.promise=null,l(i,""),i}return await l(null,o.resource_id),o}async postOrUpdate(e){return L(e.req)?(await(0,F.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,F.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new I.B).timeout(5e3)])}catch(t){(0,x.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const l=performance.now(),o=new I.B,i={count:50,effect_types:t,uid:S.$.userInfo.uid,cursor:0};for(;performance.now()-l<5e3;){const t=await(0,F.Js)(i).catch((()=>null));if(null!=t&&t.effect_item_list){const l=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>l.has(e))))return}await o.timeout(500)}}}var w=l(76892),N=l(15621),j=l(18552),A=l(89130),U=l(38595),P=l(71157),T=l(57494),k=l(47791),E=l(39110),R=l(47573),Z=l(32950),z=l(54734),W=l(38833),q=l(38432),O=l(5065),V=l(52272),D=l(76664),B=l(22531),$=l(33452);const Y=(0,o.createContext)(null),G=()=>(0,o.useContext)(Y);var J=l(72322);const K=(0,i.Pi)((({className:e})=>{var t,l;const o=(0,d.$Y)(),i=G(),a=i.materialListStore.selectedMaterial;return(0,J.jsx)(n.v,{className:e,groups:o,initGroup:c.nb.File,activeGroup:c.nb.File,resetExpandedGroupKey:null!==(t=null==a||null===(l=a.payload)||void 0===l?void 0:l.localId)&&void 0!==t?t:null,getStatus:e=>{var t;return e.key===c.id.CollectionNum&&!i.isFilterCountValid&&i.hasTriggeredImport?"error":"mainForm"!==i.mainFormLayout?"init":i.isCollectionCoverCardSelected?"success":a?null!==(t=a.payload)&&void 0!==t&&null!==(t=t.unmetRequirements)&&void 0!==t&&t.includes(e.key)?"error":"success":"init"}})}));var Q=l(14986),H=l(67509);const X=(0,i.Pi)((({className:e})=>{const t=G(),{t:l}=(0,a.$)(),i=(0,o.useRef)(null),r=(0,o.useMemo)((()=>t.materialListStore.materialList.length),[t.materialListStore.materialList]),s=(0,o.useMemo)((()=>t.isAllReadyPublish),[t.isAllReadyPublish]);return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(Q.Z,{className:e,leftText:l("pc_sticker_import_zero_to_hundred_web",{X:r,Y:t.maxTotalCount}),isPublishDisabled:!s,isPublishing:t.isPublishing,needConfirmModalOnClose:t.needConfirmModalOnClose,onPublish:()=>t.uploadAndPublish(i.current)}),(0,J.jsx)(H.q,{ref:i,uploadStats:t.materialListStore.uploadStats,onRetryUpload:t.retryUpload,onCancel:t.isAllUploadedWatcher.stop,onShowUploadFail:t.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:t.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var ee=l(21418),te=l(40358),le=l(18751),oe=l.n(le),ie=l(48660),ae=l(52340);const re="root-CyHG0U",se="container-gVo1aR",ne="cardDragWrapper-zJCxOO",ce="card-Gf3Uuf",de="hover-right-r4hcXu",me="hover-left-eC5Wkd",pe=(0,i.Pi)((()=>{const e=G(),{materialListStore:t}=e,l=(0,o.useCallback)(((e,l)=>{t.selectedId!==e.payload.localId&&t.selectMaterial(e.payload.localId)}),[t.selectMaterial]),i=(0,o.useCallback)(((t,l)=>{var o;return(0,J.jsx)(ae.Z,{className:oe()(ce,{[de]:"right"===l,[me]:"left"===l}),material:t,onClick:e.selectMaterial,isSelected:e.materialListStore.selectedId===t.payload.localId,onRemove:e.materialListStore.removeMaterial,onReimport:e.reimport},null===(o=t.payload)||void 0===o?void 0:o.localId)}),[e.reimport,e.selectMaterial,e.materialListStore.removeMaterial,e.materialListStore.selectedId]);return(0,J.jsx)("div",{className:re,children:(0,J.jsx)("div",{className:se,children:(0,J.jsx)(ie.y,{list:t.materialList,renderCard:i,onMoveCard:t.dragInsert,className:ne,getId:e=>e.payload.localId,scrollAreaRef:e.materialListStore.scrollAreaRef,onCardClick:l})})})}));var ue=l(13199);const _e="root-GNdXWA",ge="coverWrapper-m2s_kd",he="box-vldsSe",fe="img-M22_Hp",Ce="editCover-TbZjiP",ve="disabled-hWdY5N",be="icon-n04zn6";var ye=l(37964);const Se=(0,i.Pi)((e=>{const t=G(),{t:l}=(0,a.$)(),{payload:i}=t.collection,r=((0,o.useMemo)((()=>{const e=t.materialListStore.materialList.length;return e<=t.maxTotalCount&&e>=t.getImportMinMaxCount().minCount&&!t.collection.payload.filterImg}),[t.materialListStore.materialList,t.collection.payload.filterImg]),(()=>{const{succeeded:e,pending:l,failed:o}=t.materialListStore.uploadStats;return e+l<Z.Cz?{tooltip:null,percent:null}:null})()),{handleMouseEnter:s}=(0,ye.w)({content:null==r?void 0:r.tooltip,cursor:"not-allowed"});return(0,J.jsx)("div",{className:_e,children:(0,J.jsx)("div",{className:ge,children:(0,J.jsxs)("div",{className:he,children:[i.filterImg?(0,J.jsx)("img",{className:fe,src:i.filterImg}):(0,J.jsx)(ue.t,{className:be,iconWidth:28}),(0,J.jsx)("div",{className:oe()(Ce,r&&ve),onMouseEnter:null!=r&&r.tooltip?s:void 0,onClick:e=>{r?e.stopPropagation():t.openFilterCollectionCoverEditor()},children:l("pc_stickers_release_cover_edit_web")})]})})})}));var xe=l(33094),Ie=(l(94443),l(93585)),Fe=l(63e3),Le=l(86807),Me=l(56230),we=l(26851);const Ne="root-Wz5Kiy",je="input-V8uRBu",Ae="businessCheckbox-HQ78x3",Ue=(0,i.Pi)((()=>{const{t:e}=(0,a.$)(),t=G(),{formApi:l}=t;(0,o.useLayoutEffect)((()=>(null==l||l.reset(),null==l||l.setValues(t.collection,{isOverride:!0}),()=>{const e=null==l?void 0:l.getValues();e&&t.updateCollectionForm({is_vip:e.is_vip||!1,common_data:{...t.collection.common_data,title:e.common_data.title||"",description:e.common_data.description,is_original:e.common_data.is_original||!1,is_business:e.common_data.is_business||!1}})})),[]);const i=(e,l)=>{t.updateCollectionForm({common_data:{...t.collection.common_data,[l]:e}})},{getDisplayLength:r}=(0,Me._)();return(0,J.jsxs)("div",{className:Ne,children:[(0,J.jsx)(Se,{}),(0,J.jsx)(xe.l,{fieldClassName:je,label:e("pc_filter_collection_name"),field:"common_data.title",maxLength:Z.Mc,allowEnter:!1,placeholder:e("pc_stickers_release_xy_name_web",{X:1,Y:r(Z.Mc)}),rules:[{required:!0,message:""}],onChange:e=>i(e,"title")}),(0,J.jsx)(xe.l,{fieldClassName:je,label:e("pc_filter_collection_description"),field:"common_data.description",maxLength:Z.Mn,allowEnter:!1,placeholder:e("pc_stickers_release_xy_details_web",{X:1,Y:r(Z.Mn)}),rules:[{required:!0,message:""}],onChange:e=>i(e,"description")}),!1,(0,J.jsx)(Ie.Z,{children:(0,J.jsxs)("div",{className:we.Z.authGroup,children:[(0,J.jsx)(Ie._,{text:e("pc_template_authorize_range_web")}),(0,J.jsxs)("div",{className:we.Z.right,children:[(0,J.jsx)(Fe.l,{noLabel:!0,field:"is_vip",sendLogService:t.sendLogServ}),(0,J.jsx)(Le.R,{fieldClassName:Ae,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:t.authorSignService,getAuthFileUploadService:()=>t.authFileUploadServiceManager.ensure(t.collection.payload.localId),sendLogService:t.sendLogServ})]})]})})]})}));var Pe=l(68288);const Te="root-W9YKLd",ke="selected-MfKVC9",Ee="cover-Sg1bSx",Re="icon-NjGS_M",Ze="textInfo-zYCck9",ze="title-PHGLK_",We="description-W4AGHI",qe="statusBar-wU3FIA",Oe="checkedStatusBar-YMzSep",Ve=({className:e,selected:t,coverSrc:l,title:o,description:i,isInfoComplete:r,onClick:s})=>{const{t:n}=(0,a.$)(),{handleMouseEnter:c}=(0,ye.S)();return(0,J.jsxs)("div",{className:oe()(e,Te,t&&ke),onClick:s,children:[(0,J.jsx)("div",{className:Ee,children:l?(0,J.jsx)("img",{className:Re,src:l}):(0,J.jsx)(ue.t,{className:Re,iconWidth:28})}),(0,J.jsxs)("div",{className:Ze,children:[(0,J.jsx)("div",{className:ze,onMouseEnter:c,children:o||n("pc_stickers_release_group_name_web")}),(0,J.jsx)("div",{className:We,onMouseEnter:c,children:i||n("pc_stickers_release_details_recommend_web")})]}),r?(0,J.jsx)(Pe.Bo,{className:Oe,text:n("pc_stickers_release_finish_fill_web")}):(0,J.jsx)(Pe.LU,{className:qe})]})},De=(0,i.Pi)((e=>{const{className:t}=e,l=G(),{common_data:{title:o,description:i},payload:a}=l.collection;return(0,J.jsx)(Ve,{className:t,selected:l.isCollectionCoverCardSelected,coverSrc:null==a?void 0:a.filterImg,title:o,description:i||"",isInfoComplete:Boolean(o&&i),onClick:l.selectCollectionCoverCard})}));var Be=l(46656);const $e="collectionCard-SdYl10",Ye=(0,i.Pi)((({className:e})=>{const t=G(),{t:l}=(0,a.$)(),i=(0,o.useCallback)((()=>t.isCollectionCoverCardSelected?(0,J.jsx)(Ue,{}):t.materialListStore.selectedMaterial&&(0,J.jsx)(Be.Z,{material:t.materialListStore.selectedMaterial,materialListStore:t.materialListStore,formApi:t.formApi,collectionId:t.collection.payload.localId})),[t.isCollectionCoverCardSelected,t.materialListStore.selectedMaterial,t.materialListStore,t.formApi]);return(0,s.pg)(t),(0,ee.O)({className:e,layout:t.mainFormLayout,uploadAreaProps:{titleForUploadArea:l("pc_sticker_release_drag_web"),titleForMainForm:l("pc_stickers_release_drag_in_web"),subTitle:".cube/.3dl",draggingTitle:l("pc_sticker_release_mouse_web"),disabled:t.isImportDisabled,disabledTooltip:"",onClick:t.openFilterPicker,onDrop:t.uploadDroppedAudioFiles},setFormApi:t.setFormApi,renderImportArea:e=>(0,J.jsxs)(J.Fragment,{children:[e,(0,J.jsx)(De,{className:$e}),(0,J.jsx)(pe,{})]}),renderFormArea:i,scrollAreaRef:t.materialListStore.scrollAreaRef,onRetry:te.cb})}));var Ge=l(90856);const Je="page-nEVnn2",Ke="content-j9aRoI",Qe="requirement-PCZk_y",He="mainForm-CMsd0V",Xe="footer-cJesUg",et=(0,i.Pi)((()=>{const e=function(){const e=(0,U.WQ)(),t=(0,A.WQ)(e),l=new N.l,i=new W.v({itemType:C.Ab.FilterCollection}),a=(0,R.G)({watch:()=>r.isAllUploaded}),r=(0,_.fv)((()=>({uploadConfigService:new j.w,formApi:null,setFormApi:e=>{r.formApi=e},sendLogServ:i,authorSignService:new T.I({signScene:D.d.BusinessArtist}),authFileUploadServiceManager:new k.r({}),performanceTimingCollector:(0,$.uY)(),isPublishing:!1,setIsPublishing:(0,g.aD)((e=>r.isPublishing=e)),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===r.mainFormLayoutAfterLoading&&P.appModel.isInitFailed?"error":r.mainFormLayoutAfterLoading},get isFilterCountValid(){const e=r.materialListStore.materialList.length;return e>=Z.Cz&&e<=Z.OQ},collection:{effect_type:C.Ab.FilterCollection,common_data:{title:"",description:"",tags:[],source:F.r0.UserPostPcCollection,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:""}},is_vip:!1,payload:{hasEverSelected:!1,localId:(0,w.V)("filter-collection"),filterImg:"",isUploadFailed:!1,error:"",temporary:{Thumbnail:"",Upload:""}}},updateCollectionForm:(0,g.aD)((e=>{Object.assign(r.collection,e)})),pubServ:new M,isCollectionCoverCardSelected:!1,selectMaterial(t){r.isCollectionCoverCardSelected&&(r.isCollectionCoverCardSelected=!1),e.selectMaterial(t)},selectCollectionCoverCard(){e.selectMaterial(null),r.isCollectionCoverCardSelected=!0,r.collection.payload.hasEverSelected=!0},get maxTotalCount(){return Z.OQ},get isImportDisabled(){return e.materialList.length>=r.maxTotalCount},get needConfirmModalOnClose(){return e.materialList.length>0},materialListStore:e,importLoadingStore:t,getImportMinMaxCount(){const t=e.materialList.length;return{minCount:Math.max(1,Z.Cz-t),maxCount:Math.max(0,r.maxTotalCount-t),maxTotalCount:r.maxTotalCount}},get isAllReadyPublish(){var t,l;return e.materialList.length>=Z.Cz&&e.materialList.length<=r.maxTotalCount&&e.isReadyToPublish&&r.collection.payload.filterImg&&(null===(t=r.collection.common_data)||void 0===t?void 0:t.title)&&(null===(l=r.collection.common_data)||void 0===l?void 0:l.description)},handleLoading(){r.materialListStore.materialList.length&&"uploadArea"===r.mainFormLayoutAfterLoading&&(t.showImportLoading(),r.selectCollectionCoverCard(),r.mainFormLayoutAfterLoading="mainForm",r.collection.is_vip=(0,q.K)(O.YW.OriginalForSubscription))},hasTriggeredImport:!1,openFilterPicker(){l.lock(Z.dr,(async()=>{i.sendUploadActionLog(r),await e.openFilterPicker({...r.getImportMinMaxCount(),source:F.r0.UserPostPcCollection,collectionId:r.collection.payload.localId}),r.hasTriggeredImport=!0,r.handleLoading()}))},uploadDroppedAudioFiles(){l.lock(Z.dr,(async()=>{i.sendUploadActionLog(r),await e.uploadDroppedFilterFiles({...r.getImportMinMaxCount(),source:F.r0.UserPostPcCollection,collectionId:r.collection.payload.localId}),r.hasTriggeredImport=!0,r.handleLoading()}))},reimport(t){l.lock(Z.dr,(async()=>{await e.reimportFilterFilePicker({...r.getImportMinMaxCount(),source:F.r0.UserPostPcCollection,oldId:t.payload.localId}),r.handleLoading()}))},async openFilterCollectionCoverEditor(){const t=await z.Z.openFilterCollectionCoverImage({...await r.uploadConfigService.getUploadConfigs("openFilterCollectionCoverImage"),filters:e.materialList.map((e=>({id:e.payload.localId}))),collectionId:r.collection.payload.localId});"Success"===t.result&&(0,g.z)((()=>{r.collection.payload.filterImg="",r.collection.common_data.icon.image_uri="",r.collection.payload.temporary.Thumbnail=t.temporaryId,r.collection.payload.temporary.Upload=t.temporaryId})),"Error"===t.result&&(r.collection.payload.isUploadFailed=!0,r.collection.payload.error=t.error)},get isAllUploaded(){const{pending:e,failed:t}=r.materialListStore.uploadStats,l=Boolean(r.collection.common_data.icon.image_uri);return!e&&!t&&l},sendUploadProgressModalShowErrorLog(){const e=r.materialListStore.materialList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.error,collection_detail:"collection_material"})));r.collection.payload.isUploadFailed&&e.push({collection_detail:"collection_cover",error_report:r.collection.payload.error}),i.sendMaterialPublishErrorLog(e)},async retryUpload(){const e=r.materialListStore.materialList.filter((e=>e.payload.isUploadFailed)),t=r.collection.payload.isUploadFailed?[r.collection.payload.localId]:[];return r.materialListStore.retryUpload(e,t)},isAllUploadedWatcher:a,asyncFormData(){var t;const l=null===(t=r.formApi)||void 0===t?void 0:t.getValues();if(l)if(r.isCollectionCoverCardSelected)r.updateCollectionForm({is_vip:l.is_vip||!1,common_data:{...r.collection.common_data,title:l.common_data.title||"",description:l.common_data.description,is_original:l.common_data.is_original||!1,is_business:l.common_data.is_business||!1}});else{const t=r.materialListStore.selectedMaterial;if(!t)return;e.updateFormState(t,{is_vip:l.is_vip||!1,common_data:{...t.common_data,title:l.common_data.title||"",description:l.common_data.description,is_original:l.common_data.is_original||!1,is_business:l.common_data.is_business||!1}})}},async uploadAndPublish(e){r.asyncFormData(),i.sendPageActionLog({action:"publish"}),r.isAllUploaded||(await r.retryUpload(),null==e||e.show(),await r.isAllUploadedWatcher.start());try{await r.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{r.setIsPublishing(!0);const{collection:t}=r,l=e.materialList.map((e=>{const l=(0,E.pn)({isVip:t.is_vip,isBusiness:t.common_data.is_business});return{id:e.payload.localId,req:{...(0,u.Z)(e,["payload"]),...l.root,common_data:{...e.common_data,is_original:t.common_data.is_original,...l.commonData}},onResult:t=>{i.sendMaterialPublishLog({publishResult:t,filter:e,logPrefix:"[CollectionStore]"})}}}));(0,x.c6)("[CollectionStore] filters publish start",{ids:l.map((e=>e.id))});const o=(await r.pubServ.batchPublish(l)).map((e=>e.resource_id));(0,x.c6)("[CollectionStore] filters publish done",{resourceIdList:o});const a=(0,E.pn)({isVip:t.is_vip,isBusiness:t.common_data.is_business,authFiles:r.authFileUploadServiceManager.getUploadedFiles(t.payload.localId)}),{resource_id:s}=await r.pubServ.publish({id:t.payload.localId,req:{...(0,u.Z)(t,["payload"]),...a.root,common_data:{...t.common_data,...a.commonData},collection_info:{resource_id_list:o}},onResult:e=>{i.sendMaterialCollectionPublishLog({publishResult:e,collection:t})}});await r.pubServ.pollUntilAllInEffectList({ids:[s],types:[C.Ab.FilterCollection]}),(0,x.c6)("[CollectionStore] poll done"),h.FN.success(f.I18n.t("pc_filter_release_successful")),(0,V.ZM)({effect_type:C.Ab.FilterCollection}),setTimeout((()=>(0,V.Nt)({item_type:C.Ab.FilterCollection})),1e3)}catch(t){h.FN.error(f.I18n.t("pc_sticker_release_failed_retry_web")),(0,x.RF)("[CollectionStore] publish fail",t)}finally{r.setIsPublishing(!1)}},handleCollectionProcessResult(e){if(e.collectionId===r.collection.payload.localId){if("Success"===e.result)switch(e.type){case"Thumbnail":const{base64:t}=e;(0,g.z)((()=>{r.collection.payload.filterImg=`data:;base64,${t}`}));break;case"Upload":const{uri:l}=e;r.collection.common_data.icon.image_uri=l;break;default:return}"Error"===e.result&&(r.collection.payload.isUploadFailed=!0,"Upload"===e.type&&(r.collection.common_data.icon.image_uri=""))}},handleFilterFileProcessResult(t){r.handleCollectionProcessResult(t);const l=e.getMaterial(t.id);if(!l)return;const o=t.temporaryId===l.payload.temporary[t.type];if("Success"===t.result)switch(t.type){case"Thumbnail":if(!o)return;const{base64:i}=t;e.updateFormState(l,{payload:{...l.payload,filterImg:`data:;base64,${i}`}});break;case"FilterImg":if(!o)return;const{sourceUri:a,filterUri:r}=t;e.updateUploadResp(l,{sourceUri:a,filterUri:r});break;case"FilterFile":const{fileUri:s}=t;e.updateUploadResp(l,{fileUri:s});break;default:return}if("Error"===t.result){if("FilterImg"===t.type&&o){const{sourceUri:o,filterUri:i}=t;e.updateUploadResp(l,(0,p.Z)({sourceUri:o,filterUri:i},m.Z))}e.updateFormState(l,{payload:{...l.payload,isUploadFailed:!0}})}}})));return(0,B.u)({watch:()=>r.needConfirmModalOnClose}),(0,o.useEffect)((()=>{window.store=r;const e=z.Z.registerFilterFileProcessResultEvent(r.handleFilterFileProcessResult);return r.authorSignService.init(),r.performanceTimingCollector.addRenderTiming($.Pk),()=>{e(),t.destroy()}}),[]),r}(),{t}=(0,a.$)(),{selectedMaterial:l}=e.materialListStore;(0,o.useMemo)((()=>e.materialListStore.materialList.length?e.isCollectionCoverCardSelected?e.collection:l:null),[e.isCollectionCoverCardSelected,e.collection,l]);return(0,r.F)({title:t("pc_filter_release_collection"),pid:"filter-publish-collection"}),(0,Ge.d)(),(0,s.t9)(e.sendLogServ),(0,J.jsx)(Y.Provider,{value:e,children:(0,J.jsxs)("div",{className:Je,children:[(0,J.jsxs)("div",{className:Ke,children:[(0,J.jsx)(K,{className:Qe}),(0,J.jsx)(Ye,{className:He})]}),(0,J.jsx)(X,{className:Xe})]})})}))}}]);