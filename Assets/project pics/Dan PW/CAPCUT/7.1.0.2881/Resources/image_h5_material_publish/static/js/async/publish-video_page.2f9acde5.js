"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[5776],{54290:(e,o,i)=>{i.d(o,{Ab:()=>a});let a=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},28636:(e,o,i)=>{i.r(o),i.d(o,{default:()=>wo});var a=i(65625),t=i(42716),l=i(62293),r=i(82686),s=i(18571),n=i(43130),d=i(79292);let c=function(e){return e.Format="format",e.RecommendFileSize="RecommendFileSize",e.FileDuration="FileDuration",e.ResolutionSize="ResolutionSize",e}({}),p=function(e){return e.File="file",e}({});const u={[p.File]:{[c.Format]:d.I18n.t("pc_video_form"),[c.FileDuration]:d.I18n.t("pc_filter_time_limit"),[c.RecommendFileSize]:d.I18n.t("pc_filter_file_size_one_g"),[c.ResolutionSize]:d.I18n.t("pc_filter_pixel_size_n")}},m="ImportVideo";var v=i(73221),g=i(20165),f=i(60963),y=i(79337),_=i(54290),h=i(71157),b=i(18552),F=i(15621),A=i(83305),C=i(85108),S=i(76892),V=i(57494),I=i(47791),x=i(39110),P=i(47573),w=i(57102),j=Object.defineProperty,L=Object.defineProperties,O=Object.getOwnPropertyDescriptors,k=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable,U=(e,o,i)=>o in e?j(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,M=(e,o)=>{for(var i in o||(o={}))R.call(o,i)&&U(e,i,o[i]);if(k)for(var i of k(o))E.call(o,i)&&U(e,i,o[i]);return e};const T={version:void 0};var N=(e,o={})=>{return w.Z.call("openVideoFilePicker",e,(i=M({},o),a={customOptions:M({jsb_rules:T},o.customOptions)},L(i,O(a))));var i,a},B=Object.defineProperty,z=Object.defineProperties,D=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,G=(e,o,i)=>o in e?B(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,J=(e,o)=>{for(var i in o||(o={}))Z.call(o,i)&&G(e,i,o[i]);if(q)for(var i of q(o))Y.call(o,i)&&G(e,i,o[i]);return e};const W={version:void 0};var Q=(e,o={})=>{return w.Z.call("uploadDroppedVideoFiles",e,(i=J({},o),a={customOptions:J({jsb_rules:W},o.customOptions)},z(i,D(a))));var i,a};var X=Object.defineProperty,H=Object.defineProperties,K=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,ie=(e,o,i)=>o in e?X(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,ae=(e,o)=>{for(var i in o||(o={}))ee.call(o,i)&&ie(e,i,o[i]);if($)for(var i of $(o))oe.call(o,i)&&ie(e,i,o[i]);return e};const te={version:void 0};var le=(e,o={})=>{return w.Z.call("openVideoCoverEdit",e,(i=ae({},o),a={customOptions:ae({jsb_rules:te},o.customOptions)},H(i,K(a))));var i,a},re=Object.defineProperty,se=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,de=Object.getOwnPropertySymbols,ce=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,ue=(e,o,i)=>o in e?re(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,me=(e,o)=>{for(var i in o||(o={}))ce.call(o,i)&&ue(e,i,o[i]);if(de)for(var i of de(o))pe.call(o,i)&&ue(e,i,o[i]);return e};const ve={version:void 0};var ge=(e,o={})=>{return w.Z.call("cancelVideoUpload",e,(i=me({},o),a={customOptions:me({jsb_rules:ve},o.customOptions)},se(i,ne(a))));var i,a};const fe=new class{async openVideoFilePicker(e){(0,A.c6)("[JSB] openVideoFilePicker req --\x3e",{request:e});const o=await N(e);return(0,A.c6)("[JSB] openVideoFilePicker resp <--",o),o}async uploadDroppedVideoFiles(e){var o;(0,A.c6)("[JSB] uploadDroppedVideoFiles req --\x3e",{...(0,v.Z)(e,[])});const i=await Q(e);return(0,A.c6)("[JSB] uploadDroppedVideoFiles resp <--",{imagesCount:null==i||null===(o=i.videos)||void 0===o?void 0:o.length,ids:i.videos.map((e=>e.id))}),i}registerVideoFileProcessResultEvent(e){return(e=>{const o=w.Z.on("videoFileProcessResult",(o=>{o.data&&e(o.data)}));return()=>w.Z.off("videoFileProcessResult",o)})((o=>{(0,A.c6)(`[JSB] videoFileProcessResult {${null==o?void 0:o.id}}`,o),e(o)}))}async openVideoCoverEdit(e){(0,A.c6)("[JSB] openVideoCoverEdit req --\x3e",{...(0,v.Z)(e,[])});const o=await le(e);return(0,A.c6)("[JSB] openVideoCoverEdit resp <--",o),o}async cancelVideoUpload(e){(0,A.c6)("[JSB] CancelVideoUploadRequest req --\x3e",{...e}),await ge(e)}};var ye=i(10806),_e=i(85918),he=i(38432),be=i(5065),Fe=i(23818),Ae=i(48647);const Ce=e=>e.filter((e=>{var o;return!(null!==(o=e.payload)&&void 0!==o&&o.itemId)})).map((e=>(e.payload.hasVideoFrameSelect||(e.common_data.icon.image_uri=e.payload.coverUri),e))),Se=e=>{const{id:o,path:i,size:a,duration:t,video_size_type:l}=e,r=(0,_e.lm)(i),s=[];["mp4","mov","avi"].includes(r)||s.push(c.Format),a>1073741824&&s.push(c.RecommendFileSize),t>60&&s.push(c.FileDuration);return{effect_type:5,common_data:{title:(0,Fe.YB)(i,{maxLength:ye.S8}),description:"",tags:[],source:Ae.r0.UserPostPc,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:""},file:{file_uri:"",file_md5:"",size:Number(a)}},is_vip:(0,he.K)(be.YW.OriginalForSubscription),payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:s,localId:o,path:i,coverBase64:"",size:a,hasVideoFrameSelect:!1,coverUri:"",isUploadFailed:!1,uploadFailedText:"",temporaryRecord:{VideoCover:""}},video:{video_id:"",duration:t,video_size_type:l}}};var Ve=i(52272),Ie=i(76664),xe=i(22531),Pe=i(33452);const we=(0,s.createContext)(null),je=()=>(0,s.useContext)(we);var Le=i(72322);const Oe=(0,a.Pi)((({className:e})=>{var o,i;const{t:a}=(0,t.$)(),l=(0,s.useMemo)((()=>{return[{key:p.File,title:a("pc_video_specification"),instructions:(e=p.File,Object.entries(u[e]).map((([e,o])=>({key:e,title:o}))))}];var e}),[]),r=je().selectedVideo;return(0,Le.jsx)(n.v,{className:e,groups:l,initGroup:p.File,activeGroup:p.File,resetExpandedGroupKey:null!==(o=null==r||null===(i=r.payload)||void 0===i?void 0:i.localId)&&void 0!==o?o:null,getStatus:e=>{var o;return r?null!==(o=r.payload)&&void 0!==o&&null!==(o=o.unmetRequirements)&&void 0!==o&&o.includes(e.key)?"error":"success":"init"}})}));var ke=i(14986),Re=i(67509);const Ee=(0,a.Pi)((({className:e})=>{const o=je(),{t:i}=(0,t.$)(),a=(0,s.useRef)(null),l=(0,s.useMemo)((()=>o.videoList.length),[o.videoList]);return(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(ke.Z,{className:e,leftText:i("pc_sticker_import_zero_to_hundred_web",{X:l,Y:50}),isPublishDisabled:!o.isAllReadyPublish,isPublishing:o.isPublishing,needConfirmModalOnClose:o.needConfirmModalOnClose,onPublish:()=>o.uploadAndPublish(a.current)}),(0,Le.jsx)(Re.q,{ref:a,uploadStats:o.uploadStats,onRetryUpload:o.retryUpload,onCancel:o.isAllUploadedWatcher.stop,onShowUploadFail:o.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:o.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var Ue=i(21418),Me=i(40358),Te=i(18751),Ne=i.n(Te),Be=i(48660);const ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAYAAACMRWrdAAAACXBIWXMAAAhOAAAITgGMMQDsAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGOSURBVHgB7ZjpbsIwEIQnhUI5erz/M/YXhzgqSHdIIhVqIuPdpn/mk6xIITY73mXWARBCCCGEEEIIIQKp4KCu67ldpjZGKKe2cayqan2zNtcc2f0jChijEPtiCnpFDGNb72witnblZi9tcNM2NoYV5pybYmaieKWgJziJCu6EcpghCmHpLRFEpLCNldJX7oS25ObtSMESPKCQYvOwwBb4vcMMZG0CTz3zfgpKlRwFbUtNo8OTsXPiHg1lasHv0AR3JdDuv6DZjJSLnto5OwTgtXsGyMzN7jxyEYgmM+9IC+IG7UzQBoG4hHVkCExxEYQmSzWCCRHWkSnwTwV1uPtFYr1RxjM14r/7ishSfLMxeWAazYKZ2/e5aClDmcekfe6eG7IH7hGIp4/R2j/ufMwetErYPTdgEIHRDTqruQ4hMEpY0WkhQ+Bq8NeWGy7m0Z7OH6XqWfMZ//DachuEF2aI5bdAAJ5ekn2Sz+TQHqs+0bipC6/d8zfCg603Y8zU1UnE+9eAEEIIIYQQQggRyjdM3Jsueus4uQAAAABJRU5ErkJggg==";var De=i(18329),qe=i(68288),Ze=i(84133),Ye=i(33921);const Ge="root-Gp6SAy",Je="statusBar-RlHIzL",We="contextMenuItem-Q1pqvP",Qe=(0,a.Pi)((({className:e,video:o,isSelected:i,onClick:a,onReimport:l,onRemove:r})=>{var s,n;const{t:d}=(0,t.$)(),{common_data:c,payload:m}=o,v=m.coverBase64,g=Boolean(null===(s=o.payload)||void 0===s||null===(s=s.unmetRequirements)||void 0===s?void 0:s.length),f=Boolean(c.title&&(null===(n=c.tags)||void 0===n?void 0:n.length)),{handleContextMenu:y}=(0,Ye.D)({content:(0,Le.jsx)(Ze.m,{items:[{key:"reimport",render:({key:e,className:i})=>Boolean(g)&&(0,Le.jsx)("div",{className:Ne()(i,We),onClick:()=>l(o),children:d("pc_material_release_import_again")},e)},{key:"remove",render:({key:e,className:i})=>(0,Le.jsx)("div",{className:Ne()(i,We),onClick:()=>r(o),children:d("pc_material_release_delete")},e)}]})});return(0,Le.jsxs)("div",{className:Ne()(e,Ge),onClick:()=>{a(o.payload.localId)},children:[(0,Le.jsx)(De.Y,{src:o.payload.coverBase64||ze,isSelected:i,isInvalid:Boolean(g),size:80,onContextMenu:e=>{var i;y(e),a(null===(i=o.payload)||void 0===i?void 0:i.localId)}}),(0,Le.jsx)(qe.ir,{className:Je,loading:!v,invalid:g,errorToolip:g&&(null===(_=o.payload)||void 0===_||null===(_=_.unmetRequirements)||void 0===_?void 0:_.map((e=>{const o=u[p.File][e];return o?(0,Le.jsx)("div",{children:o},e):null}))),isInfoComplete:f,title:c.title})]});var _})),Xe="root-zxRVxw",He="container-X208Ej",Ke="cardDragWrapper-FfPLEp",$e="videoCard-erG3SL",eo="hover-right-LBd8Iu",oo="hover-left-HN679b",io=(0,a.Pi)((()=>{const e=je(),o=(0,s.useCallback)(((o,i)=>{e.selectedId!==o.payload.localId&&e.selectMaterial(o.payload.localId)}),[e.selectMaterial]),i=(0,s.useCallback)(((o,i)=>{var a;return(0,Le.jsx)(Qe,{className:Ne()($e,{[eo]:"right"===i,[oo]:"left"===i}),video:o,onClick:e.selectMaterial,isSelected:e.selectedId===o.payload.localId,onRemove:e.removeVideo,onReimport:e.reimport},null===(a=o.payload)||void 0===a?void 0:a.localId)}),[e.reimport,e.selectMaterial,e.removeVideo,e.selectedId]);return(0,Le.jsx)("div",{className:Xe,children:(0,Le.jsx)("div",{className:He,children:(0,Le.jsx)(Be.y,{list:e.videoList,renderCard:i,onMoveCard:e.dragInsert,className:Ke,getId:e=>e.payload.localId,scrollAreaRef:e.scrollAreaRef,onCardClick:o})})})}));var ao=i(33094),to=i(45220),lo=(i(94443),i(56230)),ro=i(93585),so=i(63e3),no=i(86807),co=i(26851);const po="root-KZIMjN",uo="coverWrapper-RGIBQO",mo="box-DSqyOS",vo="imgBox-DIFFJg",go="editCover-CztcLw",fo="label-AoVgOz",yo="useAll-_BX2u3",_o="input-ZRdCJO",ho="businessCheckbox-TvUDwv",bo=(0,a.Pi)((({video:e})=>{const{t:o}=(0,t.$)(),i=je();(0,s.useLayoutEffect)((()=>{var o,a;return null===(o=i.formApi)||void 0===o||o.reset(),null===(a=i.formApi)||void 0===a||a.setValues(e,{isOverride:!0}),()=>i.syncFormData(e)}),[e]);const{getDisplayLength:a}=(0,lo._)(),l=(o,a)=>{i.updateFormState(e,{common_data:{...e.common_data,[a]:o}})};return(0,Le.jsxs)("div",{className:po,children:[(0,Le.jsx)("div",{className:uo,children:(0,Le.jsxs)("div",{className:mo,children:[(0,Le.jsx)("div",{className:vo,style:{backgroundImage:`url(${e.payload.coverBase64||ze})`}}),(0,Le.jsx)("div",{className:go,onClick:()=>i.openCoverEdit(e.payload.localId),children:o("pc_video_frame_select")})]})}),(0,Le.jsx)(ao.l,{fieldClassName:_o,label:o("pc_filter_video_name"),field:"common_data.title",maxLength:ye.S8,placeholder:o("pc_stickers_release_xy_name_web",{X:1,Y:a(ye.S8)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>l(e,"title")}),(0,Le.jsxs)("div",{className:fo,children:[(0,Le.jsx)(to.u,{fieldClassName:_o,label:o("pc_stickers_release_tag_set_web"),placeholder:o("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"common_data.tags",itemType:5,recommendConfig:{title:e.common_data.title},rules:[{required:!0,message:""}],onChange:e=>l(e,"tags"),temporaryId:e.payload.localId}),(0,Le.jsx)("span",{className:yo,onClick:()=>{var e;const{tags:o}=(null===(e=i.formApi)||void 0===e?void 0:e.getValue("common_data"))||{};null!=o&&o.length&&i.applyForTags({tags:o})},children:o("pc_material_release_apply_all")})]}),!1,(0,Le.jsx)(ro.Z,{onClickUseAll:()=>{var e;const o=null===(e=i.formApi)||void 0===e?void 0:e.getValues();o&&i.applyAuthSettingsToAll({isVip:o.is_vip,isOriginal:o.common_data.is_original,isBusiness:o.common_data.is_business})},children:(0,Le.jsxs)("div",{className:co.Z.authGroup,children:[(0,Le.jsx)(ro._,{text:o("pc_template_authorize_range_web")}),(0,Le.jsxs)("div",{className:co.Z.right,children:[(0,Le.jsx)(so.l,{noLabel:!0,field:"is_vip",sendLogService:i.sendLogServ}),(0,Le.jsx)(no.R,{fieldClassName:ho,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:i.authorSignService,getAuthFileUploadService:()=>i.authFileUploadServiceManager.ensure(e.payload.localId),sendLogService:i.sendLogServ})]})]})})]})})),Fo=(0,a.Pi)((({className:e})=>{const o=je(),{t:i}=(0,t.$)(),a=(0,s.useCallback)((()=>o.selectedVideo&&(0,Le.jsx)(bo,{video:o.selectedVideo})),[o.selectedVideo]);(0,r.pg)({mainFormLayout:o.mainFormLayout,sendLogServ:o.sendLogServ});const l=(0,s.useMemo)((()=>o.videoList.length>=50),[o.videoList]);return(0,Ue.O)({className:e,layout:o.mainFormLayout,uploadAreaProps:{titleForUploadArea:i("pc_sticker_release_drag_web"),titleForMainForm:i("pc_stickers_release_drag_in_web"),subTitle:".mov/.mp4/.avi",draggingTitle:i("pc_sticker_release_mouse_web"),disabled:l,disabledTooltip:"",onClick:o.openVideoPicker,onDrop:o.droppedVideoFiles},setFormApi:o.setFormApi,renderImportArea:e=>(0,Le.jsxs)(Le.Fragment,{children:[e,(0,Le.jsx)(io,{})]}),renderFormArea:a,scrollAreaRef:o.scrollAreaRef,onRetry:Me.cb})}));var Ao=i(90856);const Co="page-jqxfuS",So="content-JGf9Xk",Vo="requirement-qtA9wp",Io="mainForm-TtAQN9",xo="footer-bDqSJs",Po=(0,a.Pi)((()=>{const e=function(){const{t:e}=(0,t.$)(),o=new F.l,i=new b.w,a=new r.D5({itemType:_.Ab.Video}),l=(0,P.G)({watch:()=>n.isAllUploaded}),n=(0,g.fv)((()=>({videoList:[],formApi:null,isPublishing:!1,pubServ:new C.Z,sendLogServ:a,scrollAreaRef:(0,s.createRef)(),authorSignService:new V.I({signScene:Ie.d.BusinessArtist}),authFileUploadServiceManager:new I.r({}),performanceTimingCollector:(0,Pe.uY)(),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return"uploadArea"===n.mainFormLayoutAfterLoading&&h.appModel.isInitFailed?"error":n.mainFormLayoutAfterLoading},get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get importMinMaxCount(){const e=n.videoList.length;return{minCount:1,maxCount:Math.max(0,50-e),maxTotalCount:50}},get needConfirmModalOnClose(){return n.videoList.length>0},selectedId:"",get selectedVideo(){return n.selectedId?n.getVideo(n.selectedId):null},getVideo:e=>{var o;return null!==(o=n.videoList.find((o=>{var i;return(null===(i=o.payload)||void 0===i?void 0:i.localId)===e})))&&void 0!==o?o:null},getVideoIndex:e=>n.videoList.findIndex((o=>{var i;return(null===(i=o.payload)||void 0===i?void 0:i.localId)===e})),selectMaterial(e){n.selectedId=e,n.selectedVideo&&(n.selectedVideo.payload.hasEverSelected=!0)},updateFormState(e,o){Object.assign(e,o)},setIsPublishing:(0,f.aD)((e=>n.isPublishing=e)),setFormApi:(0,f.aD)((e=>n.formApi=e)),applyForTags:({tags:e})=>{n.videoList.forEach((o=>{o.common_data.tags=e}))},applyAuthSettingsToAll:({isOriginal:e,isBusiness:o,isVip:i})=>{n.videoList.forEach((a=>{a.is_vip=Boolean(i),a.common_data.is_original=Boolean(e),a.common_data.is_business=Boolean(o)}))},dragInsert(e,o){const i=n.videoList.splice(e,1),a=e>o?o+1:o;n.videoList.splice(a,0,...i)},addVideos(e){0!==e.length&&(n.videoList=[...n.videoList,...e],n.selectMaterial(e[0].payload.localId),"uploadArea"===n.mainFormLayoutAfterLoading&&(n.mainFormLayoutAfterLoading="mainForm"))},async removeVideo(e){await fe.cancelVideoUpload({id:e.payload.localId}),n.videoList=n.videoList.filter((o=>o.payload.localId!==e.payload.localId))},getUploadParams:async(e,o)=>(await i.refreshUploadConfigsIfNeeded({when:o,logPrefix:"[VideoStore]"}),{...await i.getUploadConfigs("openVideoPicker"),accept:"mp4-mov-avi",thumbnailSize:236,maxFileSize:1073741824,maxFileDuration:60,...e}),async handleVideoFileProcessResult(e){var o;const i=n.getVideo(e.id);if(i)if("Success"===e.result)switch(e.type){case"Thumbnail":i.payload.coverBase64=`data:;base64,${e.base64}`;break;case"VideoInitCover":i.payload.coverUri=e.coverUri;break;case"VideoFile":const{videoId:a,fileUri:t}=e;i.video.video_id=a,i.common_data.file={file_md5:"",size:null===(o=i.common_data.file)||void 0===o?void 0:o.size,file_uri:t};break;case"VideoCover":const{temporaryId:l,coverUri:r}=e;i.payload.temporaryRecord[e.type]===l&&(i.common_data.icon.image_uri=r);break;default:return}else"Error"===e.result&&(i.payload.isUploadFailed=!0,i.payload.uploadFailedText=e.error||"")},initVideos({videos:e}){if(!e.length)return[];const o=[];for(const i of e){const e=Se(i);o.push(e)}return o},async openVideoPicker(){o.lock(m,(async()=>{try{a.sendPageActionLog({action:"mainForm"===n.mainFormLayout?"upload_more":"upload"});const e=await n.getUploadParams({...n.importMinMaxCount,multiple:!0},"openVideoPicker"),o=await fe.openVideoFilePicker(e),i=n.initVideos(o);n.addVideos(i)}catch(e){(0,A.RF)("openVideoFilePicker jsb failed ",e,{action:"openVideoPicker"})}}))},async droppedVideoFiles(){o.lock(m,(async()=>{try{a.sendPageActionLog({action:"mainForm"===n.mainFormLayout?"upload_more":"upload"});const e=await n.getUploadParams({...n.importMinMaxCount,multiple:!0},"droppedVideoFiles"),o=await fe.uploadDroppedVideoFiles(e),i=n.initVideos(o);n.addVideos(i)}catch(e){(0,A.RF)("uploadDroppedVideoFiles jsb failed ",e,{action:"droppedVideoFiles"})}}))},async reimport(e){o.lock(m,(async()=>{var o;await fe.cancelVideoUpload({id:e.payload.localId});const i=await n.getUploadParams({minCount:1,maxCount:1,maxTotalCount:1,multiple:!1},"reimport"),a=await fe.openVideoFilePicker(i),t=Se(a.videos[0]),l=n.getVideoIndex(e.payload.localId);-1!==l&&(n.videoList[l]=t,n.selectMaterial(null===(o=t.payload)||void 0===o?void 0:o.localId))}))},async openCoverEdit(e){try{const o=n.getVideo(e);if(!o)return;await i.refreshUploadConfigsIfNeeded({when:"openCoverEdit",logPrefix:"[VideoStore]"});const a=await i.getUploadConfigs("openCoverEdit"),t=(0,S.V)("video"),l=await fe.openVideoCoverEdit({id:e,temporaryId:t,...a});l.coverBase64&&n.updateFormState(o,{common_data:{...o.common_data,icon:{image_uri:""}},payload:{...null==o?void 0:o.payload,coverBase64:`data:;base64,${l.coverBase64}`,hasVideoFrameSelect:!0,temporaryRecord:{VideoCover:t}}})}catch(o){(0,A.RF)("openVideoCoverEdit jsb failed ",o,{action:"openCoverEdit"})}},isAllUploadedWatcher:l,async retryUpload(){const e=n.videoList.filter((e=>e.payload.isUploadFailed)).map((e=>e.payload.localId));if(!e.length)return;e.forEach((e=>{const o=n.getVideo(e);o&&(o.payload.isUploadFailed=!1)}));const o=await n.getUploadParams({multiple:!0,minCount:1,maxCount:e.length,maxTotalCount:e.length,retryUploadIds:e},"retryUpload");await fe.openVideoFilePicker(o)},sendUploadProgressModalShowErrorLog(){const e=n.videoList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.uploadFailedText})));a.sendMaterialPublishErrorLog(e)},get uploadStats(){let e=0,o=0,i=0;return Ce(n.videoList).forEach((a=>{var t;a.payload.isUploadFailed?o+=1:(null===(t=a.common_data.file)||void 0===t?void 0:t.file_uri)&&a.video.video_id&&a.common_data.icon.image_uri?e+=1:i+=1})),{pending:i,succeeded:e,failed:o}},get isAllReadyPublish(){const e=n.videoList.every((e=>{var o,i;return e.common_data.title&&(null===(o=e.common_data.tags)||void 0===o?void 0:o.length)&&!(null!==(i=e.payload.unmetRequirements)&&void 0!==i&&i.length)}));return n.videoList.length>0&&e},get isAllUploaded(){const{pending:e,failed:o}=n.uploadStats;return!e&&!o},syncFormData(e){var o;const i=null===(o=n.formApi)||void 0===o?void 0:o.getValues();i&&n.updateFormState(e,{is_vip:i.is_vip||!1,common_data:{...e.common_data,title:i.common_data.title||"",tags:i.common_data.tags||[],is_original:i.common_data.is_original||!1,is_business:i.common_data.is_business||!1}})},async uploadAndPublish(e){a.sendPageActionLog({action:"publish"}),n.selectedVideo&&n.syncFormData(n.selectedVideo),n.isAllUploaded||(await n.retryUpload(),null==e||e.show(),await n.isAllUploadedWatcher.start());try{await n.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{n.setIsPublishing(!0);const o=Ce(n.videoList).map((e=>{const o=(0,x.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:n.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)});return{id:e.payload.localId,req:{...(0,v.Z)(e,["payload"]),...o.root,common_data:{...e.common_data,...o.commonData}},onResult:o=>{const{req:i,error:t,errorText:l,time:r,resourceId:s}=o;t||n.updateFormState(e,{payload:{...e.payload,itemId:s}}),a.sendMaterialPublishStatusLog({status:t?"fail":"success",time:r,error_type:l,publishParams:i,path:e.payload.path})}}}));(0,A.c6)("[VideoStore] videos publish start",{ids:o.map((e=>e.id))});const i=(await n.pubServ.batchPublish(o)).map((e=>e.resource_id));(0,A.c6)("[VideoStore] videos publish done",{resourceIdList:i}),await n.pubServ.pollUntilAllInEffectList({ids:i.slice(-C.f),types:[5]}),(0,A.c6)("[VideoStore] poll done"),y.FN.success(e("pc_filter_release_successful")),(0,Ve.ZM)({effect_type:_.Ab.Video}),setTimeout((()=>(0,Ve.Nt)({item_type:_.Ab.Video})),1e3)}catch(o){y.FN.error(e("pc_sticker_release_failed_retry_web")),(0,A.RF)("[VideoStore] publish fail",o)}finally{n.setIsPublishing(!1)}}})));return(0,xe.u)({watch:()=>n.needConfirmModalOnClose}),(0,s.useEffect)((()=>{window.store=n,i.uploadConfigsCache.update(),n.authorSignService.init(),n.performanceTimingCollector.addRenderTiming(Pe.Pk)}),[]),(0,s.useEffect)((()=>{const e=fe.registerVideoFileProcessResultEvent(n.handleVideoFileProcessResult);return()=>{e()}}),[]),n}(),{t:o}=(0,t.$)();return(0,l.F)({title:o("pc_filter_video_release"),pid:"video-publish-single"}),(0,Ao.d)(),(0,r.t9)(e.sendLogServ),(0,Le.jsx)(we.Provider,{value:e,children:(0,Le.jsxs)("div",{className:Co,children:[(0,Le.jsxs)("div",{className:So,children:[(0,Le.jsx)(Oe,{className:Vo}),(0,Le.jsx)(Fo,{className:Io})]}),(0,Le.jsx)(Ee,{className:xo})]})})})),wo=()=>(0,Le.jsx)(Po,{})},23818:(e,o,i)=>{i.d(o,{YB:()=>l,xB:()=>t});var a=i(13928);function t(e){const{len:o,i18n:i}=e,[a]=(i.language||"").split("-");return"zh"===a?Math.floor(o/2):o}function l(e,o){const i=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,a.aF)(i,null==o?void 0:o.maxLength)}}}]);