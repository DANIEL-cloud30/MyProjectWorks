"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[4011],{89130:(e,i,o)=>{o.d(i,{WQ:()=>s});var a=o(18571),t=o(60963),l=o(20165),r=o(12803);const n=1e4;function s(e){const i=(0,l.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new r.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{i.isImportLoading=!0,await Promise.race([new Promise((e=>i.notifyImportLoadingFinish=e)),i.hideImportLoadingTimer.timeout(n)]),(0,t.z)((()=>{i.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{i.isImportLoading&&i.notifyImportLoadingFinish&&(i.notifyImportLoadingFinish(),i.notifyImportLoadingFinish=null)},destroy:()=>{i.hideImportLoadingTimer.cancel()}})));return(0,a.useEffect)((()=>{const o=(0,t.EH)((()=>{e.isAllReady&&i.finishImportLoadingFinishIfNeeded()}));return()=>{o()}}),[]),i}},52340:(e,i,o)=>{o.d(i,{Z:()=>_});var a=o(18751),t=o.n(a),l=o(65625),r=o(42716),n=o(18329),s=o(68288),d=o(84133),c=o(33921),p=o(96461),u=o(32950);const m="root-bPt1FS",g="statusBar-HPGgP6",f="contextMenuItem-HpV5Jn";var v=o(72322);const _=(0,l.Pi)((({className:e,material:i,isSelected:o,onClick:a,onReimport:l,onRemove:_})=>{var h;const{t:y}=(0,r.$)(),{common_data:F}=i,I=i.payload.filterImg,C=Boolean(null===(h=i.payload)||void 0===h||null===(h=h.unmetRequirements)||void 0===h?void 0:h.length),b=Boolean(F.title&&F.description),{handleContextMenu:x}=(0,c.D)({content:(0,v.jsx)(d.m,{items:[{key:"reimport",render:({key:e,className:o})=>Boolean(C)&&(0,v.jsx)("div",{className:t()(o,f),onClick:()=>l(i),children:y("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:o})=>(0,v.jsx)("div",{className:t()(o,f),onClick:()=>_(i),children:y("pc_stickers_release_delete_web")},e)}]})});return(0,v.jsxs)("div",{className:t()(e,m),onClick:()=>{var e;a(null===(e=i.payload)||void 0===e?void 0:e.localId)},children:[(0,v.jsx)(n.Y,{src:i.payload.filterImg,isSelected:o,isInvalid:Boolean(C),size:80,onContextMenu:e=>{var o;x(e),a(null===(o=i.payload)||void 0===o?void 0:o.localId)}}),(0,v.jsx)(s.ir,{className:g,loading:!I,invalid:C,errorToolip:C&&(null===(L=i.payload)||void 0===L||null===(L=L.unmetRequirements)||void 0===L?void 0:L.map((e=>{const i=u.ZV[p.nb.File][e]||u.ZV[p.nb.Cover][e];return i?(0,v.jsx)("div",{children:i},e):null}))),isInfoComplete:b,title:F.title})]});var L}))},46656:(e,i,o)=>{o.d(i,{Z:()=>S});var a=o(18571),t=o(65625),l=o(42716),r=o(79337),n=(o(54290),o(33094)),s=(o(94443),o(63e3)),d=o(86807),c=o(56230),p=o(93585),u=o(13199),m=o(32950),g=o(26851),f=o(48647);const v="root-qPd6XE",_="coverWrapper-YHEPdi",h="box-Tn50Wt",y="img-MkfnN9",F="tag-rTNBT4",I="editCover-cZ6Noe",C="input-ixM0l_",b="icon-nenuZE",x="businessCheckbox-RcPes0";var L=o(72322);const S=(0,t.Pi)((({material:e,materialListStore:i,formApi:o,collectionId:t,authProps:S})=>{var k;const{t:P}=(0,l.$)(),{payload:U}=e,{value:w}=(0,r.tL)("common_data.title");(0,a.useMemo)((()=>e.common_data.source===f.r0.UserPostPc),[e]);(0,a.useLayoutEffect)((()=>(null==o||o.reset(),null==o||o.setValues(e,{isOverride:!0}),()=>{const a=null==o?void 0:o.getValues();a&&i.updateFormState(e,{is_vip:a.is_vip||!1,common_data:{...e.common_data,title:a.common_data.title||"",description:a.common_data.description,is_original:a.common_data.is_original||!1,is_business:a.common_data.is_business||!1}})})),[e]);const{getDisplayLength:Z}=(0,c._)(),M=(o,a)=>{i.updateFormState(e,{common_data:{...e.common_data,[a]:o}})};return(0,L.jsxs)("div",{className:v,children:[(0,L.jsx)("div",{className:_,children:(0,L.jsxs)("div",{className:h,children:[U.filterImg?(0,L.jsx)("img",{className:y,src:U.filterImg}):(0,L.jsx)(u.t,{className:b,iconWidth:28}),(0,L.jsx)("div",{className:F,style:{backgroundColor:null===(k=e.filter)||void 0===k?void 0:k.desc_background_color},children:w}),(0,L.jsx)("div",{className:I,onClick:async()=>{i.openFilterCoverEditor(e,t)},children:P("pc_stickers_release_cover_edit_web")})]})}),(0,L.jsx)(n.l,{fieldClassName:C,label:P("pc_filter_title"),field:"common_data.title",maxLength:m.S8,placeholder:P("pc_stickers_release_xy_name_web",{X:1,Y:Z(m.S8)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>M(e,"title")}),(0,L.jsx)(n.l,{fieldClassName:C,label:P("pc_filter_setting_describe"),field:"common_data.description",maxLength:m.t2,placeholder:P("pc_stickers_release_xy_details_web",{X:1,Y:Z(m.t2)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>M(e,"description")}),!1,S&&(0,L.jsx)(p.Z,{onClickUseAll:()=>{const e=null==o?void 0:o.getValues();e&&i.applyAuthSettingsToAll({isVip:e.is_vip,isOriginal:e.common_data.is_original,isBusiness:e.common_data.is_business})},children:(0,L.jsxs)("div",{className:g.Z.authGroup,children:[(0,L.jsx)(p._,{text:P("pc_template_authorize_range_web")}),(0,L.jsxs)("div",{className:g.Z.right,children:[(0,L.jsx)(s.l,{noLabel:!0,field:"is_vip",sendLogService:S.sendLogServ}),(0,L.jsx)(d.R,{fieldClassName:x,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:S.authorSignService,getAuthFileUploadService:()=>S.authFileUploadServiceManager.ensure(U.localId),sendLogService:S.sendLogServ})]})]})})]})}))},38833:(e,i,o)=>{o.d(i,{v:()=>l});var a=o(82686),t=o(83305);class l extends a.D5{sendUploadActionLog(e){const{mainFormLayout:i}=e,o="mainForm"===i?"upload_more":"upload";this.sendPageActionLog({action:o})}sendMaterialPublishLog({publishResult:e,filter:i,logPrefix:o}){this.sendMaterialPublishStatusLog({...e,publishParams:i,status:e.error?"fail":"success",cover_type:i.payload.coverEditType,path:i.payload.path},{material_size:i.payload.size}),e.error?(0,t.RF)(`${o} filter publish failed`,e.error,{id:i.payload.localId}):(0,t.c6)(`${o} filter publish success`,{id:i.payload.localId,resourceId:e.resourceId})}sendMaterialCollectionPublishLog({publishResult:e,collection:i}){this.sendMaterialPublishStatusLog({...e,cover_type:"online_generated",publishParams:i,status:e.error?"fail":"success",path:"",resolution:"720x720"}),e.error?(0,t.RF)("[CollectionStore] collection publish failed",e.error,{id:i.payload.localId}):(0,t.c6)("[CollectionStore] collection publish success",{id:i.payload.localId,resourceId:e.resourceId}),(0,t.c6)("[CollectionStore] collection publish done",{resourceId:e.resourceId})}}},54734:(e,i,o)=>{o.d(i,{Z:()=>m});var a=o(32547),t=o(73221),l=o(57102),r=o(37168),n=o(44812),s=o(30754),d=o(28612),c=o(4947);var p=o(83305),u=o(76892);const m=new class{async openFilterFilePicker(e){const i={...e,temporaryId:(0,u.V)("single")};(0,p.c6)("[JSB] openFilterFilePicker req --\x3e",{...(0,t.Z)(i,[])});const o=await(0,r.Z)(i);return(0,p.c6)("[JSB] openFilterFilePicker resp <--",(0,t.Z)(o,["filterImg"])),o}async uploadDroppedFilterFiles(e){var i;const o={...e,temporaryId:(0,u.V)("single")};(0,p.c6)("[JSB] uploadDroppedFilterFiles req --\x3e",{...(0,t.Z)(o,[])});const a=await(0,n.Z)(o);return(0,p.c6)("[JSB] uploadDroppedFilterFiles resp <--",{imagesCount:null==a||null===(i=a.filters)||void 0===i?void 0:i.length}),a}registerFilterFileProcessResultEvent(e){return(e=>{const i=l.Z.on("FilterFileProcessResult",(i=>{i.data&&e(i.data)}));return()=>l.Z.off("FilterFileProcessResult",i)})((i=>{(0,p.c6)(`[JSB] FilterFileProcessResult ${null==i?void 0:i.type} {${null==i?void 0:i.id}}`,{...(0,a.Z)(i,["result","uri","error","fileUri","sourceUri","filterUri","temporaryId","id","collectionId"])}),e(i)}))}async openFilterCollectionCoverImage(e){const i={...e,temporaryId:(0,u.V)("collection")};(0,p.c6)("[JSB] openFilterCollectionCoverImage req --\x3e",{...(0,t.Z)(i,[])});const o=await(0,d.Z)(i);return(0,p.c6)("[JSB] openFilterCollectionCoverImage resp <--",(0,t.Z)(o,["filterImg"])),o}async openFilterCoverImage(e){const i={...e,temporaryId:(0,u.V)("single")};(0,p.c6)("[JSB] openFilterCoverImage req --\x3e",{...(0,t.Z)(i,[])});const o=await(0,s.Z)(i);return(0,p.c6)("[JSB] openFilterCoverImage resp <--",(0,t.Z)(o,["filterImg"])),o}async cancelFilterUpload(e){(0,p.c6)("[JSB] cancelFilterUpload req --\x3e",e),await(0,c.Z)(e),(0,p.c6)("[JSB] cancelFilterUpload resp <--")}}},38595:(e,i,o)=>{o.d(i,{WQ:()=>f});var a=o(32547),t=o(73221),l=o(18571),r=o(20165),n=o(54290),s=o(18552),d=o(54734),c=o(10277),p=o(32950),u=o(38432),m=o(5065),g=o(23818);function f(){const e=(0,r.fv)((()=>({uploadConfigService:new s.w,materialList:[],scrollAreaRef:(0,l.createRef)(),get hasMaterials(){return this.materialList.length>0},selectedId:null,get selectedMaterial(){return e.selectedId?e.getMaterial(e.selectedId):null},get isAllReady(){return e.materialList.length>0&&e.materialList.every((e=>e.payload.filterImg))},addMaterials(i){i.length&&(e.materialList=[...e.materialList,...i],e.materialList.length===i.length&&(e.selectedId=i[0].payload.localId))},getMaterial:i=>{var o;return null!==(o=e.materialList.find((e=>{var o;return(null===(o=e.payload)||void 0===o?void 0:o.localId)===i})))&&void 0!==o?o:null},selectMaterial(i){e.selectedId=i,e.selectedMaterial&&(e.selectedMaterial.payload.hasEverSelected=!0)},updateThumbnailSrc(e,i){e.payload.filterImg=i},updateUploadedData(e,i){i.fileUri&&(e.filter={...e.filter,original_file_uri:i.fileUri})},updateUnmetRequirements(e,i){e.payload.unmetRequirements=i,e.payload.hasCheckedRequirements=!0},makeInitForm:({payload:e,source:i,title:o,format:a,is_vip:t})=>({effect_type:n.Ab.Filter,common_data:{title:o,description:"",tags:[],source:i,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:""},format:a},is_vip:t,payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,localId:"",filterImg:"",size:0,path:"",error:"",temporary:{FilterFile:"",Thumbnail:"",FilterImg:""},coverEditType:void 0,...e},filter:{desc_background_color:p.KD,original_image:{image_uri:(0,c.c_)()},original_file_uri:""}}),updateFormState(e,i){Object.assign(e,i)},updateUploadResp(e,{fileUri:i,sourceUri:o,filterUri:a,uri:t}){i&&(e.filter={...e.filter,original_file_uri:i}),o&&(e.filter={...e.filter,original_image:{image_uri:o}}),t&&(e.filter={...e.filter,original_image:{image_uri:t}}),a&&(e.common_data.icon.image_uri=a)},reimportMaterial(i,o){const a=e.materialList.findIndex((e=>e.payload.localId===i));-1!==a&&(e.materialList[a]=o)},removeMaterial(i){e.materialList=e.materialList.filter((e=>e.payload.localId!==i.payload.localId)),d.Z.cancelFilterUpload({id:i.payload.localId})},applyAuthSettingsToAll:({isOriginal:i,isBusiness:o,isVip:a})=>{e.materialList.forEach((e=>{e.is_vip=Boolean(a),e.common_data.is_original=Boolean(i),e.common_data.is_business=Boolean(o)}))},dragInsert(i,o){const a=e.materialList.splice(i,1),t=i>o?o+1:o;e.materialList.splice(t,0,...a)},get isReadyToPublish(){return e.materialList.every((e=>{var i,o,a;return 0===(null===(i=e.payload.unmetRequirements)||void 0===i?void 0:i.length)&&(null===(o=e.common_data)||void 0===o?void 0:o.title)&&(null===(a=e.common_data)||void 0===a?void 0:a.description)&&e.payload.filterImg}))},get uploadStats(){let i=0,o=0,a=0;return e.materialList.forEach((e=>{var t,l,r;if(e.payload.isUploadFailed)return void(o+=1);(null===(t=e.common_data.icon)||void 0===t?void 0:t.image_uri)&&(null===(l=e.filter)||void 0===l?void 0:l.original_file_uri)&&(null===(r=e.filter)||void 0===r||null===(r=r.original_image)||void 0===r?void 0:r.image_uri)?i+=1:a+=1})),{pending:a,succeeded:i,failed:o}},collectLogData:()=>e.materialList.map((e=>{const i=(0,t.Z)(e.payload,"filterImg");return{...e,payload:i}})),async openFilterCoverEditor(i,o){var a;const t=await d.Z.openFilterCoverImage({...await e.uploadConfigService.getUploadConfigs("openFilterCoverImage"),...p.Pc,id:i.payload.localId,tagColor:null===(a=i.filter)||void 0===a?void 0:a.desc_background_color,title:i.common_data.title,filters:e.materialList.map((e=>({id:e.payload.localId}))),collectionId:o});"Success"===t.result&&(t.isUseAll?e.materialList.forEach((e=>{e.filter={...e.filter,desc_background_color:t.tagColor},e.payload.temporary={...e.payload.temporary,FilterImg:t.temporaryId,Thumbnail:t.temporaryId},e.payload.coverEditType=t.coverEditType})):(i.filter={...i.filter,desc_background_color:t.tagColor},i.payload.temporary={...i.payload.temporary,FilterImg:t.temporaryId,Thumbnail:t.temporaryId},i.payload.coverEditType=t.coverEditType)),"Error"===t.result&&(i.payload.isUploadFailed=!0,i.payload.error=t.error)},handleFilePickerResp(i,o){const t=(0,u.K)(m.YW.OriginalForSubscription);return i.filters.map((i=>{const l=(0,c.td)(i.path,i.size),r=(0,g.YB)(i.path,{maxLength:p.S8}),n={FilterFile:i.temporaryId,FilterImg:i.temporaryId,Thumbnail:i.temporaryId};return e.makeInitForm({payload:{localId:i.id,...(0,a.Z)(i,["size","path","error"]),...l,temporary:n,isUploadFailed:"Error"===i.result},source:o,title:r,format:l.fileType,is_vip:t})}))},async refreshUploadConfigsIfNeeded(i){await e.uploadConfigService.refreshUploadConfigsIfNeeded({when:i,logPrefix:"[FilterStore]"})},async openFilterPicker({maxTotalCount:i,maxCount:o,minCount:a,source:t,collectionId:l}){await e.refreshUploadConfigsIfNeeded("openFilterFilePicker");const r=await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:a,maxCount:o,maxTotalCount:i,collectionId:l}),n=e.handleFilePickerResp(r,t);e.addMaterials(n)},async reimportFilterFilePicker({maxTotalCount:i,maxCount:o,minCount:a,source:t,oldId:l,collectionId:r}){await e.refreshUploadConfigsIfNeeded("openFilterFilePicker");const n=await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:a,maxCount:o,maxTotalCount:i,multiple:!1,collectionId:r}),s=e.handleFilePickerResp(n,t);s[0]&&(e.reimportMaterial(l,s[0]),d.Z.cancelFilterUpload({id:l}))},async uploadDroppedFilterFiles({maxTotalCount:i,maxCount:o,minCount:a,source:t,collectionId:l}){await e.refreshUploadConfigsIfNeeded("uploadDroppedFilterFiles");const r=await d.Z.uploadDroppedFilterFiles({...await e.uploadConfigService.getUploadConfigs("uploadDroppedFilterFiles"),...p.Zk,minCount:a,maxCount:o,maxTotalCount:i,collectionId:l}),n=e.handleFilePickerResp(r,t);e.addMaterials(n)},async retryUpload(i,o){if(!(i.length+o.length))return;const a=i.map((e=>e.payload.localId));a.forEach((i=>{const o=e.getMaterial(i);o&&(o.payload.isUploadFailed=!1)}));await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:1,maxCount:i.length,maxTotalCount:i.length,retryUploadIds:[...a,...o]})}})));return e}},10277:(e,i,o)=>{o.d(i,{$Y:()=>p,c_:()=>c,td:()=>d});var a=o(18571),t=o(42716),l=o(85918),r=o(71157),n=o(96461),s=o(32950);const d=(e,i)=>{const o=[];i>s.Tb&&o.push(n.id.MaxFileSize);let a="";try{a=function(e){const i=(0,l.lm)(e);if("cube"===i)return n.FU.CUBE;if("3dl"===i)return n.FU.THREEDL;throw new Error(`Unsupported suffix ${i}`)}(e)}catch(t){o.push(n.id.Format)}return{unmetRequirements:o,fileType:a}},c=()=>r.appModel.debugInfo.useBOE?"tos-boei18n-i-9ove8i7dyj/1760c449404c48e79f65500872fbf75c":"tos-alisg-i-fhsjxsyzit-sg/c7ea4ddb53394986a5d524457a5c66ef";function p(){const{t:e}=(0,t.$)(),i=e=>Object.entries(s.ZV[e]).map((([e,i])=>({key:e,title:i}))),o=!1;return(0,a.useMemo)((()=>[{key:n.nb.File,title:e("pc_filter_specification"),...o,instructions:i(n.nb.File)},{key:n.nb.Cover,title:e("pc_filter_cover_description"),...o,instructions:i(n.nb.Cover)}]),[])}},96461:(e,i,o)=>{o.d(i,{FU:()=>t,id:()=>a,nb:()=>l});let a=function(e){return e.Format="format",e.MaxFileSize="maxFileSize",e.CollectionNum="collectionNum",e.CoverCopyright="coverCopyright",e.CoverLut="coverLut",e.CoverFormat="coverFormat",e.CoverMinImageSize="coverMinImageSize",e.CoverMaxFileSize="coverMaxFileSize",e}({}),t=function(e){return e.CUBE="cube",e.THREEDL="3dl",e}({}),l=function(e){return e.File="file",e.Cover="cover",e}({})},23818:(e,i,o)=>{o.d(i,{YB:()=>l,xB:()=>t});var a=o(13928);function t(e){const{len:i,i18n:o}=e,[a]=(o.language||"").split("-");return"zh"===a?Math.floor(i/2):i}function l(e,i){const o=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,a.aF)(o,null==i?void 0:i.maxLength)}}}]);