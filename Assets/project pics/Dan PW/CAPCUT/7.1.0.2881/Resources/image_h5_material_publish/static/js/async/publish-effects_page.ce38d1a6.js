"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[8464],{37964:(e,t,a)=>{a.d(t,{S:()=>h,w:()=>_});var l=a(18571),i=a(70126),o=a(54275),r=a(18751),n=a.n(r),s=a(79337),c=a(42716),d=a(51091),u=a(12803),m=a(36958),p=a(93747),f=a(72322);const g=(0,l.forwardRef)(((e,t)=>{const{tooltipProps:a,getPopupContainer:i,onClosePopover:r,position:c,cursor:d="default"}=e,[g,_]=(0,l.useState)(!0),[h,v]=(0,l.useState)(!1),{top:y}=c,b=c.left-10,w=(0,l.useRef)(null),C=(0,l.useRef)(null),x=(0,o.Z)((()=>{var e;null===(e=C.current)||void 0===e||e.destroy(),v(!1),_(!1)})),L=(0,o.Z)((()=>{var e;const t=i().querySelector(`.${p.Z.tooltipWrapper}`);if(!t||(null===(e=C.current)||void 0===e?void 0:e.tooltipWrapper)===t)return;t.addEventListener("animationend",x);const a=new u.B;a.timeout(500).then(x),C.current={tooltipWrapper:t,destroy:()=>{t.removeEventListener("animationend",x),a.cancel(),C.current=null}}}));(0,l.useImperativeHandle)(t,(()=>({hide:()=>{L(),v(!0)}})));const I=(0,l.useMemo)((()=>({default:{height:18,width:12},"not-allowed":{height:(0,m.c)()?30:15,width:15}})),[]),S=I[d]||I.default;return(0,f.jsx)(s.u,{autoAdjustOverflow:!0,position:"bottomLeft",motion:!1,...a,className:n()(a.className,p.Z.tooltipWrapper,h&&p.Z.fadingOut),trigger:"custom",visible:g,showArrow:!1,rePosKey:`${y}-${b}`,getPopupContainer:i,onVisibleChange:e=>{var t;!e&&r(),null===(t=a.onVisibleChange)||void 0===t||t.call(a,e)},children:(0,f.jsx)("div",{className:p.Z.point,tabIndex:-1,ref:w,style:{top:y,left:b,...S}})})}));function _(e){const{zIndex:t=1060,cursor:a="default",checkIsTarget:r,getEllipsisDOM:n,...s}=e,u=(0,l.useRef)(null),m=(0,l.useRef)(null),[_,h]=(0,l.useState)(null),{i18n:v}=(0,c.$)(),y=()=>{const{content:e}=s;if("function"!=typeof e)return e;if(!u.current)return null;const{targetElement:t}=u.current;return a=>e({...a,target:t})},b=(0,o.Z)((()=>{u.current&&(u.current.destroy(),u.current=null,h(null))})),w=(0,o.Z)((()=>{var e;null===(e=u.current)||void 0===e||e.destroy(),u.current=null})),C=(0,o.Z)((()=>{u.current&&(u.current.destroy(),u.current=null,h(null))})),x=(0,o.Z)(((e,a)=>{const l=null==n?void 0:n(a);if(l&&l.offsetWidth>=l.scrollWidth)return;if(u.current){if(!u.current.hasLeaved&&u.current.targetElement===a)return;b()}const o=document.createElement("div");o.className=p.Z.root,o.style.zIndex=`${t}`;const r=e=>{h({left:e.clientX,top:e.clientY})},s=e=>{a===e.target&&(u.current&&(u.current.hasLeaved=!0),m.current?m.current.hide():b())};a.addEventListener("mousemove",r),a.addEventListener("mouseleave",s),document.body.appendChild(o);const c=(0,i.createRoot)(o);u.current={container:o,targetElement:a,hasLeaved:!1,reactRoot:c,destroy:()=>{o.remove(),Promise.resolve().then((()=>c.unmount())),a.removeEventListener("mousemove",r),a.removeEventListener("mouseleave",s)}},h({left:e.clientX,top:e.clientY})})),L=(0,o.Z)((e=>{const t=e.currentTarget;x(e,t)})),I=(0,o.Z)((e=>{var t;const a=e.target;(null!==(t=null==r?void 0:r(a))&&void 0!==t?t:e.currentTarget===a)&&x(e,a)}));return(0,l.useLayoutEffect)((()=>w),[]),(0,l.useLayoutEffect)((()=>{(()=>{if(!u.current||!_)return;const{reactRoot:e,container:l}=u.current;l.style.zIndex=`${t}`,e.render((0,f.jsx)(d.a,{i18n:v,children:(0,f.jsx)(g,{ref:m,tooltipProps:{...s,content:y()},getPopupContainer:()=>l,onClosePopover:b,position:_,cursor:a})}))})()})),{handleMouseEnter:L,handleMouseOver:I,destroyTooltip:C}}function h(e={}){const{getEllipsisDOM:t=e=>e,content:a=({target:e})=>e.textContent,...l}=e;return _({...l,getEllipsisDOM:t,content:a})}},18774:(e,t,a)=>{a.d(t,{NZ:()=>n,OD:()=>r,RO:()=>i,dr:()=>o,kx:()=>s});const l=e=>`https://sf16-web-tos-buz.capcutstatic.com/obj/capcut-web-buz-sg/artist-op-web${e}`,i=`${l("/LoadingScissorsCapCut.d9f5d23b.gif")}`,o=({lang:e,region:t})=>`https://www.capcut.com/clause/creator-agreement?lang=${e}&store_region=${t}`,r=()=>"https://www.capcut.com/clause/original-work-notice?lang=en",n=()=>"https://www.capcut.com/clause/original-work-notice-commercial-material?lang=en",s=()=>"https://www.capcut.com/clause/paid-materials?lang=en"},54290:(e,t,a)=>{a.d(t,{Ab:()=>l});let l=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},97225:(e,t,a)=>{a.r(t),a.d(t,{default:()=>aa});var l=a(65625),i=a(42716),o=a(82686),r=a(62293),n=a(43130);let s=function(e){return e.Format="format",e.MaxFileSize="maxFileSize",e}({}),c=function(e){return e.ZIP="zip",e}({}),d=function(e){return e.File="file",e}({});var u=a(18571),m=a(85918),p=a(79292);const f=10485760,g={[d.File]:{[s.Format]:p.I18n.t("cc_pc_material_visual_effect_publish_guidance_format_web"),[s.MaxFileSize]:p.I18n.t("cc_pc_material_visual_effect_publish_guidance_size_web",{size:10})}},_={accept:"zip",multiple:!0,maxFileSize:f},h="ImportEffects";const v=(e,t)=>{const a=[];t>f&&a.push(s.MaxFileSize);let l="";try{l=function(e){const t=(0,m.lm)(e);if("zip"===t)return c.ZIP;throw new Error(`Unsupported suffix ${t}`)}(e)}catch(i){a.push(s.Format)}return{unmetRequirements:a,fileType:l}};var y=a(73221),b=a(20165),w=a(60963),C=a(79337),x=a(71157),L=a(12803);var I=a(18552),S=a(15621),E=a(54290),A=a(88154),z=a(31062),P=a(7561),M=a(1234),F=a(83305),T=a(48647);function k(e){return Boolean(e.id)}class N{constructor(){(0,A.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const a of(0,z.Z)(e,10)){const e=await Promise.all(a.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:a,onResult:l,onUpdateResult:i}=e,o=JSON.parse(JSON.stringify(e.req));let r=this.itemMap.get(a);if(null!==(t=r)&&void 0!==t&&t.promise&&(0,P.Z)(r.req,o))try{return await r.promise}catch(n){(0,F.c6)("[MaterialPublishService] publish failed, start to retry",{id:a})}return r={promise:null,id:a,req:o,onResult:l,onUpdateResult:i},this.itemMap.set(a,r),r.promise=this.publishImpl(r),r.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),a=async(a,l)=>{try{const r={error:a,errorText:this.getErrorText(a),time:Math.round(performance.now()-t),resourceId:l};var i,o;if(k(e.req))await(null===(i=e.onUpdateResult)||void 0===i?void 0:i.call(e,{req:e.req,...r}));else await(null===(o=e.onResult)||void 0===o?void 0:o.call(e,{req:e.req,...r}))}catch(r){(0,F.RF)("[MaterialPublishService] callOnResult failed",r)}};let l;try{l=await this.postOrUpdate(e)}catch(i){throw e.promise=null,a(i,""),i}return await a(null,l.resource_id),l}async postOrUpdate(e){return k(e.req)?(await(0,T.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,T.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new L.B).timeout(5e3)])}catch(t){(0,F.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const a=performance.now(),l=new L.B,i={count:50,effect_types:t,uid:M.$.userInfo.uid,cursor:0};for(;performance.now()-a<5e3;){const t=await(0,T.Js)(i).catch((()=>null));if(null!=t&&t.effect_item_list){const a=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>a.has(e))))return}await l.timeout(500)}}}var U=a(57494),j=a(47791),R=a(39110),Z=a(47573),O=a(52272),q=a(57102),B=a(40298),D=a(69575),$=a(73564),V=a(23064),W=a(10246);let J=function(e){return e.Thumbnail="Thumbnail",e.UploadCover="UploadCover",e.UploadEffect="UploadEffect",e}({});var Y=a(76664),G=a(22531),H=a(33452),X=a(32547),K=a(76892);const Q=new class{async openEffectFilePicker(e){const t={...e,temporaryId:(0,K.V)("single")};(0,F.c6)("[JSB] openEffectFilePicker req --\x3e",{...(0,y.Z)(t,[])});const a=await(0,B.Z)(t);return(0,F.c6)("[JSB] openEffectFilePicker resp <--",a.effects),a}async uploadDroppedEffectFiles(e){var t;const a={...e,temporaryId:(0,K.V)("single")};(0,F.c6)("[JSB] uploadDroppedEffectFiles req --\x3e",{...(0,y.Z)(a,[])});const l=await(0,D.Z)(a);return(0,F.c6)("[JSB] uploadDroppedEffectFiles resp <--",{imagesCount:null==l||null===(t=l.effects)||void 0===t?void 0:t.length}),l}async setEffectCoverImage(e){(0,F.c6)("[JSB] setEffectCoverImage req --\x3e",e);const t=await(0,$.Z)(e);return(0,F.c6)("[JSB] setEffectCoverImage resp <--",{}),t}async uploadEffectCoverImage(e){(0,F.c6)("[JSB] uploadEffectCoverImage req --\x3e",e);const t=await(0,W.Z)(e);return(0,F.c6)("[JSB] uploadEffectCoverImage resp <--",{}),t}registerEffectFileProcessResultEvent(e){return(e=>{const t=q.Z.on("effectProcessResult",(t=>{t.data&&e(t.data)}));return()=>q.Z.off("effectProcessResult",t)})((t=>{(0,F.c6)(`[JSB] EffectFileProcessResult ${null==t?void 0:t.type} {${null==t?void 0:t.id}}`,{...(0,X.Z)(t,["result","uri","error","fileUri","temporaryId","id","collectionId"])}),e(t)}))}async cancelEffectUpload(e){(0,F.c6)("[JSB] cancelEffectUpload req --\x3e",e),await(0,V.Z)(e),(0,F.c6)("[JSB] cancelEffectUpload resp <--")}};var ee=a(23818),te=a(46350);function ae(e){switch(e){case E.Ab.Special:return"special_effect";case E.Ab.Transition:return"transition";case E.Ab.VideoAnimation:return"video_animation";case E.Ab.FaceSpecial:return"face_effect";default:return"effect"}}class le extends o.D5{sendUploadActionLog(e){const{mainFormLayout:t}=e,a="mainForm"===t?"upload_more":"effect_upload";this.sendPageActionLog({action:a})}sendMaterialPublishLog({publishResult:e,effect:t,logPrefix:a}){this.sendMaterialPublishStatusLog({...e,publishParams:t,status:e.error?"fail":"success",path:t.payload.path,error_type:e.errorText},{material_size:t.payload.size,is_official_task:t.common_data.post_channel===T.iu.Open?0:1,task_id:t.payload.targetedActivityId,material_id:e.resourceId,material_subcategory:ae(t.effect_type),effect_type_id:t.payload.categoryId,effect_type_title:t.payload.categoryName}),e.error?(0,F.RF)(`${a} effects publish failed`,e.error,{id:t.payload.localId}):(0,F.c6)(`${a} effects publish success`,{id:t.payload.localId,resourceId:e.resourceId})}}function ie(){const e=function(){const e=(0,b.fv)((()=>({uploadConfigService:new I.w,materialList:[],scrollAreaRef:(0,u.createRef)(),effectsPostConfigMap:{[E.Ab.Special]:new te.E(E.Ab.Special),[E.Ab.FaceSpecial]:new te.E(E.Ab.FaceSpecial),[E.Ab.VideoAnimation]:new te.E(E.Ab.VideoAnimation),[E.Ab.Transition]:new te.E(E.Ab.Transition)},get hasMaterials(){return this.materialList.length>0},selectedId:null,get selectedMaterial(){return e.selectedId?e.getMaterial(e.selectedId):null},get isAllReady(){return e.materialList.length>0},addMaterials(t){t.length&&(e.materialList=[...e.materialList,...t],e.materialList.length===t.length&&(e.selectedId=t[0].payload.localId))},getMaterial:t=>{var a;return null!==(a=e.materialList.find((e=>{var a;return(null===(a=e.payload)||void 0===a?void 0:a.localId)===t})))&&void 0!==a?a:null},selectMaterial(t){e.selectedId=t,e.selectedMaterial&&(e.selectedMaterial.payload.hasEverSelected=!0)},updateThumbnailSrc(e,t){e.payload.thumbImg=t},updateUnmetRequirements(e,t){e.payload.unmetRequirements=t,e.payload.hasCheckedRequirements=!0},makeInitForm:({payload:e,title:t,format:a,is_vip:l,effect_type:i,md5:o})=>{var r;return{effect_type:i,common_data:{title:t,description:"",tags:[],source:T.r0.UserPostPc,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:"",width:200,height:200},format:a,file:{size:null!==(r=e.size)&&void 0!==r?r:0,file_uri:"",file_md5:o},md5:o},is_vip:l,payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:[],hasCheckedRequirements:!1,localId:"",thumbImg:"",size:0,path:"",error:"",temporary:{UploadCover:"",Thumbnail:"",UploadEffect:""},coverUpdating:!1,coverImgUrls:{fadeInUrl:""},duration:0,...e}}},updateFormState(e,t){Object.assign(e,t)},updateUploadResp(e,{fileUri:t,imgUri:a}){t&&e.common_data.file&&(e.common_data.file.file_uri=t),a&&(e.common_data.icon.image_uri=a)},reimportMaterial(t,a){const l=e.materialList.findIndex((e=>e.payload.localId===t));-1!==l&&(e.materialList[l]=a)},removeMaterial(t){e.materialList=e.materialList.filter((e=>e.payload.localId!==t.payload.localId)),Q.cancelEffectUpload({id:t.payload.localId})},applyAuthSettingsToAll:({isOriginal:t,isBusiness:a,isVip:l})=>{e.materialList.forEach((e=>{e.is_vip=Boolean(l),e.common_data.is_original=Boolean(t),e.common_data.is_business=Boolean(a)}))},applyCommonDataToAll:t=>{e.materialList.forEach((e=>{e.common_data={...e.common_data,...t}}))},applyPayloadDataToAll:t=>{e.materialList.forEach((e=>{e.payload={...e.payload,...t}}))},dragInsert(t,a){const l=e.materialList.splice(t,1),i=t>a?a+1:a;e.materialList.splice(i,0,...l)},get isReadyToPublish(){return e.materialList.every((e=>{var t;return 0===(null===(t=e.payload.unmetRequirements)||void 0===t?void 0:t.length)&&this.getIsInfoComplete(e)}))},get uploadStats(){let t=0,a=0,l=0;return e.materialList.forEach((e=>{var i,o;"UploadFailed"!==e.payload.failedType?(null===(i=e.common_data.icon)||void 0===i?void 0:i.image_uri)&&(null===(o=e.common_data.file)||void 0===o?void 0:o.file_uri)?t+=1:l+=1:a+=1})),{pending:l,succeeded:t,failed:a}},getIsInfoComplete(e){const{title:t,tags:a,post_channel:l}=e.common_data,{categoryId:i,targetedActivityId:o}=e.payload,r=this.effectsPostConfigMap[e.effect_type],{mustPaidAuth:n}=r.authConfig;{const r=l===T.iu.Open||l===T.iu.Targeted&&Boolean(o),s=n&&e.is_vip||!n;return Boolean(t&&(null==a?void 0:a.length)&&e.payload.thumbImg&&i&&r&&s)}},collectLogData:()=>e.materialList.map((e=>{const t=(0,y.Z)(e.payload,"thumbImg");return{...e,payload:t}})),handleFilePickerResp(t){const a=M.$.isEnableAuthorization;return t.effects.map((t=>{const l=v(t.path,t.size),i=(0,ee.YB)(t.path,{maxLength:this.effectsPostConfigMap[t.effect_type].resourceCommonConfig.maxTitleLen||15}),o={EffectFile:t.temporaryId,EffectImg:t.temporaryId,Thumbnail:t.temporaryId};return e.makeInitForm({effect_type:t.effect_type,payload:{localId:t.id,duration:Math.round(1e3*t.duration),...(0,X.Z)(t,["size","path","error"]),...l,temporary:o,failedType:"importFailed"},title:i,format:l.fileType,is_vip:a,md5:t.md5})}))},async refreshUploadConfigsIfNeeded(t){await e.uploadConfigService.refreshUploadConfigsIfNeeded({when:t,logPrefix:"[EffectStore]"})},async openEffectPicker({maxTotalCount:t,maxCount:a,minCount:l}){await e.refreshUploadConfigsIfNeeded("openEffectFilePicker");const i=await Q.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),..._,minCount:l,maxCount:a,maxTotalCount:t}),o=e.handleFilePickerResp(i);e.addMaterials(o)},async reimportEffectFilePicker({maxTotalCount:t,maxCount:a,minCount:l,oldId:i}){await e.refreshUploadConfigsIfNeeded("openEffectFilePicker");const o=await Q.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),..._,minCount:l,maxCount:a,maxTotalCount:t,multiple:!1}),r=e.handleFilePickerResp(o);r[0]&&(e.reimportMaterial(i,r[0]),Q.cancelEffectUpload({id:i}))},async uploadDroppedEffectFiles({maxTotalCount:t,maxCount:a,minCount:l}){await e.refreshUploadConfigsIfNeeded("uploadDroppedEffectFiles");const i=await Q.uploadDroppedEffectFiles({...await e.uploadConfigService.getUploadConfigs("uploadDroppedEffectFiles"),..._,minCount:l,maxCount:a,maxTotalCount:t}),o=e.handleFilePickerResp(i);e.addMaterials(o)},async setEffectCoverImage(t){const a=e.getMaterial(t.payload.localId);if(!a)return;const l=(0,K.V)("single");return a.payload.coverUpdating=!0,a.payload.temporary.Thumbnail=l,"updateCoverFailed"===a.payload.failedType&&(a.payload.failedType=void 0),Q.setEffectCoverImage({id:t.payload.localId,fadeInUrl:t.payload.coverImgUrls.fadeInUrl,fadeOutUrl:t.payload.coverImgUrls.fadeOutUrl,imageWidth:200,imageHeight:200,temporaryId:l})},async retryUpdateCover(e){return e.payload.failedType=void 0,this.setEffectCoverImage(e)},async retryUpload(t){if(!t.length)return;const a=t.map((e=>e.payload.localId));return a.forEach((t=>{const a=e.getMaterial(t);a&&(a.payload.failedType=void 0)})),Q.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),..._,minCount:1,maxCount:t.length,maxTotalCount:t.length,retryUploadIds:a})}})));return e}(),t=function(e){const t=(0,b.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new L.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{t.isImportLoading=!0,await Promise.race([new Promise((e=>t.notifyImportLoadingFinish=e)),t.hideImportLoadingTimer.timeout(1e4)]),(0,w.z)((()=>{t.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{t.isImportLoading&&t.notifyImportLoadingFinish&&(t.notifyImportLoadingFinish(),t.notifyImportLoadingFinish=null)},destroy:()=>{t.hideImportLoadingTimer.cancel()}})));return(0,u.useEffect)((()=>{const a=(0,w.EH)((()=>{e.isAllReady&&t.finishImportLoadingFinishIfNeeded()}));return()=>{a()}}),[]),t}(e),a=new S.l,l=new le({itemType:E.Ab.LocalEffects}),i=(0,Z.G)({watch:()=>o.isAllUploaded}),o=(0,b.fv)((()=>({uploadConfigService:new I.w,formApi:null,setFormApi:e=>{o.formApi=e},isPublishing:!1,sendLogServ:l,authorSignService:new U.I({signScene:Y.d.BusinessArtist}),authFileUploadServiceManager:new j.r({}),performanceTimingCollector:(0,H.uY)(),setIsPublishing:(0,w.aD)((e=>o.isPublishing=e)),mainFormLayoutAfterLoading:"uploadArea",startPublishTime:0,get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===o.mainFormLayoutAfterLoading&&x.appModel.isInitFailed?"error":0===o.materialListStore.materialList.length?"uploadArea":o.mainFormLayoutAfterLoading},pubServ:new N,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get maxTotalCount(){return 10},get isImportDisabled(){return e.materialList.length>=10},get needConfirmModalOnClose(){return e.materialList.length>0},materialListStore:e,importLoadingStore:t,getImportMinMaxCount(){const t=e.materialList.length;return{minCount:1,maxCount:Math.max(0,o.maxTotalCount-t),maxTotalCount:o.maxTotalCount}},get isAllReadyPublish(){return e.materialList.length&&e.isReadyToPublish},handleLoading(){o.materialListStore.materialList.length&&"uploadArea"===o.mainFormLayoutAfterLoading&&(t.showImportLoading(),o.mainFormLayoutAfterLoading="mainForm")},openEffectPicker(){a.lock(h,(async()=>{l.sendUploadActionLog(o),await e.openEffectPicker({...o.getImportMinMaxCount()}),o.handleLoading()}))},uploadDroppedEffectFiles(){a.lock(h,(async()=>{l.sendUploadActionLog(o),await e.uploadDroppedEffectFiles({...o.getImportMinMaxCount()}),o.handleLoading()}))},reimport(t){a.lock(h,(async()=>{await e.reimportEffectFilePicker({...o.getImportMinMaxCount(),oldId:t.payload.localId}),o.handleLoading()}))},get isAllUploaded(){const{pending:e,failed:t}=o.materialListStore.uploadStats;return!e&&!t},sendUploadProgressModalShowErrorLog(){const e=o.materialListStore.materialList.filter((e=>"UploadFailed"===e.payload.failedType)).map((e=>({error_report:e.payload.error})));l.sendMaterialPublishErrorLog(e)},async retryUpload(){const e=o.materialListStore.materialList.filter((e=>"UploadFailed"===e.payload.failedType));return o.materialListStore.retryUpload(e)},isAllUploadedWatcher:i,asyncFormData(){var t;const a=null===(t=o.formApi)||void 0===t?void 0:t.getValues(),l=o.materialListStore.selectedMaterial;l&&a&&e.updateFormState(l,{is_vip:a.is_vip||!1,common_data:{...l.common_data,title:a.common_data.title||"",description:a.common_data.description,post_channel:a.common_data.post_channel,tags:a.common_data.tags||[],is_original:a.common_data.is_original||!1,is_business:a.common_data.is_business||!1}})},async uploadAndPublish(t){this.startPublishTime=performance.now(),o.asyncFormData(),l.sendPageActionLog({action:"publish",material_cnt:e.materialList.length}),o.isAllUploaded||(await o.retryUpload(),await Q.uploadEffectCoverImage({ids:e.materialList.map((e=>e.payload.localId))}),null==t||t.show(),await o.isAllUploadedWatcher.start());try{await o.publishImpl()}finally{null==t||t.hide()}},async publishImpl(){try{o.setIsPublishing(!0);const t=e.materialList.map((e=>{const t=(0,R.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:o.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)}),{categoryId:a,targetedActivityId:i,duration:r}=e.payload,{post_channel:n}=e.common_data;return{id:e.payload.localId,req:{...(0,y.Z)(e,["payload"]),...t.root,common_data:{...e.common_data,...t.commonData,post_channel:n===T.iu.Targeted?`${T.iu.Targeted}_${i}`:n,web_extra:JSON.stringify({choose_category_id:[a],targeted_id:i})},biz_extra:JSON.stringify({effect_duration:r})},onResult:a=>{l.sendMaterialPublishLog({publishResult:a,effect:{...e,...t.root},logPrefix:"[SingleStore]"})}}}));(0,F.c6)("[SingleStore] effects publish start",{ids:t.map((e=>e.id))});const a=(await o.pubServ.batchPublish(t)).map((e=>e.resource_id));(0,F.c6)("[SingleStore] effects publish done",{resourceIdList:a}),this.sendLogServ.sendMaterialPublishPageResultLog({status:"success",time:Math.round(performance.now()-this.startPublishTime),material_cnt:a.length,material_id:a.join(",")}),await o.pubServ.pollUntilAllInEffectList({ids:a.slice(-10),types:[E.Ab.Special,E.Ab.FaceSpecial,E.Ab.VideoAnimation,E.Ab.Transition]}),(0,F.c6)("[SingleStore] effects poll done"),C.FN.success(p.I18n.t("pc_filter_release_successful")),(0,O.ZM)({effect_type:E.Ab.Special}),setTimeout((()=>(0,O.Nt)({item_type:E.Ab.Special})),1e3)}catch(a){var t;this.sendLogServ.sendMaterialPublishPageResultLog({status:"fail",error_type:null!==(t=null==a?void 0:a.message)&&void 0!==t?t:`publish error: ${JSON.stringify(a)}`,time:Math.round(performance.now()-this.startPublishTime),material_cnt:e.materialList.length,material_id:""}),C.FN.error(p.I18n.t("pc_sticker_release_failed_retry_web")),(0,F.RF)("Effects [SingleStore] publish fail",a)}finally{o.setIsPublishing(!1)}},handleEffectFileProcessResult(t){const a=e.getMaterial(t.id);if(a){if(t.type===J.Thumbnail){if(!(t.temporaryId===a.payload.temporary[J.Thumbnail]))return}if("Success"===t.result)switch(t.type){case J.Thumbnail:const{base64:l}=t;e.updateFormState(a,{payload:{...a.payload,thumbImg:`data:;base64,${l}`}});break;case J.UploadEffect:e.updateUploadResp(a,{fileUri:t.uri});break;case J.UploadCover:e.updateUploadResp(a,{imgUri:t.uri});break;default:return}else switch(t.type){case J.Thumbnail:e.updateFormState(a,{payload:{...a.payload,failedType:"updateCoverFailed"}});break;case J.UploadEffect:case J.UploadCover:e.updateFormState(a,{payload:{...a.payload,failedType:"UploadFailed"}});break;default:return}t.type===J.Thumbnail&&e.updateFormState(a,{payload:{...a.payload,coverUpdating:!1}})}}})));return(0,G.u)({watch:()=>o.needConfirmModalOnClose}),(0,u.useEffect)((()=>{window.store=o,window.toJS=w.ZN;const e=Q.registerEffectFileProcessResultEvent(o.handleEffectFileProcessResult);return o.authorSignService.init(),o.performanceTimingCollector.addRenderTiming(H.Pk),()=>{e(),t.destroy()}}),[]),o}const oe=(0,u.createContext)(null),re=()=>(0,u.useContext)(oe);var ne=a(72322);const se=(0,l.Pi)((({className:e})=>{var t,a;const l=function(){const{t:e}=(0,i.$)(),t={link:{text:e("cc_pc_material_visual_effect_publish_guidance_linked_web"),src:"https://bytedance.sg.larkoffice.com/docx/LfCWds6fLoPI3PxTpxJl9iA4gsT?open_in_browser=true"}};return(0,u.useMemo)((()=>{return[{key:d.File,title:e("cc_pc_material_visual_effect_publish_guidance_web"),...t,instructions:(a=d.File,Object.entries(g[a]).map((([e,t])=>({key:e,title:t}))))}];var a}),[])}(),o=re(),r=o.materialListStore.selectedMaterial;return(0,ne.jsx)(n.v,{className:e,groups:l,initGroup:d.File,activeGroup:d.File,resetExpandedGroupKey:null!==(t=null==r||null===(a=r.payload)||void 0===a?void 0:a.localId)&&void 0!==t?t:null,getStatus:e=>{var t;return r?null!==(t=r.payload)&&void 0!==t&&null!==(t=t.unmetRequirements)&&void 0!==t&&t.includes(e.key)?"error":"success":"init"},onClickGroupLink:()=>{o.sendLogServ.sendPageActionLog({action:"click_doc_guide"})}})}));var ce=a(14986),de=a(67509);const ue=(0,l.Pi)((({className:e})=>{const t=re(),{t:a}=(0,i.$)(),l=(0,u.useRef)(null),o=(0,u.useMemo)((()=>t.materialListStore.materialList.length),[t.materialListStore.materialList]),r=(0,u.useMemo)((()=>t.isAllReadyPublish),[t.isAllReadyPublish]);return(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(ce.Z,{className:e,leftText:a("pc_sticker_import_zero_to_hundred_web",{X:o,Y:t.maxTotalCount}),isPublishDisabled:!r,isPublishing:t.isPublishing,needConfirmModalOnClose:t.needConfirmModalOnClose,onPublish:()=>t.uploadAndPublish(l.current),onCancel:()=>{(0,O.Nt)(),t.sendLogServ.sendPageActionLog({action:"cancel"})}}),(0,ne.jsx)(de.q,{ref:l,uploadStats:t.materialListStore.uploadStats,onRetryUpload:t.retryUpload,onCancel:()=>{t.isAllUploadedWatcher.stop(),t.sendLogServ.sendMaterialPublishPageResultLog({status:"cancel",time:Math.round(performance.now()-t.startPublishTime),material_cnt:t.materialListStore.materialList.length,material_id:""})},onShowUploadFail:t.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:t.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var me,pe,fe,ge,_e,he=a(21418),ve=a(40358),ye=a(18751),be=a.n(ye),we=a(48660);function Ce(){return Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)({}).hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Ce.apply(null,arguments)}const xe=e=>u.createElement("svg",Ce({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),me||(me=u.createElement("path",{stroke:"#CCC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 23.5H7.5a1 1 0 0 1-1-1v-15a1 1 0 0 1 1-1h15a1 1 0 0 1 1 1V15"})),pe||(pe=u.createElement("path",{fill:"#CCC",fillRule:"evenodd",d:"M17.8 11.457a2 2 0 0 0 1.513-2.942q.12-.015.243-.015a2 2 0 1 1-1.756 2.957",clipRule:"evenodd"})),fe||(fe=u.createElement("path",{fill:"#CCC",d:"M14.358 15.392a.764.764 0 0 1 .99-.991l1.381.508a.78.78 0 0 0 .742-.103l1.137-.858c.521-.393 1.29.01 1.287.675l-.004 1.452a.83.83 0 0 0 .355.678l1.212.85c.555.39.438 1.23-.195 1.409l-1.384.388a.75.75 0 0 0-.522.522l-.388 1.383c-.178.634-1.02.75-1.409.196l-.85-1.212a.83.83 0 0 0-.678-.355l-1.452.005c-.665.002-1.068-.767-.675-1.288l.858-1.137a.78.78 0 0 0 .103-.742z"})),ge||(ge=u.createElement("rect",{width:2,height:4,x:20.186,y:21.643,fill:"#CCC",rx:1,transform:"rotate(-45 20.186 21.643)"})),_e||(_e=u.createElement("path",{stroke:"#CCC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6.5 18.67 11 14l1.5 1"})));var Le,Ie,Se,Ee,Ae,ze;function Pe(){return Pe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)({}).hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Pe.apply(null,arguments)}const Me=e=>u.createElement("svg",Pe({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),Le||(Le=u.createElement("path",{stroke:"#fff",strokeOpacity:.8,strokeWidth:1.5,d:"M7.886 9.4a4.16 4.16 0 0 0-1.038 3.853l1.086 4.507a7.75 7.75 0 1 0 15.069-3.632l-1.087-4.507a4.16 4.16 0 0 0-2.679-2.957l-.394-.137A10.15 10.15 0 0 0 8.174 9.1z"})),Ie||(Ie=u.createElement("mask",{id:"faceSpecial_svg__a",fill:"#fff"},u.createElement("path",{fillRule:"evenodd",d:"M11.067 14.184a.586.586 0 0 1-.195-.807l.49-.8a.235.235 0 0 0-.078-.323l-.8-.49a.586.586 0 0 1 .612-1l1.5.918c.277.169.364.53.195.806l-.918 1.501a.586.586 0 0 1-.806.194",clipRule:"evenodd"}),u.createElement("path",{d:"M15.994 9.483a.352.352 0 0 1 .616-.149l.408.5c.075.091.19.14.308.127l.641-.066a.352.352 0 0 1 .332.54l-.349.542a.35.35 0 0 0-.026.333l.261.59a.352.352 0 0 1-.411.482l-.623-.164a.35.35 0 0 0-.325.078l-.48.43a.352.352 0 0 1-.586-.242l-.036-.643a.35.35 0 0 0-.175-.285l-.557-.323a.352.352 0 0 1 .049-.633l.6-.233a.35.35 0 0 0 .217-.254z"}),u.createElement("path",{fillRule:"evenodd",d:"M12.957 17.222c-.238-.01-.421.208-.323.424a2.1 2.1 0 0 0 1.078 1.056 3.92 3.92 0 0 0 4.551-1.096 2.1 2.1 0 0 0 .48-1.432c-.012-.237-.274-.347-.481-.23a9.93 9.93 0 0 1-5.305 1.278m-.777-1.206a.867.867 0 0 0-.903.9 3.27 3.27 0 0 0 1.971 2.864 5.09 5.09 0 0 0 5.92-1.427c.797-.965.976-2.31.45-3.447a.867.867 0 0 0-1.214-.39l-.72.407a8.76 8.76 0 0 1-4.678 1.127z",clipRule:"evenodd"}))),Se||(Se=u.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M11.067 14.184a.586.586 0 0 1-.195-.807l.49-.8a.235.235 0 0 0-.078-.323l-.8-.49a.586.586 0 0 1 .612-1l1.5.918c.277.169.364.53.195.806l-.918 1.501a.586.586 0 0 1-.806.194",clipRule:"evenodd"})),Ee||(Ee=u.createElement("path",{fill:"#fff",d:"M15.994 9.483a.352.352 0 0 1 .616-.149l.408.5c.075.091.19.14.308.127l.641-.066a.352.352 0 0 1 .332.54l-.349.542a.35.35 0 0 0-.026.333l.261.59a.352.352 0 0 1-.411.482l-.623-.164a.35.35 0 0 0-.325.078l-.48.43a.352.352 0 0 1-.586-.242l-.036-.643a.35.35 0 0 0-.175-.285l-.557-.323a.352.352 0 0 1 .049-.633l.6-.233a.35.35 0 0 0 .217-.254z"})),Ae||(Ae=u.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M12.957 17.222c-.238-.01-.421.208-.323.424a2.1 2.1 0 0 0 1.078 1.056 3.92 3.92 0 0 0 4.551-1.096 2.1 2.1 0 0 0 .48-1.432c-.012-.237-.274-.347-.481-.23a9.93 9.93 0 0 1-5.305 1.278m-.777-1.206a.867.867 0 0 0-.903.9 3.27 3.27 0 0 0 1.971 2.864 5.09 5.09 0 0 0 5.92-1.427c.797-.965.976-2.31.45-3.447a.867.867 0 0 0-1.214-.39l-.72.407a8.76 8.76 0 0 1-4.678 1.127z",clipRule:"evenodd"})),ze||(ze=u.createElement("path",{fill:"#fff",fillOpacity:.8,d:"m10.872 13.377.853.522zm-.388-1.612.521-.854zm.612-1.001-.522.853zm1.5.918-.521.853zm.195.806.853.522zm-.918 1.501-.853-.522zm-.511-1.412-.853-.522zm-.078-.323-.522.853zm4.358-1.887-.362-.932zm.216-.254-.977-.21zm-.866 1.12-.502.865zm.049-.633.362.932zm.683 1.24.998-.055zm-.175-.284.502-.865zm.797 1.17.668.745zm-.586-.242-.998.056zm1.39-.266.256-.967zm-.324.078-.668-.744zm1.36-.397.914-.404zm-.412.483-.255.967zm.176-1.405.841.542zm-.026.333-.914.405zm.043-1.415.103.995zm.332.54-.84-.541zm-1.281-.602-.775.633zm.308.128-.102-.995zm-.716-.627.775-.632zm-.616.149.977.21zm-2.282 9.22.396-.919zm4.551-1.097-.77-.637zm-.001-1.662.492.87zm-5.305 1.278.041-.999zm-1.68-.306-1 .04zm.903-.9.042-1zm1.068 3.764-.396.918zm5.92-1.427.77.637zm.45-3.447-.908.42zm-1.214-.39.492.87zm-.72.407-.492-.87zm-4.678 1.127-.042 1zm5.736.124-.999.045zm-6.108 1.472.91-.415zm-2.615-4.79a1.586 1.586 0 0 0 .526 2.18l1.043-1.706c.195.12.257.374.137.569zm.49-.801-.49.8 1.706 1.044.49-.8zm-.547.563.8.49 1.044-1.707-.8-.49zm-.526-2.181a1.586 1.586 0 0 0 .526 2.18l1.043-1.706c.195.12.257.374.137.57zm2.181-.526a1.586 1.586 0 0 0-2.18.526l1.706 1.043a.414.414 0 0 1-.57.137zm1.501.918-1.5-.918-1.044 1.706 1.5.918zm.526 2.181a1.586 1.586 0 0 0-.526-2.181l-1.043 1.706a.414.414 0 0 1-.137-.569zm-.918 1.501.918-1.501-1.706-1.043-.918 1.5zm-2.181.526a1.586 1.586 0 0 0 2.181-.526l-1.706-1.043a.413.413 0 0 1 .568-.138zm1.67-1.939a1.235 1.235 0 0 0-.41-1.697l-1.043 1.706a.765.765 0 0 1-.253-1.052zm3.62-3.132.408.5 1.55-1.265-.408-.499zm1.594.99.641-.066-.205-1.99-.641.066zm.03-1.062-.35.542 1.682 1.083.349-.542zm-.449 1.821.261.59 1.829-.81-.261-.59zm1.02-.3-.624-.164-.51 1.934.623.164zm-1.872.137-.48.43 1.336 1.489.48-.43zm.6.876-.036-.643-1.997.112.037.643zm-.707-1.737-.558-.323-1.003 1.73.557.323zm-.648.841.6-.233-.723-1.864-.6.233zm1.433-1.21.135-.63-1.955-.419-.135.63zm-.833.977c.425-.164.738-.531.833-.976l-1.955-.42a.65.65 0 0 1 .399-.468zm-.51-.931a.648.648 0 0 1-.09 1.164l-.724-1.864c-1.057.41-1.17 1.86-.189 2.43zm1.23 1.417a1.35 1.35 0 0 0-.672-1.094l-1.003 1.73a.65.65 0 0 1-.322-.524zm-1.044.197a.648.648 0 0 1 1.08.446l-1.997.112c.063 1.132 1.408 1.688 2.252.93zm1.727-.731a1.35 1.35 0 0 0-1.248.3l1.336 1.49a.65.65 0 0 1-.599.143zm-.135 1.053a.648.648 0 0 1 .758-.889l-.51 1.934c1.096.29 2.04-.818 1.58-1.854zm-.161-1.868a1.35 1.35 0 0 0-.1 1.28l1.829-.81c.088.199.07.43-.048.613zm.96.454a.648.648 0 0 1-.611-.996l1.681 1.083c.614-.953-.147-2.193-1.275-2.077zm-1.827-.424c.288.352.733.536 1.186.49l-.205-1.99a.65.65 0 0 1 .569.235zm1.142-1.764c-.717-.879-2.131-.538-2.37.571l1.956.42a.648.648 0 0 1-1.136.273zm-3.277 9.082a1.1 1.1 0 0 1-.564-.553l-1.82.83a3.1 3.1 0 0 0 1.592 1.56zm3.385-.815a2.92 2.92 0 0 1-3.385.815l-.792 1.837a4.92 4.92 0 0 0 5.718-1.378zm.25-.75a1.1 1.1 0 0 1-.25.75l1.541 1.274a3.1 3.1 0 0 0 .707-2.113zm-4.828 2.002c2.04.086 4.062-.402 5.84-1.407l-.986-1.74a8.93 8.93 0 0 1-4.77 1.15zm-.639-1.344a.133.133 0 0 1-.138.138l.084-1.998a1.867 1.867 0 0 0-1.944 1.938zm1.368 1.984a2.27 2.27 0 0 1-1.368-1.984l-1.998.078a4.27 4.27 0 0 0 2.574 3.743zm4.753-1.145a4.09 4.09 0 0 1-4.753 1.145l-.792 1.837a6.09 6.09 0 0 0 7.086-1.708zm.313-2.39a2.27 2.27 0 0 1-.313 2.39l1.541 1.274a4.27 4.27 0 0 0 .587-4.504zm.186.06a.133.133 0 0 1-.186-.06l1.815-.84a1.867 1.867 0 0 0-2.614-.84zm-.72.407.72-.407-.985-1.74-.72.406zm-5.212 1.256a9.76 9.76 0 0 0 5.213-1.256l-.985-1.74a7.76 7.76 0 0 1-4.145.998zm-.826-.034.826.034.083-1.998-.825-.034zm7.603-.886a1.28 1.28 0 0 0-.748-1.112 1.35 1.35 0 0 0-1.224.056l.985 1.741a.65.65 0 0 1-.596.021.72.72 0 0 1-.415-.616zm-6.197 1.102a.72.72 0 0 1-.09.738.65.65 0 0 1-.54.252L13 16.223a1.35 1.35 0 0 0-1.115.507 1.28 1.28 0 0 0-.16 1.331z",mask:"url(#faceSpecial_svg__a)"})));a.p;var Fe;function Te(){return Te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)({}).hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Te.apply(null,arguments)}const ke=e=>u.createElement("svg",Te({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),Fe||(Fe=u.createElement("path",{fill:"#fff",fillOpacity:.8,fillRule:"evenodd",d:"M7.5 8.5h14.3v13.282H7.5zM6 7h17.3v16.282H6V7m10.655 8-2.905 1.756v-3.512zm-3.544-3.75a.86.86 0 0 0-.861.862v5.776a.863.863 0 0 0 1.307.738l4.777-2.888a.862.862 0 0 0 0-1.476l-4.777-2.888a.86.86 0 0 0-.446-.124",clipRule:"evenodd"})));var Ne;function Ue(){return Ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)({}).hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Ue.apply(null,arguments)}const je=e=>u.createElement("svg",Ue({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),Ne||(Ne=u.createElement("path",{stroke:"#D4D4D4",strokeLinejoin:"bevel",strokeWidth:1.6,d:"M7 21.625 24 7v14.625L7 7z",clipRule:"evenodd"})));var Re=a(18329),Ze=a(12247),Oe=a(77991),qe=a(92644),Be=a(17150),De=a(37964),$e=a(71410),Ve=a(7890);const We=e=>{const{className:t,loadingText:a}=e,{t:l}=(0,i.$)(),{handleMouseEnter:o}=(0,De.S)();return(0,ne.jsxs)("div",{className:be()(Ve.Z.root,t),children:[(0,ne.jsx)(Be.a,{className:Ve.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,ne.jsx)("div",{className:Ve.Z.text,onMouseEnter:o,children:a||l("pc_stickers_release_in_web")})]})},Je=e=>{const{className:t,tooltip:a}=e,{t:l}=(0,i.$)(),{handleMouseEnter:o}=(0,De.w)({content:a,className:Ve.Z.tooltip}),r=(0,u.useRef)(null),{setIsMarqueeLoopRunning:n,reactNode:s}=(0,$e.J)({text:l("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>r.current});return(0,ne.jsxs)("div",{className:be()(Ve.Z.root,t,Ve.Z.error),onMouseEnter:e=>{n(!0),o(e)},onMouseLeave:()=>n(!1),children:[(0,ne.jsx)(Ze.r,{className:Ve.Z.icon}),(0,ne.jsx)("div",{ref:r,className:Ve.Z.text,children:s})]})},Ye=e=>{const{className:t,text:a}=e,{handleMouseEnter:l}=(0,De.S)();return(0,ne.jsxs)("div",{className:be()(Ve.Z.root,t,Ve.Z.checked),children:[(0,ne.jsx)(qe.r,{className:Ve.Z.icon}),(0,ne.jsx)("div",{className:Ve.Z.text,onMouseEnter:l,children:a})]})},Ge=e=>{const{className:t}=e,{t:a}=(0,i.$)(),{handleMouseEnter:l}=(0,De.S)();return(0,ne.jsxs)("div",{className:be()(Ve.Z.root,t),children:[(0,ne.jsx)("div",{className:be()(Ve.Z.icon,Ve.Z.yellowIcon),children:(0,ne.jsx)("div",{className:Ve.Z.yellowPoint})}),(0,ne.jsx)("div",{className:Ve.Z.text,onMouseEnter:l,children:a("pc_stickers_release_editing_web")}),(0,ne.jsx)(Oe.r,{className:Ve.Z.icon})]})},He=e=>{const{className:t,loading:a,invalid:l,errorToolip:i,isInfoComplete:o,title:r,loadingText:n}=e;return a?(0,ne.jsx)(We,{className:t,loadingText:n}):l?(0,ne.jsx)(Je,{className:t,tooltip:i}):o?(0,ne.jsx)(Ye,{className:t,text:r}):(0,ne.jsx)(Ge,{className:t})};var Xe=a(84133),Ke=a(33921);const Qe="root-dTVjo3",et="statusBar-s3NSaI",tt="contextMenuItem-AyAlEH",at="coverIcon-_65uTe",lt=(0,l.Pi)((({className:e,material:t,isSelected:a,onClick:l,onReimport:o,onRemove:r,effectType:n,isInfoComplete:s,onRetryUpdateCover:c})=>{var u;const{t:m}=(0,i.$)(),{common_data:p}=t,{coverUpdating:f}=t.payload,_=t.payload.thumbImg,h=Boolean(null===(u=t.payload)||void 0===u||null===(u=u.unmetRequirements)||void 0===u?void 0:u.length),v="updateCoverFailed"===t.payload.failedType,y=h||v,{handleContextMenu:b}=(0,Ke.D)({content:(0,ne.jsx)(Xe.m,{items:[{key:"retryUpdateCover",render:({key:e,className:a})=>Boolean(v)&&(0,ne.jsx)("div",{className:be()(a,tt),onClick:()=>c(t),children:m("cc_pc_material_visual_effect_publish_cover_retry_web")},e)},{key:"reimport",render:({key:e,className:a})=>Boolean(y)&&(0,ne.jsx)("div",{className:be()(a,tt),onClick:()=>o(t),children:m("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:a})=>(0,ne.jsx)("div",{className:be()(a,tt),onClick:()=>r(t),children:m("pc_stickers_release_delete_web")},e)}]})});return(0,ne.jsxs)("div",{className:be()(e,Qe),onClick:()=>{var e;l(null===(e=t.payload)||void 0===e?void 0:e.localId)},children:[(0,ne.jsx)(Re.Y,{src:f?"":t.payload.thumbImg,customRenderIcon:(()=>{if(!_&&!f)return()=>{switch(n){case E.Ab.Special:return(0,ne.jsx)(xe,{className:at});case E.Ab.FaceSpecial:return(0,ne.jsx)(Me,{className:at});case E.Ab.VideoAnimation:return(0,ne.jsx)(ke,{className:at});case E.Ab.Transition:return(0,ne.jsx)(je,{className:at});default:return null}}})(),isSelected:a,isInvalid:Boolean(y),size:80,onContextMenu:e=>{var a;b(e),l(null===(a=t.payload)||void 0===a?void 0:a.localId)}}),(0,ne.jsx)(He,{className:et,loading:f,loadingText:m("cc_pc_material_visual_effect_publish_cover_fail_updating_web"),invalid:y,errorToolip:h?null===(w=t.payload)||void 0===w||null===(w=w.unmetRequirements)||void 0===w?void 0:w.map((e=>{const t=g[d.File][e];return t?(0,ne.jsx)("div",{children:t},e):null})):v?m("cc_pc_material_visual_effect_publish_cover_fail_web"):null,isInfoComplete:s,title:p.title})]});var w})),it="root-tZNHZs",ot="container-x9pyNI",rt="cardDragWrapper-szN40I",nt="card-DcrvQZ",st="hover-right-YTbO59",ct="hover-left-C7z4sq",dt=(0,l.Pi)((()=>{const e=re(),{materialListStore:t}=e,a=(0,u.useCallback)((e=>{t.selectedId!==e.payload.localId&&t.selectMaterial(e.payload.localId)}),[t.selectMaterial]),l=(0,u.useCallback)(((a,l)=>{var i;return(0,ne.jsx)(lt,{className:be()(nt,{[st]:"right"===l,[ct]:"left"===l}),material:a,onClick:e.materialListStore.selectMaterial,isSelected:e.materialListStore.selectedId===a.payload.localId,onRemove:e.materialListStore.removeMaterial,onReimport:e.reimport,effectType:a.effect_type,isInfoComplete:t.getIsInfoComplete(a),onRetryUpdateCover:t.retryUpdateCover},null===(i=a.payload)||void 0===i?void 0:i.localId)}),[e.reimport,e.materialListStore.selectMaterial,e.materialListStore.removeMaterial,e.materialListStore.selectedId]);return(0,ne.jsx)("div",{className:it,children:(0,ne.jsx)("div",{className:ot,children:(0,ne.jsx)(we.y,{list:t.materialList,renderCard:l,onMoveCard:t.dragInsert,className:rt,getId:e=>e.payload.localId,scrollAreaRef:e.materialListStore.scrollAreaRef,onCardClick:a})})})}));var ut=a(48055),mt=a(54275),pt=a(13928),ft=a(66795);const gt="textarea-LCPYTj",_t=e=>{var t;const a=(0,u.useRef)(!1),[l,i]=(0,u.useState)(""),{allowEnter:o=!0,value:r,...n}=e,{className:s,maxLength:c,onChange:d,onCompositionEnd:m,onCompositionStart:p}=n,f=a.current?l:r,g=(0,mt.Z)((e=>{const t=e||"";return o?t:t.replace(/\n/g,"")})),_=(0,mt.Z)((e=>{const t=g(e);return void 0!==c?(0,pt.aF)(t,c):t})),h=(0,mt.Z)((e=>{a.current=!0,i(e.currentTarget.value),null==p||p(e)})),v=(0,u.useRef)(null),{saveSelectionIfNeeded:y}=(0,ft.u)({getInputElem:()=>v.current}),b=(0,mt.Z)(((e,t)=>{y(e),null==d||d(e,t)})),w=(0,mt.Z)((e=>{const t=_(e.currentTarget.value);a.current=!1,i(t),b(t,e),null==m||m(e)})),x=(0,mt.Z)(((e,t)=>{const l=g(e);if(a.current)return void i(l);if(void 0===c)return void b(l,t);const o=_(l);b(o,t)})),L=(0,u.useMemo)((()=>({maxRows:3})),[]);return(0,ne.jsx)(C.Kx,{autoComplete:"off",...n,ref:v,value:f,className:be()(s,gt),maxLength:void 0,autosize:null!==(t=n.autosize)&&void 0!==t?t:L,rows:1,onChange:x,onCompositionStart:h,onCompositionEnd:w})},ht=(0,C.Q2)(_t);a(94443);var vt=a(54970),yt=a(56230);const bt="authGroup-Yuaspf";var wt=a(46796);const Ct=e=>{const{t}=(0,i.$)(),{className:a,boxClassName:l,title:o,children:r,onClickUseAll:n,hiddenFieldLabel:s=!1,required:c=!1}=e;return(0,ne.jsxs)("div",{className:be()(wt.Z.root,a),children:[!s&&(0,ne.jsxs)("div",{className:wt.Z.fieldLabel,children:[(0,ne.jsx)("div",{className:be()({[wt.Z.showRequired]:c}),children:null!=o?o:t("pc_template_authorize_settings_web")}),n&&(0,ne.jsx)("span",{className:wt.Z.useAll,onClick:n,children:t("pc_material_release_apply_all")})]}),(0,ne.jsx)("div",{className:be()(wt.Z.box,l),children:r})]})};var xt=a(13199),Lt=a(34549),It=a(45220),St=a(43792),Et=a(73858);const At="root-gQdqRP",zt="rootCategory-gHMpjw",Pt="secondCategoryWrapper-UM_jLd",Mt="secondCategory-t3M31B",Ft=e=>{const{value:t,onChange:a,categories:l,loading:o,effectType:r}=e,n=(0,u.useRef)(""),[s,c]=(0,St.Z)(void 0,{dimension:"width"}),{handleMouseEnter:d,destroyTooltip:m}=(0,De.w)({content:n.current}),{t:p}=(0,i.$)(),{handleMouseEnter:f}=(0,De.S)();return(0,ne.jsxs)("div",{className:At,children:[(0,ne.jsx)("div",{className:zt,onMouseEnter:f,children:(()=>{switch(r){case E.Ab.Special:return p("cc_pc_material_visual_effect_type_video_effect_web");case E.Ab.FaceSpecial:return p("cc_pc_material_visual_effect_type_body_effect_web");case E.Ab.Transition:return p("cc_pc_material_visual_effect_type_transition_web");case E.Ab.VideoAnimation:return p("cc_pc_material_visual_effect_type_animation_web");default:return""}})()}),(0,ne.jsx)("div",{className:Pt,ref:s,children:(0,ne.jsx)(C.Ph,{value:t,loading:o,className:Mt,placeholder:p("cc_pc_material_visual_effect_type_category_web"),optionList:l.map(((e,t)=>({value:e.id,label:e.name,desc:e.desc,key:t,fadeInUrl:e.fade_in_url,fadeOutUrl:e.fade_out_url}))),renderOptionItem:t=>{const{label:l,desc:i,value:o,onClick:r,fadeInUrl:s,fadeOutUrl:u}=t,p=o===e.value;return(0,ne.jsxs)("div",{className:"custom-select-option",onMouseEnter:e=>((e,t)=>{t&&(n.current=t,d(e))})(e,i),onClick:e=>{null==r||r(e),null==a||a({categoryId:o,categoryName:l,fadeInUrl:s,fadeOutUrl:u}),n.current="",m()},style:{maxWidth:c.width-12},children:[p&&(0,ne.jsx)(Et.r,{className:"checkedIcon"}),!p&&(0,ne.jsx)("div",{className:"placeholder"}),l]})}})})]})},Tt="root-KVaL4a",kt="coverWrapper-IJ2U5k",Nt="box-l32ETe",Ut="img-UsMa71",jt="label-iZB0vG",Rt="useAll-euWGNE",Zt="initialCover-TMGtxi",Ot="coverDesc-c6sUQG",qt="titleLabel-DBP9RC",Bt="titleName-aHymLh",Dt="titleIcon-kLKwkO",$t="input-oQfVTZ",Vt="icon-WX0oFX",Wt="publishDirectionUseAll-z6m7mf",{Label:Jt}=C.Form,Yt=(0,l.Pi)((({material:e,materialListStore:t,formApi:a,authProps:l,sendLogServ:o})=>{var r,n,s;const{t:c}=(0,i.$)(),{payload:d,effect_type:m}=e,{coverUpdating:p,categoryId:f,targetedActivityId:g}=d,{effectsPostConfigMap:_}=t,{authConfig:h,resourceCommonConfig:v}=_[e.effect_type],{mustPaidAuth:y}=h,b=v.maxTitleLen||15,{value:w}=(0,C.tL)("common_data.title"),{value:x}=(0,C.tL)("common_data.post_channel"),[L,I]=(0,u.useState)({}),[S,E]=(0,u.useState)({});(0,u.useLayoutEffect)((()=>(null==a||a.reset(),null==a||a.setValues(e,{isOverride:!0}),()=>{const l=null==a?void 0:a.getValues();l&&t.updateFormState(e,{is_vip:l.is_vip||!1,common_data:{...e.common_data,title:l.common_data.title||"",post_channel:l.common_data.post_channel,description:l.common_data.description,tags:l.common_data.tags,is_original:l.common_data.is_original||!1,is_business:l.common_data.is_business||!1}})})),[e]),(0,u.useEffect)((()=>{L[m]||async function(e){return(await(0,T.ip)({effect_type:e})).tasks.map((e=>({label:e.title,value:e.task_id})))}(m).then((e=>{I((t=>({...t,[m]:e})))})),S[m]||async function(e){return(await(0,T.kM)({effect_type:e})).categories}(m).then((e=>{E((t=>({...t,[m]:e})))}))}),[m]),(0,u.useEffect)((()=>{M.$.isEnableAuthorization&&z(!0)}),[M.$.isEnableAuthorization]);const{getDisplayLength:A}=(0,yt._)(),z=l=>{t.updateFormState(e,{is_vip:l}),null==a||a.setValue("is_vip",l)},P=(e,t)=>(0,ne.jsxs)("div",{className:qt,children:[(0,ne.jsx)("span",{className:Bt,children:e}),(0,ne.jsx)(C.u,{autoAdjustOverflow:!0,content:t,position:"right",showArrow:!1,trigger:"hover",children:(0,ne.jsx)("span",{children:(0,ne.jsx)(ut.r,{className:Dt})})})]});return(0,ne.jsxs)("div",{className:Tt,children:[(0,ne.jsx)("div",{className:kt,children:(0,ne.jsxs)("div",{className:Nt,children:[p?(0,ne.jsx)(xt.t,{className:Vt,iconWidth:28}):d.thumbImg?(0,ne.jsx)("img",{className:Ut,src:d.thumbImg}):(0,ne.jsx)("div",{className:Zt,children:c("cc_pc_material_visual_effect_publish_preview_note_web")}),(0,ne.jsx)("div",{className:Ot,children:c("cc_pc_material_visual_effect_publish_preview_bottom_web")})]})}),(0,ne.jsx)(ht,{fieldClassName:$t,label:P(c("cc_pc_material_visual_effect_publish_name_web"),c("cc_pc_material_visual_effect_publish_name_hover_web")),field:"common_data.title",maxLength:b,placeholder:c("pc_stickers_release_xy_name_web",{X:1,Y:A(b)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:a=>((a,l)=>{t.updateFormState(e,{common_data:{...e.common_data,[l]:a}})})(a,"title")}),(0,ne.jsxs)("div",{className:jt,children:[(0,ne.jsx)(Jt,{required:!0,text:P(c("cc_pc_material_visual_effect_type_web"),c("cc_pc_material_visual_effect_type_hover_web"))}),(0,ne.jsx)(Ft,{effectType:m,value:f,onChange:a=>{f?o.sendPageActionLog({action:"change_effect_category"}):o.sendPageActionLog({action:"choose_effect_category"}),e.payload.coverImgUrls={fadeInUrl:a.fadeInUrl,fadeOutUrl:a.fadeOutUrl},e.payload.categoryId=a.categoryId,e.payload.categoryName=a.categoryName,t.setEffectCoverImage(e)},categories:null!==(r=S[m])&&void 0!==r?r:[],loading:!(null!==(n=S[m])&&void 0!==n&&n.length)})]}),(0,ne.jsxs)("div",{className:jt,children:[(0,ne.jsx)(It.u,{fieldClassName:$t,label:c("pc_stickers_release_tag_set_web"),placeholder:c("cc_pc_material_visual_effect_tag_grey_web"),max:10,field:"common_data.tags",onChange:l=>{const i={...e.common_data,tags:l};t.updateFormState(e,{common_data:i}),null==a||a.setValue("common_data",i)},itemType:m,recommendConfig:{title:w},rules:[{required:!0,message:""}],onRecentTagSelect:()=>{o.sendPageActionLog({action:"click_lastest_hashtag"})},disableRecommend:!0}),(0,ne.jsx)("span",{className:Rt,onClick:()=>{o.sendPageActionLog({action:"apply_hashtag_to_all"});const e=null==a?void 0:a.getValues();e&&t.applyCommonDataToAll({tags:e.common_data.tags})},children:c("pc_material_release_apply_all")})]}),(0,ne.jsxs)("div",{className:jt,children:[(0,ne.jsx)(Jt,{required:!0,text:c("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,ne.jsx)(Lt.Z,{value:{postChannel:x,activityId:g},onChange:l=>{const i={...e.common_data,post_channel:l.postChannel};t.updateFormState(e,{common_data:i}),null==a||a.setValue("common_data",i),e.payload.targetedActivityId=l.activityId},taskList:L[m]||[],loading:!(null!==(s=L[m])&&void 0!==s&&s.length),viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/LFfKdQUOOogNLExPM4zl0nXGgsi?open_in_browser=true",onOrientationViewMoreClick:()=>{o.sendPageActionLog({action:"click_more_official_task"})}}),(0,ne.jsx)("span",{className:Wt,onClick:()=>{o.sendPageActionLog({action:"apply_publish_type_to_all"});const e=null==a?void 0:a.getValues();e&&(t.applyCommonDataToAll({post_channel:e.common_data.post_channel}),t.applyPayloadDataToAll({targetedActivityId:g}))},children:c("pc_material_release_apply_all")})]}),!1,l&&(0,ne.jsx)(Ct,{onClickUseAll:()=>{o.sendPageActionLog({action:"authorize_apply_to_all "});const e=null==a?void 0:a.getValues();e&&t.applyAuthSettingsToAll({isVip:e.is_vip,isOriginal:e.common_data.is_original,isBusiness:e.common_data.is_business})},required:y,title:c("cc_pc_material_visual_effect_publish_authorization_web"),children:(0,ne.jsx)("div",{className:bt,children:(0,ne.jsx)(vt.R,{noLabel:!0,field:"is_vip",disabled:M.$.isEnableAuthorization,disabledTooltip:c("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:y?c("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:o,onChange:e=>{e&&o.sendPageActionLog({action:"choose_subscription_authorize"}),z(e)}})})})]})})),Gt=(0,l.Pi)((({className:e})=>{const t=re(),{t:a}=(0,i.$)(),l=(0,u.useCallback)((()=>t.materialListStore.selectedMaterial&&(0,ne.jsx)(Yt,{material:t.materialListStore.selectedMaterial,materialListStore:t.materialListStore,formApi:t.formApi,authProps:(0,X.Z)(t,"authorSignService","authFileUploadServiceManager"),sendLogServ:t.sendLogServ})),[t.materialListStore.selectedMaterial,t.materialListStore,t.formApi]);return(0,o.pg)(t),(0,he.O)({className:e,layout:t.mainFormLayout,uploadAreaProps:{titleForUploadArea:a("pc_sticker_release_drag_web"),titleForMainForm:a("pc_stickers_release_drag_in_web"),subTitle:a("cc_pc_material_visual_effect_publish_guidance_zip_web"),draggingTitle:a("pc_sticker_release_mouse_web"),disabled:t.isImportDisabled,disabledTooltip:"",onClick:t.openEffectPicker,onDrop:t.uploadDroppedEffectFiles},setFormApi:t.setFormApi,renderImportArea:e=>(0,ne.jsxs)(ne.Fragment,{children:[e,(0,ne.jsx)(dt,{})]}),renderFormArea:l,scrollAreaRef:t.materialListStore.scrollAreaRef,onRetry:ve.cb})}));var Ht=a(90856);const Xt="page-gReLnA",Kt="content-zqASBO",Qt="requirement-cAMPWF",ea="mainForm-cORglw",ta="footer-rHRMuw",aa=(0,l.Pi)((()=>{const e=ie(),{t}=(0,i.$)();return(0,r.F)({title:t("cc_pc_material_visual_effect_publish_title_web"),pid:"effects-publish-single"}),(0,Ht.d)(),(0,o.t9)(e.sendLogServ),(0,ne.jsx)(oe.Provider,{value:e,children:(0,ne.jsxs)("div",{className:Xt,children:[(0,ne.jsxs)("div",{className:Kt,children:[(0,ne.jsx)(se,{className:Qt}),(0,ne.jsx)(Gt,{className:ea})]}),(0,ne.jsx)(ue,{className:ta})]})})}))},23818:(e,t,a)=>{a.d(t,{YB:()=>o,xB:()=>i});var l=a(13928);function i(e){const{len:t,i18n:a}=e,[l]=(a.language||"").split("-");return"zh"===l?Math.floor(t/2):t}function o(e,t){const a=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,l.aF)(a,null==t?void 0:t.maxLength)}}}]);